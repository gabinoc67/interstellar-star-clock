<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cash Five Pattern Coach — 3+ Hit Learning (1–35, 5 numbers, 10 tickets)</title>
<style>
  :root{
    --bg:#0b1222;
    --panel:#121a33;
    --ink:#edf2ff;
    --muted:#a9b7e3;
    --accent:#8fb4ff;
    --grid:#1b2550;
    --chip:#1e2a59;
    --warn:#ffd37a;
    --bad:#ff8c8c;
    --good:#7bffb1;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1200px;margin:0 auto;padding:16px}
  h1{margin:6px 0 4px;font-size:1.6rem}
  .tagline{margin:0 0 12px;color:var(--muted);font-size:0.9rem}
  .grid{display:grid;grid-template-columns:1.3fr 1fr;gap:16px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  section{background:var(--panel);border:1px solid var(--grid);border-radius:10px;padding:12px}
  h2{margin:0 0 8px;font-size:1.05rem}
  label{font-size:0.85rem;color:var(--muted);display:block;margin-bottom:4px}
  textarea{
    width:100%;min-height:90px;background:#070c19;color:var(--ink);
    border:1px solid var(--grid);border-radius:8px;padding:8px;
    font-family:ui-monospace,Consolas,monospace;font-size:0.8rem;resize:vertical;white-space:pre;
  }
  textarea.small{min-height:70px}
  .hint{font-size:0.75rem;color:var(--muted);margin:4px 0 8px}
  .btn-row{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0}
  button{
    border:none;border-radius:999px;padding:7px 14px;font-size:0.85rem;cursor:pointer;
    background:var(--chip);color:var(--ink)
  }
  button.primary{background:var(--accent);color:#050816;font-weight:600}
  button.ghost{background:transparent;border:1px solid var(--grid)}
  button:disabled{opacity:0.55;cursor:not-allowed}
  .summary{margin-top:8px;padding:8px;border-radius:8px;background:#0c1630;border:1px dashed var(--grid);font-size:0.8rem}
  .summary strong{color:var(--accent)}
  .pill-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
  .pill{font-size:0.7rem;padding:2px 8px;border-radius:999px;border:1px solid var(--grid);background:#0a142b;color:var(--muted)}
  .pill.good{border-color:var(--good);color:var(--good)}
  .pill.bad{border-color:var(--bad);color:var(--bad)}
  .tiny-diag{margin-top:4px;font-size:0.78rem;color:var(--muted)}
  .tiny-diag.safe{color:var(--good)}
  .tiny-diag.risky{color:var(--bad)}
  .tiny-diag.hot{color:var(--warn)}
  .spread{margin-top:6px;font-size:0.75rem;color:var(--muted)}
  .spread.tight{color:var(--bad)}
  .spread.loose{color:var(--warn)}
  .spread.balanced{color:var(--good)}
  .footer-note{margin-top:12px;font-size:0.72rem;color:var(--muted)}
  .prize-note{margin-top:8px;font-size:0.74rem;color:var(--muted)}
  .ev-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .ev-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .kv{display:flex;justify-content:space-between;gap:10px;padding:6px 8px;border:1px solid var(--grid);border-radius:8px;background:#0a142b;font-size:0.84rem}
  .kv strong{color:var(--accent)}
  input[type="number"]{
    background:#070c19;color:var(--ink);border:1px solid var(--grid);border-radius:8px;padding:6px 8px;font-size:0.85rem
  }
  .table-like{font-size:0.85rem;border:1px solid var(--grid);border-radius:8px;overflow:hidden}
  .table-like header,.table-like .row{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr}
  .table-like header{background:#0a142b;color:var(--muted);padding:6px 8px;font-weight:600}
  .table-like .row{padding:6px 8px;border-top:1px solid var(--grid)}
  .right{text-align:right}
</style>
</head>
<body>
<div class="wrap">
  <h1>Cash Five Pattern Coach — 3+ Hit Learning</h1>
  <p class="tagline">
    Texas Cash Five • 5 numbers • 1–35 • 10 tickets. Uses all history + recent draws + your own 3+ hit rows.
    (Draws Mon–Fri. Prizes: 2/5 = free ticket, 3/5 = $15, 4/5 = $350, 5/5 = $25,000.)
  </p>

  <div class="grid">
    <!-- LEFT: INPUTS + ANALYSIS -->
    <section>
      <h2>1. History input &amp; analysis</h2>

      <label for="allDraws">All historical winning draws (REQUIRED, oldest → newest)</label>
      <textarea id="allDraws" placeholder="Example (one line per draw):&#10;03 12 24 29 35&#10;01 05 18 27 33&#10;... paste ALL Cash Five results you have"></textarea>
      <div class="hint">
        REQUIRED: paste as many past Cash Five draws as you have (months/years). Each line: 5 numbers (1–35), spaces or commas.
      </div>

      <label for="recentDraws">Last ~20 official draws (optional extra weight)</label>
      <textarea id="recentDraws" placeholder="Example (one line per draw):&#10;04 09 13 22 31&#10;02 06 17 25 35&#10;... last 15–25 Cash Five draws (extra bias)"></textarea>
      <div class="hint">Optional: these draws get extra weight as &quot;recent behavior&quot;.</div>

      <label for="ticketsIn">Your past played / generated tickets (250–400+ rows)</label>
      <textarea id="ticketsIn" placeholder="Example (one line per ticket):&#10;02 11 19 24 35&#10;03 12 24 29 35&#10;... all Cash Five tickets you've actually played/tested"></textarea>
      <div class="hint">The code finds which rows hit 3+ against your pasted history and treats them as &quot;good&quot;.</div>

      <div class="btn-row">
        <button class="primary" onclick="analyzeHistory()">Analyze (3+ hits, safe zone &amp; scores)</button>
        <button class="ghost" onclick="clearAll()">Reset all</button>
      </div>

      <div id="summary" class="summary">
        Paste your history, then click <strong>Analyze</strong> to see 3+ hit rate and number scores.
      </div>

      <div id="safeDiag" class="tiny-diag">
        Safe zone target: ~8–20% of your tickets reaching ≥3 matches (3, 4, or 5 hits) across your history.
      </div>

      <div class="prize-note">
        Prize reminder: 2/5 = free Quick Pick (small win, valued at $1), 3/5 = $15, 4/5 = $350, 5/5 = $25,000.
      </div>
    </section>

    <!-- RIGHT: GENERATION + SCORES + PRIZE ESTIMATOR -->
    <section>
      <h2>2. Generate 10 new tickets (biased by history)</h2>

      <label for="ticketsOut">New 10-ticket set (play candidates)</label>
      <textarea id="ticketsOut" class="small" placeholder="After Analyze, click &quot;Generate 10 tickets&quot;."></textarea>

      <div class="btn-row">
        <button class="primary" onclick="generateTickets()">Generate 10 tickets (weighted by scores)</button>
        <button onclick="copyTickets()">Copy tickets</button>
      </div>

      <div id="spreadDiag" class="spread">
        Spread diagnostic will appear here (tight / balanced / loose) after generation.
      </div>

      <div class="summary">
        <strong>Number score bands (how the coach sees the field)</strong>
        <div id="scoreBands" class="pill-row">
          <span class="pill">No scores yet — run Analyze first.</span>
        </div>
      </div>

      <h2 style="margin-top:12px">3. Prize estimator (per draw)</h2>
      <div class="ev-grid">
        <div class="ev-row">
          <label for="evTickets">Tickets per draw</label>
          <input id="evTickets" type="number" min="1" step="1" value="10" oninput="updateEV()"/>
          <button onclick="setEV(10)">10</button>
          <button onclick="setEV(30)">30</button>
          <button onclick="setEV(60)">60</button>
        </div>
        <div class="ev-row">
          <span>Free ticket value locked to <strong>$1</strong>.</span>
        </div>
      </div>

      <div class="table-like" style="margin-top:8px">
        <header>
          <div>Match</div><div class="right">Payout</div><div class="right">Odds</div><div class="right">Exp. Count</div><div class="right">Exp. $</div>
        </header>
        <div id="evRows"></div>
      </div>

      <div class="kv" style="margin-top:8px">
        <div>Total expected return per draw</div>
        <div><strong id="evTotal">$0.00</strong></div>
      </div>

      <div class="footer-note">
        ⚠️ Estimator uses official odds (per ticket): 5/5 1:324,632 • 4/5 1:2,164 • 3/5 1:75 • 2/5 1:8.
        Your number shaping influences variance, not base odds.
      </div>
    </section>
  </div>
</div>

<script>
  // ==== CASH FIVE CONFIG ====
  const MAX_N = 35;           // 1..35
  const NUM_PER_TICKET = 5;   // Cash Five picks
  const TICKETS_TO_GEN = 10;

  // Official odds (per $1 play) & payouts
  const ODDS = { "5":324632, "4":2164, "3":75, "2":8 };
  const PAYOUTS = { "5":25000, "4":350, "3":15, "2":1 }; // Free ticket valued at $1

  let lastScores = null;      // score[1..35]
  let lastAnalyzeInfo = null; // summary/debug info

  // ---------- Helpers ----------
  function parseTickets(raw){
    const lines = raw.split(/[\r\n]+/).map(l=>l.trim()).filter(l=>l.length>0);
    const tickets = [];
    for(const line of lines){
      const nums = line
        .replace(/,/g,' ')
        .split(/\s+/)
        .map(x=>parseInt(x,10))
        .filter(n=>Number.isFinite(n) && n>=1 && n<=MAX_N);
      if(nums.length === NUM_PER_TICKET){
        const uniq = Array.from(new Set(nums)).sort((a,b)=>a-b);
        if(uniq.length === NUM_PER_TICKET){
          tickets.push(uniq);
        }
      }
    }
    return tickets;
  }

  function countMatches(a,b){
    let i=0,j=0,hit=0;
    while(i<a.length && j<b.length){
      if(a[i] === b[j]){ hit++; i++; j++; }
      else if(a[i]<b[j]) i++;
      else j++;
    }
    return hit;
  }

  // ---------- Analysis ----------
  function analyzeHistory(){
    const allDrawsRaw    = document.getElementById('allDraws').value;
    const recentDrawsRaw = document.getElementById('recentDraws').value;
    const ticketsRaw     = document.getElementById('ticketsIn').value;

    const summaryEl = document.getElementById('summary');
    const safeDiagEl= document.getElementById('safeDiag');

    const allDraws    = parseTickets(allDrawsRaw);
    const recentDraws = parseTickets(recentDrawsRaw);
    const tickets     = parseTickets(ticketsRaw);

    if(allDraws.length === 0 || tickets.length === 0){
      summaryEl.innerHTML =
        'You must paste <strong>all historical Cash Five draws</strong> ' +
        'and your <strong>played tickets</strong> to analyze. ' +
        'Each line must have exactly 5 numbers between 1 and 35.';
      safeDiagEl.className = 'tiny-diag';
      safeDiagEl.textContent =
        'Safe zone target: ~8–20% of your tickets reaching ≥3 matches (3, 4, or 5 hits).';
      lastScores = null;
      lastAnalyzeInfo = null;
      updateScoreBands(null);
      return;
    }

    const refDraws = allDraws.concat(recentDraws);

    // Frequencies
    const freqAllDraws    = Array(MAX_N+1).fill(0);
    const freqRecent20    = Array(MAX_N+1).fill(0);
    const freqGoodTickets = Array(MAX_N+1).fill(0);
    const freqBadTickets  = Array(MAX_N+1).fill(0);

    for(const d of allDraws){ for(const n of d) freqAllDraws[n]++; }
    for(const d of recentDraws){ for(const n of d) freqRecent20[n]++; }

    let goodTickets = 0, badTickets = 0;
    const hitHist = [0,0,0,0,0,0]; // 0..5

    for(const t of tickets){
      let bestHit = 0;
      for(const d of refDraws){
        const h = countMatches(t,d);
        if(h>bestHit) bestHit = h;
        if(bestHit === NUM_PER_TICKET) break;
      }
      hitHist[bestHit]++;
      if(bestHit>=3){ goodTickets++; for(const n of t) freqGoodTickets[n]++; }
      else{ badTickets++; for(const n of t) freqBadTickets[n]++; }
    }

    const totalTickets = tickets.length;
    const threePlus = goodTickets;
    const threePlusPct = totalTickets>0 ? (threePlus*100/totalTickets) : 0;

    // Scoring: history + recency + reward good rows − penalize bad rows
    const scores = Array(MAX_N+1).fill(0);
    let anyPos = false;
    for(let n=1;n<=MAX_N;n++){
      let s = 2.0*freqAllDraws[n] + 1.5*freqRecent20[n] + 1.5*freqGoodTickets[n] - 0.5*freqBadTickets[n];
      if(s<0) s = 0;
      if(s>0) anyPos = true;
      scores[n] = s;
    }
    if(!anyPos){ for(let n=1;n<=MAX_N;n++) scores[n] = 1; }

    lastScores = scores;
    lastAnalyzeInfo = {
      allDrawsCount: allDraws.length,
      recentDrawsCount: recentDraws.length,
      totalTickets,
      hitHist,
      threePlus,
      threePlusPct,
    };

    updateScoreBands(scores);

    const lines = [];
    lines.push(
      `Analyzed <strong>${allDraws.length}</strong> all-time draws, ` +
      `<strong>${recentDraws.length}</strong> recent draws, and ` +
      `<strong>${totalTickets}</strong> of your tickets.`
    );
    lines.push(
      `Tickets by best match vs any draw: ` +
      `${hitHist[0]}×0, ${hitHist[1]}×1, ${hitHist[2]}×2, ` +
      `${hitHist[3]}×3, ${hitHist[4]}×4, ${hitHist[5]}×5.`
    );
    lines.push(
      `You had <strong>${threePlus}</strong> tickets reaching ` +
      `<strong>3 or more</strong> matches (~${threePlusPct.toFixed(1)}% of your tickets).`
    );

    let zoneText = '', diagClass = 'tiny-diag';
    if(threePlusPct < 8){ zoneText = 'You are in the <strong>cold / risky zone</strong> (&lt;8% 3+-hit rate). Consider mixing in under-used numbers and checking spacing.'; diagClass += ' risky'; }
    else if(threePlusPct <= 20){ zoneText = 'You are in the <strong>safe zone</strong> (8–20% 3+-hit rate).'; diagClass += ' safe'; }
    else { zoneText = 'You are in a <strong>hot / suspicious zone</strong> (&gt;20% 3+-hit rate). Likely short-term luck; do not overfit.'; diagClass += ' hot'; }
    lines.push(zoneText);

    summaryEl.innerHTML = lines.join('<br>');
    safeDiagEl.className = diagClass;
    safeDiagEl.innerHTML =
      `3+ hit rate: <strong>${threePlusPct.toFixed(1)}%</strong> — ` +
      (threePlusPct < 8 ? 'Below safe zone.' :
       threePlusPct <= 20 ? 'Inside safe zone.' : 'Above safe zone (likely luck).');

    updateEV(); // refresh EV panel
  }

  function updateScoreBands(scores){
    const el = document.getElementById('scoreBands');
    el.innerHTML = '';
    if(!scores){ el.innerHTML = '<span class="pill">No scores yet — run Analyze first.</span>'; return; }
    const vals = scores.slice(1);
    const max = Math.max(...vals), min = Math.min(...vals), span = max - min || 1;
    const bands = { low:0, mid:0, high:0 };
    for(let n=1;n<=MAX_N;n++){
      const norm = (scores[n]-min)/span;
      if(norm < 0.33) bands.low++; else if(norm < 0.66) bands.mid++; else bands.high++;
    }
    const mk = (cls,txt)=>{ const s=document.createElement('span'); s.className='pill '+cls; s.textContent=txt; return s; };
    el.appendChild(mk('bad', `Low-score numbers: ${bands.low}`));
    el.appendChild(mk('', `Mid-score numbers: ${bands.mid}`));
    el.appendChild(mk('good', `High-score numbers: ${bands.high}`));
  }

  // ---------- Ticket Generation ----------
  function weightedPick(scores, usedSet){
    let total = 0;
    for(let n=1;n<=MAX_N;n++){ if(!usedSet.has(n)) total += scores[n]; }
    if(total <= 0){
      while(true){ const r = 1 + Math.floor(Math.random()*MAX_N); if(!usedSet.has(r)) return r; }
    }
    let r = Math.random()*total;
    for(let n=1;n<=MAX_N;n++){
      if(usedSet.has(n)) continue;
      r -= scores[n];
      if(r<=0) return n;
    }
    for(let n=1;n<=MAX_N;n++){ if(!usedSet.has(n)) return n; }
    return 1;
  }

  function generateTickets(){
    const ticketsOutEl = document.getElementById('ticketsOut');
    const spreadDiagEl = document.getElementById('spreadDiag');
    if(!lastScores){ alert('Please run "Analyze" first with your Cash Five draws and tickets.'); return; }

    const scores = lastScores, out = [], allTicketsNums = [];
    for(let t=0;t<TICKETS_TO_GEN;t++){
      const used = new Set();
      while(used.size < NUM_PER_TICKET){ used.add( weightedPick(scores, used) ); }
      const ticket = Array.from(used).sort((a,b)=>a-b);
      out.push(ticket.map(n=>String(n).padStart(2,'0')).join(' '));
      allTicketsNums.push(ticket);
    }
    ticketsOutEl.value = out.join('\n');

    // Spread diagnostic tuned for 1..35 with 5 picks:
    let totalGap=0,gapsCount=0,minGapAll=Infinity,maxGapAll=-Infinity;
    for(const t of allTicketsNums){
      for(let i=1;i<t.length;i++){
        const g = t[i]-t[i-1];
        totalGap += g; gapsCount++;
        if(g<minGapAll) minGapAll=g;
        if(g>maxGapAll) maxGapAll=g;
      }
    }
    const avgGap = gapsCount>0 ? (totalGap/gapsCount) : 0;
    let spreadClass='spread', label='';
    if(avgGap < 6){ spreadClass+=' tight'; label='tight (numbers are bunched)'; }
    else if(avgGap > 9){ spreadClass+=' loose'; label='loose (very spread out)'; }
    else { spreadClass+=' balanced'; label='balanced (mix of gaps)'; }
    spreadDiagEl.className=spreadClass;
    spreadDiagEl.textContent=`Spread: avg gap ~ ${avgGap.toFixed(2)} (min gap ${minGapAll}, max gap ${maxGapAll}) → ${label}.`;
  }

  function copyTickets(){
    const ta = document.getElementById('ticketsOut');
    if(!ta.value.trim()){ alert('No tickets to copy yet. Generate first.'); return; }
    ta.select(); ta.setSelectionRange(0, ta.value.length);
    document.execCommand('copy');
    alert('Generated tickets copied to clipboard.');
  }

  // ---------- Prize Estimator (EV per draw) ----------
  function setEV(n){ document.getElementById('evTickets').value = n; updateEV(); }

  function updateEV(){
    const n = Math.max(1, parseInt(document.getElementById('evTickets').value||'10',10));

    const rowsEl = document.getElementById('evRows');
    rowsEl.innerHTML = '';

    // Expected counts per event = tickets / odds
    const exp2 = n / ODDS["2"];
    const exp3 = n / ODDS["3"];
    const exp4 = n / ODDS["4"];
    const exp5 = n / ODDS["5"];

    const exp$2 = exp2 * PAYOUTS["2"]; // $1 per free ticket
    const exp$3 = exp3 * PAYOUTS["3"];
    const exp$4 = exp4 * PAYOUTS["4"];
    const exp$5 = exp5 * PAYOUTS["5"];

    const fmt = (x)=> (Math.round(x*100)/100).toLocaleString();

    function addRow(match, payout, odds, expCount, expMoney){
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <div>${match}/5</div>
        <div class="right">$${payout}</div>
        <div class="right">1:${odds.toLocaleString()}</div>
        <div class="right">${fmt(expCount)}</div>
        <div class="right">$${fmt(expMoney)}</div>
      `;
      rowsEl.appendChild(row);
    }

    addRow(2, 'Free Ticket ($1)', ODDS["2"], exp2, exp$2);
    addRow(3, 15, ODDS["3"], exp3, exp$3);
    addRow(4, 350, ODDS["4"], exp4, exp$4);
    addRow(5, 25000, ODDS["5"], exp5, exp$5);

    const total = exp$2 + exp$3 + exp$4 + exp$5;
    document.getElementById('evTotal').textContent = `$${fmt(total)}`;
  }

  // ---------- Reset ----------
  function clearAll(){
    document.getElementById('allDraws').value = '';
    document.getElementById('recentDraws').value = '';
    document.getElementById('ticketsIn').value = '';
    document.getElementById('ticketsOut').value = '';
    document.getElementById('summary').innerHTML =
      'Paste your history, then click <strong>Analyze</strong> to see 3+ hit rate and number scores.';
    const safeDiagEl = document.getElementById('safeDiag');
    safeDiagEl.className = 'tiny-diag';
    safeDiagEl.textContent =
      'Safe zone target: ~8–20% of your tickets reaching ≥3 matches (3, 4, or 5 hits).';
    const spreadDiagEl = document.getElementById('spreadDiag');
    spreadDiagEl.className = 'spread';
    spreadDiagEl.textContent =
      'Spread diagnostic will appear here (tight / balanced / loose) after generation.';
    lastScores = null;
    lastAnalyzeInfo = null;
    updateScoreBands(null);
    updateEV();
  }

  // Initialize EV table on load
  updateEV();
</script>
</body>
</html>
