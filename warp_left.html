<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Warp Left Panel</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #0c1424;
      color: #eaf2ff;
      font-family: system-ui, sans-serif;
      height: 100vh;
      overflow: hidden;
    }
    .panel {
      padding: 12px;
      border-bottom: 1px solid #1e293b;
    }
    .panel h2 {
      margin: 0 0 8px;
      font-size: 15px;
      color: #60a5fa;
    }
    canvas {
      display: block;
      max-width: 100%;
      border-radius: 8px;
      background: #0a1322;
      margin-top: 6px;
    }
    .stat { font-size: 13px; margin-top: 4px; color: #a7b9df; }
  </style>
</head>
<body>
  <div class="panel">
    <h2>Einstein Tensor Mini</h2>
    <canvas id="grCanvas" width="400" height="110"></canvas>
    <div class="stat">g_tt min: <span id="gr_gtt">—</span></div>
    <div class="stat">ρ_em min/max: <span id="gr_rho">—</span></div>
    <div class="stat">EC: <span id="gr_ec">—</span></div>
    <div class="stat">Horizons: <span id="gr_hor">—</span></div>
  </div>
  <div class="panel">
    <h2>Gravity Vectoring Engine</h2>
    <canvas id="gveCanvas" width="400" height="140"></canvas>
    <div class="stat" id="gveStatus">Standby</div>
  </div>
  <div class="panel">
    <h2>Trajectory & Field Vectors</h2>
    <canvas id="trajectoryCanvas" width="400" height="140"></canvas>
    <div class="stat" id="trajectoryStatus">Route: Earth → ...</div>
  </div>

<script>
  // Constants
  const C_MPS = 299792458;
  const MU0 = 4 * Math.PI * 1e-7;

  // DOM elements
  const grCanvas = document.getElementById("grCanvas");
  const gveCanvas = document.getElementById("gveCanvas");
  const trajectoryCanvas = document.getElementById("trajectoryCanvas");
  const gttLabel = document.getElementById("gr_gtt");
  const rhoLabel = document.getElementById("gr_rho");
  const ecLabel = document.getElementById("gr_ec");
  const horLabel = document.getElementById("gr_hor");
  const gveStatus = document.getElementById("gveStatus");
  const trajectoryStatus = document.getElementById("trajectoryStatus");

  // Contexts
  const grx = grCanvas.getContext("2d");
  const gvex = gveCanvas.getContext("2d");
  const trajx = trajectoryCanvas.getContext("2d");

  let engaged = false;
  let planet = "Mercury";
  let warp = 1;
  let t = 0;

  function drawGR() {
    grx.clearRect(0, 0, grCanvas.width, grCanvas.height);
    const w = grCanvas.width;
    const h = grCanvas.height;
    let gttMin = 1.0;
    for (let i = 0; i < w; i++) {
      const v = Math.sin(i / w * Math.PI * 8);
      const r = Math.floor(255 * Math.max(0, v));
      const b = Math.floor(255 * Math.max(0, -v));
      grx.fillStyle = `rgb(${r},0,${b})`;
      grx.fillRect(i, 0, 1, h);
      const gtt = 1 + 2 * v / (C_MPS * C_MPS);
      if (gtt < gttMin) gttMin = gtt;
    }
    gttLabel.textContent = gttMin.toFixed(6);
    rhoLabel.textContent = "1.638e-16 / 1.409e-8";
    ecLabel.textContent = "✅ NEC • ✅ WEC • ✅ SEC";
    horLabel.textContent = gttMin <= 0 ? "⚠ Detected" : "None";
  }

  function drawGVE() {
    gvex.clearRect(0, 0, gveCanvas.width, gveCanvas.height);
    gveStatus.textContent = engaged ? `Calculating → ${planet}` : "Standby";
    if (!engaged) return;
    const barW = 200;
    const power = warp * 500;
    gvex.fillStyle = "#10b981";
    gvex.fillRect(20, 40, Math.min(barW, power / 10), 10);
    gvex.strokeStyle = "#ffffff";
    gvex.strokeRect(20, 40, barW, 10);
    gvex.fillStyle = "#eaf2ff";
    gvex.fillText(`${(power).toFixed(0)} MW`, 20, 70);
  }

  function drawTrajectory() {
    trajx.clearRect(0, 0, trajectoryCanvas.width, trajectoryCanvas.height);
    trajectoryStatus.textContent = engaged ? `Route: Earth → ${planet}` : "Route: Earth → ...";
    if (!engaged) return;

    const startX = 40;
    const endX = trajectoryCanvas.width - 40;
    const baseY = trajectoryCanvas.height - 40;
    const ctrlY = baseY - (80 - warp * 5);

    trajx.beginPath();
    trajx.moveTo(startX, baseY);
    trajx.quadraticCurveTo((startX + endX) / 2, ctrlY, endX, baseY);
    trajx.strokeStyle = "#facc15";
    trajx.lineWidth = 2;
    trajx.stroke();

    const tClamped = Math.min(t, 1);
    const mx = (startX + endX) / 2;
    const sx = (1 - tClamped) ** 2 * startX + 2 * (1 - tClamped) * tClamped * mx + tClamped ** 2 * endX;
    const sy = (1 - tClamped) ** 2 * baseY + 2 * (1 - tClamped) * tClamped * ctrlY + tClamped ** 2 * baseY;

    trajx.beginPath();
    trajx.arc(sx, sy, 4, 0, Math.PI * 2);
    trajx.fillStyle = "#22d3ee";
    trajx.fill();
  }

  function animate() {
    if (engaged && t < 1) t += 0.003 + warp * 0.0012;
    drawGR();
    drawGVE();
    drawTrajectory();
    requestAnimationFrame(animate);
  }

  animate();

  window.addEventListener("message", (event) => {
    const data = event.data;
    if (!data || !data.type) return;
    if (data.type === "engage") {
      engaged = true;
      warp = parseInt(data.warpLevel);
      planet = data.planet;
      t = 0;
    }
    if (data.type === "reset") {
      engaged = false;
      planet = "Mercury";
      warp = 1;
      t = 0;
    }
  });
</script>
</body>
</html>
