<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interstellar Star Clock — Warp Trip Planner (Earth → Planet)</title>
<style>
  :root{
    --bg:#050815;
    --panel:#111735;
    --ink:#eaf0ff;
    --muted:#9fa8d6;
    --accent:#8fb4ff;
    --grid:#1d264e;
    --border:#1c2750;
    --ok:#35e6a2;
    --warn:#ffd15a;
    --bad:#ff6b8b;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{
    max-width:1800px;
    margin:0 auto;
    padding:16px;
  }
  header{
    padding:12px 16px 18px;
    border-radius:16px;
    background:radial-gradient(circle at top left,#3b82f6 0,#020617 40%,#000 100%);
    border:1px solid rgba(148,163,184,0.4);
    margin-bottom:14px;
  }
  header h1{
    margin:0 0 4px;
    font-size:22px;
    letter-spacing:0.04em;
    text-transform:uppercase;
  }
  header p{
    margin:2px 0;
    font-size:13px;
    color:var(--muted);
  }
  .tagline{
    font-size:12px;
    color:#a5b4fc;
  }

  .panel{
    background:var(--panel);
    border-radius:16px;
    border:1px solid var(--border);
    padding:12px 14px 14px;
    box-shadow:0 18px 40px rgba(15,23,42,0.75);
    margin-bottom:14px;
  }
  .panel h2{
    margin:0 0 8px;
    font-size:16px;
  }
  .panel h3{
    margin:12px 0 4px;
    font-size:14px;
  }
  .panel p{
    font-size:13px;
    color:var(--muted);
    margin:3px 0 6px;
  }

  /* ===== TRIP PLANNER ===== */
  .trip-grid{
    display:grid;
    grid-template-columns:minmax(0,340px) minmax(0,1.3fr);
    gap:14px;
  }
  .trip-field{
    margin-bottom:8px;
    font-size:12px;
  }
  .trip-field label{
    display:block;
    margin-bottom:2px;
    color:var(--muted);
    font-size:11px;
  }
  .trip-field select{
    width:100%;
    font-size:12px;
    padding:4px 6px;
    border-radius:6px;
    border:1px solid rgba(148,163,184,0.5);
    background:#020617;
    color:#e5e7eb;
  }
  .btn-row{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:6px;
  }
  button{
    font-size:12px;
    border-radius:999px;
    padding:5px 11px;
    border:1px solid rgba(148,163,184,0.6);
    background:#020617;
    color:#e5e7eb;
    cursor:pointer;
  }
  button.primary{
    border-color:#4ade80;
    color:#bbf7d0;
  }
  button.danger{
    border-color:var(--bad);
    color:#fecaca;
  }
  button:disabled{
    opacity:0.45;
    cursor:default;
  }
  button:hover:not(:disabled){
    background:#020b24;
  }

  .go-row{
    display:flex;
    align-items:center;
    gap:10px;
    margin-top:10px;
  }
  .go-circles{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .go-circle{
    width:34px;
    height:34px;
    border-radius:50%;
    border:2px solid #64748b;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:11px;
    cursor:default;
    background:#020617;
    color:#94a3b8;
  }
  .go-circle.go-active{
    border-color:var(--ok);
    box-shadow:0 0 12px rgba(34,197,94,0.7);
    color:#bbf7d0;
    cursor:pointer;
  }
  .go-circle.nogo-active{
    border-color:var(--bad);
    box-shadow:0 0 10px rgba(248,113,113,0.7);
    color:#fecaca;
  }
  .go-note{
    font-size:11px;
    color:var(--muted);
    max-width:460px;
  }
  .trip-status{
    margin-top:6px;
    font-size:11px;
    color:#fbbf24;
  }

  .trip-report{
    margin-top:4px;
    border-top:1px dashed rgba(148,163,184,0.5);
    padding-top:6px;
    font-size:11px;
  }
  .trip-report-row{
    display:flex;
    justify-content:space-between;
    gap:6px;
    margin-bottom:2px;
  }
  .trip-report-row span:first-child{
    color:var(--muted);
  }

  /* ===== CLOCK PANEL ===== */
  .clock-grid{
    display:grid;
    grid-template-columns:repeat(4,minmax(0,1fr));
    gap:10px;
    font-size:12px;
  }
  .clock-card{
    border-radius:12px;
    border:1px solid rgba(148,163,184,0.5);
    background:#020617;
    padding:8px 10px;
  }
  .clock-title{
    font-size:11px;
    color:#e5e7eb;
    margin-bottom:2px;
  }
  .clock-time{
    font-family:monospace;
    font-size:12px;
    margin-bottom:3px;
  }
  .clock-note{
    font-size:11px;
    color:var(--muted);
  }

  /* ===== ENGINE CANVAS ===== */
  canvas{
    display:block;
    width:100%;
    max-width:100%;
    border-radius:12px;
    background:#020617;
    border:1px solid var(--grid);
  }
  .labels-toggle{
    margin-top:8px;
    font-size:12px;
    display:flex;
    align-items:center;
    gap:6px;
    color:var(--muted);
  }

  /* ===== TELEMETRY ===== */
  .telemetry-grid{
    display:grid;
    grid-template-columns:repeat(4,minmax(0,1fr));
    gap:10px;
    margin-top:4px;
  }
  .telemetry-card{
    padding:6px 8px;
    border-radius:10px;
    border:1px solid rgba(148,163,184,0.45);
    background:#020617;
    font-size:11px;
  }
  .telemetry-title{
    font-size:11px;
    margin-bottom:2px;
    color:#e5e7eb;
  }
  .telemetry-value{
    font-family:monospace;
    font-size:11px;
    margin-bottom:2px;
  }
  .gauge{
    position:relative;
    width:100%;
    height:5px;
    border-radius:999px;
    background:#020617;
    overflow:hidden;
  }
  .gauge-fill{
    position:absolute;
    left:0;top:0;bottom:0;
    width:0%;
    border-radius:inherit;
    background:linear-gradient(90deg,#22c55e,#eab308,#ef4444);
    transition:width .12s linear;
  }

  .note{
    font-size:12px;
    color:var(--muted);
    margin-bottom:6px;
  }
  .eq{
    font-family: "SF Mono",ui-monospace,Menlo,Consolas,monospace;
    font-size:13px;
    margin:3px 0 5px;
    color:#e5e7eb;
  }
  .list{
    margin:4px 0 8px 18px;
    padding:0;
    font-size:12px;
    color:var(--muted);
  }
  .list li{margin-bottom:2px;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Interstellar Star Clock — Warp Trip Planner</h1>
    <p>Warp Trip Planner — Earth → Planet (Buttons 1–5). Engine speed and particles follow the computed curvature, time dilation, and g-force envelope.</p>
    <p class="tagline">Earth is the launch clock. All trips start from Earth’s orbit and ride a CST-locked warp bubble to the chosen planet.</p>
  </header>

  <!-- ===== WARP TRIP PLANNER (BUTTONS 1–5) ===== -->
  <div class="panel">
    <h2>Warp Trip Planner — Earth → Planet (Buttons 1–5)</h2>
    <div class="trip-grid">
      <div>
        <div class="trip-field">
          <label>1 — Target Planet (Earth is launch point)</label>
          <select id="planetSelect">
            <option value="mercury">Mercury (0.39 AU)</option>
            <option value="venus">Venus (0.72 AU)</option>
            <option value="mars" selected>Mars (1.52 AU)</option>
            <option value="jupiter">Jupiter (5.20 AU)</option>
            <option value="saturn">Saturn (9.58 AU)</option>
            <option value="uranus">Uranus (19.20 AU)</option>
            <option value="neptune">Neptune (30.10 AU)</option>
            <option value="pluto">Pluto (39.50 AU)</option>
          </select>
        </div>

        <div class="trip-field">
          <label>2 — Warp Drive Factor (1–10)</label>
          <select id="warpSelect">
            <option value="1">Warp 1</option>
            <option value="2">Warp 2</option>
            <option value="3" selected>Warp 3</option>
            <option value="4">Warp 4</option>
            <option value="5">Warp 5</option>
            <option value="6">Warp 6</option>
            <option value="7">Warp 7</option>
            <option value="8">Warp 8</option>
            <option value="9">Warp 9</option>
            <option value="10">Warp 10</option>
          </select>
        </div>

        <div class="btn-row">
          <button id="btnCompute" class="primary">3 — Compute Warp Trip</button>
          <button id="btnReset">4 — Reset to Defaults</button>
          <button id="btnEngage" class="primary" disabled>5 — Engage Warp (click when highlighted)</button>
        </div>

        <div class="go-row">
          <div class="go-circles">
            <div id="lampNoGo" class="go-circle">NO</div>
            <div id="lampGo" class="go-circle">GO</div>
          </div>
          <div class="go-note">
            Bubble shows Go / No-Go based on curvature index, time dilation (γ), and effective g-force.<br>
            <span id="goExplanation">NO-GO — compute a trip first.</span>
          </div>
        </div>

        <div id="tripStatus" class="trip-status">
          Idle — waiting for you to choose a planet, warp factor, and press “3 — Compute Warp Trip”.
        </div>
      </div>

      <div>
        <div class="trip-report">
          <div class="trip-report-row">
            <span>Distance (Earth → planet)</span>
            <span id="r_dist">—</span>
          </div>
          <div class="trip-report-row">
            <span>Coordinate Trip Time (CST)</span>
            <span id="r_coord">—</span>
          </div>
          <div class="trip-report-row">
            <span>Ship Proper Time (warp frame)</span>
            <span id="r_ship">—</span>
          </div>
          <div class="trip-report-row">
            <span>ΔAge (CST − Ship) for this trip</span>
            <span id="r_age">—</span>
          </div>
          <div class="trip-report-row">
            <span>Speeds</span>
            <span id="r_speed">—</span>
          </div>
          <div class="trip-report-row">
            <span>Curvature Index</span>
            <span id="r_curv">—</span>
          </div>
          <div class="trip-report-row">
            <span>Approx g-force (with inertial dampers)</span>
            <span id="r_gforce">—</span>
          </div>
          <div class="trip-report-row">
            <span>Safety Summary</span>
            <span id="r_safety">—</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== CLOCK PANEL ===== -->
  <div class="panel">
    <h2>CST Clock Deck — UTC, CST, Ship Warp Clock & Age Dilation</h2>
    <div class="clock-grid">
      <div class="clock-card">
        <div class="clock-title">UTC Atomic</div>
        <div id="clkUTC" class="clock-time">--:--:--</div>
        <div class="clock-note">Reference lab time (no gravity correction).</div>
      </div>
      <div class="clock-card">
        <div class="clock-title">CST (Earth Engine Sync)</div>
        <div id="clkCST" class="clock-time">--:--:--</div>
        <div class="clock-note">Earth surface clock, used as the main CST reference.</div>
      </div>
      <div class="clock-card">
        <div class="clock-title">Ship Warp Clock</div>
        <div id="clkShip" class="clock-time">--:--:--</div>
        <div class="clock-note" id="clkShipNote">
          Waiting for first computed trip. During warp, this clock runs slightly slower than CST.
        </div>
      </div>
      <div class="clock-card">
        <div class="clock-title">Last Trip Summary</div>
        <div class="clock-time" id="clkTripSpeed">Speed: —</div>
        <div class="clock-note" id="clkTripAge">ΔAge last trip: —</div>
      </div>
    </div>
  </div>

  <!-- ===== ENGINE VIEW ===== -->
  <div class="panel">
    <h2>Engine View — Mass–Energy Core & Toroidal Shell</h2>
    <canvas id="engineView" width="1200" height="360"></canvas>
    <label class="labels-toggle">
      <input type="checkbox" id="labels" checked>
      Show simplified labels and CST research zones
    </label>
  </div>

  <!-- ===== TELEMETRY PANEL (KEPT) ===== -->
  <div class="panel">
    <h2>Warp Telemetry — Streams, Temperatures, Field Shape</h2>
    <div class="telemetry-grid">
      <div class="telemetry-card">
        <div class="telemetry-title">Plasma Speed Multiplier</div>
        <div class="telemetry-value" id="v_speed">x1.0</div>
        <div class="gauge"><div class="gauge-fill" id="g_speed"></div></div>
        <div class="telemetry-title" style="margin-top:4px;">Field Radius (Warp Shell)</div>
        <div class="telemetry-value" id="v_field">1.00</div>
        <div class="gauge"><div class="gauge-fill" id="g_field"></div></div>
      </div>

      <div class="telemetry-card">
        <div class="telemetry-title">Shield Fraction & Stretch</div>
        <div class="telemetry-value" id="v_fshield">0%</div>
        <div class="gauge"><div class="gauge-fill" id="g_fshield"></div></div>
        <div class="telemetry-value" id="v_fstretch" style="margin-top:4px;">0 / 0</div>
        <div class="gauge"><div class="gauge-fill" id="g_fstretch"></div></div>
      </div>

      <div class="telemetry-card">
        <div class="telemetry-title">Curvature / Gamma / g-force</div>
        <div class="telemetry-value" id="v_curv">0.00</div>
        <div class="gauge"><div class="gauge-fill" id="g_curv"></div></div>
        <div class="telemetry-value" id="v_gamma" style="margin-top:4px;">γ = 1.000</div>
        <div class="gauge"><div class="gauge-fill" id="g_gamma"></div></div>
        <div class="telemetry-value" id="v_g" style="margin-top:4px;">0.00 g</div>
        <div class="gauge"><div class="gauge-fill" id="g_g"></div></div>
      </div>

      <div class="telemetry-card">
        <div class="telemetry-title">Clock & Photons & Magnetics</div>
        <div class="telemetry-value" id="v_clock">1.000×</div>
        <div class="gauge"><div class="gauge-fill" id="g_clock"></div></div>
        <div class="telemetry-value" id="v_phot" style="margin-top:4px;">0 /s</div>
        <div class="gauge"><div class="gauge-fill" id="g_phot"></div></div>
        <div class="telemetry-value" id="v_mag" style="margin-top:4px;">0.00</div>
        <div class="gauge"><div class="gauge-fill" id="g_mag"></div></div>
      </div>

      <div class="telemetry-card">
        <div class="telemetry-title">Core & Coolant Temperatures</div>
        <div class="telemetry-value" id="v_tcore">0 °C</div>
        <div class="gauge"><div class="gauge-fill" id="g_tcore"></div></div>
        <div class="telemetry-value" id="v_tcool" style="margin-top:4px;">0 °C</div>
        <div class="gauge"><div class="gauge-fill" id="g_tcool"></div></div>
      </div>

      <div class="telemetry-card">
        <div class="telemetry-title">Entanglement Flux & Plasma Shape</div>
        <div class="telemetry-value" id="v_ent">0 /s</div>
        <div class="gauge"><div class="gauge-fill" id="g_ent"></div></div>
        <div class="telemetry-value" id="v_plen" style="margin-top:4px;">0 u</div>
        <div class="gauge"><div class="gauge-fill" id="g_plen"></div></div>
        <div class="telemetry-value" id="v_prad" style="margin-top:4px;">0 u</div>
        <div class="gauge"><div class="gauge-fill" id="g_prad"></div></div>
      </div>

      <div class="telemetry-card">
        <div class="telemetry-title">Plasma Wave Metric</div>
        <div class="telemetry-value" id="v_pwave">0.00</div>
        <div class="gauge"><div class="gauge-fill" id="g_pwave"></div></div>
      </div>

      <div class="telemetry-card">
        <div class="telemetry-title">Status</div>
        <p style="font-size:11px;margin:3px 0 0;">
          Plasma stays subluminal; apparent FTL comes from warp geometry + CST mapping, with <strong>E ⇌ m</strong> core and hull shell conversion.
        </p>
      </div>
    </div>
  </div>

  <!-- ===== SCIENTIFIC ENHANCEMENTS (UNCHANGED TEXT) ===== -->
  <div class="panel">
    <h2>Scientific Enhancements for the Interstellar Star Clock & Warp Drive</h2>
    <p class="note">
      These equations sit behind the CST clock and warp navigation. They convert poetry into physics while keeping your
      bold vision intact — time slippage, star coordinates, and energy gradients all feed one unified engine.
    </p>
    <h3>1. Time Dilation (Special Relativity)</h3>
    <div class="eq">Δt' = Δt × √(1 - v² / c²)</div>
    <ul class="list">
      <li><strong>Clock layer:</strong> Used to adjust ship proper time vs CST when plasma streams move at a fraction of <em>c</em> inside the engine.</li>
      <li><strong>Navigation:</strong> High-velocity segments of a jump arc show reduced proper time; CST keeps the crew anchored to the master cosmic clock.</li>
    </ul>

    <h3>2. Gravitational Time Dilation (General Relativity)</h3>
    <div class="eq">Δt' = Δt × √(1 - 2GM / (r c²))</div>
    <ul class="list">
      <li><strong>Clock layer:</strong> Used when the ship operates near stars, planets, or compact objects; CST compensates for slower clocks in deeper wells.</li>
      <li><strong>Warp control:</strong> The engine avoids curvature regimes where GR plus warp geometry could create unstable CTC-like loops.</li>
    </ul>

    <h3>3. Star Coordinate Mapping (RA / Dec → 3D)</h3>
    <div class="eq">
      x = cos(δ) × cos(α),&nbsp;
      y = cos(δ) × sin(α),&nbsp;
      z = sin(δ)
    </div>
    <ul class="list">
      <li><strong>Star clock:</strong> Anchors each star to a fixed direction on the celestial sphere at a given epoch.</li>
      <li><strong>Warp navigation:</strong> Converts RA/Dec into a 3D target vector for the FTL jump planner; the CST engine rides curvature along that vector.</li>
    </ul>

    <h3>4. Sidereal Clock Adjustment</h3>
    <div class="eq">Sidereal Day = 23h 56m 4.1s</div>
    <ul class="list">
      <li><strong>Clock layer:</strong> The CST clock keeps both solar time and sidereal time; over years, the tiny offset accumulates into real star drift.</li>
      <li><strong>Warp navigation:</strong> Corrects star positions for drift since J2000 so the RA/Dec map stays aligned over long deep-time jumps.</li>
    </ul>

    <h3>5. Light-Time Correction</h3>
    <div class="eq">t = d / c</div>
    <ul class="list">
      <li><strong>Star clock:</strong> Shows how “old” the light is from each star; your constellations become time-delayed snapshots.</li>
      <li><strong>Warp comms:</strong> Compares conventional light-time to instantaneous entanglement or warp-burst signals in your communication panels.</li>
    </ul>

    <h3>6. Stefan–Boltzmann Law (Radiative Heat from Coils & Panels)</h3>
    <div class="eq">F = σ T⁴</div>
    <ul class="list">
      <li><strong>Engine core:</strong> Predicts heat flux from hot coils, plasma chambers, and gradient panels as a function of temperature.</li>
      <li><strong>Safety / Shield mix:</strong> When radiative flux approaches structural limits, the controller shifts energy from warp geometry into cooling and shielding.</li>
      <li><strong>Telemetry:</strong> The “Core Temp” and “Coolant Temp” readouts conceptually trace back to this T⁴ scaling.</li>
    </ul>

    <h3>7. Hamiltonian Operator (Energy of the Warp Field)</h3>
    <div class="eq">Ĥ ψ = E ψ</div>
    <ul class="list">
      <li><strong>Field layer:</strong> Treats the warp shell and vacuum modes as a quantum system with a Hamiltonian that encodes all energy terms (plasma, EM, vacuum).</li>
      <li><strong>Gradient design:</strong> By choosing a Hamiltonian with stable eigenmodes, you bias the engine toward field configurations that maintain a smooth bubble.</li>
      <li><strong>CST integration:</strong> The CST clock can be thought of as following the phase evolution of the warp state vector over long-duration missions.</li>
    </ul>

    <h3>8. Wave Equation (Propagation of Warp & Shield Fields)</h3>
    <div class="eq">∂²ψ/∂t² = c² ∇²ψ  &nbsp; (classical form)</div>
    <ul class="list">
      <li><strong>Field geometry:</strong> Describes how disturbances in EM, plasma, and vacuum modes propagate through the warp shell.</li>
      <li><strong>Gradient control:</strong> The controller uses an internal wave model so pulses launched by the coils arrive in phase at the front vs rear shell.</li>
      <li><strong>Shield shaping:</strong> Radiation and particle shielding are engineered as standing-wave solutions that wrap the hull in a stable harmonic envelope.</li>
    </ul>

    <p class="note">
      Together, these equations let the Interstellar Star Clock do more than tell time: it <em>predicts</em> how time, energy, and geometry interact.
      Your warp engine sits on top of this clock, using CST to keep energy gradients, curvature, and crew experience in sync.
      The <strong>E ⇌ m zones</strong> inside the engine are: (1) the nuclear mass core (m → E) and (2) the hull conversion shell (E → m effective mass around the ship).
    </p>
  </div>
  <!-- ===== SCRIPT: WARP TRIP + ENGINE + TELEMETRY ===== -->
  <script>
  (function(){
    const C = 299792458;                          // m/s
    const AU = 1.495978707e11;                    // m
    const SECONDS_PER_YEAR = 365.25*86400;

    const PLANETS = {
      mercury:{name:'Mercury', au:0.39},
      venus  :{name:'Venus',   au:0.72},
      mars   :{name:'Mars',    au:1.52},
      jupiter:{name:'Jupiter', au:5.20},
      saturn :{name:'Saturn',  au:9.58},
      uranus :{name:'Uranus',  au:19.2},
      neptune:{name:'Neptune', au:30.1},
      pluto  :{name:'Pluto',   au:39.5}
    };

    const planetSelect = document.getElementById('planetSelect');
    const warpSelect   = document.getElementById('warpSelect');
    const btnCompute   = document.getElementById('btnCompute');
    const btnReset     = document.getElementById('btnReset');
    const btnEngage    = document.getElementById('btnEngage');

    const lampNoGo     = document.getElementById('lampNoGo');
    const lampGo       = document.getElementById('lampGo');
    const goExplanation= document.getElementById('goExplanation');
    const tripStatus   = document.getElementById('tripStatus');

    const r_dist   = document.getElementById('r_dist');
    const r_coord  = document.getElementById('r_coord');
    const r_ship   = document.getElementById('r_ship');
    const r_age    = document.getElementById('r_age');
    const r_speed  = document.getElementById('r_speed');
    const r_curv   = document.getElementById('r_curv');
    const r_gforce = document.getElementById('r_gforce');
    const r_safety = document.getElementById('r_safety');

    const clkUTC   = document.getElementById('clkUTC');
    const clkCST   = document.getElementById('clkCST');
    const clkShip  = document.getElementById('clkShip');
    const clkShipNote = document.getElementById('clkShipNote');
    const clkTripSpeed = document.getElementById('clkTripSpeed');
    const clkTripAge   = document.getElementById('clkTripAge');

    const engineCanvas = document.getElementById('engineView');
    const ectx = engineCanvas.getContext('2d');
    const labelsToggle = document.getElementById('labels');

    // Telemetry elements
    const v_speed=document.getElementById('v_speed'), g_speed=document.getElementById('g_speed');
    const v_field=document.getElementById('v_field'), g_field=document.getElementById('g_field');
    const v_fshield=document.getElementById('v_fshield'), g_fshield=document.getElementById('g_fshield');
    const v_fstretch=document.getElementById('v_fstretch'), g_fstretch=document.getElementById('g_fstretch');
    const v_curv=document.getElementById('v_curv'), g_curv=document.getElementById('g_curv');
    const v_gamma=document.getElementById('v_gamma'), g_gamma=document.getElementById('g_gamma');
    const v_g=document.getElementById('v_g'), g_g=document.getElementById('g_g');
    const v_clock=document.getElementById('v_clock'), g_clock=document.getElementById('g_clock');
    const v_phot=document.getElementById('v_phot'), g_phot=document.getElementById('g_phot');
    const v_mag=document.getElementById('v_mag'), g_mag=document.getElementById('g_mag');
    const v_tcore=document.getElementById('v_tcore'), g_tcore=document.getElementById('g_tcore');
    const v_tcool=document.getElementById('v_tcool'), g_tcool=document.getElementById('g_tcool');
    const v_ent=document.getElementById('v_ent'), g_ent=document.getElementById('g_ent');
    const v_plen=document.getElementById('v_plen'), g_plen=document.getElementById('g_plen');
    const v_prad=document.getElementById('v_prad'), g_prad=document.getElementById('g_prad');
    const v_pwave=document.getElementById('v_pwave'), g_pwave=document.getElementById('g_pwave');

    function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
    function lerp(a,b,t){ return a+(b-a)*t; }
    function fmtSecToHM(sec){
      if(!isFinite(sec) || sec<=0) return '0 s';
      if(sec<60) return sec.toFixed(1)+' s';
      const m = Math.floor(sec/60);
      const s = sec-m*60;
      if(m<60) return m+' min '+s.toFixed(0)+' s';
      const h = Math.floor(m/60);
      const m2 = m-h*60;
      return h+' h '+m2+' min';
    }

    // ==== Warp + Trip state ====
    let currentWarp = 1;
    let lastTrip = null;       // stores physics of last computation
    let tripSafe = false;
    let tripActive = false;
    let tripStart = 0;
    let tripDurationMs = 0;
    let tripProgress = 0;

    // Ship clock: starts synced to CST, then runs at SR·GR·warp rate during active trip
    let shipClockMs = Date.now();
    let lastFrameTime = performance.now();

    function localSpeedFrac(w){
      // plasma stays subluminal: between 0.2 c and 0.92 c
      return clamp(0.2 + 0.08*(w-1),0.2,0.92);
    }
    function gammaSR(vFrac){
      return 1/Math.sqrt(1-vFrac*vFrac);
    }
    function gammaGR_regime(){ 
      // solar orbit regime as default reference
      return 1.000002;
    }

    function computeWarpTrip(){
      const key = planetSelect.value;
      const warp = parseInt(warpSelect.value,10);
      const planet = PLANETS[key];
      const earthAU = 1.0;
      const distAU = Math.abs(planet.au - earthAU);
      const distMeters = distAU*AU;
      const distKm = distMeters/1000;
      const lightTimeSec = distMeters/C;                // d / c

      const vLocal = localSpeedFrac(warp);              // plasma speed (fraction c)
      const vApp   = warp * vLocal;                     // apparent FTL (geometry)

      const coordSec = lightTimeSec / vApp;             // CST coordinate time for trip
      const gSR = gammaSR(vLocal);
      const gGR = gammaGR_regime();
      const shipSec = coordSec/(gSR*gGR);               // proper time on ship
      const deltaAgeSec = coordSec - shipSec;           // CST - ship

      const curvatureIndex = distAU * warp;             // simple curvature metric (AU × warp)
      const effG = 0.20 + 0.18*(warp-1);                // inertial dampers hold g to safe band

      // Safety thresholds
      const maxGamma = 2.0;
      const maxCurv  = 40.0;
      const maxEffG  = 2.0;                             // inside “no black-out” envelope
      const maxAgeSec= 5*365*24*3600;                   // 5 years of age gap (far more than you’ll hit here)

      let safe = true;
      const reasons = [];

      if(gSR>maxGamma){
        safe = false;
        reasons.push('γ > '+maxGamma.toFixed(1));
      }
      if(curvatureIndex>maxCurv){
        safe = false;
        reasons.push('curvature index > '+maxCurv.toFixed(0));
      }
      if(effG>maxEffG){
        safe = false;
        reasons.push('effective g > '+maxEffG.toFixed(1));
      }
      if(deltaAgeSec>maxAgeSec){
        safe = false;
        reasons.push('Δage too large');
      }

      // Fill right-hand report
      const distAUtxt = distAU.toFixed(3)+' AU';
      const distKMtxt = distKm/1e6;
      const lightTxt  = lightTimeSec.toFixed(1)+' s';

      r_dist.textContent =
        distAUtxt+' ≈ '+distKMtxt.toFixed(2)+' M km (light-time '+lightTxt+')';

      r_coord.textContent = fmtSecToHM(coordSec);
      r_ship.textContent  = fmtSecToHM(shipSec);
      r_age.textContent   = deltaAgeSec.toFixed(3)+' s (CST ahead of ship)';

      r_speed.textContent =
        'v_app ≈ '+vApp.toFixed(2)+' c, v_local ≈ '+vLocal.toFixed(2)+' c';
      r_curv.textContent  = curvatureIndex.toFixed(2)+' (AU × Warp)';
      r_gforce.textContent= effG.toFixed(2)+' g (damped)';

      r_safety.textContent = safe
        ? 'GO — all limits within envelope.'
        : 'NO-GO — '+reasons.join(', ')+'.';

      // Lamps + engage button
      lampGo.classList.remove('go-active');
      lampNoGo.classList.remove('nogo-active');

      if(safe){
        lampGo.classList.add('go-active');
        lampNoGo.classList.remove('nogo-active');
        goExplanation.textContent =
          'GO — curvature, time dilation, and effective g-force all inside safe bubble. Click GO or “5 — Engage Warp” to start the trip.';
        btnEngage.disabled = false;
      }else{
        lampNoGo.classList.add('nogo-active');
        goExplanation.textContent =
          'NO-GO — one or more limits exceeded ('+reasons.join(', ')+'). Adjust warp or pick a closer planet, then recompute.';
        btnEngage.disabled = true;
      }

      tripStatus.textContent =
        (safe ? 'Trip computed: GO bubble is active. '
              : 'Trip computed: NO-GO. ')
        +'Distance Earth → '+planet.name+', warp '+warp+'.';

      // Save into lastTrip + animation envelope
      lastTrip = {
        key, planet, warp, distAU, distMeters, distKm,
        lightTimeSec, vLocal, vApp,
        coordSec, shipSec, deltaAgeSec,
        curvatureIndex, effG, safe,
        gSR,gGR
      };
      tripSafe = safe;
      currentWarp = warp;

      // Animation duration maps coordSec ∈ [600 s, 10^7 s] → [6 s, 22 s] approx
      const minPhys = 600;
      const maxPhys = 1.0e7;
      const tNorm = clamp((coordSec-minPhys)/(maxPhys-minPhys),0,1);
      tripDurationMs = 6000 + tNorm*(22000-6000);

      // Update clock summary
      clkTripSpeed.textContent =
        'Speed: v_app '+vApp.toFixed(2)+' c, v_local '+vLocal.toFixed(2)+' c';
      clkTripAge.textContent =
        'ΔAge last trip: '+deltaAgeSec.toFixed(3)+' s (CST slower – ship younger).';
      clkShipNote.textContent =
        'Ship clock runs at ≈ '+(1/(gSR*gGR)).toFixed(3)+'× CST for the last computed warp profile.';
    }

    function resetTrip(){
      planetSelect.value = 'mars';
      warpSelect.value   = '3';
      lastTrip = null;
      tripSafe = false;
      tripActive = false;
      tripProgress = 0;
      currentWarp = 1;

      btnEngage.disabled = true;
      lampGo.classList.remove('go-active');
      lampNoGo.classList.remove('nogo-active');
      goExplanation.textContent = 'NO-GO — compute a trip first.';
      tripStatus.textContent =
        'Idle — waiting for you to choose a planet, warp factor, and press “3 — Compute Warp Trip”.';

      r_dist.textContent   = '—';
      r_coord.textContent  = '—';
      r_ship.textContent   = '—';
      r_age.textContent    = '—';
      r_speed.textContent  = '—';
      r_curv.textContent   = '—';
      r_gforce.textContent = '—';
      r_safety.textContent = '—';

      clkTripSpeed.textContent = 'Speed: —';
      clkTripAge.textContent   = 'ΔAge last trip: —';
      clkShipNote.textContent  =
        'Waiting for first computed trip. During warp, this clock runs slightly slower than CST.';
    }

    function engageWarp(){
      if(!lastTrip || !tripSafe || tripActive) return;
      tripActive = true;
      tripStart = performance.now();
      tripProgress = 0;
      shipClockMs = Date.now();   // sync ship clock to CST at departure
      tripStatus.textContent =
        'Warp engaged — Earth → '+lastTrip.planet.name+
        '. Engine will ramp up, hold, then ramp down as the ship arrives.';
    }

    // GO circle also acts as Engage button when safe
    lampGo.addEventListener('click', function(){
      if(tripSafe){
        engageWarp();
      }
    });

    btnCompute.addEventListener('click', computeWarpTrip);
    btnReset.addEventListener('click', resetTrip);
    btnEngage.addEventListener('click', engageWarp);

    // ===== CLOCKS =====
    function updateClocks(dtMs){
      const now = Date.now();
      // Live UTC / CST
      clkUTC.textContent = new Date(now).toLocaleTimeString('en-US',{
        hour12:false,timeZone:'UTC'
      });
      clkCST.textContent = new Date(now).toLocaleTimeString('en-US',{
        hour12:false,timeZone:'America/Chicago'
      });

      // Ship clock: if active, run at SR·GR rate; else track CST
      let rate = 1.0;
      if(tripActive && lastTrip){
        rate = 1/(lastTrip.gSR*lastTrip.gGR);
      }
      shipClockMs += dtMs*rate;
      clkShip.textContent =
        new Date(shipClockMs).toLocaleTimeString('en-US',{hour12:false});
    }

    // ===== ENGINE VISUAL =====
    const TAU = Math.PI*2;
    const particles = [];

    function spawnParticles(strength){
      const count = Math.floor(10 + strength*70);
      const w = engineCanvas.width;
      const h = engineCanvas.height;
      const cx = w*0.28;
      const cy = h*0.5;
      for(let i=0;i<count;i++){
        const t = Math.random();
        const angle = lerp(-0.35,0.35,t);
        const speed = lerp(0.4,1.3,strength)* (0.6+Math.random()*0.7);
        particles.push({
          x:cx + 40,
          y:cy + (Math.random()*2-1)*26,
          vx: Math.cos(angle)*speed,
          vy: Math.sin(angle)*speed*0.3,
          life:0,
          maxLife: lerp(500,1600,Math.random()),
          size: lerp(1.2,2.4,Math.random())
        });
      }
    }

    function drawEngine(dtMs){
      const w = engineCanvas.width;
      const h = engineCanvas.height;
      const cx = w*0.28;
      const cy = h*0.5;

      ectx.clearRect(0,0,w,h);

      // Background gradient
      const gBG = ectx.createLinearGradient(0,0,w,h);
      gBG.addColorStop(0,'#020617');
      gBG.addColorStop(1,'#020314');
      ectx.fillStyle = gBG;
      ectx.fillRect(0,0,w,h);

      // Warp bubble radius scales with warp and tripProgress
      const targetWarp = currentWarp;
      const warpNorm = clamp((targetWarp-1)/9,0,1);
      const bubbleBase = 110 + warpNorm*80;
      const stretch = 1.0 + warpNorm*0.7;

      // A little extra stretch when actively in mid-trip
      let tripBoost = 0;
      if(tripActive){
        const t = tripProgress;
        const mid = t<0.5 ? t/0.5 : (1-t)/0.5;
        tripBoost = mid*0.35;
      }

      ectx.save();
      ectx.translate(cx+140*warpNorm,cy);
      ectx.scale(stretch+tripBoost,1-(warpNorm+tripBoost)*0.15);

      // Outer toroidal shell (E → m effective mass)
      const gShell = ectx.createRadialGradient(0,0,bubbleBase*0.3,0,0,bubbleBase);
      gShell.addColorStop(0,'rgba(56,189,248,0.08)');
      gShell.addColorStop(0.6,'rgba(56,189,248,0.32)');
      gShell.addColorStop(1,'rgba(56,189,248,0.02)');
      ectx.fillStyle = gShell;
      ectx.beginPath();
      ectx.ellipse(0,0,bubbleBase,bubbleBase*0.55,0,0,TAU);
      ectx.fill();

      // Inner shell
      ectx.strokeStyle = 'rgba(74,222,128,0.7)';
      ectx.lineWidth = 2;
      ectx.beginPath();
      ectx.ellipse(0,0,bubbleBase*0.78,bubbleBase*0.42,0,0,TAU);
      ectx.stroke();

      ectx.restore();

      // Ship / core body
      const bodyLen = 220;
      const bodyRad = 46;
      ectx.save();
      ectx.translate(cx,cy);
      ectx.fillStyle = '#0b1220';
      ectx.strokeStyle = '#1f2937';
      ectx.lineWidth = 1.2;
      ectx.beginPath();
      ectx.moveTo(-bodyLen*0.55,-bodyRad);
      ectx.lineTo(bodyLen*0.55,-bodyRad);
      ectx.quadraticCurveTo(bodyLen*0.75,0,bodyLen*0.55,bodyRad);
      ectx.lineTo(-bodyLen*0.55,bodyRad);
      ectx.quadraticCurveTo(-bodyLen*0.8,0,-bodyLen*0.55,-bodyRad);
      ectx.closePath();
      ectx.fill();
      ectx.stroke();

      // Mass–energy core
      ectx.fillStyle = '#facc15';
      ectx.beginPath();
      ectx.arc(0,0,18,0,TAU);
      ectx.fill();
      ectx.strokeStyle = '#f97316';
      ectx.lineWidth = 1.4;
      ectx.stroke();

      ectx.fillStyle = '#111827';
      ectx.font = '9px system-ui';
      ectx.textAlign = 'center';
      ectx.textBaseline = 'middle';
      ectx.fillText('E=mc²',0,-6);
      ectx.fillText('m=E/c²',0,7);

      // Intake fan
      ectx.strokeStyle='#64748b';
      ectx.lineWidth=2;
      ectx.beginPath();
      ectx.arc(-bodyLen*0.55,0,24,0,TAU);
      ectx.stroke();

      ectx.restore();

      // Exhaust glow cone
      const coneLen = 180 + warpNorm*120 + tripBoost*160;
      const coneRad = 32 + warpNorm*18;
      const x0 = cx + bodyLen*0.55;
      const x1 = x0 + coneLen;

      const gCone = ectx.createLinearGradient(x0,cy,x1,cy);
      gCone.addColorStop(0,'rgba(253,224,171,0.8)');
      gCone.addColorStop(0.45,'rgba(254,215,170,0.25)');
      gCone.addColorStop(1,'rgba(254,215,170,0.02)');
      ectx.fillStyle = gCone;
      ectx.beginPath();
      ectx.moveTo(x0,cy-coneRad);
      ectx.lineTo(x1,cy-coneRad*0.3);
      ectx.lineTo(x1,cy+coneRad*0.3);
      ectx.lineTo(x0,cy+coneRad);
      ectx.closePath();
      ectx.fill();

      // Particles emitted from nozzle; spawn rate tied to warp + trip
      const baseStrength = 0.15 + warpNorm*0.85;
      const extraTrip = tripActive ? (0.2 + 0.8*(tripProgress<0.5 ? tripProgress/0.5 : (1-tripProgress)/0.5)) : 0;
      const strength = clamp(baseStrength + extraTrip,0,1.4);

      spawnParticles(strength);

      // Integrate particles
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.life += dtMs;
        p.x += p.vx*dtMs*0.08;
        p.y += p.vy*dtMs*0.08;
        if(p.life>p.maxLife || p.x>w+40){
          particles.splice(i,1);
          continue;
        }
        const alpha = 1-Math.pow(p.life/p.maxLife,1.2);
        ectx.fillStyle = 'rgba(156,163,255,'+alpha.toFixed(3)+')';
        ectx.beginPath();
        ectx.arc(p.x,p.y,p.size,0,TAU);
        ectx.fill();
      }

      // Simple labels if toggle on
      if(labelsToggle.checked){
        ectx.fillStyle='#e5e7eb';
        ectx.font='11px system-ui';
        ectx.textAlign='left';
        ectx.textBaseline='middle';
        ectx.fillText('1: Nuclear mass core (m → E)', cx-40, cy-70);
        ectx.fillText('2: Hull conversion shell (E → m effective mass)', cx+120, cy-90);
        ectx.fillText('3: Warp bubble boundary (geometry / CST)', cx+180, cy+80);
      }
    }

    // ===== TELEMETRY UPDATE =====
    function setGauge(el,frac){
      if(!el) return;
      el.style.width = (clamp(frac,0,1)*100).toFixed(0)+'%';
    }

    function updateTelemetry(dtMs){
      const warp = currentWarp;
      const vLocal = localSpeedFrac(warp);
      const vApp   = warp*vLocal;
      const gSR = gammaSR(vLocal);
      const gGR = gammaGR_regime();
      const effClockRate = 1/(gSR*gGR);
      const effG = 0.20 + 0.18*(warp-1);
      const fieldRadius = 1.0 + 0.15*(warp-1);

      const curvature = lastTrip ? lastTrip.curvatureIndex : warp*0.4;
      const photonsPerSec = 500 + 4500*(warp-1)/9;
      const mag = fieldRadius*warp;

      if(v_speed){ v_speed.textContent='x'+(1+0.6*(warp-1)).toFixed(1); setGauge(g_speed,(warp-1)/9); }
      if(v_field){ v_field.textContent=fieldRadius.toFixed(2); setGauge(g_field,(fieldRadius-1)/(0.15*9)); }

      if(v_fshield){
        const shieldFrac = clamp(0.3+0.5*(warp-1)/9,0,1);
        v_fshield.textContent=Math.round(shieldFrac*100)+'%';
        setGauge(g_fshield,shieldFrac);
        v_fstretch.textContent=(fieldRadius*100).toFixed(0)+' / '+(fieldRadius*70).toFixed(0);
        setGauge(g_fstretch,clamp((fieldRadius-1)/1.35,0,1));
      }

      if(v_curv){
        v_curv.textContent=curvature.toFixed(2);
        setGauge(g_curv,clamp(curvature/40,0,1));
      }
      if(v_gamma){
        v_gamma.textContent='γ = '+gSR.toFixed(3);
        setGauge(g_gamma,clamp((gSR-1)/1,0,1));
      }
      if(v_g){
        v_g.textContent=effG.toFixed(2)+' g';
        setGauge(g_g,clamp(effG/2,0,1));
      }

      if(v_clock){
        v_clock.textContent=effClockRate.toFixed(3)+'×';
        setGauge(g_clock,1-effClockRate);
      }

      if(v_phot){
        v_phot.textContent=Math.round(photonsPerSec)+' /s';
        setGauge(g_phot,clamp(photonsPerSec/5000,0,1));
      }
      if(v_mag){
        v_mag.textContent=mag.toFixed(2);
        setGauge(g_mag,clamp(mag/15,0,1));
      }

      const coreT = 200 + 900*(warp-1)/9;
      const coolT = 40 + 200*(warp-1)/9;
      if(v_tcore){ v_tcore.textContent=Math.round(coreT)+' °C'; setGauge(g_tcore,clamp(coreT/1500,0,1)); }
      if(v_tcool){ v_tcool.textContent=Math.round(coolT)+' °C'; setGauge(g_tcool,clamp(coolT/400,0,1)); }

      if(v_ent){
        const entRate = 1.0e5*(warp-1)/9;
        v_ent.textContent = (entRate<1e3?entRate.toFixed(0):entRate.toExponential(1))+' /s';
        setGauge(g_ent,clamp(entRate/1e5,0,1));
      }

      if(v_plen){
        const plen = 90 + 170*(warp-1)/9;
        v_plen.textContent=plen.toFixed(0)+' u';
        setGauge(g_plen,clamp((plen-90)/(260-90),0,1));
      }
      if(v_prad){
        const prad = 10 + 26*(warp-1)/9;
        v_prad.textContent=prad.toFixed(0)+' u';
        setGauge(g_prad,clamp((prad-10)/(36-10),0,1));
      }
      if(v_pwave){
        const pwave = 0.2 + 1.0*(warp-1)/9;
        v_pwave.textContent=pwave.toFixed(2);
        setGauge(g_pwave,clamp(pwave/1.2,0,1));
      }
    }

    // ===== MAIN LOOP =====
    function loop(){
      const now = performance.now();
      const dt = now - lastFrameTime;
      lastFrameTime = now;

      // Handle trip progression & warp ramp up/down
      if(tripActive && lastTrip){
        const t = (now-tripStart)/tripDurationMs;
        tripProgress = clamp(t,0,1);
        // Warp ramp: up first half, down second half, always ≥ 1
        const mid = tripProgress<0.5 ? (tripProgress/0.5) : ((1-tripProgress)/0.5);
        currentWarp = 1 + (lastTrip.warp-1)*clamp(mid,0,1);

        if(tripProgress>=1){
          tripActive = false;
          tripProgress = 1;
          currentWarp = 1;
          tripStatus.textContent =
            'Warp trip complete — ship has arrived in the '+lastTrip.planet.name+
            ' neighborhood and re-synced with CST.';
        }
      }else if(!tripActive && lastTrip){
        // after arrival, engine winds back to idle warp 1
        currentWarp = lerp(currentWarp,1,0.02);
      }

      updateClocks(dt);
      drawEngine(dt);
      updateTelemetry(dt);

      requestAnimationFrame(loop);
    }

    resetTrip();   // load defaults
    loop();
  })();
  </script>
</div> <!-- end .wrap -->
</body>
</html>
