<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>10-Ticket Tight Coach — Prize-Weighted Generator</title>
<style>
  :root{
    --bg:#0b1222;
    --panel:#121a33;
    --ink:#edf2ff;
    --muted:#a9b7e3;
    --accent:#8fb4ff;
    --grid:#1b2550;
    --chip:#1e2a59;
    --warn:#ffd37a;
    --bad:#ff8c8c;
    --good:#7bffb1;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
    font-size:18px; /* bigger base font */
  }
  .wrap{
    max-width:1300px;   /* wider panel */
    margin:0 auto;
    padding:24px 16px 40px;
  }
  h1{
    margin:4px 0 10px;
    font-size:2rem;
  }
  h2{
    margin:16px 0 8px;
    font-size:1.4rem;
  }
  p{
    margin:4px 0 10px;
    color:var(--muted);
  }
  .grid{
    display:grid;
    grid-template-columns:minmax(0,1.2fr) minmax(0,1fr);
    gap:18px;
    align-items:flex-start;
  }
  .card{
    background:var(--panel);
    border-radius:14px;
    padding:18px;
    box-shadow:0 0 0 1px rgba(0,0,0,0.4),0 10px 25px rgba(0,0,0,0.55);
  }
  textarea{
    width:100%;
    min-height:180px;
    background:#050816;
    border:1px solid var(--grid);
    border-radius:10px;
    padding:10px;
    color:var(--ink);
    resize:vertical;
    font-family:ui-monospace,Consolas,monospace;
    font-size:0.9rem;  /* slightly larger but compact */
    line-height:1.3;
  }
  label{
    display:block;
    font-weight:600;
    margin:8px 0 4px;
  }
  .controls-row{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top:10px;
    align-items:center;
  }
  button{
    border:none;
    border-radius:999px;
    padding:10px 18px;
    font-size:1rem;
    font-weight:600;
    cursor:pointer;
    background:linear-gradient(135deg,var(--accent),#b4d0ff);
    color:#020415;
    box-shadow:0 4px 12px rgba(0,0,0,0.45);
    display:inline-flex;
    align-items:center;
    gap:6px;
  }
  button:active{
    transform:translateY(1px);
    box-shadow:0 2px 6px rgba(0,0,0,0.6);
  }
  .btn-secondary{
    background:#222a4a;
    color:var(--ink);
  }
  .badge{
    display:inline-block;
    padding:2px 8px;
    border-radius:999px;
    font-size:0.78rem;
    font-weight:600;
    background:#182044;
    color:var(--muted);
    border:1px solid var(--grid);
    margin-left:6px;
  }
  .stats{
    margin-top:8px;
    font-size:0.95rem;
  }
  .stats-row{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin:4px 0;
  }
  .pill{
    padding:3px 9px;
    border-radius:999px;
    font-size:0.8rem;
    border:1px solid var(--grid);
    background:#050816;
  }
  .pill-hot{ border-color:var(--good); color:var(--good); }
  .pill-warm{ border-color:var(--accent); color:var(--accent); }
  .pill-cold{ border-color:var(--muted); color:var(--muted); }
  .output-box{
    margin-top:10px;
    background:#050816;
    border-radius:10px;
    padding:10px 12px;
    border:1px solid var(--grid);
    font-family:ui-monospace,Consolas,monospace;
    font-size:1.05rem;    /* larger ticket text */
    line-height:1.45;
    max-height:420px;
    overflow:auto;
  }
  .ticket-line{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:3px 0;
  }
  .ticket-label{
    color:var(--muted);
    font-size:0.9rem;
    margin-right:10px;
  }
  .ticket-numbers{
    letter-spacing:1px;
  }
  .legend{
    margin-top:6px;
    font-size:0.86rem;
    color:var(--muted);
  }
  .small-note{
    font-size:0.8rem;
    color:var(--muted);
    margin-top:4px;
  }

  /* Print: show only ticket block cleanly */
  @media print {
    body{
      background:#ffffff;
      color:#000000;
    }
    body *{
      visibility:hidden;
    }
    #ticketsBox, #ticketsBox *{
      visibility:visible;
    }
    #ticketsBox{
      position:absolute;
      left:0;
      top:0;
      width:100%;
      border:none;
      background:#ffffff;
      box-shadow:none;
      font-size:1.1rem;
      max-height:none;
      overflow:visible;
    }
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>10-Ticket Tight Coach</h1>
  <p>
    Uses your <strong>official draw history</strong> + <strong>prize-winning tickets</strong> to weight numbers,
    then generates <strong>10 tight lines</strong> (6/54 game).
  </p>

  <div class="grid">
    <!-- LEFT: INPUTS -->
    <div class="card">
      <h2>1. Official Draw History</h2>
      <p>Paste recent official draws here (e.g., last 300–500 draws). One line per draw, 6 numbers per line.</p>
      <textarea id="historyInput" placeholder="Example:&#10;24 39 22 20 25 43&#10;50 39 27 23 42 44&#10;..."></textarea>

      <h2 style="margin-top:18px;">2. Prize / Jackpot Winners (pre-loaded)</h2>
      <p>These are your 106+1 lines that already won prizes. The coach uses them as an anchor weight.</p>
      <textarea id="winnersInput">
1 2 4 27 40 42
1 3 11 15 16 50
1 3 13 14 22 52
1 4 10 14 15 26
1 6 8 11 15 25
1 6 31 43 44 53
1 7 15 35 43 53
1 9 14 23 29 41
1 10 11 31 38 49
1 12 25 36 39 45
1 16 19 39 42 46
1 25 35 42 48 51
2 3 8 12 25 27
2 3 17 35 41 44
2 5 13 16 23 38
2 6 14 26 36 50
2 6 18 39 40 48
2 6 28 29 46 53
2 7 21 35 43 50
2 8 22 29 35 38
2 9 34 38 43 51
2 11 22 27 33 40
2 14 16 19 25 28
2 19 25 28 30 51
2 23 31 37 41 50
3 4 6 23 34 54
3 4 29 31 33 50
3 5 9 32 36 37
3 5 18 29 30 52
3 6 14 43 44 50
3 6 24 36 38 49
3 8 13 25 33 44
3 9 13 25 30 51
3 11 23 35 41 54
3 13 14 17 31 33
3 16 18 23 40 44
4 5 14 16 18 19
4 10 35 38 41 49
4 11 16 19 27 30
4 12 13 26 39 54
4 13 14 18 26 38
4 14 21 29 34 43
4 14 37 39 51 52
4 19 34 35 40 52
4 21 24 40 43 48
5 6 9 14 27 51
5 6 14 25 36 44
5 7 10 28 31 44
5 8 15 25 40 53
5 9 18 22 35 48
5 9 26 38 41 44
5 10 16 22 26 46
5 10 23 35 41 48
5 11 20 24 27 46
5 13 22 29 37 48
5 14 16 17 39 46
6 7 23 34 37 50
6 11 13 18 26 49
6 11 16 21 25 32
6 14 30 45 49 50
6 20 23 24 31 54
7 9 11 30 33 53
7 10 23 34 46 47
7 14 16 35 48 52
7 15 26 31 51 54
8 10 15 18 26 44
8 11 22 24 30 49
8 13 15 32 37 47
8 14 27 30 47 51
8 16 31 36 38 51
8 19 22 31 41 43
8 19 29 44 46 48
8 21 32 35 45 52
8 25 42 45 47 53
8 34 37 44 46 54
9 10 12 17 37 51
9 13 17 20 26 28
9 15 20 28 39 43
9 19 28 41 45 51
9 20 27 42 51 53
9 28 36 38 41 42
10 14 17 31 38 48
10 14 22 28 40 44
10 16 23 24 48 50
10 27 42 43 47 52
11 21 25 30 32 50
11 28 32 49 51 53
12 15 17 31 38 47
13 24 26 30 36 52
13 36 38 45 46 49
15 17 43 45 47 50
16 17 18 19 21 47
16 17 21 28 41 52
16 34 38 40 49 54
16 36 37 45 49 52
17 23 26 32 38 45
18 19 26 29 32 42
19 21 25 45 47 52
20 24 27 37 39 41
21 23 29 44 47 53
21 25 27 30 36 48
22 33 44 45 47 54
25 26 40 43 46 51
26 27 34 37 48 53
31 35 42 44 51 53
7 17 23 28 39 48
      </textarea>

      <div class="controls-row">
        <button id="analyzeBtn" type="button">Analyze History</button>
        <button id="generateBtn" type="button" class="btn-secondary">Generate 10 Tight Tickets</button>
        <button id="printBtn" type="button" class="btn-secondary">Print 10 Tickets</button>
      </div>
      <div class="small-note">
        Game assumed: 6 numbers from 1–54. Duplicates across tickets are allowed, but exact copy of
        any prize line is blocked. Long sequences like 6–7–8–9 are also filtered out.
      </div>
    </div>

    <!-- RIGHT: STATS + OUTPUT -->
    <div class="card">
      <h2>3. Bands & Output</h2>
      <div id="summaryBox" class="stats">
        Paste history and click <strong>Analyze History</strong> to see bands.
      </div>

      <div class="legend">
        <span class="pill pill-hot">Hot</span> top frequency &nbsp;
        <span class="pill pill-warm">Warm</span> mid &nbsp;
        <span class="pill pill-cold">Cold</span> low frequency
      </div>

      <h2 style="margin-top:16px;">4. Generated 10-Ticket Set</h2>
      <div id="ticketsBox" class="output-box">
        Click “Generate 10 Tight Tickets” after you analyze.
      </div>
    </div>
  </div>
</div>
<script>
(function(){
  const N_MIN = 1;
  const N_MAX = 54;        // 6/54 game
  const TICKET_SIZE = 6;
  const NUM_TICKETS = 10;  // 10 tickets

  const historyInput = document.getElementById('historyInput');
  const winnersInput = document.getElementById('winnersInput');
  const summaryBox   = document.getElementById('summaryBox');
  const ticketsBox   = document.getElementById('ticketsBox');
  const analyzeBtn   = document.getElementById('analyzeBtn');
  const generateBtn  = document.getElementById('generateBtn');
  const printBtn     = document.getElementById('printBtn');

  let lastStats = null;    // store stats after Analyze
  let forbiddenSet = new Set(); // exact combos not allowed (prize winners)

  function parseCombos(text) {
    const combos = [];
    if (!text) return combos;
    const lines = text.trim().split(/\n+/);
    for (let line of lines) {
      const nums = line.trim().split(/[\s,]+/).map(x => parseInt(x,10))
        .filter(n => !isNaN(n));
      if (nums.length >= TICKET_SIZE) {
        const combo = nums.slice(0, TICKET_SIZE).sort((a,b)=>a-b);
        if (combo.every(n => n >= N_MIN && n <= N_MAX)) {
          combos.push(combo);
        }
      }
    }
    return combos;
  }

  function keyForCombo(combo) {
    return combo.join('-');
  }

  function computeStats(historyCombos, winnerCombos) {
    const freq = new Array(N_MAX + 1).fill(0);
    const prizeBoost = new Array(N_MAX + 1).fill(0);

    historyCombos.forEach(c =>
      c.forEach(n => { if (n>=N_MIN && n<=N_MAX) freq[n]++; })
    );
    winnerCombos.forEach(c =>
      c.forEach(n => { if (n>=N_MIN && n<=N_MAX) prizeBoost[n]++; })
    );

    const totalHits = freq.reduce((a,b)=>a+b,0);
    const drawsCount = historyCombos.length;
    const mean = totalHits / Math.max(1, (N_MAX - N_MIN + 1));
    let varSum = 0;
    for (let n=N_MIN; n<=N_MAX; n++){
      varSum += Math.pow(freq[n] - mean, 2);
    }
    const std = Math.sqrt(varSum / Math.max(1, (N_MAX - N_MIN + 1)));

    // Build array of {n, freq, boost}
    const arr = [];
    for (let n=N_MIN; n<=N_MAX; n++){
      arr.push({ n, freq:freq[n], boost:prizeBoost[n] });
    }
    arr.sort((a,b) => b.freq - a.freq || b.boost - a.boost || a.n - b.n);

    const hotCount  = 10;
    const warmCount = 15;
    const hot  = arr.slice(0, hotCount).map(o=>o.n);
    const warm = arr.slice(hotCount, hotCount+warmCount).map(o=>o.n);
    const cold = arr.slice(hotCount+warmCount).map(o=>o.n);

    // weights
    const weights = new Array(N_MAX + 1).fill(1);
    for (let n=N_MIN; n<=N_MAX; n++){
      const base = 1 + freq[n];
      const prizeExtra = 0.6 * prizeBoost[n]; // each prize hit adds extra weight
      weights[n] = Math.max(1, base + prizeExtra);
    }

    return {
      freq,
      prizeBoost,
      weights,
      hot,
      warm,
      cold,
      drawsCount,
      mean,
      std
    };
  }

  function renderStats(stats) {
    const {freq, hot, warm, cold, drawsCount, mean, std} = stats;
    const totalHits = freq.reduce((a,b)=>a+b,0);

    function fmtList(list){
      return list.length ? list.join(' ') : '(none)';
    }

    summaryBox.innerHTML = `
      <div><strong>Draws analyzed:</strong> ${drawsCount}</div>
      <div><strong>Total hits counted:</strong> ${totalHits}</div>
      <div><strong>Avg hits per number:</strong> ${mean.toFixed(2)}
        <span class="badge">σ ≈ ${std.toFixed(2)}</span>
      </div>
      <div class="stats-row" style="margin-top:8px;">
        <span class="pill pill-hot"><strong>Hot</strong> ${fmtList(hot)}</span>
      </div>
      <div class="stats-row">
        <span class="pill pill-warm"><strong>Warm</strong> ${fmtList(warm)}</span>
      </div>
      <div class="stats-row">
        <span class="pill pill-cold"><strong>Cold</strong> ${fmtList(cold)}</span>
      </div>
    `;
  }

  function weightedPick(available, weights) {
    let total = 0;
    for (const n of available) total += weights[n];
    if (total <= 0) return available[Math.floor(Math.random()*available.length)];
    let r = Math.random() * total;
    for (const n of available) {
      r -= weights[n];
      if (r <= 0) return n;
    }
    return available[available.length-1];
  }

  // Detects sequences of consecutive numbers (e.g., 6-7-8-9).
  // Returns true if there is any run >= minLen.
  function hasSequenceRun(combo, minLen) {
    let run = 1;
    for (let i = 1; i < combo.length; i++) {
      if (combo[i] === combo[i-1] + 1) {
        run++;
        if (run >= minLen) return true;
      } else {
        run = 1;
      }
    }
    return false;
  }

  function generateTicket(weights) {
    const available = [];
    for (let n=N_MIN; n<=N_MAX; n++) available.push(n);

    const combo = [];
    for (let i=0; i<TICKET_SIZE; i++){
      const pick = weightedPick(available, weights);
      combo.push(pick);
      const idx = available.indexOf(pick);
      if (idx >= 0) available.splice(idx,1);
    }
    combo.sort((a,b)=>a-b);
    return combo;
  }

  function generateTickets(stats) {
    if (!stats) {
      ticketsBox.textContent = 'Please analyze history first.';
      return;
    }
    const {weights} = stats;
    const tickets = [];
    const seen = new Set(forbiddenSet); // copy existing forbidden combos

    let attempts = 0;
    while (tickets.length < NUM_TICKETS && attempts < 4000) {
      attempts++;
      const ticket = generateTicket(weights);
      const key = keyForCombo(ticket);

      // Block exact prize lines
      if (seen.has(key)) continue;

      // Block sequences: avoid any run of 3+ consecutive numbers
      if (hasSequenceRun(ticket, 3)) continue;

      seen.add(key);
      tickets.push(ticket);
    }

    if (!tickets.length){
      ticketsBox.textContent = 'No tickets generated (too many constraints / too little randomness).';
      return;
    }

    const lines = tickets.map((t,i)=> {
      return `
        <div class="ticket-line">
          <span class="ticket-label">#${(i+1).toString().padStart(2,'0')}</span>
          <span class="ticket-numbers">${t.join('  ')}</span>
        </div>
      `;
    }).join('');

    ticketsBox.innerHTML = lines;
  }

  analyzeBtn.addEventListener('click', () => {
    const historyCombos = parseCombos(historyInput.value);
    const winnerCombos  = parseCombos(winnersInput.value);

    // build forbidden set from winners (do NOT generate exact prize lines)
    forbiddenSet = new Set();
    winnerCombos.forEach(c => forbiddenSet.add(keyForCombo(c)));

    if (!historyCombos.length){
      summaryBox.innerHTML = '<span style="color:var(--bad);">No valid history draws detected. Paste some lines first.</span>';
      return;
    }

    lastStats = computeStats(historyCombos, winnerCombos);
    renderStats(lastStats);
    ticketsBox.textContent = 'History analyzed. Now click “Generate 10 Tight Tickets”.';
  });

  generateBtn.addEventListener('click', () => {
    generateTickets(lastStats);
  });

  // Print just the 10-ticket block
  printBtn.addEventListener('click', () => {
    const txt = ticketsBox.textContent.trim();
    if (!txt || txt.includes('Click “Generate 10 Tight Tickets”')) {
      alert('Generate your 10 tickets first before printing.');
      return;
    }
    window.print();
  });

})();
</script>
</body>
</html>
