<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>20-Ticket Tight Coach — Lotto Pattern Optimizer</title>
<style>
  :root{
    --bg:#0b1222;
    --panel:#121a33;
    --ink:#edf2ff;
    --muted:#a9b7e3;
    --accent:#8fb4ff;
    --good:#7bffb1;
    --warn:#ffd37a;
    --bad:#ff8c8c;
    --chip:#1e2a59;
    --grid:#1b2550;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{
    max-width:1400px;
    margin:0 auto;
    padding:16px;
  }
  h1{
    margin:4px 0 2px;
    font-size:1.7rem;
  }
  h2{
    margin:10px 0 6px;
    font-size:1rem;
    text-transform:uppercase;
    letter-spacing:.08em;
    color:var(--muted);
  }
  p{
    margin:4px 0 8px;
    font-size:.9rem;
    color:var(--muted);
  }
  .grid{
    display:grid;
    grid-template-columns:minmax(0,1.1fr) minmax(0,1.4fr);
    gap:14px;
    margin-top:10px;
  }
  @media (max-width:1100px){
    .grid{grid-template-columns:1fr}
  }
  .panel{
    background:var(--panel);
    border-radius:14px;
    padding:12px 14px;
    box-shadow:0 0 0 1px #141c3a,0 14px 30px rgba(0,0,0,.5);
  }
  .panel h3{
    margin:0 0 6px;
    font-size:1rem;
  }
  textarea{
    width:100%;
    min-height:130px;
    resize:vertical;
    background:#050815;
    color:var(--ink);
    border-radius:10px;
    border:1px solid #27305a;
    padding:8px;
    font-family:ui-monospace,Menlo,Consolas,monospace;
    font-size:.8rem;
  }
  label{
    display:block;
    margin:4px 0 2px;
    font-size:.8rem;
    color:var(--muted);
  }
  input[type="number"]{
    width:100%;
    padding:4px 6px;
    border-radius:8px;
    border:1px solid #27305a;
    background:#070b18;
    color:var(--ink);
    font-size:.8rem;
  }
  .row{
    display:flex;
    gap:8px;
    align-items:flex-end;
    margin-top:4px;
  }
  .row > div{flex:1}
  button{
    background:#1a245a;
    color:var(--ink);
    border-radius:999px;
    border:1px solid #27305a;
    padding:7px 12px;
    font-size:.85rem;
    cursor:pointer;
  }
  button:hover{filter:brightness(1.1)}
  .chip{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:3px 8px;
    border-radius:999px;
    background:var(--chip);
    color:var(--muted);
    font-size:.75rem;
  }
  .badge{
    display:inline-block;
    padding:2px 7px;
    border-radius:999px;
    border:1px solid #2a3a78;
    background:#0d1540;
    color:var(--muted);
    font-size:.7rem;
    text-transform:uppercase;
    letter-spacing:.08em;
  }
  .bands{
    margin-top:8px;
    font-size:.8rem;
  }
  .band-line{
    margin:2px 0;
  }
  .hot{color:#ffcc88}
  .warm{color:#8fb4ff}
  .cold{color:#7bffb1}
  .tickets-table{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    margin-top:4px;
    font-size:.8rem;
    border-radius:12px;
    overflow:hidden;
    border:1px solid #27305a;
  }
  .tickets-table th,
  .tickets-table td{
    padding:6px 8px;
    border-bottom:1px solid #1b2550;
    text-align:left;
  }
  .tickets-table th{
    background:#101b40;
    position:sticky;
    top:0;
    z-index:1;
  }
  .tickets-table tr:nth-child(even) td{
    background:#0d1634;
  }
  .tickets-table tr:nth-child(odd) td{
    background:#0b132c;
  }
  .tickets-table tr:hover td{
    background:#131f46;
  }
  .nums{
    font-family:ui-monospace,Menlo,Consolas,monospace;
  }
  .pill{
    display:inline-block;
    padding:1px 6px;
    border-radius:999px;
    font-size:.7rem;
    margin-right:4px;
  }
  .pill-ok{
    background:rgba(123,255,177,.12);
    border:1px solid rgba(123,255,177,.6);
    color:var(--good);
  }
  .pill-bad{
    background:rgba(255,140,140,.12);
    border:1px solid rgba(255,140,140,.7);
    color:var(--bad);
  }
  .summary{
    margin-top:6px;
    font-size:.8rem;
    color:var(--muted);
  }
  .summary strong{color:var(--ink)}
  .note-small{
    font-size:.75rem;
    color:var(--muted);
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>20-Ticket Tight Coach — Lotto Simulator</h1>
  <p>
    You’re capped at <strong>20 tickets per draw</strong>. This tool builds
    <strong>20 “tight” tickets</strong> using your draw history, hot/warm/cold bands,
    and pattern filters (odd/even, low/high, sum, consecutive, last-digit).
    It’s for <em>fun + training</em>, not guaranteed profit.
  </p>

  <div class="grid">
    <!-- LEFT: controls -->
    <div class="panel">
      <h3>1. Paste Official Draw History (oldest at top)</h3>
      <p class="note-small">
        Each line: 6 numbers (1–54). Spaces or commas are fine.
        The more draws you give, the better the hot/warm/cold bands.
      </p>
      <textarea id="historyInput" placeholder="Example line:
24 39 22 20 25 43
50 39 27 23 42 44
..."></textarea>

      <h3 style="margin-top:10px;">2. Banned Exact Combos (don’t repeat jackpots)</h3>
      <p class="note-small">
        Any line with exactly 6 numbers will be <strong>blocked</strong> as a ticket.
        The first one is your recent jackpot line.
      </p>
      <textarea id="bannedInput">7 17 23 28 39 48</textarea>

      <h3 style="margin-top:10px;">3. Pattern Filters (tight rules)</h3>
      <div class="row">
        <div>
          <label>Odd count (min / max)</label>
          <div class="row">
            <input id="oddMin" type="number" value="2" min="0" max="6">
            <input id="oddMax" type="number" value="4" min="0" max="6">
          </div>
        </div>
        <div>
          <label>Low numbers 1–27 (min / max)</label>
          <div class="row">
            <input id="lowMin" type="number" value="2" min="0" max="6">
            <input id="lowMax" type="number" value="4" min="0" max="6">
          </div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Sum of 6 numbers (min)</label>
          <input id="sumMin" type="number" value="100" min="0" max="300">
        </div>
        <div>
          <label>Sum of 6 numbers (max)</label>
          <input id="sumMax" type="number" value="200" min="0" max="400">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Max consecutive pairs per ticket</label>
          <input id="maxConsec" type="number" value="2" min="0" max="5">
        </div>
        <div>
          <label>Max same last-digit count</label>
          <input id="maxEnding" type="number" value="2" min="1" max="6">
        </div>
      </div>

      <h3 style="margin-top:10px;">4. Band Recipe (per ticket)</h3>
      <div class="row">
        <div>
          <label>Hot numbers per ticket</label>
          <input id="hotPer" type="number" value="2" min="0" max="6">
        </div>
        <div>
          <label>Warm numbers per ticket</label>
          <input id="warmPer" type="number" value="3" min="0" max="6">
        </div>
        <div>
          <label>Cold numbers per ticket</label>
          <input id="coldPer" type="number" value="1" min="0" max="6">
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <button id="analyzeHistoryBtn">Analyze History (build bands)</button>
        <button id="generateBtn"><strong>Generate 20 Tight Tickets</strong></button>
      </div>

      <p class="summary" id="statusBar">
        Waiting for history… you can still generate, but bands will be flat (no hot/cold).
      </p>

      <div class="bands" id="bandsView">
        <div class="band-line"><span class="badge hot">HOT</span> — (none yet)</div>
        <div class="band-line"><span class="badge warm">WARM</span> — (none yet)</div>
        <div class="band-line"><span class="badge cold">COLD</span> — (none yet)</div>
      </div>
    </div>
    <!-- RIGHT: tickets & stats -->
    <div class="panel">
      <h3>Generated Tickets (20 max per run)</h3>
      <p class="note-small">
        Each ticket is built from hot/warm/cold bands, then checked against your
        pattern filters and banned combos. No duplicate tickets in a run.
      </p>

      <table class="tickets-table" id="ticketsTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Numbers</th>
            <th>Band Mix</th>
            <th>Odd/Even</th>
            <th>Low/High</th>
            <th>Sum</th>
            <th>Consec</th>
            <th>Same End</th>
            <th>OK?</th>
          </tr>
        </thead>
        <tbody id="ticketsBody">
          <!-- rows injected by JS -->
        </tbody>
      </table>

      <div class="summary" id="summaryBox">
        No tickets yet. Click <strong>Generate 20 Tight Tickets</strong> to start.
      </div>

      <p class="note-small" style="margin-top:8px;">
        Reminder: Even tight patterns can’t beat lotto’s built-in odds.
        This is a <strong>training tool</strong> to structure your 20 plays,
        not a guarantee of wins. Keep your cap at 20 tickets / \$60.
      </p>
    </div>
  </div>
</div>
<script>
(function(){
  const N_MAX = 54;
  const HOT_COUNT = 15;
  const WARM_COUNT = 20; // rest become cold

  const historyInput = document.getElementById('historyInput');
  const bannedInput  = document.getElementById('bannedInput');

  const statusBar = document.getElementById('statusBar');
  const bandsView = document.getElementById('bandsView');
  const ticketsBody = document.getElementById('ticketsBody');
  const summaryBox = document.getElementById('summaryBox');

  const analyzeHistoryBtn = document.getElementById('analyzeHistoryBtn');
  const generateBtn = document.getElementById('generateBtn');

  const oddMinEl = document.getElementById('oddMin');
  const oddMaxEl = document.getElementById('oddMax');
  const lowMinEl = document.getElementById('lowMin');
  const lowMaxEl = document.getElementById('lowMax');
  const sumMinEl = document.getElementById('sumMin');
  const sumMaxEl = document.getElementById('sumMax');
  const maxConsecEl = document.getElementById('maxConsec');
  const maxEndingEl = document.getElementById('maxEnding');

  const hotPerEl = document.getElementById('hotPer');
  const warmPerEl = document.getElementById('warmPer');
  const coldPerEl = document.getElementById('coldPer');

  let bands = {
    hot: [],
    warm: [],
    cold: [],
    scores: [] // {n, score, freq, gap}
  };
  let bannedSet = new Set();

  function parseLines(text){
    return text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  }

  function parseNumbers(line){
    const matches = line.match(/\d+/g);
    return matches ? matches.map(v=>parseInt(v,10)).filter(n=>n>=1 && n<=N_MAX) : [];
  }

  function analyzeHistory(){
    const lines = parseLines(historyInput.value);
    const draws = [];
    lines.forEach(line=>{
      const nums = parseNumbers(line);
      if(nums.length >= 6) draws.push(nums.slice(0,6));
    });

    if(draws.length === 0){
      // flat bands
      bands.hot = [];
      bands.warm = [];
      bands.cold = [];
      bands.scores = [];
      for(let n=1;n<=N_MAX;n++){
        bands.scores.push({n, score:0, freq:0, gap:0});
      }
      // simple sequential split
      bands.hot = Array.from({length:HOT_COUNT},(_,i)=>i+1);
      bands.warm = Array.from({length:WARM_COUNT},(_,i)=>HOT_COUNT+i+1);
      bands.cold = Array.from({length:N_MAX-HOT_COUNT-WARM_COUNT},(_,i)=>HOT_COUNT+WARM_COUNT+i+1);
      statusBar.innerHTML = 'No valid draws detected — using flat bands (1–54 split into hot/warm/cold by index).';
      renderBands();
      return;
    }

    const freq = Array(N_MAX+1).fill(0);
    const lastHitIndex = Array(N_MAX+1).fill(-1);

    draws.forEach((nums,idx)=>{
      nums.forEach(n=>{
        if(n>=1 && n<=N_MAX){
          freq[n]++;
          lastHitIndex[n] = idx; // last row index where it appeared
        }
      });
    });

    const totalDraws = draws.length;
    const gaps = Array(N_MAX+1).fill(totalDraws);
    let maxGap = 0;
    for(let n=1;n<=N_MAX;n++){
      if(lastHitIndex[n] === -1){
        gaps[n] = totalDraws + 5; // never seen → treat as very overdue
      }else{
        gaps[n] = totalDraws - lastHitIndex[n];
      }
      if(gaps[n] > maxGap) maxGap = gaps[n];
    }

    const scoreArr = [];
    for(let n=1;n<=N_MAX;n++){
      const f = freq[n];
      const g = gaps[n];
      const score = f*0.7 + (g/maxGap)*0.3; // 70% frequency, 30% overdue
      scoreArr.push({n, score, freq:f, gap:g});
    }

    scoreArr.sort((a,b)=>b.score - a.score);

    bands.scores = scoreArr.slice();
    bands.hot = scoreArr.slice(0,HOT_COUNT).map(o=>o.n);
    bands.warm = scoreArr.slice(HOT_COUNT,HOT_COUNT+WARM_COUNT).map(o=>o.n);
    bands.cold = scoreArr.slice(HOT_COUNT+WARM_COUNT).map(o=>o.n);

    statusBar.innerHTML =
      `History analyzed from <strong>${draws.length}</strong> draws. ` +
      `Top hot number: <strong>${scoreArr[0].n}</strong> (freq ${scoreArr[0].freq}, gap ${scoreArr[0].gap}).`;

    renderBands();
  }

  function renderBands(){
    const hot = bands.hot.join(', ') || '(none)';
    const warm = bands.warm.join(', ') || '(none)';
    const cold = bands.cold.join(', ') || '(none)';
    bandsView.innerHTML =
      `<div class="band-line"><span class="badge hot">HOT</span> — ${hot}</div>` +
      `<div class="band-line"><span class="badge warm">WARM</span> — ${warm}</div>` +
      `<div class="band-line"><span class="badge cold">COLD</span> — ${cold}</div>`;
  }

  function buildBannedSet(){
    bannedSet.clear();
    const lines = parseLines(bannedInput.value);
    lines.forEach(line=>{
      const nums = parseNumbers(line);
      if(nums.length === 6){
        nums.sort((a,b)=>a-b);
        bannedSet.add(nums.join('-'));
      }
    });
  }

  function randomPick(arr, count){
    const copy = arr.slice();
    const chosen = [];
    for(let i=0;i<count && copy.length>0;i++){
      const idx = Math.floor(Math.random()*copy.length);
      chosen.push(copy[idx]);
      copy.splice(idx,1);
    }
    return chosen;
  }

  function generateCandidate(){
    const hotPer  = parseInt(hotPerEl.value,10)  || 0;
    const warmPer = parseInt(warmPerEl.value,10) || 0;
    const coldPer = parseInt(coldPerEl.value,10) || 0;
    const total = hotPer+warmPer+coldPer;
    if(total !== 6){
      return null;
    }

    if(bands.hot.length === 0){
      // flat split if analyzeHistory not run yet
      analyzeHistory();
    }

    const nums = [];
    nums.push(...randomPick(bands.hot,  hotPer));
    nums.push(...randomPick(bands.warm, warmPer));
    nums.push(...randomPick(bands.cold, coldPer));

    // if we somehow picked duplicates (overlapping bands), fix by random fill
    const set = new Set(nums);
    while(set.size < 6){
      const n = 1 + Math.floor(Math.random()*N_MAX);
      set.add(n);
    }
    return Array.from(set).sort((a,b)=>a-b);
  }

  function evaluateTicket(nums){
    const sorted = nums.slice().sort((a,b)=>a-b);
    let odd=0, low=0, sum=0;
    let consec=0;
    const endings = {};
    for(let i=0;i<sorted.length;i++){
      const n = sorted[i];
      if(n%2!==0) odd++;
      if(n<=27) low++;
      sum += n;
      const d = n%10;
      endings[d] = (endings[d]||0)+1;
      if(i>0 && sorted[i] === sorted[i-1]+1) consec++;
    }
    const even = sorted.length - odd;
    const high = sorted.length - low;
    let maxEnd = 0;
    Object.values(endings).forEach(v=>{ if(v>maxEnd) maxEnd=v; });

    return {nums:sorted, odd, even, low, high, sum, consec, maxEnd};
  }

  function ticketPasses(evalObj){
    const oddMin = parseInt(oddMinEl.value,10)  || 0;
    const oddMax = parseInt(oddMaxEl.value,10)  || 6;
    const lowMin = parseInt(lowMinEl.value,10)  || 0;
    const lowMax = parseInt(lowMaxEl.value,10)  || 6;
    const sumMin = parseInt(sumMinEl.value,10)  || 0;
    const sumMax = parseInt(sumMaxEl.value,10)  || 999;
    const maxConsec = parseInt(maxConsecEl.value,10) || 6;
    const maxEnding = parseInt(maxEndingEl.value,10) || 6;

    if(evalObj.odd < oddMin || evalObj.odd > oddMax) return false;
    if(evalObj.low < lowMin || evalObj.low > lowMax) return false;
    if(evalObj.sum < sumMin || evalObj.sum > sumMax) return false;
    if(evalObj.consec > maxConsec) return false;
    if(evalObj.maxEnd > maxEnding) return false;
    return true;
  }

  function classifyBands(nums){
    let h=0,w=0,c=0;
    nums.forEach(n=>{
      if(bands.hot.includes(n)) h++;
      else if(bands.warm.includes(n)) w++;
      else c++;
    });
    return {h,w,c};
  }

  function generateTickets(){
    buildBannedSet();
    if(bands.hot.length === 0) analyzeHistory();

    const desired = 20;
    const tickets = [];
    const seen = new Set();
    let attempts = 0;
    const maxAttempts = 6000;

    while(tickets.length < desired && attempts < maxAttempts){
      attempts++;
      const cand = generateCandidate();
      if(!cand) break;
      cand.sort((a,b)=>a-b);
      const key = cand.join('-');
      if(seen.has(key) || bannedSet.has(key)) continue;

      const evalObj = evaluateTicket(cand);
      if(!ticketPasses(evalObj)) continue;

      seen.add(key);
      tickets.push(evalObj);
    }

    renderTickets(tickets, attempts, desired);
  }

  function renderTickets(tickets, attempts, desired){
    ticketsBody.innerHTML = '';
    if(tickets.length === 0){
      summaryBox.innerHTML = 'No tickets satisfied all filters. Relax filters slightly (sum range, odd/low limits, etc.) and try again.';
      return;
    }

    tickets.forEach((t,idx)=>{
      const tr = document.createElement('tr');

      const tdIdx = document.createElement('td');
      tdIdx.textContent = idx+1;
      tr.appendChild(tdIdx);

      const tdNums = document.createElement('td');
      tdNums.className = 'nums';
      tdNums.textContent = t.nums.join('  ');
      tr.appendChild(tdNums);

      const bc = classifyBands(t.nums);
      const tdBand = document.createElement('td');
      tdBand.innerHTML =
        `<span class="pill pill-ok">H:${bc.h}</span>`+
        `<span class="pill pill-ok">W:${bc.w}</span>`+
        `<span class="pill pill-ok">C:${bc.c}</span>`;
      tr.appendChild(tdBand);

      const tdOddEven = document.createElement('td');
      tdOddEven.textContent = `${t.odd} / ${t.even}`;
      tr.appendChild(tdOddEven);

      const tdLowHigh = document.createElement('td');
      tdLowHigh.textContent = `${t.low} / ${t.high}`;
      tr.appendChild(tdLowHigh);

      const tdSum = document.createElement('td');
      tdSum.textContent = t.sum;
      tr.appendChild(tdSum);

      const tdCon = document.createElement('td');
      tdCon.textContent = t.consec;
      tr.appendChild(tdCon);

      const tdEnd = document.createElement('td');
      tdEnd.textContent = t.maxEnd;
      tr.appendChild(tdEnd);

      const tdOk = document.createElement('td');
      const span = document.createElement('span');
      span.className = 'pill pill-ok';
      span.textContent = 'PASS';
      tdOk.appendChild(span);
      tr.appendChild(tdOk);

      ticketsBody.appendChild(tr);
    });

    summaryBox.innerHTML =
      `Generated <strong>${tickets.length}</strong> tickets (target ${desired}) ` +
      `after <strong>${attempts}</strong> attempts. ` +
      (tickets.length<desired
        ? 'Filters may be very tight — you can relax them slightly if you want more variety.'
        : 'These 20 are your “tight” plays for this draw — stay inside your \$60 cap.');
  }

  analyzeHistoryBtn.addEventListener('click', analyzeHistory);
  generateBtn.addEventListener('click', generateTickets);

  // Initial basic bands (flat split)
  analyzeHistory();
})();
</script>
</body>
</html>
