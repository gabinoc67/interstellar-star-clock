<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>üåå Warp Simulation ‚Äì CST Synced</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      padding: 10px;
    }
    .info-box {
      background: #111;
      color: #fff;
      padding: 10px;
      margin: 5px;
      width: 48%;
      border: 1px solid #444;
      border-radius: 8px;
    }
    select, button {
      margin: 5px;
      padding: 6px 12px;
      font-size: 1em;
      background: #000;
      color: #fff;
      border: 1px solid #555;
      border-radius: 6px;
    }
    canvas {
      display: block;
      margin: 10px auto;
      background: #000;
      border: 1px solid #333;
    }
  </style>
</head>
<body>

  <h1 style="text-align:center; padding:10px">üöÄ Warp Simulation</h1>

  <div class="controls">
    <div class="info-box">
      üåç CST Time: <span id="cstClock">--:--:--</span><br>
      üì° Distance: <span id="vector">-- AU</span><br>
      üß≠ Angle: <span id="angle">--¬∞</span><br>
      üïì Departure: <span id="cstTime">--</span><br>
      üõ¨ Arrival: <span id="arrival">--</span>
    </div>
    <div class="info-box">
      <select id="targetPlanet">
        <option value="199">Mercury</option>
        <option value="299">Venus</option>
        <option value="499">Mars</option>
        <option value="599">Jupiter</option>
        <option value="699">Saturn</option>
        <option value="799">Uranus</option>
        <option value="899">Neptune</option>
        <option value="999">Pluto</option>
      </select>
      <select id="warpSpeed">
        <option value="1">Warp 1</option>
        <option value="2">Warp 2</option>
        <option value="3">Warp 3</option>
        <option value="4">Warp 4</option>
        <option value="5" selected>Warp 5</option>
        <option value="6">Warp 6</option>
        <option value="7">Warp 7</option>
        <option value="8">Warp 8</option>
        <option value="9">Warp 9</option>
        <option value="10">Warp 10</option>
      </select><br>
      <button onclick="engageWarp()">Engage Warp</button>
      <button onclick="resetMap()">Reset</button>
      <button onclick="screenshotMap()">üì∏ Screenshot</button>
    </div>
  </div>

  <canvas id="orbitCanvas" width="900" height="900"></canvas>

  <audio id="warpSound">
    <source src="data:audio/ogg;base64,T2dnUwACAAAAAAAAAAA+qWAAAAAAABjYXRhdgAAAA8AAAAA//tAxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" type="audio/ogg">
  </audio>

  <script>
    const canvas = document.getElementById("orbitCanvas");
    const ctx = canvas.getContext("2d");
    const warpSound = document.getElementById("warpSound");

    const planetNames = {
      "199": "Mercury", "299": "Venus", "499": "Mars", "599": "Jupiter",
      "699": "Saturn", "799": "Uranus", "899": "Neptune", "999": "Pluto"
    };

    const AU_SCALE = 10; // scaled up for visibility
    const ORBIT_RADIUS = {
      "199": 2.0, "299": 3.5, "499": 5.0,
      "599": 6.5, "699": 7.5, "799": 8.5, "899": 9.5, "999": 10.5
    };

    let shipAnim = null;
    let currentAngle = 0, currentDistance = 1, currentLabel = "", currentWarp = 5;

    function updateTime() {
      const now = new Date();
      const options = { timeZone: 'America/Chicago', hour12: true };
      document.getElementById("cstClock").textContent = now.toLocaleTimeString('en-US', options);
    }
    setInterval(updateTime, 1000); updateTime();

    function drawSystem() {
      const cx = canvas.width / 2, cy = canvas.height / 2;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw orbits
      Object.values(ORBIT_RADIUS).forEach(rAU => {
        ctx.beginPath();
        ctx.arc(cx, cy, rAU * AU_SCALE, 0, 2 * Math.PI);
        ctx.strokeStyle = "#333";
        ctx.stroke();
      });

      // Sun
      ctx.beginPath();
      ctx.arc(cx, cy, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "yellow";
      ctx.fill();

      // Earth
      ctx.beginPath();
      ctx.arc(cx + AU_SCALE, cy, 6, 0, 2 * Math.PI);
      ctx.fillStyle = "#0ff";
      ctx.fill();
    }

    function drawScene(angleDeg, distanceAU, warpLevel) {
      drawSystem();
      const cx = canvas.width / 2, cy = canvas.height / 2;
      const earthX = cx + AU_SCALE, earthY = cy;
      const rad = angleDeg * Math.PI / 180;
      const planetX = cx + distanceAU * AU_SCALE * Math.cos(rad);
      const planetY = cy + distanceAU * AU_SCALE * Math.sin(rad);

      const midX = (earthX + planetX) / 2;
      const midY = (earthY + planetY) / 2 - 80 * (1 - warpLevel / 10);

      ctx.beginPath();
      ctx.moveTo(earthX, earthY);
      ctx.quadraticCurveTo(midX, midY, planetX, planetY);
      ctx.setLineDash([5, 3]);
      ctx.strokeStyle = "#0f0";
      ctx.stroke();
      ctx.setLineDash([]);

      ctx.beginPath();
      ctx.arc(planetX, planetY, 6, 0, 2 * Math.PI);
      ctx.fillStyle = "#f00";
      ctx.fill();

      return { earthX, earthY, midX, midY, planetX, planetY };
    }

    function animateShip(path, duration) {
      if (shipAnim) cancelAnimationFrame(shipAnim);
      const start = performance.now();

      function step(now) {
        const t = Math.min((now - start) / duration, 1);
        const x = (1 - t) ** 2 * path.earthX + 2 * (1 - t) * t * path.midX + t ** 2 * path.planetX;
        const y = (1 - t) ** 2 * path.earthY + 2 * (1 - t) * t * path.midY + t ** 2 * path.planetY;
        drawScene(currentAngle, currentDistance, currentWarp);
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, 2 * Math.PI);
        ctx.fillStyle = "#fff";
        ctx.fill();

        if (t < 1) shipAnim = requestAnimationFrame(step);
        else warpSound.pause();
      }
      warpSound.currentTime = 0;
      warpSound.play();
      shipAnim = requestAnimationFrame(step);
    }

    async function engageWarp() {
      const planetId = document.getElementById("targetPlanet").value;
      const warp = parseInt(document.getElementById("warpSpeed").value);
      currentWarp = warp;

      try {
        const res = await fetch(`https://ssd.jpl.nasa.gov/api/horizons.api?format=text&COMMAND='${planetId}'&CENTER='@sun'&MAKE_EPHEM='YES'&EPHEM_TYPE='VECTORS'&OUT_UNITS='AU-D'&VEC_TABLE='3'&START_TIME='NOW'&STOP_TIME='NOW'&STEP_SIZE='1 d'`);
        const text = await res.text();
        const line = text.split('\n').find(l => l.includes('X=') && l.includes('Y='));
        const x = parseFloat(line.match(/X= *([-\.\d]+)/)[1]);
        const y = parseFloat(line.match(/Y= *([-\.\d]+)/)[1]);
        const z = parseFloat(line.match(/Z= *([-\.\d]+)/)[1]);
        const distance = Math.sqrt(x * x + y * y + z * z).toFixed(3);
        const angle = (Math.atan2(y, x) * 180 / Math.PI).toFixed(1);
        currentDistance = parseFloat(distance);
        currentAngle = parseFloat(angle);
      } catch (e) {
        currentDistance = 1.52;
        currentAngle = 45;
      }

      const now = new Date();
      const travelSeconds = (currentDistance / warp) * 600;
      const arrival = new Date(now.getTime() + travelSeconds * 1000);
      const options = { timeZone: 'America/Chicago', hour12: true };

      document.getElementById("vector").textContent = currentDistance.toFixed(2) + " AU";
      document.getElementById("angle").textContent = currentAngle.toFixed(1) + "¬∞";
      document.getElementById("cstTime").textContent = now.toLocaleTimeString('en-US', options);
      document.getElementById("arrival").textContent = arrival.toLocaleTimeString('en-US', options);

      const path = drawScene(currentAngle, currentDistance, warp);
      animateShip(path, travelSeconds * 1000);
    }

    function resetMap() {
      if (shipAnim) cancelAnimationFrame(shipAnim);
      drawSystem();
      warpSound.pause();
      document.getElementById("vector").textContent = "-- AU";
      document.getElementById("angle").textContent = "--¬∞";
      document.getElementById("arrival").textContent = "--";
      document.getElementById("cstTime").textContent = "--";
    }

    function screenshotMap() {
      const link = document.createElement("a");
      link.download = "warp_map.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }

    drawSystem();
  </script>

</body>
</html>
