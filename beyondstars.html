<script>
// ✅ STEP 1: Automatically calculate GVE settings on destination/warp change

function autoCalculateGVE(){
  const dest = $("destination").value;
  const warp = Number($("warpSpeed").value || 1);
  const { dAU } = computeETASeconds(); // get distance in AU

  // Gravity curve baseline by planet
  const gravityMap = {
    Mercury: [34, 66],
    Venus:   [36, 64],
    Mars:    [35, 65],
    Jupiter: [38, 62],
    Saturn:  [37, 63],
    Uranus:  [33, 67],
    Neptune: [32, 68],
    Pluto:   [30, 70]
  };
  const [fBase, rBase] = gravityMap[dest] || [35, 65];

  // Adjust front/rear based on distance (longer = more rear bias)
  const distFactor = Math.min(1, dAU / 5); // Normalize 0–1
  const frontPct = Math.round(fBase - distFactor * 2);
  const rearPct  = 100 - frontPct;

  // Reactor power scaling with warp level
  const reactorMW = Math.round(4000 + 600 * warp);

  // Bias = 0, Intake = balanced
  $("frontPct").value = frontPct;
  $("rearPct").value = rearPct;
  $("reactorMW").value = reactorMW;
  $("lrBias").value = 0;
  $("udBias").value = 0;
  $("intakeMode").value = "balanced";

  // Update live display labels
  $("frontLbl").textContent = `${frontPct}%`;
  $("rearLbl").textContent = `${rearPct}%`;
  $("lrLbl").textContent = `0%`;
  $("udLbl").textContent = `0%`;

  // Trigger visual + physics refresh
  drawCurve();
  validateGR();
}

// ✅ Hook into warp and destination controls
["warpSpeed", "destination"].forEach(id => {
  const el = $(id);
  el.addEventListener("input", autoCalculateGVE);
});
</script>
