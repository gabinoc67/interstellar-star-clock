<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>🪐 Interstellar Star Clock — Solar System + Planet Clocks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --fg:#00ffcc; --gap: clamp(10px, 2vmin, 22px); --pad: clamp(10px, 2vmin, 18px); }
    *{ box-sizing: border-box; }
    body{
      background:#000; color:var(--fg); font-family:'Courier New', monospace;
      margin:0; min-height:100vh; display:flex; justify-content:center; padding: var(--pad);
    }
    /* 3-column layout: Solar (L) | Info (C) | Planet image (R) */
    .wrap{
      display:grid;
      grid-template-columns: minmax(360px, 1.25fr) minmax(360px, 1fr) minmax(240px, .85fr);
      gap: var(--gap);
      max-width: min(1400px, 98vw);
      width:100%;
      align-items:start;
    }
    header{
      grid-column: 1 / -1; display:flex; justify-content:space-between; align-items:center; gap: var(--gap);
    }
    /* Smaller, tighter title */
    h1{ margin:0; font-size: clamp(0.75rem, 1.8vw, 1.2rem); line-height:1.12; letter-spacing:.4px; }
    .controls{ display:flex; align-items:center; gap:.5rem; font-size: clamp(.8rem, 1.4vw, .95rem); }
    select{
      background:#001a16; color:var(--fg); border:1px solid #064e3b; padding:.25rem .45rem; border-radius:6px;
    }

    /* LEFT: Solar system canvas only (bigger) */
    .solar { display:flex; justify-content:center; align-items:center; }
    canvas{ width:100%; max-width:680px; aspect-ratio:1 / 1; background:#000; border:1px solid #064e3b; border-radius:10px; }

    /* CENTER: Info panel */
    .content{ text-align:center; padding: var(--pad); }
    h2{ margin:.2rem 0 .35rem; font-size: clamp(.9rem, 1.7vw, 1.2rem); }
    .clock-box{ margin-top: .7rem; font-size: clamp(.8rem, 1.3vw, 1.05rem); }
    .muted{ opacity:.85; font-size:.95em; }

    /* RIGHT: Planet image */
    .planet-image{ display:flex; justify-content:center; align-items:center; }
    .planet-image img{ width:min(26vw, 42vh, 340px); height:auto; display:block; }

    @media (max-width: 1100px){
      .wrap{
        grid-template-columns: 1fr;  /* Stack on small screens: Solar -> Info -> Image */
      }
      .planet-image img{ width:min(60vw, 48vh, 340px); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>🪐 Interstellar Star Clock — Solar System (live) + <span id="titlePlanet">Earth</span> Clocks</h1>
      <div class="controls">
        <label for="planet">Planet:</label>
        <select id="planet">
          <option>Mercury</option><option>Venus</option><option selected>Earth</option>
          <option>Mars</option><option>Jupiter</option><option>Saturn</option>
          <option>Uranus</option><option>Neptune</option><option>Pluto</option>
        </select>
      </div>
    </header>

    <!-- LEFT: Solar system -->
    <div class="solar">
      <canvas id="solarCanvas"></canvas>
    </div>

    <!-- CENTER: Selected planet readouts -->
    <div class="content">
      <div class="clock-box">
        <h2>🌍 Local Time (America/Chicago)</h2>
        <div id="localClock"></div>
      </div>

      <div class="clock-box">
        <h2>🌌 Interstellar Time</h2>
        <div id="interstellarClock" class="muted"></div>
      </div>

      <div class="clock-box">
        <h2>🚀 Stardate</h2>
        <div id="starDate" class="muted"></div>
      </div>

      <div class="clock-box">
        <h2>📏 Distance from Sun</h2>
        <div id="distanceFromSun"></div>
        <div id="distanceAU" class="muted"></div>
      </div>

      <div class="clock-box">
        <h2>📐 Distance from Earth</h2>
        <div id="distanceFromEarth"></div>
        <div id="distanceEarthAU" class="muted"></div>
      </div>

      <div class="clock-box">
        <h2>🔭 Orbital Position</h2>
        <div id="trueAnomaly"></div>
      </div>

      <div class="clock-box">
        <h2>🕛 Orbit Clock (since perihelion)</h2>
        <div id="orbitSince"></div>
        <div id="orbitRemaining"></div>
        <div id="orbitPercent"></div>
        <div id="orbitDetails" class="muted"></div>
      </div>
    </div>

    <!-- RIGHT: Planet image -->
    <div class="planet-image">
      <img id="planetImg" alt="Planet image">
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    // ---------- Constants & helpers ----------
    const DEG2RAD = Math.PI / 180, RAD2DEG = 180 / Math.PI, AU_TO_MILES = 92955807.3;
    function norm360(x){ x = x % 360; return x < 0 ? x + 360 : x; }
    function norm2pi(x){ x = x % (2*Math.PI); return x < 0 ? x + 2*Math.PI : x; }

    function toJulianDate(dateUTC) {
      const a = Math.floor((14 - (dateUTC.getUTCMonth()+1)) / 12);
      const y = dateUTC.getUTCFullYear() + 4800 - a;
      const m = (dateUTC.getUTCMonth()+1) + 12*a - 3;
      const JDN = dateUTC.getUTCDate()
        + Math.floor((153*m + 2)/5)
        + 365*y + Math.floor(y/4) - Math.floor(y/100) + Math.floor(y/400) - 32045;
      const dayFrac = (dateUTC.getUTCHours() - 12)/24
        + dateUTC.getUTCMinutes()/1440 + dateUTC.getUTCSeconds()/86400
        + dateUTC.getUTCMilliseconds()/86400000;
      return JDN + dayFrac;
    }
    function dhmsDays(totalDays) {
      const sign = totalDays < 0 ? "-" : "";  // ← fixed
      totalDays = Math.abs(totalDays);
      const d = Math.floor(totalDays);
      const h = Math.floor((totalDays - d) * 24);
      const m = Math.floor(((totalDays - d) * 24 - h) * 60);
      const s = Math.floor(((((totalDays - d) * 24 - h) * 60) - m) * 60);
      return `${sign}${d}d ${h}h ${m}m ${s}s`;
    }

    // ---------- J2000 orbital elements + secular rates ----------
    const PLANETS = {
      Mercury:{ a:0.38709893, da:0.00000066, e:0.20563069, de:0.00002527,
        L:252.25084, dL:149472.67411175, varpi:77.45645, dvarpi:0.16047689,
        Omega:48.33167, dOmega:0.159400, i:7.00487, di:-0.005951,
        P:87.9691, color:"#9ad"
      },
      Venus:{ a:0.72333199, da:0.00000092, e:0.00677323, de:-0.00004938,
        L:181.97973, dL:58517.81538729, varpi:131.56370, dvarpi:0.0020708,
        Omega:76.68069, dOmega:-0.272741, i:3.39471, di:-0.000789,
        P:224.701, color:"#f7c"
      },
      Earth:{ a:1.00000011, da:-0.00000005, e:0.01671022, de:-0.00003804,
        L:100.46435, dL:35999.37285429, varpi:102.93735, dvarpi:0.32327364,
        Omega:-11.26064, dOmega:-0.003417, i:0.00005, di:-0.013371,
        P:365.256363004, color:"#0fc"
      },
      Mars:{ a:1.52366231, da:-0.00007221, e:0.09341233, de:0.00011902,
        L:-4.553432, dL:19140.30268499, varpi:-23.943629, dvarpi:0.44441088,
        Omega:49.57854, dOmega:0.772092, i:1.85061, di:-0.008473,
        P:686.971, color:"#f66"
      },
      Jupiter:{ a:5.20336301, da:0.00060737, e:0.04839266, de:-0.00012880,
        L:34.351484, dL:3034.90567464, varpi:14.331309, dvarpi:0.2155525,
        Omega:100.55615, dOmega:0.204691, i:1.30530, di:-0.001837,
        P:4332.59, color:"#ffb"
      },
      Saturn:{ a:9.53707032, da:-0.00301530, e:0.05415060, de:-0.00036762,
        L:50.077471, dL:1222.11379404, varpi:93.057237, dvarpi:0.5665415,
        Omega:113.71504, dOmega:-0.208741, i:2.48446, di:0.002043,
        P:10759.22, color:"#fb9"
      },
      Uranus:{ a:19.19126393, da:0.00152025, e:0.04716771, de:-0.00019150,
        L:314.055005, dL:428.46699831, varpi:173.005159, dvarpi:0.1686465,
        Omega:74.22988, dOmega:-0.204, i:0.76986, di:-0.000,
        P:30688.5, color:"#9ff"
      },
      Neptune:{ a:30.06896348, da:-0.00125196, e:0.00858587, de:0.00002510,
        L:304.348665, dL:218.48620020, varpi:48.123691, dvarpi:0.0259423,
        Omega:131.72169, dOmega:1.180, i:1.76917, di:-0.000,
        P:60182, color:"#9bf"
      },
      Pluto:{ a:39.48168677, da:-0.00076912, e:0.24880766, de:0.00006465,
        L:238.92881, dL:145.20780515, varpi:224.06676, dvarpi:-0.04062942,
        Omega:110.30347, dOmega:-0.011, i:17.14175, di:0.000,
        P:90560, color:"#ddd"
      }
    };

    // ---------- Kepler solver ----------
    function solveKeplerElliptic(M, e) { // M in rad
      let E = (e < 0.8) ? M : Math.PI;
      for (let i=0; i<20; i++){
        const f = E - e*Math.sin(E) - M;
        const f1 = 1 - e*Math.cos(E);
        const dE = -f / f1;
        E += dE;
        if (Math.abs(dE) < 1e-12) break;
      }
      return E;
    }

    // Heliocentric state (x,y in AU on ecliptic), orbital progress
    function orbitState(name, dateUTC){
      const p = PLANETS[name];
      const JD = toJulianDate(dateUTC);
      const T = (JD - 2451545.0) / 36525.0; // centuries from J2000.0

      const a = p.a + p.da*T;
      const e = p.e + p.de*T;
      const L = p.L + p.dL*T;
      const varpi = p.varpi + p.dvarpi*T;
      const Omega = p.Omega + p.dOmega*T;
      const i = (p.i + (p.di||0)*T) * DEG2RAD;
      const omega = norm360(varpi - Omega);

      const Mdeg = norm360(L - varpi);
      const M = Mdeg * DEG2RAD;

      const Pdays = p.P;            // sidereal period (days)
      const n = 2*Math.PI / Pdays;  // mean motion (rad/day)

      const E = solveKeplerElliptic(M, e);
      const rAU = a * (1 - e*Math.cos(E));
      const nu = 2*Math.atan2(Math.sqrt(1+e)*Math.sin(E/2), Math.sqrt(1-e)*Math.cos(E/2));
      const nudeg = norm2pi(nu) * RAD2DEG;

      // Projected heliocentric position in ecliptic plane (AU)
      const Ω = Omega * DEG2RAD, ω = (norm360(varpi - Omega)) * DEG2RAD;
      const u = ω + nu;
      const cosΩ = Math.cos(Ω), sinΩ = Math.sin(Ω), cosi = Math.cos(i);
      const x = rAU * (cosΩ*Math.cos(u) - sinΩ*Math.sin(u)*cosi);
      const y = rAU * (sinΩ*Math.cos(u) + cosΩ*Math.sin(u)*cosi);

      const Mnorm = norm2pi(M);
      const sinceDays = Mnorm / n;
      const remainDays = (2*Math.PI - Mnorm) / n;
      const pct = (Mnorm / (2*Math.PI)) * 100;

      return { aAU:a, e, Mdeg, nudeg, rAU, sinceDays, remainDays, percent:pct, x, y, color:p.color };
    }

    // ---------- Planet images ----------
    const IMG = {
      Mercury:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/mercury2.png",
      Venus:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/venus2.png",
      Earth:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/earth.png",
      Mars:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/mars.png",
      Jupiter:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/jupiter.png",
      Saturn:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/saturn.png",
      Uranus:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/uranus.png",
      Neptune:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/neptune2.png",
      Pluto:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/pluto2.png"
    };
    function setPlanetImage(name){
      const img = document.getElementById('planetImg');
      img.src = IMG[name] || "";
      img.alt = name;
    }

    // ---------- SOLAR SYSTEM CANVAS ----------
    const solarCanvas = document.getElementById('solarCanvas');
    const sctx = solarCanvas.getContext('2d');

    function resizeSolar(){
      const css = solarCanvas.getBoundingClientRect();
      const ratio = Math.max(1, Math.floor(window.devicePixelRatio || 1));
      const w = Math.max(340, Math.floor(css.width * ratio));
      const h = Math.max(340, Math.floor(css.height * ratio));
      solarCanvas.width = w;
      solarCanvas.height = h;
      sctx.setTransform(ratio, 0, 0, ratio, 0, 0);
    }
    window.addEventListener('resize', () => { resizeSolar(); drawSolar(); });

    function drawSolar(){
      const now = new Date();
      resizeSolar();
      const w = solarCanvas.clientWidth, h = solarCanvas.clientHeight;
      const cx = w/2, cy = h/2;

      const names = Object.keys(PLANETS);
      const states = names.map(n => ({ name:n, st: orbitState(n, new Date(now.toISOString())) }));

      // Farthest distance for outer scale
      const maxR_AU = Math.max(...states.map(o => Math.hypot(o.st.x, o.st.y)));
      const Rpx = Math.min(cx, cy) * 0.88;    // total drawable radius

      // Two-zone radial scaling
      const R_BREAK_AU = 6;
      const R_INNER_PCT = 0.70;
      const R_INNER_PX = Rpx * R_INNER_PCT;
      const R_OUTER_PX = Rpx - R_INNER_PX;
      const OUTER_SPAN_AU = Math.max(0.0001, maxR_AU - R_BREAK_AU);

      function radiusPx(rAU){
        // ===== Inner planet expansion (< 2 AU) =====
        if (rAU <= 2) {
          // exaggerate inner spacing by 1.5× inside the inner zone footprint
          return Math.min(
            R_INNER_PX,                 // never exceed inner zone radius
            (rAU / 2) * (R_INNER_PX * 1.5)
          );
        }
        // Normal scaling for the rest of the inner system up to R_BREAK_AU
        if (rAU <= R_BREAK_AU) {
          return (rAU / R_BREAK_AU) * R_INNER_PX;
        }
        // Outer planet scaling remains the same
        return R_INNER_PX + ((rAU - R_BREAK_AU) / OUTER_SPAN_AU) * R_OUTER_PX;
      }

      // Clear
      sctx.clearRect(0,0,w,h);

      // --- Degree ticks (outer rim) ---
      const rimR = Rpx;
      const minorLen = 6, majorLen = 12;
      sctx.strokeStyle = "rgba(255,255,255,0.25)";
      sctx.fillStyle = "rgba(255,255,255,0.6)";
      sctx.font = "10px 'Courier New', monospace";

      for (let deg = 0; deg < 360; deg += 10) {
        const rad = deg * DEG2RAD;
        const len = (deg % 30 === 0) ? majorLen : minorLen;
        const x1 = cx + (rimR - len) * Math.cos(rad);
        const y1 = cy + (rimR - len) * Math.sin(rad);
        const x2 = cx + rimR * Math.cos(rad);
        const y2 = cy + rimR * Math.sin(rad);
        sctx.beginPath();
        sctx.moveTo(x1,y1); sctx.lineTo(x2,y2); sctx.stroke();

        if (deg % 30 === 0) {
          const lx = cx + (rimR - majorLen - 14) * Math.cos(rad);
          const ly = cy + (rimR - majorLen - 14) * Math.sin(rad);
          sctx.fillText(`${deg}°`, lx - 8, ly + 3);
        }
      }

      // --- AU guide rings + labels ---
      const ringMarksAU = [1,2,3,4,5,6,8,10,15,20,30,40];
      sctx.strokeStyle = "rgba(255,255,255,0.14)";
      sctx.lineWidth = 1;
      sctx.fillStyle = "rgba(255,255,255,0.55)";
      sctx.font = "11px 'Courier New', monospace";
      for(const mark of ringMarksAU){
        if (mark <= maxR_AU + 0.1){
          const r = radiusPx(mark);
          sctx.beginPath();
          sctx.arc(cx, cy, r, 0, Math.PI*2);
          sctx.stroke();
          const lx = cx + r + 6;
          const ly = cy + 3;
          sctx.fillText(`${mark} AU`, lx, ly);
        }
      }

      // Sun
      sctx.beginPath();
      sctx.arc(cx, cy, 6, 0, Math.PI*2);
      sctx.fillStyle = "#ffd27f";
      sctx.fill();

      // Planets + labels
      sctx.font = "11px 'Courier New', monospace";
      for(const {name, st} of states){
        const color = PLANETS[name].color || "#fff";
        const ang = Math.atan2(st.y, st.x);
        const r = radiusPx(Math.hypot(st.x, st.y));
        const x = cx + r * Math.cos(ang);
        const y = cy + r * Math.sin(ang);

        const dotR = (st.aAU < 2 ? 4.2 : (st.aAU < 6 ? 3.8 : 3.2));
        sctx.beginPath();
        sctx.arc(x, y, dotR, 0, Math.PI*2);
        sctx.fillStyle = color;
        sctx.fill();

        const lx = x + (7 + dotR) * Math.cos(ang);
        const ly = y + (7 + dotR) * Math.sin(ang);
        sctx.fillStyle = color;
        sctx.fillText(name, lx, ly);
      }

      // Footer timestamp
      sctx.fillStyle = "#aaa";
      sctx.fillText(`Positions @ ${now.toUTCString()} (inner expanded to 6 AU; outer compressed)`, 10, h - 12);
    }

    // ---------- CLOCKS / READOUTS ----------
    const planetEl = document.getElementById('planet');
    const titlePlanet = document.getElementById('titlePlanet');

    function updateClocks() {
      const now = new Date();
      const planet = planetEl.value;
      titlePlanet.textContent = planet;

      // Local time (America/Chicago)
      const chicago = new Intl.DateTimeFormat('en-US', {
        timeZone: 'America/Chicago',
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      }).format(now);
      document.getElementById("localClock").textContent = `${chicago} (America/Chicago)`;

      // Interstellar & Stardate (cosmetic)
      const start = new Date("2000-01-01T00:00:00Z");
      const nowDays = (now - start) / 86400000;
      const elapsedYears = nowDays / 365.25;
      const interstellarYears = elapsedYears * 2.26e6;
      document.getElementById("interstellarClock").textContent =
        "Year ~" + Number(interstellarYears.toFixed(2)).toLocaleString();
      const stardate = 40000 + (elapsedYears * 1000);
      document.getElementById("starDate").textContent = "Stardate " + stardate.toFixed(1);

      // Selected planet heliocentric distance
      const st = orbitState(planet, new Date(now.toISOString()));
      const milesSun = st.rAU * AU_TO_MILES;
      document.getElementById("distanceFromSun").textContent =
        Math.round(milesSun).toLocaleString() + " miles";
      document.getElementById("distanceAU").textContent =
        st.rAU.toFixed(6) + " AU";

      // Earth ↔ planet distance (geocentric, planar)
      const stEarth = orbitState("Earth", new Date(now.toISOString()));
      let dx = st.x - stEarth.x;
      let dy = st.y - stEarth.y;
      if (planet === "Earth"){ dx = 0; dy = 0; }
      const rEarthAU = Math.hypot(dx, dy);
      const milesEarth = rEarthAU * AU_TO_MILES;

      document.getElementById("distanceFromEarth").textContent =
        Math.round(milesEarth).toLocaleString() + " miles";
      document.getElementById("distanceEarthAU").textContent =
        rEarthAU.toFixed(6) + " AU";

      document.getElementById("trueAnomaly").textContent =
        `${st.nudeg.toFixed(4)}° true anomaly from perihelion`;

      document.getElementById("orbitSince").textContent =
        `Elapsed since perihelion (${planet}): ${dhmsDays(st.sinceDays)}`;
      document.getElementById("orbitRemaining").textContent =
        `Time to next perihelion (${planet}): ${dhmsDays(st.remainDays)}`;
      document.getElementById("orbitPercent").textContent =
        `Orbit completion (${planet}): ${st.percent.toFixed(6)}%`;
      document.getElementById("orbitDetails").textContent =
        `a=${st.aAU.toFixed(6)} AU, e=${st.e.toFixed(6)} | M=${st.Mdeg.toFixed(4)}°, ν=${st.nudeg.toFixed(4)}°`;
    }

    // ---------- Wiring ----------
    planetEl.addEventListener('change', () => {
      setPlanetImage(planetEl.value);
      updateClocks();
    });

    // Initial boot
    setPlanetImage(planetEl.value);
    updateClocks();
    drawSolar();
    setInterval(drawSolar, 1000);    // live solar view
    setInterval(updateClocks, 1000); // live readouts
  });
  </script>
</body>
</html>
