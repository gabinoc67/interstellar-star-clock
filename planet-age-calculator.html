<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ü™ê Planetary Age Calculator ‚Äî Compact + Reference Year</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --teal:#00ffff; }
    body { background:#000; color:#fff; font-family:"Courier New", monospace; text-align:center; padding:36px; }
    h1 { font-size:2.24em; color:var(--teal); margin:0 0 .3em; }
    p, label { font-size:1.32em; margin:.5em 0; }            /* +20% from ~1.1em */
    .controls, .row { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; align-items:flex-end; }
    .field { display:flex; flex-direction:column; gap:6px; min-width: 230px; }
    .field label { font-size:1.14em; color:#9ff; opacity:.9; text-align:left; }  /* +20% */
    input, select, button {
      padding:10px 12px; font-size:1.08em; border-radius:10px; border:1px solid #0aa; background:#061b1b; color:#d9ffff;
    }
    input[type="date"], input[type="time"] { min-width: 200px; }
    input[type="text"]::placeholder { color:#8fe; opacity:.8; }
    button { background:var(--teal); color:#000; border:none; cursor:pointer; padding:12px 16px; }
    button.secondary { background:#083a3d; color:#9ff; border:1px solid #0aa; }
    #results { margin-top:22px; }
    table { margin:18px auto 0; border-collapse:collapse; color:var(--teal); font-size:1.06em; width:min(980px, 92vw); }
    th, td { border:2px solid var(--teal); padding:10px 14px; }
    th { background:#003f3f; }
    .note { font-size:1.0em; color:#9ff; opacity:.9; margin-top:8px; }
    .summary { margin-top:12px; color:#9ff; }
    .inline { display:inline-flex; gap:8px; align-items:center; }
    .hidden { display:none; }
    .tight { max-width: 1100px; margin: 0 auto; }
  </style>
</head>
<body>
  <h1>ü™ê Planetary Age Calculator</h1>
  <p class="tight">Enter your <strong>local birth date & time</strong>, choose your <strong>Area ‚Üí Country ‚Üí Time Zone</strong>, then pick a <strong>Reference Year</strong> to see your age in that year.</p>

  <!-- Controls (map removed) -->
  <div class="controls">

    <!-- Birth date/time (explicit 12-hour with AM/PM) -->
    <div class="field">
      <label for="birthdate">Birth date (MM/DD/YYYY)</label>
      <input type="date" id="birthdate">
      <div id="rangeHelp" class="note"></div>
    </div>
    <div class="field">
      <label>Time of birth</label>
      <div class="inline">
        <input type="time" id="birthtime" step="1" value="01:00:00" style="min-width:160px">
        <select id="ampm" aria-label="AM or PM">
          <option>AM</option>
          <option>PM</option>
        </select>
      </div>
      <div class="note">Example: 01:00:00 + AM/PM</div>
    </div>

    <!-- Reference year selection -->
    <div class="field">
      <label for="refYear">Reference year</label>
      <select id="refYear"></select>
      <div class="note">From current year up to +20 years (max 2045)</div>
    </div>

    <!-- Area / Country / Time zone -->
    <div class="field">
      <label for="areaFilter">Area</label>
      <select id="areaFilter">
        <option value="">All Areas</option>
        <option>Africa</option>
        <option>America</option>
        <option>Antarctica</option>
        <option>Arctic</option>
        <option>Asia</option>
        <option>Atlantic</option>
        <option>Australia</option>
        <option>Europe</option>
        <option>Indian</option>
        <option>Pacific</option>
      </select>
    </div>

    <div class="field">
      <label for="countrySelect">Country</label>
      <select id="countrySelect">
        <option value="">‚Äî Optional ‚Äî</option>
      </select>
    </div>

    <div class="field" style="min-width: 320px;">
      <label for="tzSearch" class="inline">Search time zones
        <button type="button" class="secondary" id="useMyZoneBtn" title="Use my current time zone">Use my location</button>
      </label>
      <input type="text" id="tzSearch" placeholder="Type city or zone, e.g., 'london', 'kolkata', 'new_york'">
    </div>

    <div class="field" style="min-width: 320px;">
      <label for="tz">Time zone (IANA)</label>
      <input list="tzlist" id="tz" placeholder="Pick or type exact zone, e.g., Europe/London" />
      <datalist id="tzlist"></datalist>
      <div id="countryHint" class="note hidden"></div>
    </div>

    <div class="row" style="width:100%; justify-content:center; margin-top:8px">
      <button id="calcBtn" onclick="calculateAge()">Calculate</button>
    </div>
  </div>

  <div class="note">
    Mean tropical year = 365.24219 days. Birth date must be between <strong>01/01/1900</strong> and <strong>now</strong>. Time zone offsets & DST handled by the browser‚Äôs Intl API.
  </div>

  <div id="results"></div>

  <script>
    /* ===== Planets (days) ===== */
    const planetData = [
      { name: "Mercury",  orbit: 87.9691 },
      { name: "Venus",    orbit: 224.701 },
      { name: "Earth",    orbit: 365.24219 },
      { name: "Mars",     orbit: 686.980 },
      { name: "Jupiter",  orbit: 4332.59 },
      { name: "Saturn",   orbit: 10759.22 },
      { name: "Uranus",   orbit: 30685.4 },
      { name: "Neptune",  orbit: 60190.03 },
      { name: "Pluto",    orbit: 90560 }
    ];
    const SECONDS_PER_TROPICAL_YEAR = 365.24219 * 86400;

    /* ===== Time zones: list & country mapping (subset, can extend) ===== */
    function getSupportedTimeZones() {
      if (typeof Intl.supportedValuesOf === 'function') {
        try {
          const vals = Intl.supportedValuesOf('timeZone');
          if (Array.isArray(vals) && vals.length) return vals;
        } catch {}
      }
      return [
        "Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Cairo","Africa/Casablanca",
        "Africa/Johannesburg","Africa/Lagos","Africa/Nairobi","Africa/Tunis","Africa/Windhoek",
        "America/Adak","America/Anchorage","America/Argentina/Buenos_Aires","America/Bogota","America/Chicago",
        "America/Denver","America/Detroit","America/Edmonton","America/Guatemala","America/Halifax","America/Havana",
        "America/Hermosillo","America/Indiana/Indianapolis","America/Jamaica","America/La_Paz","America/Lima",
        "America/Los_Angeles","America/Mexico_City","America/Monterrey","America/Montevideo","America/New_York",
        "America/Panama","America/Phoenix","America/Santiago","America/Sao_Paulo","America/St_Johns","America/Tijuana",
        "America/Toronto","America/Vancouver","America/Winnipeg",
        "Antarctica/Casey","Antarctica/Davis","Antarctica/Mawson","Antarctica/Palmer","Antarctica/Troll",
        "Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Madeira","Atlantic/Reykjavik",
        "Asia/Amman","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Beirut","Asia/Colombo","Asia/Dhaka",
        "Asia/Dubai","Asia/Gaza","Asia/Hong_Kong","Asia/Ho_Chi_Minh","Asia/Jakarta","Asia/Jerusalem","Asia/Karachi",
        "Asia/Kathmandu","Asia/Kolkata","Asia/Kuala_Lumpur","Asia/Kuwait","Asia/Manila","Asia/Muscat","Asia/Qatar",
        "Asia/Riyadh","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Taipei","Asia/Tehran","Asia/Tokyo",
        "Australia/Adelaide","Australia/Brisbane","Australia/Darwin","Australia/Hobart","Australia/Melbourne","Australia/Perth","Australia/Sydney",
        "Europe/Amsterdam","Europe/Athens","Europe/Berlin","Europe/Brussels","Europe/Bucharest","Europe/Budapest",
        "Europe/Copenhagen","Europe/Dublin","Europe/Helsinki","Europe/Istanbul","Europe/Kiev","Europe/Lisbon","Europe/London",
        "Europe/Madrid","Europe/Malta","Europe/Minsk","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Prague",
        "Europe/Riga","Europe/Rome","Europe/Stockholm","Europe/Tallinn","Europe/Vienna","Europe/Vilnius","Europe/Warsaw",
        "Europe/Zurich",
        "Indian/Maldives","Indian/Mauritius","Indian/Reunion",
        "Pacific/Auckland","Pacific/Chatham","Pacific/Easter","Pacific/Guadalcanal","Pacific/Honolulu","Pacific/Noumea","Pacific/Tahiti"
      ];
    }
    const ALL_ZONES = getSupportedTimeZones().sort((a,b)=>a.localeCompare(b));

    const COUNTRY_TO_ZONES = {
      US:["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage","Pacific/Honolulu"],
      CA:["America/Toronto","America/Winnipeg","America/Edmonton","America/Vancouver","America/Halifax","America/St_Johns","America/Regina"],
      MX:["America/Mexico_City","America/Monterrey","America/Mazatlan","America/Cancun","America/Tijuana","America/Chihuahua","America/Ojinaga"],
      BR:["America/Sao_Paulo","America/Manaus","America/Recife","America/Bahia"],
      AR:["America/Argentina/Buenos_Aires","America/Argentina/Cordoba"],
      GB:["Europe/London"], IE:["Europe/Dublin"], FR:["Europe/Paris"], DE:["Europe/Berlin"], ES:["Europe/Madrid"], IT:["Europe/Rome"],
      NG:["Africa/Lagos"], ZA:["Africa/Johannesburg"], EG:["Africa/Cairo"],
      RU:["Europe/Moscow","Asia/Yekaterinburg","Asia/Novosibirsk","Asia/Krasnoyarsk","Asia/Irkutsk","Asia/Yakutsk","Asia/Vladivostok","Asia/Magadan","Asia/Kamchatka"],
      TR:["Europe/Istanbul"], IL:["Asia/Jerusalem"], SA:["Asia/Riyadh"], IR:["Asia/Tehran"], IN:["Asia/Kolkata"],
      PK:["Asia/Karachi"], BD:["Asia/Dhaka"], TH:["Asia/Bangkok"], VN:["Asia/Ho_Chi_Minh"], CN:["Asia/Shanghai"], HK:["Asia/Hong_Kong"],
      TW:["Asia/Taipei"], SG:["Asia/Singapore"], MY:["Asia/Kuala_Lumpur"], ID:["Asia/Jakarta","Asia/Makassar","Asia/Jayapura"],
      JP:["Asia/Tokyo"], KR:["Asia/Seoul"], AU:["Australia/Sydney","Australia/Melbourne","Australia/Brisbane","Australia/Perth","Australia/Adelaide","Australia/Darwin","Australia/Hobart"],
      NZ:["Pacific/Auckland","Pacific/Chatham"]
    };

    /* ===== Populate country dropdown ===== */
    const countryEl = document.getElementById("countrySelect");
    (function populateCountries(){
      const dn = new Intl.DisplayNames(['en'], { type: 'region' });
      const codes = Object.keys(COUNTRY_TO_ZONES).sort((a,b)=>dn.of(a).localeCompare(dn.of(b)));
      for (const code of codes) {
        const opt = document.createElement('option');
        opt.value = code;
        opt.textContent = dn.of(code) + ` (${code})`;
        countryEl.appendChild(opt);
      }
    })();

    /* ===== Birth date limits & helpers ===== */
    const MIN_YEAR = 1900;
    const birthDateEl = document.getElementById('birthdate');
    const birthTimeEl = document.getElementById('birthtime');
    const ampmEl      = document.getElementById('ampm');
    const rangeHelp   = document.getElementById('rangeHelp');

    (function setDateLimits(){
      const now = new Date();
      const pad = n => String(n).padStart(2,'0');
      const maxDate = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
      birthDateEl.min = `${MIN_YEAR}-01-01`;
      birthDateEl.max = maxDate;
      rangeHelp.textContent = `Allowed years: ${MIN_YEAR}‚Äì${now.getFullYear()}`;
    })();

    /* ===== Reference year (current .. current+20, capped at 2045) ===== */
    const refYearEl = document.getElementById('refYear');
    (function fillRefYears(){
      const thisYear = new Date().getFullYear();
      const maxYear = Math.min(2045, thisYear + 20);
      for (let y=thisYear; y<=maxYear; y++){
        const o = document.createElement('option');
        o.value = y;
        o.textContent = y.toString();
        refYearEl.appendChild(o);
      }
      refYearEl.value = String(thisYear);
    })();

    /* ===== Zone pickers & search ===== */
    const areaEl = document.getElementById("areaFilter");
    const tzSearchEl = document.getElementById("tzSearch");
    const tzEl = document.getElementById("tz");
    const tzListEl = document.getElementById("tzlist");
    const useMyZoneBtn = document.getElementById("useMyZoneBtn");
    const countryHint = document.getElementById("countryHint");

    function populateZones({ area = "", search = "", prefer = [] } = {}) {
      tzListEl.innerHTML = "";
      const prefix = area ? area + "/" : "";
      let list = area ? ALL_ZONES.filter(z => z.startsWith(prefix)) : ALL_ZONES.slice();
      if (search) {
        const q = search.toLowerCase().replace(/\s+/g,'_');
        list = list.filter(z => z.toLowerCase().includes(q));
      }
      const set = new Set(prefer.concat(list));
      for (const z of set) {
        const opt = document.createElement("option");
        opt.value = z;
        tzListEl.appendChild(opt);
      }
      if (prefer && prefer.length) {
        countryHint.classList.remove('hidden');
        countryHint.textContent = `Suggested for country: ${prefer.join(', ')}`;
      } else {
        countryHint.classList.add('hidden');
        countryHint.textContent = '';
      }
    }
    populateZones();

    areaEl.addEventListener("change", () => {
      populateZones({ area: areaEl.value, search: tzSearchEl.value, prefer: COUNTRY_TO_ZONES[countryEl.value] || [] });
    });

    let searchTimer = null;
    tzSearchEl.addEventListener("input", () => {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(() => {
        populateZones({ area: areaEl.value, search: tzSearchEl.value, prefer: COUNTRY_TO_ZONES[countryEl.value] || [] });
      }, 120);
    });

    countryEl.addEventListener("change", () => {
      const prefer = COUNTRY_TO_ZONES[countryEl.value] || [];
      if (prefer.length) {
        const area = prefer[0].split("/")[0];
        areaEl.value = area;
        tzEl.value = prefer[0];
        tzSearchEl.value = "";
      }
      populateZones({ area: areaEl.value, search: tzSearchEl.value, prefer });
    });

    useMyZoneBtn.addEventListener("click", () => {
      try {
        const tzGuess = Intl.DateTimeFormat().resolvedOptions().timeZone;
        if (tzGuess) {
          const area = tzGuess.split("/")[0];
          areaEl.value = area;
          tzEl.value = tzGuess;
          tzSearchEl.value = "";
          populateZones({ area, search: "", prefer: COUNTRY_TO_ZONES[countryEl.value] || [] });
        }
      } catch {}
    });

    /* ===== Time zone helpers ===== */
    function getOffsetMinutesAt(timeZone, utcMs) {
      try {
        const fmt = new Intl.DateTimeFormat('en-US', {
          timeZone,
          timeZoneName: 'shortOffset',
          year: 'numeric', month: '2-digit', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          hour12: false
        });
        const parts = fmt.formatToParts(new Date(utcMs));
        const tzNamePart = parts.find(p => p.type === 'timeZoneName');
        if (!tzNamePart) return 0;
        const m = tzNamePart.value.match(/GMT([+-])(\d{1,2})(?::?(\d{2}))?/);
        if (!m) return 0;
        const sign = m[1] === '-' ? -1 : 1;
        const hh = parseInt(m[2] || '0', 10);
        const mmParsed = parseInt(m[3] || '0', 10);
        const mm = isNaN(mmParsed) ? 0 : mmParsed;
        return sign * (hh * 60 + mm);
      } catch { return 0; }
    }
    function isValidIana(tz) {
      try { new Intl.DateTimeFormat('en-US', { timeZone: tz }).format(); return true; }
      catch { return false; }
    }
    // Build a local ISO string "YYYY-MM-DDTHH:mm:ss" from date + time + AM/PM
    function combineLocal(dateStr, timeStr, ampm) {
      if (!dateStr || !timeStr) return null;
      const [hh, mm, ss] = timeStr.split(':').map(v => parseInt(v||'0',10));
      let h = (hh % 12) + (ampm === 'PM' ? 12 : 0);
      const [y, m, d] = dateStr.split('-').map(Number);
      const pad = n => String(n).padStart(2,'0');
      return `${y}-${pad(m)}-${pad(d)}T${pad(h)}:${pad(mm)}:${pad(ss||0)}`;
    }
    function fromLocalInZoneToUTC(localIso, timeZone) {
      const [datePart, timePart] = localIso.split('T');
      const [y,m,d] = datePart.split('-').map(Number);
      const [hh,mm,ss] = timePart.split(':').map(Number);
      const asIfUTC = Date.UTC(y, m-1, d, hh, mm, ss||0, 0);
      let offsetMin = getOffsetMinutesAt(timeZone, asIfUTC);
      let utcMs = asIfUTC - offsetMin * 60000;
      const offset2 = getOffsetMinutesAt(timeZone, utcMs);
      if (offset2 !== offsetMin) { offsetMin = offset2; utcMs = asIfUTC - offsetMin * 60000; }
      return new Date(utcMs);
    }
    function fmt(n, dp=3) { return Number(n).toFixed(dp); }

    /* ===== MAIN ===== */
    function calculateAge() {
      const resultsDiv = document.getElementById('results');
      const dateVal = birthDateEl.value;
      const timeVal = birthTimeEl.value;
      const ampmVal = ampmEl.value;
      const tz = (document.getElementById('tz').value || '').trim();
      const refYear = parseInt(refYearEl.value, 10);

      if (!dateVal || !timeVal) { resultsDiv.innerHTML = "<p>Please enter birth date and time.</p>"; return; }
      if (!tz || !isValidIana(tz)) { resultsDiv.innerHTML = "<p>Please choose a valid IANA time zone (e.g., Europe/London).</p>"; return; }

      // Range check
      const minDate = new Date(`${MIN_YEAR}-01-01T00:00:00`);
      const now = new Date();
      const pickedLocalISO = combineLocal(dateVal, timeVal, ampmVal);
      const pickedLocal = new Date(pickedLocalISO.replace('T',' ') + 'Z'); // temporary construct for range check
      if (pickedLocal < minDate || pickedLocal > now) {
        resultsDiv.innerHTML = `<p>Birth date must be between <strong>01/01/${MIN_YEAR}</strong> and <strong>now</strong>.</p>`;
        return;
      }

      // Convert local birth to UTC using selected zone
      const birthLocalISO = combineLocal(dateVal, timeVal, ampmVal);
      const birthUTC = fromLocalInZoneToUTC(birthLocalISO, tz);
      if (birthUTC > now) { resultsDiv.innerHTML = "<p>Birthdate can‚Äôt be in the future.</p>"; return; }

      // Build "now" for the selected reference year: same month/day/time as current UTC
      const utcNow = new Date();
      const refNowUTC = new Date(Date.UTC(
        refYear,
        utcNow.getUTCMonth(),
        utcNow.getUTCDate(),
        utcNow.getUTCHours(),
        utcNow.getUTCMinutes(),
        utcNow.getUTCSeconds()
      ));

      // Age in tropical years at ref year "now"
      const ageSeconds = (refNowUTC.getTime() - birthUTC.getTime()) / 1000;
      const earthYears = ageSeconds / SECONDS_PER_TROPICAL_YEAR;

      // Days since (or until) birthday in that reference year ‚Äî computed in the SAME time zone
      // Build the birthday instant in ref year in the chosen time zone, then convert to UTC to compare.
      const [y,m,d] = dateVal.split('-').map(Number);
      const localBirthTime24 = combineLocal(`${refYear}-${String(m).padStart(2,'0')}-${String(d).padStart(2,'0')}`, timeVal, ampmVal);
      const birthdayThisYearUTC = fromLocalInZoneToUTC(localBirthTime24, tz);

      let daysPhrase;
      const MS_PER_DAY = 86400000;
      if (refNowUTC >= birthdayThisYearUTC) {
        const diffDays = Math.floor((refNowUTC - birthdayThisYearUTC) / MS_PER_DAY);
        daysPhrase = `${diffDays} day${diffDays===1?'':'s'} after your birthday in ${refYear}`;
      } else {
        const diffDays = Math.ceil((birthdayThisYearUTC - refNowUTC) / MS_PER_DAY);
        daysPhrase = `${diffDays} day${diffDays===1?'':'s'} until your birthday in ${refYear}`;
      }

      // Show current offset
      const offsetNowMin = getOffsetMinutesAt(tz, refNowUTC.getTime());
      const sign = offsetNowMin < 0 ? '-' : '+';
      const absMin = Math.abs(offsetNowMin);
      const oh = String(Math.floor(absMin/60)).padStart(2,'0');
      const om = String(absMin%60).padStart(2,'0');

      // Table
      let html = `
        <div class="summary">
          Time zone: <strong>${tz}</strong> (current offset: GMT${sign}${oh}:${om})<br/>
          Birth (converted to UTC): <strong>${birthUTC.toISOString().replace('T',' ').replace('Z',' UTC')}</strong><br/>
          <strong>You are ${Math.floor(earthYears)} years old and ${daysPhrase}.</strong>
        </div>
        <table>
          <tr>
            <th>Planet</th>
            <th>Age (Planet Years)</th>
            <th>Equivalent Earth Years</th>
            <th>Orbital Period (days)</th>
          </tr>`;

      planetData.forEach(p => {
        const planetYears = earthYears * (365.24219 / p.orbit);
        const earthEquivalent = (planetYears * p.orbit / 365.24219);
        html += `<tr>
          <td>${p.name}</td>
          <td>${fmt(planetYears, 3)}</td>
          <td>${fmt(earthEquivalent, 2)}</td>
          <td>${fmt(p.orbit, 5)}</td>
        </tr>`;
      });
      html += `</table>`;

      // Example line echo (their example format)
      const [mm,dd,yyyy] = [String(m).padStart(2,'0'), String(d).padStart(2,'0'), String(y)];
      const [th,tm,ts] = birthTimeEl.value.split(':');
      const show12h = `${String((parseInt(th,10)%12)||12).padStart(2,'0')}:${tm}:${ts} ${ampmVal}`;
      html += `<div class="note">Example echo: ${mm}/${dd}/${yyyy} time of birth ${show12h}. Reference year: ${refYear}.</div>`;

      resultsDiv.innerHTML = html;
    }
    window.calculateAge = calculateAge;

    /* ===== Initialize zones list & area filters ===== */
    function initZones(){
      populateZones();
    }
    initZones();
  </script>
</body>
</html>
