<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ü™ê Planetary Age Calculator ‚Äî Global Zones + Map + Search + Offline Country‚ÜíZones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --teal:#00ffff; }
    body { background:#000; color:#fff; font-family:"Courier New", monospace; text-align:center; padding:36px; }
    h1 { font-size:2.24em; color:var(--teal); margin:0 0 .3em; }
    p, label { font-size:1.1em; margin:.5em 0; }
    .controls, .row { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; align-items:flex-end; }
    .field { display:flex; flex-direction:column; gap:6px; min-width: 230px; }
    .field label { font-size:.95em; color:#9ff; opacity:.9; text-align:left; }
    input, select, button {
      padding:10px 12px; font-size:.96em; border-radius:10px; border:1px solid #0aa; background:#061b1b; color:#d9ffff;
    }
    input[type="datetime-local"] { min-width: 240px; }
    input[type="text"]::placeholder { color:#8fe; opacity:.8; }
    button { background:var(--teal); color:#000; border:none; cursor:pointer; padding:12px 16px; }
    button.secondary { background:#083a3d; color:#9ff; border:1px solid #0aa; }
    #results { margin-top:22px; }
    table { margin:18px auto 0; border-collapse:collapse; color:var(--teal); font-size:1.06em; width:min(980px, 92vw); }
    th, td { border:2px solid var(--teal); padding:10px 14px; }
    th { background:#003f3f; }
    .note { font-size:.9em; color:#9ff; opacity:.85; margin-top:8px; }
    .summary { margin-top:12px; color:#9ff; }
    .mapWrap { width:min(980px, 96vw); margin:10px auto 4px; }
    svg.world { width:100%; height:auto; border:1px solid #0aa; border-radius:8px; background:#041417; }
    .area { fill:#073336; stroke:#0aa; stroke-width:0.5; cursor:pointer; }
    .area:hover { fill:#0b4448; }
    .legendRow { display:flex; align-items:center; justify-content:center; gap:10px; margin:6px 0 16px; color:#9ff; opacity:.9; font-size:.95em; }
    .chip { border:1px solid #0aa; border-radius:999px; padding:4px 10px; }
    .inline { display:inline-flex; gap:8px; align-items:center; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <h1>ü™ê Planetary Age Calculator</h1>
  <p>Enter your <strong>local birth date & time</strong>, pick your <strong>Area ‚Üí Country ‚Üí Time Zone</strong>, or use the <strong>map</strong> and <strong>search</strong>.</p>

  <div class="mapWrap">
    <svg class="world" viewBox="0 0 1000 400" role="img" aria-label="World area picker">
      <rect class="area" data-area="America" x="80" y="60" width="260" height="260" rx="8" />
      <rect class="area" data-area="Atlantic" x="360" y="120" width="80" height="160" rx="8" />
      <rect class="area" data-area="Europe" x="460" y="80" width="160" height="120" rx="8" />
      <rect class="area" data-area="Africa" x="500" y="200" width="160" height="120" rx="8" />
      <rect class="area" data-area="Arctic" x="460" y="30" width="160" height="30" rx="6" />
      <rect class="area" data-area="Asia" x="640" y="80" width="220" height="180" rx="8" />
      <rect class="area" data-area="Australia" x="760" y="270" width="120" height="70" rx="8" />
      <rect class="area" data-area="Indian" x="640" y="270" width="110" height="70" rx="8" />
      <rect class="area" data-area="Pacific" x="880" y="140" width="80" height="160" rx="8" />
      <rect class="area" data-area="Antarctica" x="60" y="340" width="880" height="30" rx="6" />
      <g fill="#8fe" font-size="14" font-family="monospace">
        <text x="160" y="50">America</text>
        <text x="365" y="110">Atlantic</text>
        <text x="500" y="70">Europe</text>
        <text x="540" y="195">Africa</text>
        <text x="500" y="25">Arctic</text>
        <text x="710" y="70">Asia</text>
        <text x="770" y="265">Australia</text>
        <text x="660" y="265">Indian</text>
        <text x="890" y="130">Pacific</text>
        <text x="420" y="335">Antarctica</text>
      </g>
    </svg>
    <div class="legendRow">
      <span class="chip">Click an area to filter time zones</span>
      <span class="chip">Still type/search below if you prefer</span>
    </div>
  </div>

  <div class="controls">
    <div class="row">
      <div class="field">
        <label for="birthdt">Birth date & time (local at birthplace)</label>
        <input type="datetime-local" id="birthdt" />
        <div id="rangeHelp" class="note"></div>
      </div>

      <div class="field">
        <label for="areaFilter">Area</label>
        <select id="areaFilter">
          <option value="">All Areas</option>
          <option>Africa</option>
          <option>America</option>
          <option>Antarctica</option>
          <option>Arctic</option>
          <option>Asia</option>
          <option>Atlantic</option>
          <option>Australia</option>
          <option>Europe</option>
          <option>Indian</option>
          <option>Pacific</option>
        </select>
      </div>

      <div class="field">
        <label for="countrySelect">Country</label>
        <select id="countrySelect">
          <option value="">‚Äî Optional ‚Äî</option>
        </select>
      </div>

      <div class="field" style="min-width: 320px;">
        <label for="tzSearch" class="inline">Search time zones
          <button type="button" class="secondary" id="useMyZoneBtn" title="Use my current time zone">Use my location</button>
        </label>
        <input type="text" id="tzSearch" placeholder="Type city or zone, e.g., 'london', 'kolkata', 'new_york'">
      </div>

      <div class="field" style="min-width: 320px;">
        <label for="tz">Time zone (IANA)</label>
        <input list="tzlist" id="tz" placeholder="Pick or type exact zone, e.g., Europe/London" />
        <datalist id="tzlist"></datalist>
        <div id="countryHint" class="note hidden"></div>
      </div>
    </div>

    <div class="row">
      <button id="calcBtn" onclick="calculateAge()">Calculate</button>
    </div>
  </div>

  <div class="note">
    Uses the browser‚Äôs Intl API for DST & historical offsets and the mean tropical year (365.24219 days).
  </div>

  <div id="results"></div>

  <script>
    /* =================== PLANETS =================== */
    const planetData = [
      { name: "Mercury",  orbit: 87.9691 },
      { name: "Venus",    orbit: 224.701 },
      { name: "Earth",    orbit: 365.24219 },
      { name: "Mars",     orbit: 686.980 },
      { name: "Jupiter",  orbit: 4332.59 },
      { name: "Saturn",   orbit: 10759.22 },
      { name: "Uranus",   orbit: 30685.4 },
      { name: "Neptune",  orbit: 60190.03 },
      { name: "Pluto",    orbit: 90560 }
    ];
    const SECONDS_PER_TROPICAL_YEAR = 365.24219 * 86400;

    /* =================== TIME ZONES =================== */
    function getSupportedTimeZones() {
      if (typeof Intl.supportedValuesOf === 'function') {
        try {
          const vals = Intl.supportedValuesOf('timeZone');
          if (Array.isArray(vals) && vals.length) return vals;
        } catch {}
      }
      return [
        "Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Bamako","Africa/Bangui",
        "Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca",
        "Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun",
        "Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum",
        "Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi",
        "Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia",
        "Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome",
        "Africa/Tripoli","Africa/Tunis","Africa/Windhoek",
        "America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires",
        "America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja",
        "America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan",
        "America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia",
        "America/Aruba","America/Asuncion","America/Atikokan","America/Bahia","America/Bahia_Banderas","America/Barbados",
        "America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise",
        "America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Cayman",
        "America/Chicago","America/Chihuahua","America/Ciudad_Juarez","America/Costa_Rica","America/Creston","America/Cuiaba",
        "America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit",
        "America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fort_Nelson","America/Fortaleza",
        "America/Glace_Bay","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala",
        "America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis",
        "America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City",
        "America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit",
        "America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Kralendijk",
        "America/La_Paz","America/Lima","America/Los_Angeles","America/Lower_Princes","America/Maceio","America/Managua",
        "America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee",
        "America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey",
        "America/Montevideo","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome",
        "America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem",
        "America/Nuuk","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix",
        "America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Punta_Arenas",
        "America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco",
        "America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Sitka",
        "America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent",
        "America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto",
        "America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat",
        "Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson",
        "Antarctica/Palmer","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Troll","Antarctica/Vostok",
        "Arctic/Longyearbyen",
        "Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Atyrau",
        "Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Barnaul","Asia/Beirut","Asia/Bishkek","Asia/Brunei",
        "Asia/Chita","Asia/Choibalsan","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe",
        "Asia/Famagusta","Asia/Gaza","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta",
        "Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kathmandu","Asia/Khandyga",
        "Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan",
        "Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk",
        "Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qostanay","Asia/Qyzylorda",
        "Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Srednekolymsk",
        "Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Tomsk","Asia/Ulaanbaatar",
        "Asia/Urumqi","Asia/Ust-Nera","Asia/Vladivostok","Asia/Yakutsk","Asia/Yangon","Asia/Yekaterinburg","Asia/Yerevan",
        "Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira",
        "Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/Stanley",
        "Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Darwin","Australia/Eucla","Australia/Hobart",
        "Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney",
        "Europe/Amsterdam","Europe/Andorra","Europe/Astrakhan","Europe/Athens","Europe/Belgrade","Europe/Berlin",
        "Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Busingen","Europe/Chisinau",
        "Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man",
        "Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Kirov","Europe/Lisbon","Europe/Ljubljana",
        "Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco",
        "Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome",
        "Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Saratov","Europe/Simferopol","Europe/Skopje",
        "Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Ulyanovsk","Europe/Uzhgorod","Europe/Vaduz",
        "Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye",
        "Europe/Zurich",
        "Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen",
        "Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion",
        "Pacific/Apia","Pacific/Auckland","Pacific/Bougainville","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter",
        "Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos",
        "Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Kanton","Pacific/Kiritimati",
        "Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru",
        "Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn",
        "Pacific/Pohnpei","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa",
        "Pacific/Tongatapu","Pacific/Wake","Pacific/Wallis"
      ];
    }
    const ALL_ZONES = getSupportedTimeZones().sort((a,b) => a.localeCompare(b));

    /* =================== OFFLINE COUNTRY ‚Üí ZONES =================== */
    // ISO-3166-1 alpha-2 ‚Üí common IANA zones (non-exhaustive but wide coverage). You can extend as needed.
    const COUNTRY_TO_ZONES = {
      // AFRICA
      DZ:["Africa/Algiers"], AO:["Africa/Luanda"], BJ:["Africa/Porto-Novo"], BW:["Africa/Gaborone"], BF:["Africa/Ouagadougou"],
      BI:["Africa/Bujumbura"], CM:["Africa/Douala"], CV:["Atlantic/Cape_Verde"], CF:["Africa/Bangui"], TD:["Africa/Ndjamena"],
      KM:["Indian/Comoro"], CG:["Africa/Brazzaville"], CD:["Africa/Kinshasa","Africa/Lubumbashi"], CI:["Africa/Abidjan"],
      DJ:["Africa/Djibouti"], EG:["Africa/Cairo"], GQ:["Africa/Malabo"], ER:["Africa/Asmara"], ET:["Africa/Addis_Ababa"],
      GA:["Africa/Libreville"], GM:["Africa/Banjul"], GH:["Africa/Accra"], GN:["Africa/Conakry"], GW:["Africa/Bissau"],
      KE:["Africa/Nairobi"], LS:["Africa/Maseru"], LR:["Africa/Monrovia"], LY:["Africa/Tripoli"], MG:["Indian/Antananarivo"],
      MW:["Africa/Blantyre"], ML:["Africa/Bamako"], MR:["Africa/Nouakchott"], MU:["Indian/Mauritius"], MA:["Africa/Casablanca","Africa/El_Aaiun"],
      MZ:["Africa/Maputo"], NA:["Africa/Windhoek"], NE:["Africa/Niamey"], NG:["Africa/Lagos"], RW:["Africa/Kigali"],
      ST:["Africa/Sao_Tome"], SN:["Africa/Dakar"], SC:["Indian/Mahe"], SL:["Africa/Freetown"], SO:["Africa/Mogadishu"],
      ZA:["Africa/Johannesburg"], SS:["Africa/Juba"], SD:["Africa/Khartoum"], SZ:["Africa/Mbabane"], TZ:["Africa/Dar_es_Salaam"],
      TG:["Africa/Lome"], TN:["Africa/Tunis"], UG:["Africa/Kampala"], EH:["Africa/El_Aaiun"], ZM:["Africa/Lusaka"], ZW:["Africa/Harare"],
      // AMERICAS
      AG:["America/Antigua"], AR:["America/Argentina/Buenos_Aires","America/Argentina/Cordoba","America/Argentina/Mendoza","America/Argentina/Salta","America/Argentina/Ushuaia"],
      AW:["America/Aruba"], BS:["America/Nassau"], BB:["America/Barbados"], BZ:["America/Belize"], BO:["America/La_Paz"],
      BR:["America/Sao_Paulo","America/Bahia","America/Manaus","America/Belem","America/Cuiaba","America/Porto_Velho","America/Boa_Vista","America/Recife","America/Noronha"],
      CA:["America/Toronto","America/Winnipeg","America/Edmonton","America/Vancouver","America/Halifax","America/St_Johns","America/Regina","America/Whitehorse","America/Dawson","America/Yellowknife","America/Iqaluit"],
      KY:["America/Cayman"], CL:["America/Santiago","America/Punta_Arenas","Pacific/Easter"], CO:["America/Bogota"],
      CR:["America/Costa_Rica"], CU:["America/Havana"], CW:["America/Curacao"], DM:["America/Dominica"], DO:["America/Santo_Domingo"],
      EC:["America/Guayaquil","Pacific/Galapagos"], SV:["America/El_Salvador"], GL:["America/Nuuk","America/Danmarkshavn","America/Scoresbysund","America/Thule"],
      GD:["America/Grenada"], GP:["America/Guadeloupe"], GT:["America/Guatemala"], GY:["America/Guyana"],
      HT:["America/Port-au-Prince"], HN:["America/Tegucigalpa"], JM:["America/Jamaica"], MQ:["America/Martinique"],
      MX:["America/Mexico_City","America/Cancun","America/Merida","America/Monterrey","America/Mazatlan","America/Tijuana","America/Chihuahua","America/Ojinaga","America/Bahia_Banderas"],
      NI:["America/Managua"], PA:["America/Panama"], PY:["America/Asuncion"], PE:["America/Lima"], PR:["America/Puerto_Rico"],
      KN:["America/St_Kitts"], LC:["America/St_Lucia"], VC:["America/St_Vincent"], SR:["America/Paramaribo"],
      TT:["America/Port_of_Spain"], TC:["America/Grand_Turk"], US:["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage","Pacific/Honolulu","America/Adak","Pacific/Samoa","Pacific/Guam","Pacific/Saipan","America/Detroit","America/Indiana/Indianapolis","America/Kentucky/Louisville"],
      UY:["America/Montevideo"], VE:["America/Caracas"], VG:["America/Tortola"], VI:["America/St_Thomas"],
      // ANTARCTICA
      AQ:["Antarctica/Casey","Antarctica/Davis","Antarctica/Mawson","Antarctica/Palmer","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Troll","Antarctica/Vostok","Antarctica/Macquarie"],
      // ASIA
      AF:["Asia/Kabul"], AM:["Asia/Yerevan"], AZ:["Asia/Baku"], BH:["Asia/Bahrain"], BD:["Asia/Dhaka"], BT:["Asia/Thimphu"],
      BN:["Asia/Brunei"], KH:["Asia/Phnom_Penh"], CN:["Asia/Shanghai","Asia/Urumqi"], GE:["Asia/Tbilisi"], HK:["Asia/Hong_Kong"],
      IN:["Asia/Kolkata"], ID:["Asia/Jakarta","Asia/Makassar","Asia/Jayapura","Asia/Pontianak"], IR:["Asia/Tehran"], IQ:["Asia/Baghdad"],
      IL:["Asia/Jerusalem"], JP:["Asia/Tokyo"], JO:["Asia/Amman"], KZ:["Asia/Almaty","Asia/Aqtobe","Asia/Atyrau","Asia/Oral","Asia/Qostanay","Asia/Qyzylorda"],
      KW:["Asia/Kuwait"], KG:["Asia/Bishkek"], LA:["Asia/Vientiane"], LB:["Asia/Beirut"], MO:["Asia/Macau"],
      MY:["Asia/Kuala_Lumpur","Asia/Kuching"], MV:["Indian/Maldives"], MN:["Asia/Ulaanbaatar","Asia/Choibalsan","Asia/Hovd"],
      MM:["Asia/Yangon"], NP:["Asia/Kathmandu"], KP:["Asia/Pyongyang"], OM:["Asia/Muscat"], PK:["Asia/Karachi"], PH:["Asia/Manila"],
      QA:["Asia/Qatar"], SA:["Asia/Riyadh"], SG:["Asia/Singapore"], KR:["Asia/Seoul"], LK:["Asia/Colombo"], SY:["Asia/Damascus"],
      TW:["Asia/Taipei"], TJ:["Asia/Dushanbe"], TH:["Asia/Bangkok"], TR:["Europe/Istanbul"], AE:["Asia/Dubai"], UZ:["Asia/Tashkent","Asia/Samarkand"],
      VN:["Asia/Ho_Chi_Minh"], YE:["Asia/Aden"],
      // EUROPE
      AL:["Europe/Tirane"], AD:["Europe/Andorra"], AT:["Europe/Vienna"], BY:["Europe/Minsk"], BE:["Europe/Brussels"],
      BA:["Europe/Sarajevo"], BG:["Europe/Sofia"], HR:["Europe/Zagreb"], CY:["Asia/Nicosia","Asia/Famagusta"], CZ:["Europe/Prague"],
      DK:["Europe/Copenhagen"], EE:["Europe/Tallinn"], FO:["Atlantic/Faroe"], FI:["Europe/Helsinki"], FR:["Europe/Paris"],
      DE:["Europe/Berlin","Europe/Busingen"], GI:["Europe/Gibraltar"], GR:["Europe/Athens"], VA:["Europe/Vatican"],
      HU:["Europe/Budapest"], IS:["Atlantic/Reykjavik"], IE:["Europe/Dublin"], IT:["Europe/Rome"], LV:["Europe/Riga"],
      LI:["Europe/Vaduz"], LT:["Europe/Vilnius"], LU:["Europe/Luxembourg"], MT:["Europe/Malta"], MD:["Europe/Chisinau"],
      MC:["Europe/Monaco"], ME:["Europe/Podgorica"], NL:["Europe/Amsterdam"], MK:["Europe/Skopje"], NO:["Europe/Oslo"],
      PL:["Europe/Warsaw"], PT:["Europe/Lisbon","Atlantic/Madeira","Atlantic/Azores"], RO:["Europe/Bucharest"],
      RU:["Europe/Moscow","Europe/Kaliningrad","Europe/Samara","Europe/Astrakhan","Europe/Saratov","Europe/Ulyanovsk","Europe/Volgograd","Asia/Yekaterinburg","Asia/Omsk","Asia/Novosibirsk","Asia/Tomsk","Asia/Barnaul","Asia/Krasnoyarsk","Asia/Irkutsk","Asia/Yakutsk","Asia/Vladivostok","Asia/Magadan","Asia/Sakhalin","Asia/Srednekolymsk","Asia/Kamchatka","Asia/Anadyr"],
      SM:["Europe/San_Marino"], RS:["Europe/Belgrade"], SK:["Europe/Bratislava"], SI:["Europe/Ljubljana"], ES:["Europe/Madrid","Atlantic/Canary","Africa/Ceuta"],
      SE:["Europe/Stockholm"], CH:["Europe/Zurich"], UA:["Europe/Kiev","Europe/Uzhgorod","Europe/Zaporozhye","Europe/Simferopol"], GB:["Europe/London"],
      // OCEANIA
      AS:["Pacific/Pago_Pago"], AU:["Australia/Sydney","Australia/Melbourne","Australia/Brisbane","Australia/Perth","Australia/Adelaide","Australia/Darwin","Australia/Hobart","Australia/Lord_Howe","Australia/Eucla","Australia/Lindeman"],
      CK:["Pacific/Rarotonga"], FJ:["Pacific/Fiji"], PF:["Pacific/Tahiti","Pacific/Marquesas","Pacific/Gambier"], GU:["Pacific/Guam"],
      KI:["Pacific/Tarawa","Pacific/Enderbury","Pacific/Kiritimati"], MH:["Pacific/Majuro","Pacific/Kwajalein"], FM:["Pacific/Chuuk","Pacific/Pohnpei","Pacific/Kosrae"],
      NC:["Pacific/Noumea"], NZ:["Pacific/Auckland","Pacific/Chatham"], NU:["Pacific/Niue"], MP:["Pacific/Saipan"], PW:["Pacific/Palau"],
      PG:["Pacific/Port_Moresby","Pacific/Bougainville"], PN:["Pacific/Pitcairn"], WS:["Pacific/Apia"], SB:["Pacific/Guadalcanal"],
      TK:["Pacific/Fakaofo"], TO:["Pacific/Tongatapu"], TV:["Pacific/Funafuti"], VU:["Pacific/Efate"], WF:["Pacific/Wallis"]
    };

    /* =================== UI HOOKUP =================== */
    const areaEl = document.getElementById("areaFilter");
    const tzSearchEl = document.getElementById("tzSearch");
    const tzEl = document.getElementById("tz");
    const useMyZoneBtn = document.getElementById("useMyZoneBtn");
    const countryEl = document.getElementById("countrySelect");
    const tzListEl = document.getElementById("tzlist");
    const countryHint = document.getElementById("countryHint");

    // Populate Countries dropdown (sorted by localized English names)
    (function populateCountries(){
      const countryNames = new Intl.DisplayNames(['en'], { type: 'region' });
      const codes = Object.keys(COUNTRY_TO_ZONES).sort((a,b)=>{
        return countryNames.of(a).localeCompare(countryNames.of(b));
      });
      for (const code of codes) {
        const opt = document.createElement('option');
        opt.value = code;
        opt.textContent = countryNames.of(code) + ` (${code})`;
        countryEl.appendChild(opt);
      }
    })();

    // Birth date/time limits
    const MIN_YEAR = 1900;
    const birthInput = document.getElementById('birthdt');
    const rangeHelp = document.getElementById('rangeHelp');
    (function setDateLimits(){
      const pad = n => String(n).padStart(2,'0');
      const minISO = `${MIN_YEAR}-01-01T00:00`;
      const now = new Date();
      const maxISO = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
      birthInput.min = minISO;
      birthInput.max = maxISO;
      rangeHelp.textContent = `Allowed years: ${MIN_YEAR}‚Äì${now.getFullYear()}`;
    })();

    // Datalist population with area/search filters
    function populateZones({ area = "", search = "", prefer = [] } = {}) {
      tzListEl.innerHTML = "";
      const prefix = area ? area + "/" : "";
      let list = area ? ALL_ZONES.filter(z => z.startsWith(prefix)) : ALL_ZONES.slice();

      if (search) {
        const q = search.toLowerCase().replace(/\s+/g,'_');
        list = list.filter(z => z.toLowerCase().includes(q));
      }

      // If we have preferred zones (from country), put them at the top (deduped)
      const set = new Set(prefer.concat(list));
      const finalList = Array.from(set);

      for (const z of finalList) {
        const opt = document.createElement("option");
        opt.value = z;
        tzListEl.appendChild(opt);
      }

      // Country hint
      if (prefer && prefer.length) {
        countryHint.classList.remove('hidden');
        countryHint.textContent = `Suggested for country: ${prefer.join(', ')}`;
      } else {
        countryHint.classList.add('hidden');
        countryHint.textContent = '';
      }
    }

    // Initial list
    populateZones();

    // Area filter change
    areaEl.addEventListener("change", () => {
      populateZones({ area: areaEl.value, search: tzSearchEl.value, prefer: getCountryZones(countryEl.value) });
    });

    // Search filter (debounced)
    let searchTimer = null;
    tzSearchEl.addEventListener("input", () => {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(() => {
        populateZones({ area: areaEl.value, search: tzSearchEl.value, prefer: getCountryZones(countryEl.value) });
      }, 120);
    });

    // Country selection ‚Üí preferred zones + set Area to first preferred's area
    function getCountryZones(code){
      if (!code) return [];
      return COUNTRY_TO_ZONES[code] || [];
    }
    countryEl.addEventListener("change", () => {
      const code = countryEl.value;
      const prefer = getCountryZones(code);
      if (prefer.length) {
        const area = prefer[0].split("/")[0];
        areaEl.value = area;
        tzEl.value = prefer[0];
        tzSearchEl.value = "";
      }
      populateZones({ area: areaEl.value, search: tzSearchEl.value, prefer });
    });

    // Map clicks set Area filter
    document.querySelectorAll("svg.world .area").forEach(r => {
      r.addEventListener("click", (e) => {
        const area = e.currentTarget.getAttribute("data-area");
        areaEl.value = area;
        populateZones({ area, search: tzSearchEl.value, prefer: getCountryZones(countryEl.value) });
      });
    });

    // Use my location (current time zone)
    useMyZoneBtn.addEventListener("click", () => {
      try {
        const tzGuess = Intl.DateTimeFormat().resolvedOptions().timeZone;
        if (tzGuess) {
          const area = tzGuess.split("/")[0];
          areaEl.value = area;
          tzEl.value = tzGuess;
          tzSearchEl.value = "";
          populateZones({ area, search: "", prefer: getCountryZones(countryEl.value) });
        }
      } catch {}
    });

    /* =================== CONVERSION HELPERS =================== */
    function getOffsetMinutesAt(timeZone, utcMs) {
      try {
        const fmt = new Intl.DateTimeFormat('en-US', {
          timeZone,
          timeZoneName: 'shortOffset',
          year: 'numeric', month: '2-digit', day: '2-digit',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          hour12: false
        });
        const parts = fmt.formatToParts(new Date(utcMs));
        const tzNamePart = parts.find(p => p.type === 'timeZoneName');
        if (!tzNamePart) return 0;
        const m = tzNamePart.value.match(/GMT([+-])(\d{1,2})(?::?(\d{2}))?/);
        if (!m) return 0;
        const sign = m[1] === '-' ? -1 : 1;
        const hh = parseInt(m[2] || '0', 10);
        const mmParsed = parseInt(m[3] || '0', 10);
        const mm = isNaN(mmParsed) ? 0 : mmParsed;
        return sign * (hh * 60 + mm);
      } catch { return 0; }
    }

    function isValidIana(tz) {
      try { new Intl.DateTimeFormat('en-US', { timeZone: tz }).format(); return true; }
      catch { return false; }
    }

    function fromLocalInZoneToUTC(localIso, timeZone) {
      const [datePart, timePart] = localIso.split('T');
      const [y,m,d] = datePart.split('-').map(Number);
      const [hh,mm] = timePart.split(':').map(Number);
      const asIfUTC = Date.UTC(y, m-1, d, hh, mm, 0, 0);
      let offsetMin = getOffsetMinutesAt(timeZone, asIfUTC);
      let utcMs = asIfUTC - offsetMin * 60000;
      const offset2 = getOffsetMinutesAt(timeZone, utcMs);
      if (offset2 !== offsetMin) { offsetMin = offset2; utcMs = asIfUTC - offsetMin * 60000; }
      return new Date(utcMs);
    }

    function fmt(n, dp=3) { return Number(n).toFixed(dp); }

    /* =================== MAIN =================== */
    function calculateAge() {
      const resultsDiv = document.getElementById('results');
      const birthVal   = document.getElementById('birthdt').value;
      const tz         = (document.getElementById('tz').value || '').trim();

      if (!birthVal) { resultsDiv.innerHTML = "<p>Please enter a valid date & time.</p>"; return; }

      const picked = new Date(birthVal);
      const min = new Date(birthInput.min.replace('T',' ') + ':00');
      const max = new Date(birthInput.max.replace('T',' ') + ':00');
      if (picked < min || picked > max) {
        resultsDiv.innerHTML = `<p>Birth date must be between <strong>${birthInput.min.replace('T',' ')}</strong> and <strong>${birthInput.max.replace('T',' ')}</strong>.</p>`;
        return;
      }

      if (!tz || !isValidIana(tz)) { resultsDiv.innerHTML = "<p>Please choose a valid IANA time zone (e.g., Europe/London).</p>"; return; }

      const birthUTC = fromLocalInZoneToUTC(birthVal, tz);
      const now = new Date();
      if (birthUTC > now) { resultsDiv.innerHTML = "<p>Birthdate can‚Äôt be in the future.</p>"; return; }

      const ageSeconds = (now.getTime() - birthUTC.getTime()) / 1000;
      const earthYears = ageSeconds / SECONDS_PER_TROPICAL_YEAR;

      const offsetNowMin = getOffsetMinutesAt(tz, now.getTime());
      const sign = offsetNowMin < 0 ? '-' : '+';
      const absMin = Math.abs(offsetNowMin);
      const oh = String(Math.floor(absMin/60)).padStart(2,'0');
      const om = String(absMin%60).padStart(2,'0');

      let html = `
        <div class="summary">
          Time zone: <strong>${tz}</strong> (current offset: GMT${sign}${oh}:${om})<br/>
          Birth (converted to UTC): <strong>${birthUTC.toISOString().replace('T',' ').replace('Z',' UTC')}</strong>
        </div>
        <table>
          <tr>
            <th>Planet</th>
            <th>Age (Planet Years)</th>
            <th>Equivalent Earth Years</th>
            <th>Orbital Period (days)</th>
          </tr>`;

      planetData.forEach(p => {
        const planetYears = earthYears * (365.24219 / p.orbit);
        const earthEquivalent = (planetYears * p.orbit / 365.24219);
        html += `<tr>
          <td>${p.name}</td>
          <td>${fmt(planetYears, 3)}</td>
          <td>${fmt(earthEquivalent, 2)}</td>
          <td>${fmt(p.orbit, 5)}</td>
        </tr>`;
      });

      html += `</table>`;

      const years = Math.floor(earthYears);
      const months = Math.floor((earthYears - years) * 12);
      html += `<div class="note">Approx. Earth age: ${years} years, ${months} months (mean tropical year). DST & historical offsets handled automatically for ${tz}.</div>`;

      resultsDiv.innerHTML = html;
    }
    window.calculateAge = calculateAge;

    // Initial populate with no area/search and no country preference
    populateZones();
  </script>
</body>
</html>
