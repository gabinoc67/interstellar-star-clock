<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CST Time & GPS Constellation — Live (Names • Launches • NANUs • Auto-Refresh)</title>
<style>
  :root{
    --bg:#0b1020; --panel:#111831; --ink:#eaf0ff; --muted:#a7b0c3;
    --gps:#34d399; --geo:#fbbf24; --accent:#5eead4; --danger:#ef4444; --ok:#22c55e;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1400px;margin:auto;padding:20px;display:grid;gap:16px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
        border:1px solid rgba(255,255,255,.10);border-radius:16px;padding:16px}
  h1{margin:0 0 4px 0;font-size:20px}
  .muted{color:var(--muted)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .row{display:grid;grid-template-columns:1.05fr 0.95fr;gap:16px}
  .kvs{display:grid;grid-template-columns:auto 1fr;gap:6px 12px;align-items:center}
  .big{font-size:28px;letter-spacing:.5px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;font-size:13px}
  thead th{position:sticky;top:0;background:rgba(17,24,49,.9);backdrop-filter:blur(6px)}
  .scroll{max-height:460px;overflow:auto;border:1px solid rgba(255,255,255,.08);border-radius:12px}
  .nowrap{white-space:nowrap}
  pre.json{white-space:pre-wrap;word-break:break-word;background:rgba(255,255,255,.04);
           border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:10px}
  .small{font-size:12px}
  /* Globe */
  .globe{width:100%;aspect-ratio:1.2/1; background:radial-gradient(120% 100% at 50% 50%, #0f1732 0%, #0b1020 60%, #070a16 100%);
         border:1px solid rgba(255,255,255,.08);border-radius:14px;position:relative;overflow:hidden}
  svg{display:block;width:100%;height:100%}
  .sat{fill:var(--gps)}
  .satlbl{fill:var(--gps); font-size:10px}
  .earthStroke{stroke:#2b3f8f; stroke-width:1}
  .gridline{stroke:#1b2b63; stroke-width:0.5; opacity:0.5}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>CST Time & GPS Constellation (Live)</h1>
      <div class="muted">
        Uses your live device clock with <b>CST ≡ UTC</b> as the universal baseline. Each satellite shows:
        <i>Angle, Sub-Lon, Speed, Atomic UTC, CST, GEO (+45 µs/day), GPS (+38 µs/day), Δns offsets from CST since UTC midnight</i>.
        GPS III birds include their official names. No buttons—always live.
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">CST (baseline = UTC)</div>
          <div id="cstTime" class="big mono">--:--:--.---</div>
          <div class="muted mono" id="cstIso">—</div>
          <div class="kvs" style="margin-top:10px">
            <div>Elapsed since UTC midnight</div><div class="mono" id="sinceMid">—</div>
            <div>Comparison drift rates</div>
            <div class="mono">GEO: +45 µs/day · GPS (net): +38 µs/day</div>
            <div>Nominal orbital speed</div>
            <div class="mono">v ≈ 3.874 km/s (≈ 13,950 km/h)</div>
            <div>Live health/NANU refresh</div>
            <div class="mono small" id="liveStamp">No live refresh yet (using snapshot)</div>
          </div>
        </div>

        <div>
          <div class="muted">Why move everything to CST now</div>
          <ul class="muted" style="line-height:1.55">
            <li><b>One truth source:</b> Satellites stamp a universal CST time; local gravity/speed effects are tiny <i>phase</i> terms. Receivers align to CST + phase—no ad-hoc “calibration rituals.”</li>
            <li><b>Phones & cars:</b> Cleaner timing ⇒ tighter pseudoranges ⇒ higher accuracy, fewer dropouts, faster convergence. Self-driving stacks benefit from a low-bias, universal timebase.</li>
            <li><b>Airliners & ships:</b> FMS/bridge systems converge faster on precise 4D time-position. Diversions/approaches guided by exact timing rather than coarse headings.</li>
            <li><b>Launch systems (conceptual only):</b> Since satellites already carry the time model, the computer consumes CST-stamped signals directly—no separate “find-your-position” calibration step.</li>
          </ul>
          <div class="mono muted" style="font-size:13px;line-height:1.45; margin-top:6px">
            Let dt be seconds since UTC midnight.<br/>
            phi_GEO(dt) = (45e-6) * (dt/86400) s, &nbsp; phi_GPS(dt) = (38e-6) * (dt/86400) s<br/>
            T_GEO = T_CST + phi_GEO ,&nbsp; T_GPS = T_CST + phi_GPS , &nbsp; Δns = phi × 1e9
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="muted" style="margin-bottom:8px">Globe — constellation in a 12-hour orbit (illustrative geometry)</div>
      <div class="globe">
        <svg id="globeSvg" viewBox="0 0 800 500" role="img" aria-label="Earth with satellites">
          <defs>
            <radialGradient id="earthGlow" cx="50%" cy="50%" r="55%">
              <stop offset="0%" stop-color="#1f3b7a"/>
              <stop offset="70%" stop-color="#14234b"/>
              <stop offset="100%" stop-color="#0b1020"/>
            </radialGradient>
          </defs>
          <rect x="0" y="0" width="800" height="500" fill="transparent"/>
          <!-- Earth -->
          <g id="earth" transform="translate(300,250)">
            <circle r="110" fill="url(#earthGlow)" class="earthStroke"/>
            <g id="grid">
              <circle r="108" fill="none" class="gridline"/>
              <line x1="-110" y1="0" x2="110" y2="0" class="gridline"/>
              <line x1="0" y1="-110" x2="0" y2="110" class="gridline"/>
            </g>
          </g>
          <!-- Orbit ring -->
          <g id="orbitRing" transform="translate(300,250)">
            <circle r="200" fill="none" stroke="rgba(255,255,255,.12)"/>
          </g>
          <!-- Satellite layer -->
          <g id="satLayer"></g>
        </svg>
      </div>
    </div>

    <div class="card">
      <div class="muted" style="margin-bottom:8px">Satellites — Atomic UTC / CST / Adjusted Clocks & Δns</div>
      <div class="scroll">
        <table id="satTable" class="mono">
          <thead>
            <tr>
              <th>#</th>
              <th>SVN / PRN / Block / Name</th>
              <th>Angle&nbsp;(°)</th>
              <th>Sub-Lon&nbsp;(°)</th>
              <th>Speed</th>
              <th>Atomic&nbsp;UTC</th>
              <th>CST</th>
              <th>GEO&nbsp;(+45 µs/day)</th>
              <th>GPS&nbsp;(+38 µs/day)</th>
              <th>Δns&nbsp;GEO</th>
              <th>Δns&nbsp;GPS</th>
            </tr>
          </thead>
          <tbody id="satBody"></tbody>
        </table>
      </div>
      <div class="muted small" style="margin-top:8px">
        Membership & health flags change with maintenance/NANUs. Snapshot below updates automatically when live JSON is reachable.
      </div>
    </div>

    <div class="card">
      <div class="muted" style="margin-bottom:8px">Embedded / Live JSON — names, launch dates (UTC), health/NANU notes</div>
      <pre id="jsonDump" class="json mono">loading…</pre>
      <div class="muted small" style="margin-top:8px">
        <b>Tip:</b> host a JSON at the same origin (e.g. <code>/data/navcen_snapshot.json</code>) to avoid CORS.
        Expected schema (array): <code>[{ "svn":74, "prn":4, "block":"III", "name":"Vespucci (GPS III-01)", "launch_utc":"2018-12-23T13:51Z", "health_note":"HEALTHY" }, ...]</code>
      </div>
    </div>
  </div>

<script>
(function(){
  // ===== CONSTANTS & SETUP =====
  const ORBIT_PERIOD_SEC = 12*3600;     // illustrative 12-h orbit
  const RATE_GEO_US_PER_DAY = 45;       // GEO comparison drift
  const RATE_GPS_US_PER_DAY = 38;       // GPS net drift
  const SECS_PER_DAY = 86400;
  const SPEED_KM_S = 3.874;             // GPS MEO orbital speed (approx)
  const SPEED_KM_H = SPEED_KM_S * 3600; // ~13,950 km/h

  // --- Live refresh config ---
  // Add your own endpoints here (same-origin preferred). The first that returns JSON will be used to merge/refresh.
  const LIVE_STATUS_URLS = [
    // Example: same-origin snapshot you host (best for CORS):
    "/data/navcen_snapshot.json",
    // Example: alternate path (remove if unused):
    "/navcen/constellation.json"
    // If you have a proxy API, add it here.
  ];
  const REFRESH_MS = 10 * 60 * 1000; // 10 minutes

  // ===== Constellation snapshot (from your earlier list) with best-known GPS III launch dates =====
  // For older IIR/IIR-M/IIF birds, launch_utc can be filled from a master list later.
  const CONSTELLATION = [
    // Plane A
    {svn:65, prn:24, block:"IIF"},
    {svn:52, prn:31, block:"IIR-M"},
    {svn:64, prn:30, block:"IIF"},
    {svn:48, prn: 7, block:"IIR-M"},
    // Plane B
    {svn:56, prn:16, block:"IIR"},
    {svn:62, prn:25, block:"IIF"},
    {svn:58, prn:12, block:"IIR-M"},
    {svn:59, prn:19, block:"IIR"},
    {svn:71, prn:26, block:"IIF"},
    // Plane C
    {svn:57, prn:29, block:"IIR-M"},
    {svn:66, prn:27, block:"IIF"},
    {svn:72, prn: 8, block:"IIF"},
    {svn:53, prn:17, block:"IIR-M"},
    // Plane D
    {svn:61, prn: 2, block:"IIR"},
    {svn:80, prn: 1, block:"III",   name:"Sally Ride (GPS III-07)",   launch_utc:"2024-12-17"},
    {svn:67, prn: 6, block:"IIF"},
    // Plane E
    {svn:69, prn: 3, block:"IIF"},
    {svn:73, prn:10, block:"IIF"},
    {svn:50, prn: 5, block:"IIR-M"},
    {svn:51, prn:20, block:"IIR"},
    {svn:76, prn:23, block:"III",   name:"Matthew Henson (GPS III-03)", launch_utc:"2020-06-30"},
    // Plane F
    {svn:70, prn:32, block:"IIF"},
    {svn:55, prn:15, block:"IIR-M"},
    // Additional
    {svn:44, prn:22, block:"IIR"},
    {svn:68, prn: 9, block:"IIF"},
    {svn:74, prn: 4, block:"III",   name:"Vespucci (GPS III-01)",     launch_utc:"2018-12-23T13:51Z"},
    {svn:43, prn:13, block:"IIR"},
    {svn:81, prn:21, block:"III",   name:"Katherine Johnson (GPS III-08)", launch_utc:"2025-05-30T17:37Z"},
    {svn:75, prn:18, block:"III",   name:"Magellan (GPS III-02)",     launch_utc:"2019-08-22T13:06Z"},
    {svn:77, prn:14, block:"III",   name:"Sacagawea (GPS III-04)",    launch_utc:"2020-11-05"},
    {svn:79, prn:28, block:"III",   name:"Amelia Earhart (GPS III-06)", launch_utc:"2023-01-18T12:24Z"},
    // Optional GPS III-05 (not in your almanac list, kept for completeness)
    {svn:78, prn:null, block:"III", name:"Neil Armstrong (GPS III-05)", launch_utc:"2021-06-17"}
  ];

  const SAT_COUNT = CONSTELLATION.length;

  // ===== DOM =====
  const elCstTime = document.getElementById('cstTime');
  const elCstIso  = document.getElementById('cstIso');
  const elSince   = document.getElementById('sinceMid');
  const tbody     = document.getElementById('satBody');
  const satLayer  = document.getElementById('satLayer');
  const jsonDump  = document.getElementById('jsonDump');
  const liveStamp = document.getElementById('liveStamp');

  // ===== Helpers =====
  function getCSTNowMs(){ return Date.now(); } // CST ≡ UTC baseline (live)
  function pad(n, w=2){ return n.toString().padStart(w,'0'); }
  function fmtHMSms(d){
    const hh = pad(d.getUTCHours());
    const mm = pad(d.getUTCMinutes());
    const ss = pad(d.getUTCSeconds());
    const ms = pad(d.getUTCMilliseconds(),3);
    return `${hh}:${mm}:${ss}.${ms}`;
  }
  function secondsSinceUtcMidnight(ms){
    const now = new Date(ms);
    const mid = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 0,0,0,0));
    return (now - mid)/1000;
  }
  function phaseSecondsGeo(dt){ return (RATE_GEO_US_PER_DAY*1e-6) * (dt/SECS_PER_DAY); }
  function phaseSecondsGps(dt){ return (RATE_GPS_US_PER_DAY*1e-6) * (dt/SECS_PER_DAY); }
  function orbitXY(angleDeg){
    const cx = 300, cy = 250, R  = 200;
    const a  = angleDeg * Math.PI/180;
    return { x: cx + R*Math.cos(a), y: cy + R*Math.sin(a) };
  }
  function byKey(s){ return `SVN${s.svn}-PRN${s.prn!==null?s.prn:'X'}`; }

  // ===== Build UI once =====
  (function buildUI(){
    // enrich with id and phase
    CONSTELLATION.forEach((s, i) => {
      s.id = i+1;
      s.phaseSec = (i * ORBIT_PERIOD_SEC) / SAT_COUNT;
    });

    // table
    const frag = document.createDocumentFragment();
    CONSTELLATION.forEach((s) => {
      const label = `SVN${s.svn} / PRN${s.prn!==null?String(s.prn).padStart(2,'0'):'—'} / Block ${s.block}` + (s.name?` — ${s.name}`:'');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="nowrap">${s.id}</td>
        <td id="label-${s.id}" class="nowrap" title="${s.health_note ? s.health_note : ''}">${label}${s.launch_utc?` — <span class="small muted">Launched ${s.launch_utc}</span>`:''}</td>
        <td id="ang-${s.id}" class="nowrap">0.0</td>
        <td id="lon-${s.id}" class="nowrap">0.0</td>
        <td id="spd-${s.id}" class="nowrap">—</td>
        <td id="utc-${s.id}" class="nowrap">--:--:--.---</td>
        <td id="cst-${s.id}" class="nowrap">--:--:--.---</td>
        <td id="geo-${s.id}" class="nowrap">--:--:--.---</td>
        <td id="gps-${s.id}" class="nowrap">--:--:--.---</td>
        <td id="dnsG-${s.id}" class="nowrap">0.0 ns</td>
        <td id="dnsP-${s.id}" class="nowrap">0.0 ns</td>
      `;
      frag.appendChild(tr);
    });
    tbody.appendChild(frag);

    // globe sprites
    const ns = "http://www.w3.org/2000/svg";
    CONSTELLATION.forEach((s) => {
      const g = document.createElementNS(ns,'g');
      g.setAttribute('id', `sprite-${s.id}`);
      const c = document.createElementNS(ns,'circle');
      c.setAttribute('r','4'); c.setAttribute('class','sat');
      const t = document.createElementNS(ns,'text');
      t.setAttribute('class','satlbl mono');
      t.setAttribute('text-anchor','start');
      const short = s.name ? s.name.split(' (')[0] : `SVN${s.svn}`;
      t.textContent = short;
      g.appendChild(c); g.appendChild(t);
      satLayer.appendChild(g);
    });

    // initial JSON dump
    jsonDump.textContent = JSON.stringify(CONSTELLATION, null, 2);
  })();

  // ===== Live update loop =====
  (function tick(){
    const nowMs = getCSTNowMs();
    const now   = new Date(nowMs);

    // Header clock
    elCstTime.textContent = fmtHMSms(now);
    elCstIso.textContent  = now.toISOString();
    const dt = secondsSinceUtcMidnight(nowMs);
    elSince.textContent = dt.toFixed(3) + ' s';

    // Comparison phase offsets
    const phiGeo = phaseSecondsGeo(dt);
    const phiGps = phaseSecondsGps(dt);
    const deltaNsGeo = phiGeo * 1e9;
    const deltaNsGps = phiGps * 1e9;

    // Update rows & sprites
    for(const s of CONSTELLATION){
      const tOrbit = (dt + s.phaseSec) % ORBIT_PERIOD_SEC;
      const angle  = (tOrbit / ORBIT_PERIOD_SEC) * 360;           // degrees
      const subLon = ((angle - 180 + 540) % 360) - 180;           // [-180,180]

      const utcStr = fmtHMSms(now);
      const cstStr = utcStr;                                      // CST==UTC baseline
      const geoStr = fmtHMSms(new Date(nowMs + phiGeo*1000));
      const gpsStr = fmtHMSms(new Date(nowMs + phiGps*1000));

      document.getElementById(`ang-${s.id}`).textContent  = angle.toFixed(1);
      document.getElementById(`lon-${s.id}`).textContent  = subLon.toFixed(1);
      document.getElementById(`spd-${s.id}`).textContent  = `${SPEED_KM_S.toFixed(3)} km/s (${Math.round(SPEED_KM_H).toLocaleString()} km/h)`;
      document.getElementById(`utc-${s.id}`).textContent  = utcStr;
      document.getElementById(`cst-${s.id}`).textContent  = cstStr;
      document.getElementById(`geo-${s.id}`).textContent  = geoStr;
      document.getElementById(`gps-${s.id}`).textContent  = gpsStr;
      document.getElementById(`dnsG-${s.id}`).textContent = `${deltaNsGeo.toFixed(3)} ns`;
      document.getElementById(`dnsP-${s.id}`).textContent = `${deltaNsGps.toFixed(3)} ns`;

      const p = orbitXY(angle);
      const g = document.getElementById(`sprite-${s.id}`);
      if(g){
        g.setAttribute('transform', `translate(${p.x},${p.y})`);
        const lbl = g.lastChild;
        lbl.setAttribute('x', 6); lbl.setAttribute('y', -6);
      }
    }

    requestAnimationFrame(tick);
  })();

  // ===== Background live refresh (merges JSON by SVN/PRN) =====
  async function tryFetch(url){
    const res = await fetch(url, {cache:"no-store"});
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    return res.json();
  }
  function mergeLiveData(items){
    // items: array of {svn?, prn?, block?, name?, launch_utc?, health_note?}
    let changed = false;
    for(const m of items){
      const hit = CONSTELLATION.find(s =>
        (m.svn!=null && s.svn===m.svn) || (m.prn!=null && s.prn===m.prn)
      );
      if(hit){
        // merge fields if provided
        ["block","name","launch_utc","health_note","prn","svn"].forEach(k=>{
          if(m[k]!=null && m[k]!==hit[k]){ hit[k]=m[k]; changed=true; }
        });
        // refresh label cell (name/launch/tooltip)
        const label = `SVN${hit.svn} / PRN${hit.prn!==null?String(hit.prn).padStart(2,'0'):'—'} / Block ${hit.block}` + (hit.name?` — ${hit.name}`:'');
        const cell = document.getElementById(`label-${hit.id}`);
        if(cell){
          cell.innerHTML = `${label}${hit.launch_utc?` — <span class="small muted">Launched ${hit.launch_utc}</span>`:''}`;
          cell.title = hit.health_note ? hit.health_note : '';
        }
      }
    }
    if(changed){
      jsonDump.textContent = JSON.stringify(CONSTELLATION, null, 2);
    }
  }
  async function refreshLive(){
    for(const url of LIVE_STATUS_URLS){
      try{
        const data = await tryFetch(url);
        if(Array.isArray(data) && data.length){
          mergeLiveData(data);
          const t = new Date();
          liveStamp.textContent = `Last live refresh: ${t.toISOString()} from ${url}`;
          return;
        }
      }catch(e){
        // Ignore and try next URL
      }
    }
    // No success
    const t = new Date();
    liveStamp.textContent = `Live refresh attempted ${t.toISOString()} — no live JSON reachable (using embedded snapshot)`;
  }
  // start periodic refresh
  refreshLive();
  setInterval(refreshLive, REFRESH_MS);

})();
</script>
</body>
</html>
