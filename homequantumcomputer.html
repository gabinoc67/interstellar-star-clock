<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CST Scientific Calculator — Symbols • Steps • 10 Demos</title>
<style>
  :root{
    --bg:#0b1220;--panel:#121a2e;--ink:#e8eeff;--muted:#aab4d6;--accent:#7aa7ff;--ok:#34e6a2;--warn:#ffd166;--bad:#ff6b8b;--border:#22325e;
    --btn:#182241;--btn2:#1d2750;--btnOp:#253268;--btnEq:#2b7a4b;--btnAct:#3b82f6;--chip:#0f1630;--card:#0f162c;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1400px 900px at 70% 0%,#121a2e 0%,#0b1220 60%,#08101d 100%);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:1200px;margin:24px auto;padding:16px}
  h1{margin:0 0 8px;font-size:clamp(22px,3.2vw,32px)}
  p.lead{margin:0 0 14px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:420px 1fr;gap:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}

  .calc{background:linear-gradient(180deg,#121a2e,#0e1529);border:1px solid var(--border);border-radius:16px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
  .display{display:flex;gap:8px;align-items:center}
  .screen{flex:1;background:#0b1122;border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:20px;min-height:48px;box-shadow:inset 0 0 0 1px rgba(255,255,255,.03)}
  .screen input{width:100%;background:transparent;color:var(--ink);border:0;outline:0;font-size:20px}
  .mode{display:flex;gap:8px}
  .chip{background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer;user-select:none}
  .chip.active{outline:2px solid var(--accent)}

  .keypad{margin-top:10px;display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
  .btn{border:1px solid var(--border);background:var(--btn);color:var(--ink);padding:12px 8px;border-radius:10px;cursor:pointer;text-align:center;user-select:none}
  .btn.op{background:var(--btnOp)}
  .btn.eq{background:var(--btnEq)}
  .btn.act{background:var(--btnAct)}
  .btn:active{transform:translateY(1px)}

  .side{display:grid;gap:12px}
  .card{background:linear-gradient(180deg,#0d1427,#0a1223);border:1px solid var(--border);border-radius:14px;padding:12px}
  .card h3{margin:0 0 8px;font-size:16px;color:#d9e4ff}
  .steps{max-height:260px;overflow:auto;line-height:1.45}
  .steps .step{background:var(--card);border:1px dashed var(--border);padding:8px;border-radius:8px;margin:6px 0;color:#cfe1ff}
  .history{max-height:124px;overflow:auto}
  .history .item{padding:6px;border-bottom:1px dashed var(--border);font-family:ui-monospace,Consolas,Menlo,monospace;color:#cfe1ff}
  .demos{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .demo{padding:10px;background:var(--chip);border:1px solid var(--border);border-radius:10px;cursor:pointer}
  .demo:hover{outline:2px solid #29417a}
  .muted{color:var(--muted)}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .actions .btn{padding:10px 12px}
  .printable{background:#fff;color:#111;padding:16px;border-radius:12px}
  .printable h2{margin:0 0 6px}
  .printable pre{white-space:pre-wrap}
  @media print{body{background:#fff}.wrap{margin:0;max-width:none}.grid{grid-template-columns:1fr}.card,.calc{box-shadow:none}.actions{display:none}}
</style>
</head>
<body>
<div class="wrap">
  <h1>CST Scientific Calculator</h1>
  <p class="lead">Symbols • Steps • 10 Demonstrations • Print Results. Toggle <strong>DEG/RAD</strong>, click symbols, type on keyboard, and see how each result is computed step-by-step.</p>

  <div class="grid">
    <section class="calc" aria-label="scientific calculator">
      <div class="display">
        <div class="screen"><input id="expr" aria-label="expression input" placeholder="Type or tap: e.g., sin(30) + √(3)^2 - π/4"/></div>
        <div class="mode">
          <span id="degBtn" class="chip active">DEG</span>
          <span id="radBtn" class="chip">RAD</span>
        </div>
      </div>
      <div class="keypad" id="keypad"></div>
      <div class="actions" style="margin-top:10px">
        <button class="btn" id="showSteps">Solve & Show Steps</button>
        <button class="btn" id="addHist">Add to History</button>
        <button class="btn" id="printBtn">Print Result</button>
        <button class="btn" id="clearBtn">Clear Results</button>
        <span class="muted">Tip: Press Enter to evaluate • Use ↑/↓ to cycle history</span>
      </div>
    </section>

    <aside class="side">
      <div class="card"><h3>Step-by-Step Solution</h3><div id="steps" class="steps"></div></div>
      <div class="card"><h3>History</h3><div id="history" class="history"></div></div>
      <div class="card"><h3>10 Demonstrations (click to load)</h3><div class="demos" id="demos"></div></div>
      <div class="card"><h3>Printable Summary</h3><div id="printArea" class="printable"><h2>Calculation Summary</h2><div><strong>Expression:</strong> <span id="pExpr">—</span></div><div><strong>Result:</strong> <span id="pRes">—</span></div><div><strong>Mode:</strong> <span id="pMode">DEG</span></div><h3>Steps</h3><pre id="pSteps">(Run a calculation to populate this section.)</pre></div></div>
      <div class="card"><h3>Built-in Tests</h3><div class="actions"><button class="btn" id="runTests">Run Tests</button></div><div id="testOutput" class="steps"></div></div>
      <div class="card"><h3>Symbols Palette</h3><div class="demos" id="symbolsPalette"></div></div>
    </aside>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
const $=id=>document.getElementById(id);
const exprEl=$('expr'),stepsEl=$('steps'),histEl=$('history'),demosEl=$('demos');
const degBtn=$('degBtn'),radBtn=$('radBtn'),showStepsBtn=$('showSteps');
const printBtn=$('printBtn'),clearBtn=$('clearBtn'),runTestsBtn=$('runTests');
const pExpr=$('pExpr'),pRes=$('pRes'),pMode=$('pMode'),pSteps=$('pSteps');
const testOutput=$('testOutput'),paletteEl=$('symbolsPalette');
let DEG=true,memory=0,history=[];
const demos=[
  {name:"Quadratic (x=?)",expr:"(-b + sqrt(b^2 - 4*a*c)) / (2*a)",fill:{a:1,b:-3,c:2},note:"Quadratic formula for a=1, b=−3, c=2 → root 2 (plus branch)."},
  {name:"Trig mix",expr:"sin(30) + cos(60) + tan(45)",note:"Using DEG mode → total 2."},
  {name:"Log rules",expr:"ln(e^2) + log(1000) - ln(e)",note:"ln(e²)=2, log₁₀(1000)=3, ln(e)=1 → 4."},
  {name:"CST Energy",expr:"(m/rho)*(c*CSTr*TCST)^2",fill:{m:1.2,rho:0.8,c:299792458,CSTr:0.97,TCST:1.03},note:"E=(m/ρ)(c·CSTᵣ·Tᴄsᴛ)² sample."},
  {name:"Vector magnitude",expr:"sqrt(3^2 + 4^2)",note:"→ 5 by Pythagoras."},
  {name:"Compound interest",expr:"P*(1+r/n)^(n*t)",fill:{P:1000,r:0.05,n:12,t:10},note:"P(1+r/n)^{nt}."},
  {name:"Angle identity",expr:"sin(2*30)",note:"sin(60)=√3/2 ≈ 0.8660."},
  {name:"Degrees↔Radians",expr:"sin(pi/6) + cos(pi/3)",note:"RAD mode → total 1."},
  {name:"Percent & power",expr:"200*15% + 2^5",note:"15%→0.15 → 62 total."},
  {name:"Gamma-like (exp/ln)",expr:"exp(ln(5)) + ln(e)",note:"→ 6."}
];

demos.forEach((d,i)=>{
  const div=document.createElement('div');
  div.className='demo';div.dataset.index=i;div.textContent=(i+1)+'. '+d.name;
  div.title=d.note;div.tabIndex=0;
  div.onclick=()=>loadDemo(i);
  demosEl.appendChild(div);
});

function applyFill(expr,fill){let out=expr;for(const[k,v]of Object.entries(fill||{})){out=out.replace(new RegExp("\\b"+k+"\\b","g"),v);}return out;}

function loadDemo(i){
  const d=demos[i];if(!d)return;
  const expr=applyFill(d.expr,d.fill);
  exprEl.value=expr;
  stepsEl.innerHTML='';
  addStep('Demo loaded: '+d.name,true);
  addStep('Note: '+d.note,true);
  const {result,steps,error}=safeCompute(expr,DEG);
  if(error)addStep('Error: '+error,false);
  else{steps.forEach(s=>addStep(s,true));addStep('Result = '+result,true);}
  pExpr.textContent=expr;pRes.textContent=result;pSteps.textContent=steps.join('\n');
}

function addStep(t){const d=document.createElement('div');d.className='step';d.textContent=t;stepsEl.appendChild(d);stepsEl.scrollTop=stepsEl.scrollHeight;}

function safeCompute(input,degMode=true){
  const steps=[];
  try{
    let expr=input.replace(/π/g,'pi').replace(/×/g,'*').replace(/÷/g,'/').replace(/\^/g,'**').replace(/√/g,'sqrt');
    expr=expr.replace(/(\d+(?:\.\d+)?)\s*%/g,'($1/100)');
    steps.push('Normalized: '+expr);
    const trig=['sin','cos','tan'];
    if(degMode){trig.forEach(fn=>{expr=expr.replace(new RegExp('\\b'+fn+'\\(([^()]+)\\)','g'),(_,a)=>`${fn}d(${a})`);});steps.push('DEG mode active');}
    const scope=buildScope();
    const fn=new Function(...Object.keys(scope),'return ('+expr+')');
    const res=fn(...Object.values(scope));
    steps.push('Evaluated: '+res);
    return{result:res,steps};
  }catch(e){return{result:null,steps,error:e.message};}
}

function buildScope(){
  const toRad=x=>x*Math.PI/180;
  return{pi:Math.PI,e:Math.E,c:299792458,
    sqrt:Math.sqrt,abs:Math.abs,exp:Math.exp,ln:Math.log,log:x=>Math.log10(x),
    sin:Math.sin,cos:Math.cos,tan:Math.tan,
    sind:x=>Math.sin(toRad(x)),cosd:x=>Math.cos(toRad(x)),tand:x=>Math.tan(toRad(x))
  };
}
});
</script>
</body>
</html>
