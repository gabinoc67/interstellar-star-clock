<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>🪐 Interstellar Star Clock — Multi-Planet + Vectors</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --fg:#00ffcc; --gap: clamp(10px, 2vmin, 22px); --pad: clamp(10px, 2vmin, 18px); }
    *{ box-sizing: border-box; }
    body{
      background:#000; color:var(--fg); font-family:'Courier New', monospace;
      margin:0; min-height:100vh; display:flex; justify-content:center; padding:var(--pad);
    }
    .wrap{
      display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap);
      max-width: min(1200px, 98vw); width:100%; align-items:start;
    }
    header{
      grid-column: 1 / -1; display:flex; justify-content:space-between; align-items:center; gap: var(--gap);
    }
    h1{ margin:0; font-size: clamp(1.2rem, 3.2vw, 2.4rem); line-height:1.15; }
    .controls{ display:flex; align-items:center; gap:.5rem; font-size: clamp(.9rem, 1.6vw, 1rem); }
    select{
      background:#001a16; color:var(--fg); border:1px solid #064e3b; padding:.3rem .5rem; border-radius:6px;
    }

    /* Left side: Vector canvas + image stacked */
    .left{
      display:flex; flex-direction:column; align-items:center; gap: var(--gap);
    }
    .canvas-wrap{ width:100%; display:flex; justify-content:center; }
    canvas{ width:100%; max-width:560px; aspect-ratio:1 / 1; background:#000; border:1px solid #064e3b; border-radius:10px; }

    .planet-image{ display:flex; justify-content:center; width:100%; }
    .planet-image img{ width:min(40vw, 44vh, 420px); height:auto; display:block; }

    /* Right side: text content */
    .content{ text-align:center; padding: var(--pad); }
    h2{ margin:.25rem 0 .4rem; font-size: clamp(1rem, 2.1vw, 1.6rem); }
    .clock-box{ margin-top: .9rem; font-size: clamp(.95rem, 1.5vw, 1.2rem); }
    .muted{ opacity:.85; font-size:.95em; }

    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      .planet-image img{ width:min(70vw, 48vh, 420px); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>🪐 Interstellar Star Clock — <span id="titlePlanet">Earth</span></h1>
      <div class="controls">
        <label for="planet">Planet:</label>
        <select id="planet">
          <option>Mercury</option><option>Venus</option><option selected>Earth</option>
          <option>Mars</option><option>Jupiter</option><option>Saturn</option>
          <option>Uranus</option><option>Neptune</option><option>Pluto</option>
        </select>
      </div>
    </header>

    <div class="left">
      <div class="canvas-wrap">
        <canvas id="vectorCanvas"></canvas>
      </div>
      <div class="planet-image">
        <img id="planetImg" alt="Planet image">
      </div>
    </div>

    <div class="content">
      <div class="clock-box">
        <h2>🌍 Local Time (America/Chicago)</h2>
        <div id="localClock"></div>
      </div>

      <div class="clock-box">
        <h2>🌌 Interstellar Time</h2>
        <div id="interstellarClock" class="muted"></div>
      </div>

      <div class="clock-box">
        <h2>🚀 Stardate</h2>
        <div id="starDate" class="muted"></div>
      </div>

      <div class="clock-box">
        <h2>📏 Distance from Sun</h2>
        <div id="distanceFromSun"></div>
      </div>

      <div class="clock-box">
        <h2>🔭 Orbital Position</h2>
        <div id="trueAnomaly"></div>
      </div>

      <div class="clock-box">
        <h2>🕛 Orbit Clock (since perihelion)</h2>
        <div id="orbitSince"></div>
        <div id="orbitRemaining"></div>
        <div id="orbitPercent"></div>
        <div id="orbitDetails" class="muted"></div>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    // ---------- Constants & helpers ----------
    const DEG2RAD = Math.PI / 180, RAD2DEG = 180 / Math.PI, AU_TO_MILES = 92955807.3;
    function norm360(x){ x = x % 360; return x < 0 ? x + 360 : x; }
    function norm2pi(x){ x = x % (2*Math.PI); return x < 0 ? x + 2*Math.PI : x; }

    function toJulianDate(dateUTC) {
      const a = Math.floor((14 - (dateUTC.getUTCMonth()+1)) / 12);
      const y = dateUTC.getUTCFullYear() + 4800 - a;
      const m = (dateUTC.getUTCMonth()+1) + 12*a - 3;
      const JDN = dateUTC.getUTCDate()
        + Math.floor((153*m + 2)/5)
        + 365*y + Math.floor(y/4) - Math.floor(y/100) + Math.floor(y/400) - 32045;
      const dayFrac = (dateUTC.getUTCHours() - 12)/24
        + dateUTC.getUTCMinutes()/1440 + dateUTC.getUTCSeconds()/86400
        + dateUTC.getUTCMilliseconds()/86400000;
      return JDN + dayFrac;
    }
    function dhmsDays(totalDays) {
      const sign = totalDays < 0 ? "-" : "";
      totalDays = Math.abs(totalDays);
      const d = Math.floor(totalDays);
      const h = Math.floor((totalDays - d) * 24);
      const m = Math.floor(((totalDays - d) * 24 - h) * 60);
      const s = Math.floor(((((totalDays - d) * 24 - h) * 60) - m) * 60);
      return `${sign}${d}d ${h}h ${m}m ${s}s`;
    }

    // ---------- J2000 mean elements with secular rates (deg/century) ----------
    const PLANETS = {
      Mercury: { a:0.38709893, da:0.00000066, e:0.20563069, de:0.00002527, L:252.25084, dL:149472.67411175, varpi:77.45645, dvarpi:0.16047689, P:87.9691, color:"#9ad" },
      Venus:   { a:0.72333199, da:0.00000092, e:0.00677323, de:-0.00004938, L:181.97973, dL:58517.81538729, varpi:131.56370, dvarpi:0.0020708,  P:224.701, color:"#f7c" },
      Earth:   { a:1.00000011, da:-0.00000005, e:0.01671022, de:-0.00003804, L:100.46435, dL:35999.37285429, varpi:102.93735, dvarpi:0.32327364, P:365.256363004, color:"#0fc" },
      Mars:    { a:1.52366231, da:-0.00007221, e:0.09341233, de:0.00011902, L:-4.553432, dL:19140.30268499, varpi:-23.943629, dvarpi:0.44441088, P:686.971, color:"#f66" },
      Jupiter: { a:5.20336301, da:0.00060737, e:0.04839266, de:-0.00012880, L:34.351484, dL:3034.90567464, varpi:14.331309, dvarpi:0.2155525, P:4332.59, color:"#ffb" },
      Saturn:  { a:9.53707032, da:-0.00301530, e:0.05415060, de:-0.00036762, L:50.077471, dL:1222.11379404, varpi:93.057237, dvarpi:0.5665415, P:10759.22, color:"#fb9" },
      Uranus:  { a:19.19126393, da:0.00152025, e:0.04716771, de:-0.00019150, L:314.055005, dL:428.46699831, varpi:173.005159, dvarpi:0.1686465, P:30688.5, color:"#9ff" },
      Neptune: { a:30.06896348, da:-0.00125196, e:0.00858587, de:0.00002510, L:304.348665, dL:218.48620020, varpi:48.123691, dvarpi:0.0259423, P:60182, color:"#9bf" },
      Pluto:   { a:39.48168677, da:-0.00076912, e:0.24880766, de:0.00006465, L:238.92881, dL:145.20780515, varpi:224.06676, dvarpi:-0.04062942, P:90560, color:"#ddd" }
    };

    // ---------- Kepler solver ----------
    function solveKeplerElliptic(M, e) { // M in rad
      let E = (e < 0.8) ? M : Math.PI;
      for (let i=0; i<15; i++){
        const f = E - e*Math.sin(E) - M;
        const f1 = 1 - e*Math.cos(E);
        const dE = -f / f1;
        E += dE;
        if (Math.abs(dE) < 1e-12) break;
      }
      return E;
    }

    function orbitState(name, dateUTC){
      const p = PLANETS[name];
      const JD = toJulianDate(dateUTC);
      const T = (JD - 2451545.0) / 36525.0;

      const a = p.a + p.da*T;
      const e = p.e + p.de*T;
      const L = p.L + p.dL*T;
      const varpi = p.varpi + p.dvarpi*T;

      const Mdeg = norm360(L - varpi);
      const M = Mdeg * DEG2RAD;

      const Pdays = p.P;
      const n = 2*Math.PI / Pdays;

      const E = solveKeplerElliptic(M, e);
      const rAU = a * (1 - e*Math.cos(E));
      const nu = 2*Math.atan2(Math.sqrt(1+e)*Math.sin(E/2), Math.sqrt(1-e)*Math.cos(E/2));
      const nudeg = norm2pi(nu) * RAD2DEG;

      const Mnorm = norm2pi(M);
      const sinceDays = Mnorm / n;
      const remainDays = (2*Math.PI - Mnorm) / n;
      const pct = (Mnorm / (2*Math.PI)) * 100;

      return { aAU:a, e, Mdeg, nudeg, rAU, sinceDays, remainDays, percent:pct, color:p.color };
    }

    // ---------- Image handling ----------
    const IMG = {
      Mercury:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/mercury.png",
      Venus:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/venus.png",
      Earth:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/earth.png",
      Mars:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/mars.png",
      Jupiter:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/jupiter.png",
      Saturn:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/saturn.png",
      Uranus:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/uranus.png",
      Neptune:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/neptune.png",
      Pluto:"https://raw.githubusercontent.com/gabinoc67/interstellar-star-clock/main/pluto.png"
    };
    function setPlanetImage(name){
      const img = document.getElementById('planetImg');
      img.src = IMG[name] || "";
      if(!IMG[name]){
        img.alt = name;
      }
    }

    // ---------- Canvas drawing (all planets) ----------
    const planetEl = document.getElementById('planet');
    const titlePlanet = document.getElementById('titlePlanet');
    const canvas = document.getElementById('vectorCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas(){
      // Handle HiDPI for crisp lines
      const cssSize = canvas.getBoundingClientRect();
      const ratio = Math.max(1, Math.floor(window.devicePixelRatio || 1));
      canvas.width = Math.floor(cssSize.width * ratio);
      canvas.height = Math.floor(cssSize.height * ratio);
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0); // draw in CSS pixels
    }
    window.addEventListener('resize', () => { resizeCanvas(); drawVectors(); });

    function drawVectors(){
      const now = new Date();
      resizeCanvas();
      const w = canvas.clientWidth, h = canvas.clientHeight;
      const cx = w/2, cy = h/2;

      // Compute states for all planets
      const names = Object.keys(PLANETS);
      const states = names.map(n => ({ name:n, st: orbitState(n, new Date(now.toISOString())) }));

      // Determine scale so Pluto fits comfortably
      const maxAphelion = Math.max(...states.map(o => o.st.aAU * (1 + o.st.e)));
      const margin = 0.9; // leave border
      const scale = Math.min(cx, cy) * margin / maxAphelion; // pixels per AU

      // Clear
      ctx.clearRect(0,0,w,h);

      // Draw Sun at center
      ctx.beginPath();
      ctx.arc(cx, cy, 6, 0, Math.PI*2);
      ctx.fillStyle = "#ffd27f";
      ctx.fill();

      // 0° reference line (perihelion direction)
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.lineTo(cx + maxAphelion*scale, cy);
      ctx.strokeStyle = "rgba(255,255,255,0.25)";
      ctx.lineWidth = 1;
      ctx.setLineDash([6,4]);
      ctx.stroke();
      ctx.setLineDash([]);

      // Draw orbits (circles at aAU) & vectors/points
      ctx.lineWidth = 1;
      ctx.font = "12px 'Courier New', monospace";

      for(const {name, st} of states){
        const color = PLANETS[name].color || "#fff";
        const orbitR = st.aAU * scale;

        // Orbit ring (approx circular)
        ctx.beginPath();
        ctx.arc(cx, cy, orbitR, 0, Math.PI*2);
        ctx.strokeStyle = "rgba(255,255,255,0.15)";
        ctx.stroke();

        // Vector to current position at true anomaly ν from perihelion (0° along +x)
        const theta = st.nudeg * DEG2RAD;
        const rPx = st.rAU * scale;
        const x = cx + rPx * Math.cos(theta);
        const y = cy + rPx * Math.sin(theta);

        // Vector line
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(x, y);
        ctx.strokeStyle = color;
        ctx.lineWidth = (name === planetEl.value) ? 2.5 : 1.5;
        ctx.stroke();

        // Planet marker
        ctx.beginPath();
        ctx.arc(x, y, (name === planetEl.value) ? 4 : 3, 0, Math.PI*2);
        ctx.fillStyle = color;
        ctx.fill();

        // Label (slight offset)
        ctx.fillStyle = color;
        ctx.fillText(name, x + 6, y - 6);
      }

      // Legend for selected planet
      const sel = planetEl.value;
      const selState = states.find(o => o.name === sel).st;
      ctx.fillStyle = "#aaa";
      ctx.fillText(`0° = perihelion direction  |  Showing vectors at: ${now.toUTCString()}`, 12, h - 14);
    }

    // ---------- Clock/Readouts ----------
    function updateClocks() {
      const now = new Date();
      const planet = planetEl.value;
      titlePlanet.textContent = planet;

      // Proper America/Chicago local time with DST
      const chicago = new Intl.DateTimeFormat('en-US', {
        timeZone: 'America/Chicago',
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      }).format(now);
      document.getElementById("localClock").textContent = `${chicago} (America/Chicago)`;

      // Interstellar & Stardate (cosmetic)
      const start = new Date("2000-01-01T00:00:00Z");
      const nowDays = (now - start) / 86400000;
      const elapsedYears = nowDays / 365.25;
      const interstellarYears = elapsedYears * 2.26e6;
      document.getElementById("interstellarClock").textContent =
        "Year ~" + Number(interstellarYears.toFixed(2)).toLocaleString();
      const stardate = 40000 + (elapsedYears * 1000);
      document.getElementById("starDate").textContent = "Stardate " + stardate.toFixed(1);

      // Accurate orbit/perihelion clock for selected planet
      const st = orbitState(planet, new Date(now.toISOString()));
      document.getElementById("orbitSince").textContent =
        `Elapsed since perihelion (${planet}): ${dhmsDays(st.sinceDays)}`;
      document.getElementById("orbitRemaining").textContent =
        `Time to next perihelion (${planet}): ${dhmsDays(st.remainDays)}`;
      document.getElementById("orbitPercent").textContent =
        `Orbit completion (${planet}): ${st.percent.toFixed(6)}%`;
      document.getElementById("orbitDetails").textContent =
        `a=${st.aAU.toFixed(6)} AU, e=${st.e.toFixed(6)} | M=${st.Mdeg.toFixed(4)}°, ν=${st.nudeg.toFixed(4)}°`;

      // Distance & true anomaly for selected planet
      const distanceMiles = st.rAU * AU_TO_MILES;
      document.getElementById("distanceFromSun").textContent =
        Math.round(distanceMiles).toLocaleString() + " miles";
      document.getElementById("trueAnomaly").textContent =
        `${st.nudeg.toFixed(4)}° true anomaly from perihelion`;

      // Redraw vectors
      drawVectors();
    }

    // ---------- Wiring ----------
    planetEl.addEventListener('change', () => {
      setPlanetImage(planetEl.value);
      updateClocks();
    });

    // Initial
    setPlanetImage(planetEl.value);
    updateClocks();
    setInterval(updateClocks, 1000);
  });
  </script>
</body>
</html>
