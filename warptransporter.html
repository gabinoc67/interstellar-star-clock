<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Transporter Rooms A↔B — Warp-Tunnel Demo</title>
<style>
  :root{
    --bg:#0b1020; --ink:#eaf0ff; --muted:#b8c4ff; --card:#12183a; --accent:#9bb4ff; --ok:#20e3b2;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  a{color:var(--accent)}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  h1{margin:.2rem 0 .6rem;font-size:26px}
  h2{margin:.4rem 0 .3rem;font-size:18px;color:var(--muted)}
  .grid{display:grid;gap:14px}
  .cols{grid-template-columns:1fr 1fr}
  .card{background:var(--card);border:1px solid #21305e;border-radius:18px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  label{display:block;font-size:12px;color:var(--muted);margin:.25rem 0}
  input,select,button{width:100%;padding:9px 11px;border-radius:12px;border:1px solid #2a3a72;background:#0e1533;color:var(--ink)}
  input[type=range]{padding:0}
  .row{display:flex;gap:10px;align-items:center}
  .row>*{flex:1}
  .btn{cursor:pointer;transition:.15s ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:#1b2a6b;border-color:#2b3b9e}
  .btn.reset{background:#3a1b1b;border-color:#7a2d2d}
  .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:8px}
  .kpi .cell{background:#0d1430;border:1px solid #22305c;border-radius:14px;padding:10px}
  .kpi .label{font-size:12px;color:var(--muted)}
  .kpi .value{font-size:16px;font-weight:700}
  canvas{width:100%;height:380px;background:#050a1a;border:1px solid #1c2a58;border-radius:16px}
  .legend{font-size:12px;color:var(--muted)}
  .note{font-size:13px;color:#d5dbff}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Transporter Rooms A↔B — Warp-Tunnel Demo (Earth⇄Moon)</h1>
    <p class="note">
      This demo uses warp-tunnel concepts (η, bubble/tunnel radii, CST timing, stress-energy sketch) to visualize
      room-to-room transport. <b>Rule:</b> Stability must be <b>≥ 94/100</b> to engage. During transit a <b>white dot</b>
      moves from source to destination; on arrival the <b>destination circle turns white</b>. <b>Reset</b> returns both
      circles to yellow. Item selection is for the user’s reference only (mass ignored).
    </p>

    <div class="grid cols">
      <div class="card" id="roomA">
        <h2>Transporter A — Earth</h2>

        <label>Item (user selection only; mass ignored)</label>
        <div class="row">
          <select id="item">
            <option>Tool case</option><option>Medical kit</option><option>Seismometer</option>
            <option>Water canister</option><option>Soil sample</option><option>Food pack</option>
            <option>Battery module</option><option>Small rover</option><option>Comm relay</option>
            <option>Photon sensor array</option><option>Field analyzer</option><option>Hab module spare</option>
            <option>Navigation beacon</option><option>Thermal blanket</option><option>Micro-drone</option>
          </select>
          <button class="btn" id="rnd">Randomize</button>
        </div>

        <div class="row">
          <div>
            <label>Tunnel radius R (m)</label>
            <input type="number" id="RA" value="2.5" min="1" step="0.1"/>
          </div>
          <div>
            <label>Bubble radius R<sub>b</sub> (m)</label>
            <input type="number" id="RbA" value="1.6" min="0.1" step="0.1"/>
          </div>
        </div>
      </div>

      <div class="card" id="roomB">
        <h2>Transporter B — Moon</h2>
        <label>Direction</label>
        <select id="dir">
          <option value="AtoB" selected>A → B (Earth → Moon)</option>
          <option value="BtoA">B → A (Moon → Earth)</option>
        </select>
        <div class="row">
          <div>
            <label>Tunnel radius R (m)</label>
            <input type="number" id="RB" value="2.5" min="1" step="0.1"/>
          </div>
          <div>
            <label>Bubble radius R<sub>b</sub> (m)</label>
            <input type="number" id="RbB" value="1.6" min="0.1" step="0.1"/>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>Central Console — Calculations</h2>
      <div class="row" style="margin-bottom:10px">
        <div>
          <label>Photon field (arb.)</label>
          <input type="range" id="Iph" min="0" max="10" value="6" step="0.1"/>
        </div>
        <div>
          <label>Casimir array power (arb.)</label>
          <input type="range" id="Pcas" min="0" max="10" value="4" step="0.1"/>
        </div>
        <div>
          <label>Entanglement sync (arb.)</label>
          <input type="range" id="Sent" min="0" max="10" value="7" step="0.1"/>
        </div>
        <div>
          <label>CST effective c factor (c_eff/c)</label>
          <input type="range" id="ceff" min="0.1" max="1" value="0.9" step="0.01"/>
        </div>
      </div>

      <div class="kpi">
        <div class="cell"><div class="label">Distance Earth–Moon (km)</div><div class="value" id="dist">384,400</div></div>
        <div class="cell"><div class="label">Space Usage η=(R_b/R)^2</div><div class="value" id="eta">—</div></div>
        <div class="cell"><div class="label">Bubble Volume V_b (norm.)</div><div class="value" id="Vb">—</div></div>
        <div class="cell"><div class="label">Δt_CST = L/c_eff (norm.)</div><div class="value" id="dtcst">—</div></div>
        <div class="cell"><div class="label">ρ (stress-energy sketch)</div><div class="value" id="rho">—</div></div>
        <div class="cell"><div class="label">Stability Index</div><div class="value" id="stab">—</div></div>
      </div>

      <div class="row" style="margin-top:12px">
        <button class="btn primary" id="calc">Calculate</button>
        <button class="btn primary" id="engage">Engage Beam</button>
        <button class="btn reset" id="reset">Reset</button>
      </div>

      <p class="legend" style="margin-top:10px">
        Equations (demo): η=(R_b/R)^2, V_b=πR_b^2 L, Δt_CST=L/c_eff,
        and stress-energy sketch ρ = A·I_ph − B·P_cas + C·S_ent (normalized).
        <b>Safety rule:</b> require R_b ≤ R and <b>Stability ≥ 94/100</b> to beam.
      </p>
      <div id="narr" class="legend">
        Press <b>Calculate</b> to populate values. <b>Engage</b>: a white dot moves toward the destination; the destination circle turns white.
        <b>Reset</b>: both circles return to yellow. Item selection is cosmetic only; mass is ignored.
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>Visualization</h2>
      <canvas id="viz" width="1000" height="380"></canvas>
      <div class="legend">Left pad = Transporter A (Earth). Right pad = Transporter B (Moon). Yellow = ready, White = item present at that station.</div>
    </div>
  </div>

<script>
// ---------------- Data & UI ----------------
const L_km = 384400;                // Earth↔Moon average
const A=1.0, B=0.6, C=0.4;          // weights for stress-energy sketch
const STAB_THRESHOLD = 94;          // NEW: must be ≥ 94/100 to engage

const el={
  RA:document.getElementById('RA'), RbA:document.getElementById('RbA'),
  RB:document.getElementById('RB'), RbB:document.getElementById('RbB'),
  dir:document.getElementById('dir'), Iph:document.getElementById('Iph'), Pcas:document.getElementById('Pcas'), Sent:document.getElementById('Sent'), ceff:document.getElementById('ceff'),
  calc:document.getElementById('calc'), engage:document.getElementById('engage'), reset:document.getElementById('reset'),
  eta:document.getElementById('eta'), Vb:document.getElementById('Vb'), dtcst:document.getElementById('dtcst'), rho:document.getElementById('rho'), stab:document.getElementById('stab'), narr:document.getElementById('narr'),
  canvas:document.getElementById('viz'),
  item:document.getElementById('item'), rnd:document.getElementById('rnd')
};

el.rnd.onclick = ()=>{ el.item.selectedIndex = Math.floor(Math.random()*el.item.options.length); };

// ---------------- Drawing ----------------
const ctx=el.canvas.getContext('2d');
const W=el.canvas.width, H=el.canvas.height;
const PAD_L={x:200,y:H/2}, PAD_R={x:W-200,y:H/2};

function drawScene(opts){
  const {RA,RbA,RB,RbB,dir='AtoB',t=0,phase='idle'}=opts;
  ctx.clearRect(0,0,W,H);
  // pads
  ctx.setLineDash([6,6]); ctx.strokeStyle='#9bb4ff'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(PAD_L.x,PAD_L.y, 60, 0, Math.PI*2); ctx.stroke();
  ctx.beginPath(); ctx.arc(PAD_R.x,PAD_R.y, 60, 0, Math.PI*2); ctx.stroke();
  ctx.setLineDash([]);
  // bubbles (scaled to radii)
  const bL = Math.min(58, 58*(RbA/RA));
  const bR = Math.min(58, 58*(RbB/RB));
  ctx.fillStyle='rgba(155,180,255,0.25)';
  ctx.beginPath(); ctx.arc(PAD_L.x,PAD_L.y, bL, 0, Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(PAD_R.x,PAD_R.y, bR, 0, Math.PI*2); ctx.fill();
  // labels
  ctx.fillStyle='#eaf0ff'; ctx.font='14px system-ui';
  ctx.fillText('A — Earth', PAD_L.x-38, PAD_L.y+92);
  ctx.fillText('B — Moon',  PAD_R.x-30, PAD_R.y+92);

  const src = (dir==='AtoB')? PAD_L : PAD_R;
  const dst = (dir==='AtoB')? PAD_R : PAD_L;

  // stations: both start yellow; after arrival, destination is white
  station(PAD_L.x, PAD_L.y, (phase==='arrived' && dir==='BtoA') ? '#ffffff' : '#ffd54f');
  station(PAD_R.x, PAD_R.y, (phase==='arrived' && dir==='AtoB') ? '#ffffff' : '#ffd54f');

  // traveling dot during transit
  if(phase==='transit'){
    const x = src.x + (dst.x-src.x)*t;
    const y = src.y + (dst.y-src.y)*t;
    ctx.fillStyle='#ffffff'; ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2); ctx.fill();
  }

  function station(x,y,color){ ctx.fillStyle=color; ctx.beginPath(); ctx.arc(x,y,12,0,Math.PI*2); ctx.fill(); }
}

// ---------------- Calculations ----------------
function compute(){
  const dir = el.dir.value;
  const R  = dir==='AtoB' ? parseFloat(el.RA.value)  : parseFloat(el.RB.value);
  const Rb = dir==='AtoB' ? parseFloat(el.RbA.value) : parseFloat(el.RbB.value);
  const eta = Math.pow(Rb/R,2);
  const Vb = Math.PI * Rb*Rb * L_km;           // normalized units
  const ceff = parseFloat(el.ceff.value);
  const dt = L_km / ceff;                      // normalized CST delay (demo)
  const rho = 1.0*parseFloat(el.Iph.value) - 0.6*parseFloat(el.Pcas.value) + 0.4*parseFloat(el.Sent.value);

  // Stability heuristic
  let stab=100;
  if(Rb>R) stab-=40;
  const idealEta=0.45; stab -= Math.min(40, Math.abs(eta-idealEta)*160);
  const fieldBalance = Math.abs(parseFloat(el.Iph.value) - (parseFloat(el.Pcas.value)+parseFloat(el.Sent.value)));
  stab -= Math.min(40, fieldBalance*4);
  stab = Math.max(0, Math.min(100, stab));

  // KPIs
  el.eta.textContent   = eta.toFixed(3);
  el.Vb.textContent    = Vb.toExponential(2);
  el.dtcst.textContent = dt.toExponential(2);
  el.rho.textContent   = rho.toFixed(2);
  el.stab.textContent  = stab.toFixed(0) + '/100';

  const src = dir==='AtoB' ? 'Earth (A)' : 'Moon (B)';
  const dst = dir==='AtoB' ? 'Moon (B)'  : 'Earth (A)';
  el.narr.innerHTML = `Plan: <b>${src} → ${dst}</b> with item <b>${el.item.value}</b> (mass ignored). η=<b>${eta.toFixed(3)}</b>, Δt≈<b>${dt.toExponential(2)}</b> (norm.), ρ=<b>${rho.toFixed(2)}</b>, Stability=<b>${stab.toFixed(0)}/100</b>. `+
                      `You need <b>≥ ${STAB_THRESHOLD}/100</b> to engage.`;

  drawScene({RA:parseFloat(el.RA.value),RbA:parseFloat(el.RbA.value),RB:parseFloat(el.RB.value),RbB:parseFloat(el.RbB.value),dir,phase:'idle',t:0});
  return {eta,Vb,dt,rho,stab,R,Rb,dir};
}

// ---------------- Repeating Beep While Traveling ----------------
let beepTimer=null; let audioCtx=null;
function startBeep(){
  try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){ audioCtx=null; }
  if(!audioCtx) return;
  const play = ()=>{
    const o=audioCtx.createOscillator(); const g=audioCtx.createGain();
    o.type='sine'; o.frequency.value=520;
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.18, audioCtx.currentTime+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.22);
    o.connect(g).connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.24);
  };
  play();
  beepTimer = setInterval(play, 300);
}
function stopBeep(){ if(beepTimer){ clearInterval(beepTimer); beepTimer=null; } if(audioCtx){ try{audioCtx.close();}catch(e){} audioCtx=null; } }

// ---------------- Beam Animation ----------------
let raf=null;
function engage(){
  const plan = compute();
  if(!(plan.Rb<=plan.R)){ el.narr.innerHTML += ' <b>NO-GO:</b> R_b exceeds R.'; return; }
  if(plan.stab<STAB_THRESHOLD){ el.narr.innerHTML += ` <b>NO-GO:</b> Stability must be ≥ ${STAB_THRESHOLD}/100.`; return; }

  startBeep();
  const RA=parseFloat(el.RA.value), RbA=parseFloat(el.RbA.value), RB=parseFloat(el.RB.value), RbB=parseFloat(el.RbB.value);
  const dir=plan.dir;
  const T=1700; let t0=null;
  function frame(t){
    if(!t0) t0=t; const k=Math.min(1,(t-t0)/T);
    drawScene({RA,RbA,RB,RbB,dir,phase:(k<1?'transit':'arrived'),t:k});
    if(k<1) raf=requestAnimationFrame(frame); else finish(dir,RA,RbA,RB,RbB);
  }
  cancelAnimationFrame(raf); raf=requestAnimationFrame(frame);
}

function finish(dir,RA,RbA,RB,RbB){
  stopBeep();
  drawScene({RA,RbA,RB,RbB,dir,phase:'arrived',t:1});
  el.narr.innerHTML += ' <b>ARRIVAL:</b> destination station is white.';
}

function resetAll(){
  cancelAnimationFrame(raf); raf=null; stopBeep();
  el.stab.textContent='—'; el.eta.textContent='—'; el.Vb.textContent='—'; el.dtcst.textContent='—'; el.rho.textContent='—';
  el.narr.textContent='Press Calculate to populate values. Engage: traveling dot; destination turns white. Reset: both yellow. Stability must be ≥ 94/100.';
  drawScene({RA:parseFloat(el.RA.value),RbA:parseFloat(el.RbA.value),RB:parseFloat(el.RB.value),RbB:parseFloat(el.RbB.value),dir:el.dir.value,phase:'idle',t:0});
}

// Bind
el.calc.onclick = ()=>compute();
el.engage.onclick = ()=>engage();
el.reset.onclick = ()=>resetAll();

// First paint
resetAll();
</script>
</body>
</html>
