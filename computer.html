<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Attitude AI — Particle Flip Q&A</title>
<style>
  :root{
    --bg:#0b1020; --fg:#eaf0ff; --muted:#9fb0d0; --panel:#111735; --accent:#6ea8ff;
    --yes:#29cc6a; --no:#ff4d5a; --idle:#223057; --chip:#1a2247
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:14px}
  h1{font-size:20px;margin:0 0 8px;color:#cfe2ff}
  .grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  .panel{background:var(--panel);border:1px solid #1e2a56;border-radius:16px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  .row{display:flex;gap:8px;align-items:center}
  textarea{width:100%;min-height:84px;background:#0c1230;color:var(--fg);border:1px solid #21306b;border-radius:12px;padding:10px;resize:vertical}
  button{background:var(--accent);border:0;color:#001233;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
  button.secondary{background:#253365;color:#cfe2ff}
  button:disabled{opacity:.6;cursor:not-allowed}
  .log{margin-top:12px;display:flex;flex-direction:column;gap:10px;max-height:420px;overflow:auto;padding-right:4px}
  .bubble{padding:10px 12px;border-radius:12px;line-height:1.25;border:1px solid #27346b}
  .you{background:#0d1638}
  .ai{background:#0a1b2a;border-color:#153d2c}
  .nope{background:#2a0a12;border-color:#4a1b24}
  .meta{font-size:12px;color:var(--muted)}
  /* Flip grid */
  .flip-wrap{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;margin-top:10px}
  .cell{
    width:100%;padding-top:100%;position:relative;border-radius:6px;background:var(--idle);
    transform-style:preserve-3d;transition:transform .18s ease, background .18s ease, box-shadow .18s ease;
    box-shadow:inset 0 0 0 1px #1f2b57, 0 2px 8px rgba(0,0,0,.25)
  }
  .cell > i{position:absolute;inset:0;border-radius:6px}
  .cell.yes{background:var(--yes)}
  .cell.no{background:var(--no)}
  .cell.flip{transform:rotateY(180deg)}
  .status{display:flex;justify-content:space-between;gap:8px;align-items:center;margin-top:8px}
  .badge{font-size:12px;padding:6px 10px;border:1px solid #28407a;border-radius:999px;background:#0c1433;color:#d3e1ff}
  .ticker{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .chip{font-size:12px;padding:6px 10px;border-radius:999px;background:var(--chip);border:1px solid #2a3a72;opacity:.55}
  .chip.active{opacity:1;outline:2px solid #2d57ff}
  .totals{font-size:12px;color:var(--muted);margin-top:8px}
  .divider{height:1px;background:#1c2550;margin:10px 0}
  .small{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Attitude AI — Particle Flip Q&amp;A</h1>
    <div class="grid">
      <!-- Q&A panel -->
      <section class="panel">
        <div class="row" style="justify-content:space-between;">
          <strong>Ask a question</strong>
          <button id="clearAll" class="secondary" title="Clear questions & answers">Clear</button>
        </div>
        <div class="divider"></div>
        <textarea id="q" placeholder="Type your question… (e.g., &quot;What is inertia?&quot; or &quot;12*(3+4)&quot;)"></textarea>
        <div class="row" style="margin-top:8px;gap:10px;">
          <button id="ask">Ask</button>
          <span class="small">Answers only appear if the particle flip says “Yes”.</span>
        </div>
        <div class="log" id="log" aria-live="polite"></div>
      </section>

      <!-- Particle/attitude panel -->
      <section class="panel">
        <div class="row" style="justify-content:space-between;">
          <strong>Robot Particles — Coin Flip Engine</strong>
          <span id="attitude" class="badge">Attitude: Neutral</span>
        </div>
        <div class="ticker" id="ticker">
          <span class="chip">web</span>
          <span class="chip">dictionary</span>
          <span class="chip">NASA</span>
          <span class="chip">papers</span>
          <span class="chip">encyclopedia</span>
          <span class="chip">notes</span>
        </div>
        <div class="flip-wrap" id="flipWrap" aria-label="Decision grid"></div>
        <div class="status">
          <span class="badge" id="decision">Waiting…</span>
          <span class="small">Green = Yes • Red = No</span>
        </div>
        <div class="totals" id="totals">Heads: 0 • Tails: 0</div>
      </section>
    </div>

    <p class="small" style="margin-top:12px">
      This is a local demo. It doesn’t call real web services; the “searching” ticker is just for vibes.
    </p>
  </div>

<script>
(() => {
  // ------- Elements -------
  const qEl = document.getElementById('q');
  const askBtn = document.getElementById('ask');
  const clearBtn = document.getElementById('clearAll');
  const log = document.getElementById('log');
  const flipWrap = document.getElementById('flipWrap');
  const decisionBadge = document.getElementById('decision');
  const totalsEl = document.getElementById('totals');
  const attitudeBadge = document.getElementById('attitude');
  const ticker = document.getElementById('ticker').querySelectorAll('.chip');

  // ------- Build particle grid -------
  const SIZE = 8;                 // 8x8 grid
  const CELLS = SIZE * SIZE;
  let cells = [];
  function buildGrid(){
    flipWrap.innerHTML = '';
    cells = [];
    for(let i=0;i<CELLS;i++){
      const c = document.createElement('div');
      c.className = 'cell';
      const iEl = document.createElement('i'); c.appendChild(iEl);
      flipWrap.appendChild(c);
      cells.push(c);
    }
  }
  buildGrid();

  // ------- Utilities -------
  const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
  function addBubble(text, cls){
    const b = document.createElement('div');
    b.className = 'bubble ' + cls;
    b.textContent = text;
    log.appendChild(b);
    log.scrollTop = log.scrollHeight;
  }
  function setDecision(text, color){
    decisionBadge.textContent = text;
    decisionBadge.style.background = color==='yes'?'#0e2a1e': (color==='no'?'#2a1013':'#0c1433');
    decisionBadge.style.borderColor = color==='yes'?'#1b5a3a': (color==='no'?'#5a1b2a':'#28407a');
  }
  function setAttitude(level){ // -1 grumpy, 0 neutral, 1 curious
    const map = { '-1': ['Grumpy','#3b1620'], '0':['Neutral','#0c1433'], '1':['Curious','#132b18'] };
    const [label,bg] = map[level];
    attitudeBadge.textContent = 'Attitude: ' + label;
    attitudeBadge.style.background = bg;
  }

  // ------- Ticker animation -------
  async function runTicker(ms=1400){
    const order = [...ticker].sort(()=>Math.random()-0.5);
    for (let i=0;i<order.length;i++){
      order[i].classList.add('active');
      await sleep(ms / (order.length+1));
    }
    await sleep(150);
    order.forEach(chip=>chip.classList.remove('active'));
  }

  // ------- Particle flip engine -------
  async function flipAndDecide(){
    // Random attitude bias per question
    const attitude = Math.random() < .33 ? -1 : (Math.random() < .5 ? 0 : 1);
    setAttitude(attitude);

    const rounds = 14 + Math.floor(Math.random()*10);
    let heads=0, tails=0;

    // animate flipping
    for(let r=0;r<rounds;r++){
      for (const c of cells){
        const flip = Math.random() < .6;
        if (flip) c.classList.toggle('flip');
        // temporarily unset color while flipping
        c.classList.remove('yes','no');
        c.style.background = 'var(--idle)';
      }
      await sleep(70 + Math.random()*30);
    }

    // settle: set yes/no per cell
    heads = 0; tails = 0;
    for (const c of cells){
      const isYes = Math.random() < .5 + (attitude*0.08); // bias by attitude
      c.classList.remove('flip');
      c.classList.toggle('yes', isYes);
      c.classList.toggle('no', !isYes);
      if (isYes) heads++; else tails++;
    }
    totalsEl.textContent = `Heads: ${heads} • Tails: ${tails}`;

    // Decision threshold (slight inertia: need > half by 3)
    const decideYes = heads >= tails + 3;
    setDecision(decideYes ? 'Answering' : 'Declining', decideYes ? 'yes' : 'no');
    return {decideYes, attitude};
  }

  // ------- Tiny offline "answer engine" (playful) -------
  function tryEvalMath(expr){
    // Safe-ish: only allow digits, ops, spaces, decimal, parentheses
    if (!/^[\d\s+\-*/().%^]+$/.test(expr)) return null;
    try{
      // Replace ^ with ** for exponent
      const cleaned = expr.replace(/\^/g,'**');
      // eslint-disable-next-line no-new-func
      const val = Function(`"use strict"; return (${cleaned});`)();
      if (typeof val === 'number' && Number.isFinite(val)) return val;
    }catch(e){}
    return null;
  }

  function generateAnswer(q, attitude){
    q = q.trim();
    const lower = q.toLowerCase();

    // 1) Simple math
    const mathVal = tryEvalMath(q);
    if (mathVal !== null) {
      return (attitude<0)
        ? `Fine. ${q} = ${mathVal}. Happy now?`
        : (attitude>0
           ? `Nice one! I crunched it: ${q} = ${mathVal}.`
           : `Result: ${q} = ${mathVal}.`);
    }

    // 2) Basic patterns
    if (/^what is /.test(lower) || /^define /.test(lower)) {
      const term = q.replace(/^what is /i,'').replace(/^define /i,'').replace(/\?+$/,'').trim();
      return (attitude>0)
        ? `Here’s a quick take on ${term}: a concise concept defined by its core purpose, inputs, and effects. Start by stating a one-line definition, then give one example, then one contrast.`
        : (attitude<0
           ? `You want ${term}? Short version: name, purpose, inputs, effects. That’s all you need.`
           : `A simple way to understand ${term}: write one-line purpose, list key parts, and show one example.`);
    }

    if (/^how (do|does|to)\b/i.test(lower) || lower.startsWith('how ')) {
      return (attitude>0)
        ? `Try this: 1) Define the goal. 2) List materials. 3) Outline 3–5 steps. 4) Test on a tiny example. 5) Iterate once.`
        : (attitude<0)
          ? `Steps? Keep it short: goal, tools, 3 steps, done.`
          : `General approach: goal → tools → steps → check result → tweak.`;
    }

    if (/^why\b/.test(lower)){
      return (attitude>0)
        ? `Because causes stack: immediate cause, underlying mechanism, and context. Check all three.`
        : (attitude<0)
          ? `Short answer: multiple causes. Look closer.`
          : `Likely due to a mix of direct causes and deeper context.`;
    }

    if (/^when\b/.test(lower) || /^where\b/.test(lower)){
      return (attitude>0)
        ? `Pin it by narrowing scope: timeframe/location → evidence → a single best estimate.`
        : (attitude<0)
          ? `Narrow it. Too broad.`
          : `Specify range and sources to estimate accurately.`;
    }

    // 3) Fallback
    const starters = attitude>0
      ? "Here’s a constructive direction: "
      : (attitude<0 ? "Short version: " : "A practical starting point: ");
    return starters + "define the goal in one sentence, list constraints, choose 3 checks for success, and try a tiny prototype.";
  }

  // ------- Ask flow -------
  askBtn.addEventListener('click', async ()=>{
    const q = qEl.value.trim();
    if (!q) return;
    addBubble('You: ' + q, 'you');
    qEl.value='';

    setDecision('Flipping…', 'neutral');
    totalsEl.textContent = `Heads: 0 • Tails: 0`;

    // Run both ticker & flipping in parallel
    const flipPromise = flipAndDecide();
    const tickerPromise = runTicker(1200);
    await Promise.all([flipPromise, tickerPromise]);
    const {decideYes, attitude} = await flipPromise;

    if (decideYes){
      // Small extra "processing" beat for drama
      await runTicker(900);
      const a = generateAnswer(q, attitude);
      addBubble(a, 'ai');
    }else{
      const snarks = [
        "Nope. The particles said 'pass.'",
        "Request denied. Ask better.",
        "Today’s vibe: not answering that.",
        "Flip says no. Try rephrasing."
      ];
      addBubble(snarks[Math.floor(Math.random()*snarks.length)], 'nope');
    }
  });

  // Enter to submit (with Shift+Enter for newline)
  qEl.addEventListener('keydown', (e)=>{
    if (e.key==='Enter' && !e.shiftKey){
      e.preventDefault();
      askBtn.click();
    }
  });

  // Clear all
  clearBtn.addEventListener('click', ()=>{
    log.innerHTML = '';
    buildGrid();
    setDecision('Waiting…','neutral');
    totalsEl.textContent = `Heads: 0 • Tails: 0`;
    setAttitude(0);
  });
})();
</script>
</body>
</html>
