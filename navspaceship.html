<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CST-WARP ENGINE — Twin Nacelle Simulator</title>
<style>
html, body {
  margin:0; height:100%; overflow:hidden;
  background:black; font-family:Orbitron, Arial;
}
#starfield {
  position:fixed; inset:0; z-index:-1;
  background:black; overflow:hidden;
}
.nacelle {
  position:absolute; top:50%; width:180px; height:40px;
  transform:translateY(-50%); border-radius:30px;
  background:linear-gradient(90deg,#013,#036);
  box-shadow:0 0 14px #0099ff;
}
#leftNacelle { left:12%; }
#rightNacelle { right:12%; }
.plasma {
  position:absolute; top:-40px; left:50%;
  transform:translateX(-50%); width:24px; height:24px;
  border-radius:50%; background:#18b6ff;
  filter:blur(6px); opacity:0;
}
#warpBubble {
  position:absolute; left:50%; top:50%;
  width:0; height:0; transform:translate(-50%,-50%);
  border-radius:50%; border:3px solid rgba(0,170,255,0.6);
  opacity:0; box-shadow:0 0 25px #18b6ff;
}
</style>
</head>
<body>

<canvas id="starfield"></canvas>

<div id="leftNacelle" class="nacelle">
  <div id="plasmaL" class="plasma"></div>
</div>
<div id="rightNacelle" class="nacelle">
  <div id="plasmaR" class="plasma"></div>
</div>

<div id="warpBubble"></div>

<script>
// ======================== PART 1 — ENGINE SIMULATION ========================
const canvas = document.getElementById("starfield");
const ctx = canvas.getContext("2d");
let stars = [], warpLevel = 0;
function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; }
addEventListener("resize",resize); resize();
function initStars(n=250){ stars=[]; for(let i=0;i<n;i++)
stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,z:Math.random()*3+1}); }
initStars();
function drawStars(){
  ctx.fillStyle="black"; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let s of stars){
    s.x -= warpLevel*(s.z*0.8+0.2);
    if(s.x<0) s.x = canvas.width;
    ctx.fillStyle = `rgba(130,200,255,${0.3 + s.z/3})`;
    ctx.fillRect(s.x,s.y,2+s.z,2+s.z);
  }
  requestAnimationFrame(drawStars);
}
drawStars();

const plasmaL = document.getElementById("plasmaL");
const plasmaR = document.getElementById("plasmaR");
const bubble = document.getElementById("warpBubble");

function engine_setWarp(v){
  warpLevel = v;
  plasmaL.style.opacity = plasmaR.style.opacity = v>0?1:0;
  plasmaL.style.animation = plasmaR.style.animation =
    v?`plasmaPulse ${0.8 - v*0.05}s infinite linear`:"none";
  bubble.style.opacity = v>0?1:0;
  bubble.style.width = (v*110)+"px";
  bubble.style.height = (v*110)+"px";
  bubble.style.borderWidth = (2+v*0.4)+"px";
}

document.head.insertAdjacentHTML("beforeend",`
<style>
@keyframes plasmaPulse { 
  0%{background:#0ae; filter:blur(4px);}
  50%{background:#9ef; filter:blur(8px);}
  100%{background:#0ae; filter:blur(4px);}
}
</style>
`);

</script>
<!-- PART 1 STOP -->
<!-- ======================== PART 2 — CST NAVIGATION SYSTEM ======================== -->
<style>
#cstPanel {
  position: fixed;
  top: 12px;
  right: 12px;
  width: 280px;
  padding: 14px;
  background: rgba(0, 25, 55, 0.75);
  border: 2px solid #18b6ff;
  border-radius: 8px;
  color: #b9eaff;
  font-family: Orbitron;
  font-size: 13px;
  text-shadow: 0 0 4px #0af;
}
.navLabel { color:#6ad7ff; }
#navGrid {
  margin-top: 10px; width:100%; height:140px;
  background:radial-gradient(circle,#003355,#000);
  border:1px solid #18b6ff;
  border-radius:6px; position:relative;
}
.navPoint {
  position:absolute; width:8px; height:8px;
  background:#18b6ff; border-radius:50%;
}
</style>

<div id="cstPanel">
  <div><span class="navLabel">Earth CST Time:</span> <span id="cstClock">0</span></div>
  <div><span class="navLabel">Warp Time Offset:</span> <span id="timeOffset">0</span> μs</div>
  <div><span class="navLabel">CST Phase (%):</span> <span id="cstPhaseVal">0</span></div>
  <div><span class="navLabel">Heading (°):</span> <span id="headingVal">0</span></div>
  <div><span class="navLabel">Warp Factor:</span> <span id="warpVal">0</span></div>
  <div id="navGrid">
    <div id="shipDot" class="navPoint" style="left:50%;top:50%;"></div>
    <div id="destDot" class="navPoint" style="background:#fffc;"></div>
  </div>
  <div style="margin-top:8px;"><span class="navLabel">Destination:</span> <span id="destLabel">N/A</span></div>
</div>

<script>
// ------- CST NAVIGATION CORE ------- 

let CST = {
  t: 0,              // base time counter
  offset: 0,         // relativistic difference in microseconds
  phase: 0,          // navigation phase
  heading: 0,        // degrees
  warp: 0,           // warp factor 0-10
  destination: "None"
};

const CSTclockEl = document.getElementById("cstClock");
const offsetEl = document.getElementById("timeOffset");
const phaseEl = document.getElementById("cstPhaseVal");
const headEl = document.getElementById("headingVal");
const warpEl = document.getElementById("warpVal");
const destEl = document.getElementById("destLabel");

const shipDot = document.getElementById("shipDot");
const destDot = document.getElementById("destDot");
const grid = document.getElementById("navGrid");

// update time and relativistic offset
function updateCST(){
  CST.t++;
  // Warp causes exponential CST-time offset
  CST.offset = Math.floor(Math.pow(CST.warp,2.8));
  
  CSTclockEl.textContent = CST.t;
  offsetEl.textContent = CST.offset;
  phaseEl.textContent = CST.phase;
  headEl.textContent = CST.heading;
  warpEl.textContent = CST.warp || warpLevel; // sync to engine warp
  
  requestAnimationFrame(updateCST);
}
updateCST();

// position destination and ship dots inside navGrid
function nav_updatePositions(){
  // ship always centered in bubble nav view
  shipDot.style.left = `calc(50% - 4px)`;
  shipDot.style.top = `calc(50% - 4px)`;

  // destination plotted on 4-D holographic nav field projection  
  let radius = (CST.warp+1) * 8; 
  let rad = CST.heading * Math.PI / 180;
  destDot.style.left = `${50 + radius * Math.cos(rad)}%`;
  destDot.style.top = `${50 - radius * Math.sin(rad)}%`;
  
  destEl.textContent = CST.destination;

  requestAnimationFrame(nav_updatePositions);
}
nav_updatePositions();

// API functions for control system
function nav_setWarp(v){ CST.warp = v; engine_setWarp(v); }
function nav_setPhase(v){ CST.phase = Number(v); }
function nav_setHeading(v){ CST.heading = Number(v); }
function nav_setDestination(d){ CST.destination = d; }
</script>
<!-- PART 2 STOP -->
<!-- ======================== PART 3 — FULL CONTROL SYSTEM ======================== -->
<style>
#controlsPanel {
  position: fixed;
  bottom: 0;
  width: 100%;
  padding: 18px;
  background: rgba(0, 15, 35, 0.78);
  border-top: 2px solid #18b6ff;
  display: flex;
  flex-direction: column;
  gap: 16px;
  font-family: Orbitron;
}
.ctrlRow { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
.ctrlBtn {
  padding: 12px 20px;
  font-size: 16px;
  border: 1px solid #18b6ff;
  background: rgba(0, 35, 75, 0.7);
  color: #8fd9ff;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.15s;
}
.ctrlBtn:hover { background: rgba(0, 55, 105, 0.9); }

.ctrlSliderBox {
  display: flex;
  flex-direction: column;
  min-width: 180px;
  background: rgba(0, 25, 50, 0.7);
  border: 1px solid #18b6ff;
  padding: 10px;
  border-radius: 6px;
}
.ctrlLabel { color: #36c1ff; font-size: 13px; margin-bottom: 6px; }
.ctrlSlider { width: 100%; }

#destinationSelect {
  padding: 10px; font-size: 15px; border: 1px solid #18b6ff;
  border-radius: 6px; background: rgba(0, 35, 75, 0.7); color: #8fd9ff;
}
.autopilotRow { display: flex; justify-content: center; gap: 14px; margin-top: 6px; }
.autoBtn {
  padding: 12px 18px; background: rgba(0, 35, 75, 0.7); border: 1px solid #18b6ff;
  border-radius: 6px; cursor: pointer; color: #8fd9ff; transition: .15s;
}
.autoBtn:hover { background: rgba(0, 55, 105, 0.9); }
</style>

<div id="controlsPanel">

  <!-- ░░ BUTTON PANEL ░░ -->
  <div class="ctrlRow">
    <button class="ctrlBtn" onclick="sim_startPlasma()">START Plasma</button>
    <button class="ctrlBtn" onclick="sim_igniteReactors()">IGNITE Reactor</button>
    <button class="ctrlBtn" onclick="sim_warpUp()">Warp ▲</button>
    <button class="ctrlBtn" onclick="sim_warpDown()">Warp ▼</button>
    <button class="ctrlBtn" onclick="sim_navLockCST()">CST NAV LOCK</button>
    <button class="ctrlBtn" onclick="sim_stopWarp()">STOP</button>
  </div>

  <!-- ░░ SLIDER PANEL ░░ -->
  <div class="ctrlRow">
    <div class="ctrlSliderBox">
      <span class="ctrlLabel">Warp Power</span>
      <input id="sliderPower" class="ctrlSlider" type="range" min="0" max="10" step="1"
             oninput="sim_setWarpPower(this.value)">
    </div>

    <div class="ctrlSliderBox">
      <span class="ctrlLabel">CST Phase Alignment</span>
      <input id="sliderPhase" class="ctrlSlider" type="range" min="0" max="100" step="1"
             oninput="sim_setCSTPhase(this.value)">
    </div>

    <div class="ctrlSliderBox">
      <span class="ctrlLabel">Navigation Vector</span>
      <input id="sliderHeading" class="ctrlSlider" type="range" min="0" max="360" step="1"
             oninput="sim_setHeading(this.value)">
    </div>

    <div class="ctrlSliderBox">
      <span class="ctrlLabel">Emergency Collapse</span>
      <input id="sliderCollapse" class="ctrlSlider" type="range" min="0" max="1" step="0.01"
             oninput="sim_emergencyCollapse(this.value)">
    </div>
  </div>

  <!-- ░░ AUTOPILOT ░░ -->
  <div class="autopilotRow">
    <select id="destinationSelect">
      <option>Mars</option>
      <option>Alpha Centauri</option>
      <option>Sirius A</option>
      <option>Vega</option>
      <option>Andromeda (M31)</option>
    </select>
    <button class="autoBtn" onclick="sim_autopilotEngage()">ENGAGE AUTOPILOT</button>
  </div>

</div>

<script>
// ---- PART 3 — CONTROL SYSTEM JS ----

// internal simulator state
let sim_state = { warp:0, power:0, phase:0, heading:0, destination:"Mars" };

function sim_startPlasma(){
  nav_setWarp(0);
  engine_setWarp(0);
  console.log("[ENGINE] Plasma flow initiated.");
}
function sim_igniteReactors(){
  console.log("[ENGINE] Reactor online.");
  engine_setWarp(sim_state.warp);
}
function sim_warpUp(){
  sim_state.warp = Math.min(sim_state.warp+1,10);
  nav_setWarp(sim_state.warp);
}
function sim_warpDown(){
  sim_state.warp = Math.max(sim_state.warp-1,0);
  nav_setWarp(sim_state.warp);
}
function sim_navLockCST(){
  console.log("[NAV] CST phase locked.");
}
function sim_stopWarp(){
  sim_state.warp = 0;
  nav_setWarp(0);
  console.log("[ENGINE] Warp shutdown.");
}
function sim_setWarpPower(v){
  sim_state.power = v; nav_setWarp(Number(v));
}
function sim_setCSTPhase(v){
  sim_state.phase = v; nav_setPhase(Number(v));
}
function sim_setHeading(v){
  sim_state.heading = v; nav_setHeading(Number(v));
}
function sim_emergencyCollapse(v){
  if(v > 0.95){
    console.log("[FAILSAFE] EMERGENCY COLLAPSE INITIATED");
    sim_state.warp = 0;
    nav_setWarp(0);
  }
}
function sim_autopilotEngage(){
  const d = document.getElementById("destinationSelect").value;
  sim_state.destination = d;
  nav_setDestination(d);
  console.log("[AUTOPILOT] Course set to:", d);
  sim_state.heading = Math.floor(Math.random()*360);
  nav_setHeading(sim_state.heading);
  sim_state.warp = 5; // auto engage at warp 5
  nav_setWarp(sim_state.warp);
}
</script>
<!-- PART 3 STOP -->
</body>
</html>
