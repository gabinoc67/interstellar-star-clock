<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Warp Drive Clock Sync Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: black;
      color: white;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    button, select {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
    #startBtn { background-color: #00ccff; color: black; }
    #stopBtn { background-color: #999; color: white; }
    #resetBtn { background-color: #ff6600; color: white; }

    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid white;
    }
    .synced { background-color: #0f0; color: black; }
    .warning { background-color: #ff0; color: black; }
    .danger { background-color: #f00; color: white; }

    #beacon {
      font-size: 18px;
      margin-top: 10px;
      color: cyan;
    }
    canvas {
      display: block;
      margin: 30px auto;
      background: #111;
      border: 2px solid #333;
    }
    #arrivalInfo {
      color: lime;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>üöÄ Warp Drive Clock Synchronization Simulator</h1>

<div>
  <button id="startBtn">‚ñ∂Ô∏è Start Travel</button>
  <button id="stopBtn">‚è∏Ô∏è Pause</button>
  <button id="resetBtn">üîÑ Reset</button>

  <label>
    Warp Drive:
    <select id="warpSpeed">
      <option value="1">Warp 1</option>
      <option value="2">Warp 2</option>
      <option value="3">Warp 3</option>
      <option value="4">Warp 4</option>
      <option value="5">Warp 5</option>
      <option value="6">Warp 6</option>
      <option value="7">Warp 7</option>
      <option value="8">Warp 8</option>
      <option value="9">Warp 9</option>
      <option value="10">Warp 10</option>
    </select>
  </label>

  <label>
    Destination Planet:
    <select id="destination">
      <option value="Mars">Mars</option>
      <option value="Jupiter">Jupiter</option>
      <option value="Saturn">Saturn</option>
      <option value="Pluto">Pluto</option>
    </select>
  </label>

  <button onclick="exportLog()">üìÑ Export Log CSV</button>
</div>

<div id="beacon">‚è≥ Beacon: Waiting for Start...</div>

<canvas id="curveCanvas" width="600" height="300"></canvas>
<div id="arrivalInfo"></div>

<table>
  <thead>
    <tr>
      <th>Clock ID</th><th>Name</th><th>Location</th><th>Purpose</th>
      <th>CST Time</th><th>Clock Local Time</th><th>Œî from CST (ms)</th><th>Status</th>
    </tr>
  </thead>
  <tbody id="clock-table-body"></tbody>
</table>

<script>
  let driftInterval = null, beaconInterval = null, animationFrame = null;
  let simulationRunning = false, shipProgress = 0, shipArrived = false;
  const log = [];

  const clocks = [
    { id: 'C1', name: 'BioSync', location: 'Ship Biometric Zone', purpose: 'Biometric Sync', drift: 0 },
    { id: 'C2', name: 'EdgeWave', location: 'Warp Shell Edge', purpose: 'Gravitational Phase Monitoring', drift: 3 },
    { id: 'C3', name: 'NavCore', location: 'Onboard AI Core', purpose: 'Warp Navigation Sync', drift: 0 },
    { id: 'C4', name: 'CSTMaster', location: 'CST Dome Anchor', purpose: 'Earth CST Master Reference', drift: 0 },
    { id: 'C5', name: 'DriftEye', location: 'Bubble Mid-Space', purpose: 'Clock Drift Sensor', drift: -6 },
    { id: 'C6', name: 'UGT', location: 'UGT Clock', purpose: 'Universal Galactic Time', drift: 0 },
    { id: 'C7', name: 'UniAge', location: 'Interstellar Time Base', purpose: 'Universe Age Reference', drift: 0 },
    { id: 'C8', name: 'MarsClock', location: 'Mars Surface Dome', purpose: 'Planet Local Year Tracker', drift: 0 }
  ];

  function getCSTTime() {
    return new Date().getTime();
  }

  function formatTime(ms) {
    return new Date(ms).toISOString().substr(11, 12);
  }

  function updateClocks() {
    const table = document.getElementById("clock-table-body");
    table.innerHTML = "";
    const baseTime = getCSTTime();
    let totalDrift = 0;

    clocks.forEach(clock => {
      if (simulationRunning) clock.drift += Math.random() * 2 - 1;
      const drift = clock.drift.toFixed(3);
      totalDrift += Math.abs(clock.drift);
      const time = baseTime + clock.drift;

      let status = "‚úÖ Synced", cls = "synced";
      if (Math.abs(clock.drift) >= 5 && Math.abs(clock.drift) < 10) {
        status = "‚ö†Ô∏è Slight Drift"; cls = "warning";
      } else if (Math.abs(clock.drift) >= 10) {
        status = "‚ùå Unsafe Drift"; cls = "danger";
      }

      table.innerHTML += `
        <tr class="${cls}">
          <td>${clock.id}</td><td>${clock.name}</td><td>${clock.location}</td><td>${clock.purpose}</td>
          <td>${formatTime(baseTime)}</td><td>${formatTime(time)}</td><td>${drift}</td><td>${status}</td>
        </tr>`;
    });

    const avgDrift = totalDrift / clocks.length;
    const warp = parseInt(document.getElementById("warpSpeed").value) || 1;
    const destination = document.getElementById("destination").value;
    const safe = avgDrift < (1 / warp) * 10;

    document.getElementById("beacon").textContent = 
      `üõ∞Ô∏è Warp ${warp} ‚Üí ${destination} | Avg Drift: ${avgDrift.toFixed(3)} ms ‚Üí ${safe ? "‚úÖ SAFE" : "‚ùå UNSAFE"}`;
  }

  function beaconPulse() {
    if (!simulationRunning) return;
    clocks.forEach(c => { if (c.id !== "C4") c.drift *= 0.1; });
    updateClocks();
  }

  function drawCurveWithShip() {
    const canvas = document.getElementById("curveCanvas");
    const ctx = canvas.getContext("2d");
    const warp = parseInt(document.getElementById("warpSpeed").value) || 1;
    const curveHeight = 100 / warp;
    const endX = 550, startX = 50, baseY = 250;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.moveTo(startX, baseY);
    for (let x = startX; x <= endX; x++) {
      const t = (x - startX) / (endX - startX);
      const y = baseY - curveHeight * Math.pow(t, 1 / warp) * 200;
      ctx.lineTo(x, y);
    }
    ctx.strokeStyle = "red";
    ctx.lineWidth = 2;
    ctx.stroke();

    const t = shipProgress;
    const shipX = startX + (endX - startX) * t;
    const shipY = baseY - curveHeight * Math.pow(t, 1 / warp) * 200;

    ctx.beginPath();
    ctx.arc(shipX, shipY, 8, 0, 2 * Math.PI);
    ctx.fillStyle = shipArrived ? "lime" : "cyan";
    ctx.shadowColor = shipArrived ? "lime" : "cyan";
    ctx.shadowBlur = 10;
    ctx.fill();
    ctx.shadowBlur = 0;

    ctx.beginPath();
    ctx.arc(endX, baseY - curveHeight * 200, 6, 0, 2 * Math.PI);
    ctx.fillStyle = "orange";
    ctx.fill();
    ctx.font = "14px Arial";
    ctx.fillText(document.getElementById("destination").value, endX - 20, baseY - curveHeight * 200 - 10);
  }

  function animateShip() {
    if (!simulationRunning || shipArrived) return;
    const warp = parseInt(document.getElementById("warpSpeed").value) || 1;
    shipProgress += 0.005 * warp;
    if (shipProgress >= 1) {
      shipProgress = 1;
      shipArrived = true;
      syncOnArrival();
    }
    drawCurveWithShip();
    animationFrame = requestAnimationFrame(animateShip);
  }

  function syncOnArrival() {
    const now = new Date();
    const planet = document.getElementById("destination").value;
    const localTime = new Date(now.getTime() + Math.random() * 2000 - 1000); // ¬±1s
    const message = `üü¢ ARRIVED at ${planet} | CST: ${now.toLocaleTimeString()} | Planet Local: ${localTime.toLocaleTimeString()}`;
    document.getElementById("arrivalInfo").textContent = message;
    log.push({
      time: now.toISOString(),
      warp: document.getElementById("warpSpeed").value,
      destination: planet,
      arrivalCST: now.toLocaleTimeString(),
      localTime: localTime.toLocaleTimeString(),
      status: "ARRIVED"
    });
    simulationRunning = false;
    clearInterval(driftInterval);
    clearInterval(beaconInterval);
  }

  document.getElementById("startBtn").onclick = () => {
    if (!simulationRunning) {
      simulationRunning = true;
      shipArrived = false;
      shipProgress = 0;
      driftInterval = setInterval(updateClocks, 500);
      beaconInterval = setInterval(beaconPulse, 2000);
      animateShip();
    }
  };

  document.getElementById("stopBtn").onclick = () => {
    simulationRunning = false;
    clearInterval(driftInterval);
    clearInterval(beaconInterval);
    cancelAnimationFrame(animationFrame);
  };

  document.getElementById("resetBtn").onclick = () => {
    simulationRunning = false;
    clearInterval(driftInterval);
    clearInterval(beaconInterval);
    cancelAnimationFrame(animationFrame);
    clocks.forEach(c => c.drift = 0);
    shipProgress = 0;
    shipArrived = false;
    log.length = 0;
    document.getElementById("arrivalInfo").textContent = "";
    document.getElementById("beacon").textContent = "‚è≥ Beacon: Waiting for Start...";
    updateClocks();
    drawCurveWithShip();
  };

  function exportLog() {
    const csv = [
      ["Time", "Warp", "Destination", "Arrival CST", "Local Planet Time", "Status"],
      ...log.map(e => [e.time, e.warp, e.destination, e.arrivalCST, e.localTime, e.status])
    ].map(row => row.join(",")).join("\n");

    const blob = new Blob([csv], { type: "text/csv" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "warp_arrival_log.csv";
    link.click();
  }

  updateClocks();
  drawCurveWithShip();
</script>

</body>
</html>
