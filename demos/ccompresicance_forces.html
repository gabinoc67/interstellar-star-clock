<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FULL UNIFIED COMPRECISANCE LAB — Physics • DNA • Cognition • Language • Evolution</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root { color-scheme: dark; }
  body {
    margin:0; padding:18px;
    background: radial-gradient(circle at top, #020617 0, #000 65%);
    color:#e5e7eb;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }
  h1 { margin-top:0; font-size:1.5rem; }
  .layout{ display:flex; flex-wrap:wrap; gap:22px; }
  #plot {
    border:1px solid #1f2937;
    border-radius:10px;
    background:radial-gradient(circle at center, #020617 0, #000 90%);
  }
  .side {
    display:flex; flex-direction:column;
    gap:12px; width:340px; max-width:400px;
  }
  .box{
    padding:12px;
    border-radius:12px;
    background:rgba(15,23,42,0.92);
    border:1px solid #1f2937;
  }
  h2 { margin:0; font-size:1rem; }
  input[type=range]{ width:100%; }
  button{
    padding:6px 10px; font-size:0.82rem;
    border-radius:6px; border:none; cursor:pointer;
    background:#1e3a8a; color:#e5e7eb;
  }
  button:hover{ background:#3749ad; }
  .tiny{ font-size:0.75rem; color:#9ca3af; }
  pre{ white-space:pre-wrap; font-size:0.75rem; }
</style>
</head>
<body>

<h1>Unified Comprecisance Evolution Lab — Physics, DNA, Syntax, Cognition, Natural Selection</h1>

<p style="max-width:960px;font-size:0.9rem;">
Every organism cluster is an **agent**:
drifting, adapting, station-locking, branching and dying based on fitness.
Fitness unifies **DNA geometry, syntax, semantics, brain coherence and physics constraints**.
</p>

<div class="layout">
  <canvas id="plot" width="680" height="600"></canvas>

  <div class="side">

    <!-- PHYSICS BAND -->
    <div class="box">
      <h2>Physics Comprecisance</h2>
      <label>Physics band width
        <input id="bandWidth" type="range" min="0.05" max="0.4" step="0.01" value="0.18">
      </label>
      <label>Physics slope
        <input id="slope" type="range" min="0.4" max="1.6" step="0.05" value="1.0">
      </label>
      <p class="tiny">Defines comfort region for EM, strong, weak, gravity.</p>
    </div>

    <!-- EVOLUTION -->
    <div class="box">
      <h2>Evolutionary Dynamics</h2>

      <label>Evolutionary band width
        <input id="evoWidth" type="range" min="0.05" max="0.45" step="0.01" value="0.25">
      </label>

      <label>Extinction radius
        <input id="extinctRadius" type="range" min="0.05" max="0.7" step="0.01" value="0.35">
      </label>

      <label>DNA drift complexity
        <input id="dnaComplex" type="range" min="0.1" max="1" step="0.05" value="0.45">
      </label>

      <label>Syntactic precision strength
        <input id="syntaxWeight" type="range" min="0" max="1" step="0.05" value="0.6">
      </label>

      <label>Semantic compression strength
        <input id="semanticWeight" type="range" min="0" max="1" step="0.05" value="0.6">
      </label>

      <button id="addDNA">Add Species</button>
      <button id="driftToggle">Start Drift</button>
      <button id="toggle3D">Toggle 3D</button>

      <p class="tiny">
        Species adapt, branch, drift, or go extinct.<br>
        Syntax + semantics + DNA + physics = unified fitness.
      </p>
    </div>

    <!-- EXPORT -->
    <div class="box">
      <h2>Export</h2>
      <button id="exportCSV">Export CSV</button>
      <pre id="csvOut"></pre>
    </div>

  </div>
</div>

<script>
/* CORE PARAMETERS */
const canvas=document.getElementById("plot"), ctx=canvas.getContext("2d");

let drifting=false, threeD=false;
let species=[], nextName=1;

/*** ADD FORCES FIXED ***/
const forces=[
  {name:"EM", x:0.78,y:0.72,color:"#38bdf8"},
  {name:"Weak", x:0.65,y:0.55,color:"#f97316"},
  {name:"Strong", x:0.88,y:0.82,color:"#22c55e"},
  {name:"Gravity", x:0.35,y:0.40,color:"#e5e7eb"}
];

/******** UTILS ********/
function toCanvas(x,y){
  const pad=60, w=canvas.width-pad*2, h=canvas.height-pad*2;
  const cx=pad + x*w;
  const cy=canvas.height - pad - y*h;
  return {cx,cy};
}

/******** UI DOM *********/
const bandWidthIn=document.getElementById("bandWidth");
const slopeIn=document.getElementById("slope");
const evoWidthIn=document.getElementById("evoWidth");
const extinctIn=document.getElementById("extinctRadius");
const dnaCompIn=document.getElementById("dnaComplex");
const synIn=document.getElementById("syntaxWeight");
const semIn=document.getElementById("semanticWeight");
const addBtn=document.getElementById("addDNA");
const driftBtn=document.getElementById("driftToggle");
const toggle3DBtn=document.getElementById("toggle3D");
const exportBtn=document.getElementById("exportCSV");
const csvOut=document.getElementById("csvOut");

/******** MAIN DRAW ********/
function drawAxes(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="rgba(148,163,184,0.12)";
  for(let i=0;i<=10;i++){
    const x=(canvas.width/10)*i, y=(canvas.height/10)*i;
    ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,canvas.height);ctx.stroke();
    ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(canvas.width,y);ctx.stroke();
  }
  ctx.strokeStyle="#9ca3af";
  ctx.beginPath();ctx.moveTo(60,canvas.height-60);ctx.lineTo(canvas.width-15,canvas.height-60);ctx.stroke();
  ctx.beginPath();ctx.moveTo(60,canvas.height-60);ctx.lineTo(60,15);ctx.stroke();
}

/* generic band drawing */
function drawBand(width,slope,fill,edge){
  const N=150;
  ctx.beginPath();
  for(let i=0;i<=N;i++){
    const x=i/N; let yT=slope*x+width; if(yT>1)yT=1;
    const {cx,cy}=toCanvas(x,yT);
    if(i===0)ctx.moveTo(cx,cy); else ctx.lineTo(cx,cy);
  }
  for(let i=N;i>=0;i--){
    const x=i/N; let yB=slope*x-width; if(yB<0)yB=0;
    const {cx,cy}=toCanvas(x,yB);
    ctx.lineTo(cx,cy);
  }
  ctx.closePath();
  ctx.fillStyle=fill; ctx.fill();
  ctx.strokeStyle=edge; ctx.stroke();
}

function drawForces(){
  for(const f of forces){
    const {cx,cy}=toCanvas(f.x,f.y);
    ctx.beginPath();ctx.arc(cx,cy,6,0,Math.PI*2);
    ctx.fillStyle=f.color;ctx.fill();
    ctx.fillStyle="#e5e7eb";ctx.font="12px system-ui";
    ctx.fillText(f.name,cx+8,cy-8);
  }
}

function computeFitness(sp){
  const evoWidth=parseFloat(evoWidthIn.value);
  const extinctR=parseFloat(extinctIn.value);
  const synW=parseFloat(synIn.value);
  const semW=parseFloat(semIn.value);

  const dist=Math.abs(sp.y - 1*sp.x);
  const syntaxFit=Math.max(0, 1-dist);
  const semanticFit=Math.max(0, 1-dist);

  const combined = synW*syntaxFit + semW*semanticFit;
  const dnaPenalty = Math.min(1,(dist/evoWidth));

  let fitness = combined - dnaPenalty;
  fitness=Math.max(0,Math.min(1,fitness));

  if(dist>extinctR) sp.extinct=true;

  return fitness;
}

function drawSpecies(){
  const extinctR=parseFloat(extinctIn.value);
  for(const sp of species){
    const f=computeFitness(sp);
    const {cx,cy}=toCanvas(sp.x,sp.y);

    let hue = 120*f;
    let color = `hsl(${hue}, 75%, ${50+f*20}%)`;
    ctx.beginPath();ctx.arc(cx,cy,7,0,Math.PI*2);
    ctx.fillStyle=color;ctx.fill();

    ctx.fillStyle="#e5e7eb";ctx.font="10px system-ui";
    ctx.fillText(sp.name,cx+10,cy-10);

    if(sp.extinct){
      ctx.save();ctx.fillStyle="#ef4444";ctx.font="10px system-ui";
      ctx.fillText("EXTINCT",cx+10,cy);ctx.restore();
    }
  }
}

/******** EVOLUTION ********/
function driftLoop(){
  if(!drifting)return;

  const comp=parseFloat(dnaCompIn.value);
  const evoWidth=parseFloat(evoWidthIn.value);

  for(const sp of species){
    if(sp.extinct)continue;

    sp.x += (Math.random()-0.5)*0.008*comp;
    sp.y += (Math.random()-0.5)*0.008*comp;

    let dist=Math.abs(sp.y - sp.x);

    if(dist < evoWidth){ sp.y += ((sp.x - sp.y)*0.05); }

    if(Math.random()<0.002){
      if(dist<evoWidth*0.5){
        species.push({
          x:sp.x+(Math.random()-0.5)*0.05,
          y:sp.y+(Math.random()-0.5)*0.05,
          extinct:false,
          name:"Species-"+String(nextName++).padStart(3,'0')
        });
      }
    }

    if(dist > parseFloat(extinctIn.value)) sp.extinct=true;

    sp.x=Math.max(0,Math.min(1,sp.x));
    sp.y=Math.max(0,Math.min(1,sp.y));
  }

  redraw();
  requestAnimationFrame(driftLoop);
}

/******** REDRAW ********/
function redraw(){
  drawAxes();

  drawBand(parseFloat(bandWidthIn.value),parseFloat(slopeIn.value),
    "rgba(79,70,229,0.15)",
    "rgba(129,140,248,0.55)"
  );

  drawBand(parseFloat(evoWidthIn.value),1.0,
    "rgba(14,165,233,0.12)",
    "rgba(14,165,233,0.6)"
  );

  drawForces();
  drawSpecies();
}

/******** UI ACTIONS ********/
addBtn.onclick=()=>{
  species.push({
    x:Math.random()*0.9+0.05,
    y:Math.random()*0.9+0.05,
    extinct:false,
    name:"Species-"+String(nextName++).padStart(3,'0')
  });
  redraw();
};
driftBtn.onclick=()=>{
  drifting=!drifting;
  driftBtn.textContent=drifting?"Stop Drift":"Start Drift";
  if(drifting) driftLoop();
};
toggle3DBtn.onclick=()=>{
  threeD=!threeD;
  alert("3D holographic mode placeholder — Z axis = fitness; rotation next upgrade.");
};
exportBtn.onclick=()=>{
  let rows=["Species,X,Y,Fitness,Extinct"];
  for(const sp of species){
    const f=computeFitness(sp);
    rows.push(`${sp.name},${sp.x.toFixed(3)},${sp.y.toFixed(3)},${f.toFixed(3)},${sp.extinct}`);
  }
  csvOut.textContent=rows.join("\n");
};

bandWidthIn.oninput=redraw;
slopeIn.oninput=redraw;
evoWidthIn.oninput=redraw;
extinctIn.oninput=redraw;
dnaCompIn.oninput=redraw;
synIn.oninput=redraw;
semIn.oninput=redraw;

redraw();
</script>
</body>
</html>
