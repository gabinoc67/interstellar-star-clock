<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rocket Corridor Aâ†’B â€” 5 Stages â€” Arrive at Point B</title>

<style>
:root{
  color-scheme: dark;
  --bg:#070b14;
  --panel:#0f172a;
  --panel2:#0b1222;
  --ink:#e5e7eb;
  --muted:#9aa4c7;
  --accent:#60a5fa;
  --good:#34d399;
  --warn:#fbbf24;
  --bad:#fb7185;
  --line:rgba(148,163,184,.22);
  --shadow:0 18px 40px rgba(0,0,0,.45);
  --radius:16px;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#0a1226,#000 70%);
  color:var(--ink);
  font:14px system-ui;
}
header{
  position:sticky; top:0; z-index:20;
  background:#020617;
  border-bottom:1px solid var(--line);
}
.wrap{max-width:1200px;margin:auto;padding:12px}
.grid{display:grid;grid-template-columns:440px 1fr;gap:12px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

.card{
  background:rgba(15,23,42,.95);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
.card h2{
  margin:0;padding:10px;
  border-bottom:1px solid var(--line);
}
.card .body{padding:12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}

label{font-size:12px;color:var(--muted)}
input,select{
  width:100%;
  padding:8px;
  background:#020617;
  color:var(--ink);
  border:1px solid var(--line);
  border-radius:10px;
}

button{
  padding:8px 12px;
  border-radius:10px;
  background:#020617;
  color:var(--ink);
  border:1px solid var(--line);
  cursor:pointer;
}
button.primary{background:#1e3a8a}
button.good{background:#065f46}
button.danger{background:#7f1d1d}
button:disabled{opacity:.45;cursor:not-allowed}

canvas{
  width:100%;
  height:900px;
  display:block;
}
.log{
  font-family:var(--mono);
  font-size:12px;
  max-height:240px;
  overflow:auto;
  background:#020617;
  padding:8px;
  border-radius:10px;
  border:1px solid var(--line);
}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <b>Rocket Corridor Aâ†’B â€” Guaranteed Stop at Point B</b>
  </div>
</header>

<div class="wrap grid">
  <div class="card">
    <h2>Inputs + Controls</h2>
    <div class="body">
      <div class="row">
        <div><label>Latitude</label><input id="lat" value="25.9"></div>
        <div><label>Point A Altitude (m)</label><input id="h0" value="10"></div>
      </div>
      <div class="row">
        <div><label>Point B Altitude (m)</label><input id="hB" value="200000"></div>
        <div>
          <label>Mode</label>
          <select id="mode">
            <option value="orbit">Stop at B</option>
          </select>
        </div>
      </div>
      <div class="row">
        <button id="btnCalc" class="primary">Calculate</button>
        <button id="btnLaunch" class="good" disabled>Launch</button>
      </div>
      <div class="row">
        <button id="btnStop" class="danger" disabled>Stop</button>
        <button id="btnReset">Reset</button>
      </div>
      <div class="log" id="log"></div>
    </div>
  </div>

  <div class="card">
    <h2>Trajectory</h2>
    <div class="body">
      <canvas id="cv" width="900" height="900"></canvas>
    </div>
  </div>
</div>
<script>
const $=id=>document.getElementById(id);
let cv,ctx,raf=null,sim=null,logEl;

const Re=6371000, mu=3.986e14, g0=9.80665;

function log(msg){
  logEl.innerHTML=`<div>${msg}</div>`+logEl.innerHTML;
}

function drawScene(path,rocket,A,B){
  ctx.clearRect(0,0,cv.width,cv.height);
  const m=80, yTop=320000;
  const sx=(cv.width-2*m)/(B.x+180000);
  const sy=(cv.height-2*m)/yTop;
  const X=x=>m+x*sx;
  const Y=y=>cv.height-m-y*sy;

  [10000,30000,60000,100000,150000,200000].forEach(h=>{
    ctx.strokeStyle="white"; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(0,Y(h)); ctx.lineTo(cv.width,Y(h)); ctx.stroke();
    ctx.fillText(`${h/1000} km`,10,Y(h)-6);
  });

  if(path.length>1){
    ctx.strokeStyle="#60a5fa"; ctx.lineWidth=3;
    ctx.beginPath();
    path.forEach((p,i)=>i?ctx.lineTo(X(p.x),Y(p.y)):ctx.moveTo(X(p.x),Y(p.y)));
    ctx.stroke();
  }

  [[A,"A","#60a5fa"],[B,"B","#22c55e"]].forEach(([P,l,c])=>{
    ctx.fillStyle=c;
    ctx.beginPath(); ctx.arc(X(P.x),Y(P.y),10,0,Math.PI*2); ctx.fill();
    ctx.fillText(l,X(P.x)+12,Y(P.y)-8);
  });

  if(rocket){
    ctx.save();
    ctx.translate(X(rocket.x),Y(rocket.y));
    ctx.rotate(Math.atan2(rocket.vy,rocket.vx));
    ctx.fillStyle="#facc15";
    ctx.beginPath();
    ctx.moveTo(18,0); ctx.lineTo(-10,-6); ctx.lineTo(-6,0); ctx.lineTo(-10,6);
    ctx.closePath(); ctx.fill();
    ctx.restore();
  }
}
</script>
<script>
function calcSim(){
  const h0=+$("h0").value;
  const hB=+$("hB").value;

  sim={
    x:0,y:h0,
    vx:120,vy:0,
    dt:0.15,t:0,
    A:{x:0,y:h0},
    B:{x:360000,y:hB},
    path:[{x:0,y:h0}],
    running:false,done:false
  };
  $("btnLaunch").disabled=false;
  log("Calculated.");
  drawScene(sim.path,null,sim.A,sim.B);
}

function stopNow(reason){
  sim.running=false; sim.done=true;
  $("btnStop").disabled=true;
  log(reason);
}

function stepSim(){
  if(sim.done) return;

  const x0=sim.x,y0=sim.y;

  const dx=sim.B.x-sim.x, dy=sim.B.y-sim.y;
  const n=Math.hypot(dx,dy)||1;
  const ux=dx/n, uy=Math.max(0.35,dy/n);

  sim.vx+=ux*6*sim.dt;
  sim.vy+=(uy*6 - 9.81)*sim.dt;

  sim.x+=sim.vx*sim.dt;
  sim.y+=sim.vy*sim.dt;

  /* ðŸ”’ FIX â€” capture BEFORE falling */
  if(y0 < sim.B.y && sim.y >= sim.B.y){
    sim.x=sim.B.x; sim.y=sim.B.y;
    sim.vx=0; sim.vy=0;
    sim.path.push({x:sim.x,y:sim.y});
    drawScene(sim.path,{x:sim.x,y:sim.y,vx:1,vy:0},sim.A,sim.B);
    stopNow("Arrived at Point B");
    return;
  }

  sim.path.push({x:sim.x,y:sim.y});
  drawScene(sim.path,{x:sim.x,y:sim.y,vx:sim.vx,vy:sim.vy},sim.A,sim.B);
}
</script>
<script>
function loop(){
  if(!sim||!sim.running) return;
  stepSim();
  raf=requestAnimationFrame(loop);
}

$("btnCalc").onclick=calcSim;
$("btnLaunch").onclick=()=>{
  sim.running=true;
  $("btnLaunch").disabled=true;
  $("btnStop").disabled=false;
  raf=requestAnimationFrame(loop);
};
$("btnStop").onclick=()=>stopNow("Stopped manually");
$("btnReset").onclick=()=>{
  if(raf) cancelAnimationFrame(raf);
  sim=null;
  ctx.clearRect(0,0,cv.width,cv.height);
  $("btnLaunch").disabled=true;
  log("Reset.");
};

document.addEventListener("DOMContentLoaded",()=>{
  cv=$("cv"); ctx=cv.getContext("2d");
  logEl=$("log");
  drawScene([],null,{x:0,y:10},{x:360000,y:200000});
});
</script>
</body>
</html>
