<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CST Cosmic Catastrophe Clock — Ancient Sites Explorer</title>

<style>
  :root{
    --bg:#060815;
    --panel:#101528;
    --panel2:#161d34;
    --ink:#e9edff;
    --muted:#9fa8d7;
    --accent:#7dd3fc;
    --accentSoft:#0ea5e9;
    --border:#222a4d;
    --danger:#f97373;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    background:radial-gradient(circle at top,#111827 0,#020617 60%);
    color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    font-size:14px;
  }
  .wrap{
    max-width:1280px;
    margin:0 auto;
    padding:16px;
  }
  header{
    display:flex;
    flex-wrap:wrap;
    align-items:flex-end;
    justify-content:space-between;
    gap:10px;
    margin-bottom:12px;
  }
  h1{
    margin:0;
    font-size:20px;
    letter-spacing:0.04em;
  }
  header p{
    margin:2px 0 0;
    font-size:12px;
    color:var(--muted);
  }
  .badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    background:rgba(125,211,252,0.08);
    border:1px solid rgba(125,211,252,0.45);
    border-radius:999px;
    padding:3px 10px;
    font-size:11px;
    color:var(--accent);
  }
  .badge span{
    width:6px;height:6px;border-radius:50%;background:var(--accentSoft);
    box-shadow:0 0 8px rgba(125,211,252,0.9);
  }

  .layout{
    display:grid;
    grid-template-columns:270px minmax(0,1.4fr) minmax(0,1.2fr);
    gap:12px;
  }
  @media (max-width:1024px){
    .layout{
      grid-template-columns:1fr;
    }
  }
  .card{
    background:var(--panel);
    border-radius:14px;
    border:1px solid var(--border);
    padding:12px;
  }
  .card h2{
    margin:0 0 8px;
    font-size:15px;
  }
  label{
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:0.06em;
    color:var(--muted);
    display:block;
    margin-bottom:4px;
  }
  select,input[type="text"]{
    width:100%;
    background:#020617;
    border-radius:10px;
    border:1px solid #1f2937;
    padding:7px 9px;
    color:var(--ink);
    font-size:13px;
    outline:none;
  }
  select:focus,input[type="text"]:focus{
    border-color:var(--accentSoft);
    box-shadow:0 0 0 1px rgba(14,165,233,0.5);
  }
  .small{
    font-size:11px;
    color:var(--muted);
    margin-top:6px;
  }
  .pill-row{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    margin-top:8px;
  }
  .pill{
    border-radius:999px;
    padding:3px 8px;
    border:1px solid var(--border);
    font-size:11px;
    color:var(--muted);
  }
  .pill strong{color:var(--accent);}

  table{
    width:100%;
    border-collapse:collapse;
    font-size:12px;
  }
  thead{
    position:sticky;
    top:0;
    background:linear-gradient(to bottom,#020617,#050816);
    z-index:2;
  }
  thead th{
    text-align:left;
    padding:6px 6px;
    border-bottom:1px solid var(--border);
    font-weight:500;
    color:var(--muted);
  }
  tbody td{
    padding:4px 6px;
    border-bottom:1px solid rgba(15,23,42,0.9);
  }
  tbody tr:nth-child(odd){
    background:rgba(15,23,42,0.6);
  }
  tbody tr:nth-child(even){
    background:rgba(15,23,42,0.3);
  }
  tbody tr:hover{
    background:rgba(56,189,248,0.10);
  }
  .link-btn{
    background:none;
    border:none;
    padding:0;
    margin:0;
    color:var(--accent);
    cursor:pointer;
    font:inherit;
    text-align:left;
  }
  .link-btn:hover{
    text-decoration:underline;
  }
  .scroll-y{
    max-height:520px;
    overflow:auto;
  }

  .detail-grid{
    display:grid;
    grid-template-columns:1.1fr 1.2fr;
    gap:10px;
  }
  @media (max-width:900px){
    .detail-grid{
      grid-template-columns:1fr;
    }
  }
  .detail-block h3{
    margin:0 0 6px;
    font-size:13px;
  }
  .detail-list{
    list-style:none;
    padding:0;
    margin:0;
    font-size:12px;
  }
  .detail-list li{
    margin-bottom:4px;
  }
  .label{
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:0.06em;
    color:var(--muted);
  }
  .value{
    font-size:12px;
  }
  .value-empty{
    font-size:12px;
    color:#64748b;
    font-style:italic;
  }
  .tag-row{
    display:flex;
    flex-wrap:wrap;
    gap:4px;
    margin-top:4px;
  }
  .tag{
    font-size:10px;
    padding:2px 6px;
    border-radius:999px;
    background:rgba(148,163,184,0.10);
    border:1px solid rgba(148,163,184,0.35);
  }
  .tag.event{
    border-color:rgba(248,113,113,0.6);
    background:rgba(248,113,113,0.08);
    color:#fecaca;
  }
  .mono{
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size:12px;
  }
  .sky-box{
    background:radial-gradient(circle at 20% -20%,rgba(56,189,248,0.5),transparent 50%), radial-gradient(circle at 80% 120%,rgba(129,140,248,0.6),transparent 55%), #020617;
    border-radius:12px;
    border:1px solid rgba(37,99,235,0.6);
    padding:8px 10px;
    box-shadow:0 0 15px rgba(15,23,42,0.9);
  }
  .sky-row{
    display:flex;
    justify-content:space-between;
    gap:6px;
    font-size:11px;
  }
  .sky-row span.label{
    color:#a5b4fc;
  }
  .hint{
    font-size:11px;
    color:var(--muted);
    margin-top:6px;
  }
  .danger-note{
    margin-top:6px;
    font-size:11px;
    color:var(--danger);
  }

  /* ==== Bottom Cosmic Overlay Panel ==== */
  .overlay-card{
    margin-top:14px;
    background:var(--panel2);
  }
  .overlay-card h2{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
  }
  .overlay-layout{
    display:grid;
    grid-template-columns:minmax(0,1.4fr) minmax(0,1.2fr);
    gap:12px;
    margin-top:6px;
  }
  @media (max-width:960px){
    .overlay-layout{
      grid-template-columns:1fr;
    }
  }
  .overlay-controls{
    font-size:12px;
  }
  .overlay-site-list{
    border-radius:10px;
    border:1px solid var(--border);
    background:#020617;
    max-height:190px;
    overflow:auto;
    padding:6px;
    margin-bottom:6px;
  }
  .overlay-site-row{
    display:flex;
    align-items:center;
    gap:6px;
    font-size:12px;
    padding:2px 2px;
  }
  .overlay-site-row input[type="checkbox"]{
    margin:0;
  }
  .overlay-color-dot{
    width:10px;
    height:10px;
    border-radius:50%;
    border:1px solid rgba(15,23,42,0.9);
    flex-shrink:0;
  }
  .layer-toggle-row{
    display:flex;
    flex-wrap:wrap;
    gap:8px 12px;
    margin-bottom:4px;
  }
  .layer-toggle-row label{
    text-transform:none;
    letter-spacing:0;
    font-size:11px;
    display:flex;
    align-items:center;
    gap:4px;
    color:var(--ink);
  }
  .layer-toggle-row input[type="checkbox"]{
    margin:0;
  }
  .overlay-visual{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
  }
  #alignmentCanvas{
    border-radius:999px;
    background:radial-gradient(circle at 50% 20%,rgba(56,189,248,0.15),transparent 55%), #020617;
    border:1px solid rgba(51,65,85,0.9);
    box-shadow:0 0 20px rgba(15,23,42,0.9);
  }
  .overlay-legend{
    width:100%;
    border-radius:10px;
    border:1px dashed rgba(51,65,85,0.9);
    background:rgba(15,23,42,0.7);
    padding:6px 8px;
    font-size:11px;
  }
  .overlay-legend-row{
    display:flex;
    align-items:center;
    gap:6px;
    margin-bottom:2px;
  }
  .overlay-legend-note{
    margin-left:18px;
    font-size:11px;
    color:var(--muted);
    margin-bottom:3px;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>CST Cosmic Catastrophe Clock — Ancient Sites Explorer</h1>
      <p>Click any site to see lat/long, age windows, carbon dating notes, and climate/catastrophe tags. Empty fields = data still to research or link to your star engine.</p>
    </div>
    <div class="badge"><span></span> Cosmic Clock • Experimental Model</div>
  </header>

  <div class="layout">
    <!-- FILTERS -->
    <section class="card">
      <h2>Filters & Controls</h2>
      <div style="margin-bottom:10px;">
        <label for="regionSelect">Region / Group</label>
        <select id="regionSelect"></select>
      </div>
      <div style="margin-bottom:10px;">
        <label for="searchBox">Search (name or country)</label>
        <input id="searchBox" type="text" placeholder="e.g. Gobekli, Peru, Maya, Tepe…" />
      </div>
      <div class="small">
        <strong>Tip:</strong> Start with a region (A–L), then type
        partial names (“Teo”, “Tiwanaku”, “Malta”) to narrow.
      </div>
      <div class="pill-row">
        <div class="pill"><strong>Filled</strong>: has age/event notes</div>
        <div class="pill">Blank: you can add your own CST data</div>
      </div>
    </section>

    <!-- TABLE -->
    <section class="card">
      <h2>Sites (click name for cosmic details)</h2>
      <div class="scroll-y">
        <table>
          <thead>
            <tr>
              <th style="width:38%;">Site</th>
              <th style="width:20%;">Country</th>
              <th style="width:15%;">Region</th>
              <th style="width:13%;">Lat</th>
              <th style="width:13%;">Long</th>
            </tr>
          </thead>
          <tbody id="siteTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- DETAILS -->
    <section class="card">
      <h2>Site Cosmic Details</h2>
      <div id="detailEmpty" class="small">
        Select a site in the table to see its cosmic-clock data.<br/>
        Fields left blank mean you can plug in your own
        carbon-dating ranges, lunar timing, and catastrophe tags.
      </div>
      <div id="detailPanel" style="display:none;">
        <div class="detail-grid">
          <div class="detail-block">
            <h3 id="d_name">—</h3>
            <ul class="detail-list">
              <li><span class="label">Region</span><br><span class="value" id="d_region"></span></li>
              <li><span class="label">Country</span><br><span class="value" id="d_country"></span></li>
              <li><span class="label">Latitude / Longitude</span><br>
                <span class="value mono" id="d_latlong"></span>
              </li>
              <li><span class="label">Approx. construction window</span><br>
                <span id="d_start" class="value"></span>
              </li>
              <li><span class="label">Approx. abandonment / decline</span><br>
                <span id="d_end" class="value"></span>
              </li>
              <li><span class="label">Carbon-dating / chronology notes</span><br>
                <span id="d_carbon" class="value"></span>
              </li>
              <li><span class="label">Climate / catastrophe & historical notes</span><br>
                <span id="d_events" class="value"></span>
              </li>
            </ul>
          </div>
          <div class="detail-block">
            <h3>Cosmic Clock / Sky Window</h3>
            <div class="sky-box">
              <div class="sky-row">
                <div>
                  <span class="label">True North / Hemisphere</span><br>
                  <span class="value" id="d_hemisphere"></span>
                </div>
                <div>
                  <span class="label">Lat Band (for lunar/sky model)</span><br>
                  <span class="value" id="d_latband"></span>
                </div>
              </div>
              <div style="margin-top:6px;">
                <span class="label">Suggested “star-clock” focus</span><br>
                <span class="value" id="d_starFocus"></span>
              </div>
            </div>
            <p class="hint">
              This panel is where you plug your CST lunar/stellar engine:
              given lat/long and epoch you can estimate which
              <strong>months</strong> key moon crossings or star risings
              would mark construction/abandonment rituals.
            </p>
            <p class="danger-note">
              ⚠️ NOTE: Month/day/year precision is not currently known for
              these sites. Ranges shown are approximate and based on
              standard archaeological chronologies. Use this
              as a calibration scaffold, not an absolute clock.
            </p>
            <div class="tag-row" id="d_tags"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- BOTTOM PANEL: 0–360° COSMIC ALIGNMENT OVERLAY -->
  <section class="card overlay-card">
    <h2>
      0–360° Cosmic Alignment Overlay (0° = True North)
      <span style="font-size:11px;color:var(--muted);font-weight:400;">
        N / E / S / W marked on circle
      </span>
    </h2>
    <div class="overlay-layout">
      <div class="overlay-controls">
        <label>Sites in overlay (multi-select)</label>
        <div id="overlaySiteList" class="overlay-site-list"></div>
        <div class="small">
          Tick a square to add a site’s alignments.<br/>
          Each site gets its own color; dots = stones/pillars, lines = solar / lunar / stellar axes.
        </div>
        <label style="margin-top:6px;">Layers</label>
        <div class="layer-toggle-row">
          <label><input type="checkbox" id="layerSolar" checked /> Solar axes</label>
          <label><input type="checkbox" id="layerLunar" checked /> Lunar axes</label>
          <label><input type="checkbox" id="layerStellar" checked /> Stellar axes</label>
          <label><input type="checkbox" id="layerClimate" checked /> Climate / ice-core markers</label>
        </div>
        <div class="small">
          Either outcome is astonishing: shared sky templates vs. independent
          discovery by human consciousness. This overlay lets you test both.
        </div>
      </div>
      <div class="overlay-visual">
        <canvas id="alignmentCanvas" width="340" height="340"></canvas>
        <div id="overlayLegend" class="overlay-legend"></div>
        <p class="hint">
          Circle is 0–360° around local <strong>true north</strong> for each site.
          N, E, S, W are labeled; overlay compares angles only (not distance).
        </p>
      </div>
    </div>
  </section>

</div>
<script>
// ===== Data model =====
// Each site: region, name, country, lat, lon, approxStart, approxEnd,
// carbonDating, events, tags (optional small labels).
const sites = [
  // A. “Tepe” / Early Near East & Mesopotamia
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Göbekli Tepe",
    country:"Türkiye",
    lat:37.2232, lon:38.9223,
    approxStart:"c. 9600–8800 BCE (Pre-Pottery Neolithic A/B)",
    approxEnd:"c. 8000 BCE (site deliberately backfilled)",
    carbonDating:"Radiocarbon on PPNA/PPNB layers; multiple dates cluster between ~9600–8800 BCE.",
    events:"Early Holocene warming after Younger Dryas; transition from mobile hunter–gatherers to more settled communities.",
    tags:["Neolithic","Cult center","Tepe","Carbon-dated"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Karahan Tepe",
    country:"Türkiye",
    lat:37.3810, lon:39.3260,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Tepe","Neolithic?"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Çatalhöyük",
    country:"Türkiye",
    lat:37.6667, lon:32.8250,
    approxStart:"c. 7400 BCE (earliest occupation)",
    approxEnd:"c. 6000 BCE (major decline)",
    carbonDating:"Extensive radiocarbon and stratigraphic work across multiple house levels.",
    events:"Local environmental stress (deforestation/erosion) and shifts in settlement patterns.",
    tags:["Neolithic proto-city","Carbon-dated"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Nevali Çori",
    country:"Türkiye",
    lat:37.8010, lon:38.6120,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Tepe-region"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Çayönü",
    country:"Türkiye",
    lat:38.2600, lon:40.2360,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Neolithic"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Hallan Çemi",
    country:"Türkiye",
    lat:38.1650, lon:39.0830,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Epipaleolithic","Neolithic"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Jericho (Tell es-Sultan)",
    country:"Palestine",
    lat:31.8711, lon:35.4439,
    approxStart:"Natufian c. 9600–9000 BCE; Neolithic tower/walls c. 8000–7000 BCE",
    approxEnd:"Multiple destructions/rebuildings; Bronze Age city destroyed mid-2nd millennium BCE",
    carbonDating:"Wide radiocarbon range from Natufian through Bronze Age levels.",
    events:"Earthquakes, warfare, and regional climate shifts over thousands of years.",
    tags:["Oldest towns","Carbon-dated"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Ain Ghazal",
    country:"Jordan",
    lat:31.9700, lon:35.9500,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Neolithic"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Byblos (Jbeil)",
    country:"Lebanon",
    lat:34.1230, lon:35.6510,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Phoenician","Harbor"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Ugarit (Ras Shamra)",
    country:"Syria",
    lat:35.5970, lon:35.7800,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Late Bronze Age"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Mari (Tell Hariri)",
    country:"Syria",
    lat:34.5510, lon:40.8850,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Bronze Age city"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Tell Brak",
    country:"Syria",
    lat:36.6550, lon:41.0540,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Early city"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Uruk (Warka)",
    country:"Iraq",
    lat:31.3250, lon:45.6330,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Mesopotamia","Urban"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Ur (Tell el-Muqayyar)",
    country:"Iraq",
    lat:30.9641, lon:46.1030,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Sumerian"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Nippur",
    country:"Iraq",
    lat:32.1230, lon:45.2350,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Sacred city"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Nineveh (Kuyunjik)",
    country:"Iraq",
    lat:36.3590, lon:43.1520,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Assyrian capital"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Babylon",
    country:"Iraq",
    lat:32.5364, lon:44.4200,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Mesopotamia"]
  },
  {
    region:"A. Tepe / Early Near East & Mesopotamia",
    name:"Tell Mardikh (Ebla)",
    country:"Syria",
    lat:35.7970, lon:36.7950,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Bronze Age"]
  },

  // B. Egypt & North Africa
  {
    region:"B. Egypt & North Africa",
    name:"Giza Pyramids",
    country:"Egypt",
    lat:29.9792, lon:31.1342,
    approxStart:"Great Pyramid c. 2580–2560 BCE; plateau active c. 2600–2500 BCE",
    approxEnd:"Necropolis use continues; political center shifts over millennia",
    carbonDating:"Radiocarbon and historical records for Old Kingdom; quarry marks and royal names support dates.",
    events:"No single catastrophe; dynastic and religious shifts change focus of royal building.",
    tags:["Pyramid","Old Kingdom","Carbon-dated"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Saqqara (Djoser Pyramid)",
    country:"Egypt",
    lat:29.8711, lon:31.2166,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Step pyramid"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Dahshur Pyramids",
    country:"Egypt",
    lat:29.8000, lon:31.2160,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Bent & Red pyramids"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Abu Roash Pyramid",
    country:"Egypt",
    lat:30.0200, lon:31.0300,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Unfinished pyramid"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Heliopolis (Matariyya)",
    country:"Egypt",
    lat:30.1280, lon:31.2910,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Solar cult center"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Abydos (Umm el-Qa’ab)",
    country:"Egypt",
    lat:26.1860, lon:31.9210,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Early dynastic"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Dendera Temple",
    country:"Egypt",
    lat:26.1400, lon:32.6700,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Temple"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Karnak Temple",
    country:"Egypt",
    lat:25.7188, lon:32.6573,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Temple complex"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Luxor Temple",
    country:"Egypt",
    lat:25.6995, lon:32.6390,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Temple"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Valley of the Kings",
    country:"Egypt",
    lat:25.7402, lon:32.6014,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["New Kingdom"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Nabta Playa stone circle",
    country:"Egypt",
    lat:22.5090, lon:30.7330,
    approxStart:"c. 6000–4000 BCE; megaliths probably ~5000 BCE",
    approxEnd:"Occupation and ritual use fade as Sahara dries after ~4000 BCE",
    carbonDating:"Radiocarbon on hearths and associated remains in the playa basin.",
    events:"African Humid Period ending; desertification forcing pastoral groups to migrate.",
    tags:["Megalith","Green Sahara","Climate-linked"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Hierakonpolis (Nekhen)",
    country:"Egypt",
    lat:25.0900, lon:32.7800,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Predynastic"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Tanis (San el-Hagar)",
    country:"Egypt",
    lat:30.9670, lon:31.8800,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Delta city"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Great Zimbabwe",
    country:"Zimbabwe",
    lat:-20.2690, lon:30.9340,
    approxStart:"c. 11th–15th centuries CE",
    approxEnd:"Largely abandoned by late 15th century CE",
    carbonDating:"Radiocarbon on charcoal/organic remains; ceramic sequences.",
    events:"Shifts in trade routes, political power, and possible environmental pressures.",
    tags:["Stone city","Sub-Saharan","Carbon-dated"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Leptis Magna",
    country:"Libya",
    lat:32.6390, lon:14.2900,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Roman port"]
  },
  {
    region:"B. Egypt & North Africa",
    name:"Cyrene",
    country:"Libya",
    lat:32.8270, lon:21.8570,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Greek city"]
  },

  // C. Minoan, Aegean, Anatolian Bronze Age
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Knossos",
    country:"Greece (Crete)",
    lat:35.2989, lon:25.1635,
    approxStart:"First palace c. 1900 BCE; rebuilt after c. 1700 BCE",
    approxEnd:"Palatial function ends c. 1375 BCE",
    carbonDating:"Archaeological phases + cross-dating with Egyptian chronologies.",
    events:"Multiple destructions; combination of earthquakes, possible Thera after-effects, and Mycenaean takeover.",
    tags:["Minoan palace","Carbon-dated"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Phaistos",
    country:"Greece (Crete)",
    lat:35.0511, lon:24.8107,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Minoan"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Malia Palace",
    country:"Greece (Crete)",
    lat:35.2830, lon:25.5130,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Minoan"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Zakros (Kato Zakros)",
    country:"Greece (Crete)",
    lat:35.0900, lon:26.2590,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Minoan"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Akrotiri",
    country:"Greece (Santorini)",
    lat:36.3580, lon:25.4010,
    approxStart:"Flourishes c. 17th–16th century BCE",
    approxEnd:"Sudden burial by Thera eruption sometime between ~17th–16th century BCE",
    carbonDating:"Tephra + radiocarbon + correlations with ice cores and Egyptian sequences.",
    events:"Thera volcanic eruption and associated tsunamis/ashfall.",
    tags:["Bronze Age","Volcano","Carbon-dated"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Mycenae",
    country:"Greece",
    lat:37.7308, lon:22.7573,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Mycenaean citadel"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Tiryns",
    country:"Greece",
    lat:37.5980, lon:22.8070,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Mycenaean"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Troy (Hisarlik)",
    country:"Türkiye",
    lat:39.9570, lon:26.2380,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Multi-layer city"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Hattusa (Boğazköy)",
    country:"Türkiye",
    lat:40.0200, lon:34.6080,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Hittite capital"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Alaca Höyük",
    country:"Türkiye",
    lat:40.0260, lon:34.6080,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Hittite/earlier"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Ephesus",
    country:"Türkiye",
    lat:37.9390, lon:27.3410,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Classical city"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Miletus",
    country:"Türkiye",
    lat:37.5300, lon:27.2770,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Ionian city"]
  },
  {
    region:"C. Minoan, Aegean, Anatolian Bronze Age",
    name:"Pergamon (Bergama Akropolis)",
    country:"Türkiye",
    lat:39.1320, lon:27.1830,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Hellenistic"]
  },

  // D. Europe — Megaliths, Neolithic, Bronze Age
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Skara Brae",
    country:"United Kingdom (Orkney)",
    lat:59.0487, lon:-3.3417,
    approxStart:"c. 3180 BCE",
    approxEnd:"c. 2500 BCE",
    carbonDating:"Radiocarbon on midden and occupation layers; Bayesian modelling of dates.",
    events:"Likely gradual climate cooling and coastal change; no single recorded catastrophe.",
    tags:["Neolithic village","Carbon-dated"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Maeshowe",
    country:"United Kingdom (Orkney)",
    lat:59.0003, lon:-3.1874,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Passage tomb"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Ring of Brodgar",
    country:"United Kingdom (Orkney)",
    lat:59.0010, lon:-3.2290,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Stone circle"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Stonehenge",
    country:"United Kingdom",
    lat:51.1789, lon:-1.8262,
    approxStart:"First earthwork c. 3100 BCE; main stone phases ~2600–2400 BCE",
    approxEnd:"Ritual use declines after c. 1600 BCE",
    carbonDating:"Radiocarbon and stratigraphic phases; cross-checked with pottery.",
    events:"Multiple building phases; no single known catastrophe ending its use.",
    tags:["Stone circle","Solstice alignment","Carbon-dated"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Avebury",
    country:"United Kingdom",
    lat:51.4289, lon:-1.8544,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Henge","Stone circle"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Silbury Hill",
    country:"United Kingdom",
    lat:51.4150, lon:-1.8570,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Artificial mound"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Newgrange",
    country:"Ireland",
    lat:53.6947, lon:-6.4756,
    approxStart:"c. 3200 BCE",
    approxEnd:"",
    carbonDating:"Radiocarbon on construction and later activity.",
    events:"Passage tomb aligned to winter solstice sunrise; ritual use across long period.",
    tags:["Passage tomb","Solstice alignment","Carbon-dated"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Knowth",
    country:"Ireland",
    lat:53.6941, lon:-6.4900,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Passage tomb"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Dowth",
    country:"Ireland",
    lat:53.7000, lon:-6.4700,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Passage tomb"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Callanish Stones",
    country:"United Kingdom (Isle of Lewis)",
    lat:58.1978, lon:-6.7442,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Stone circle"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Carnac Alignments",
    country:"France",
    lat:47.5950, lon:-3.0820,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Megalith rows"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Gavrinis Passage Tomb",
    country:"France",
    lat:47.5820, lon:-2.8120,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Passage tomb"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Monte d’Accoddi",
    country:"Italy (Sardinia)",
    lat:40.7850, lon:8.5650,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Platform mound"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Tarxien Temples",
    country:"Malta",
    lat:35.8720, lon:14.5150,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Megalithic temple"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Ħaġar Qim",
    country:"Malta",
    lat:35.8334, lon:14.4413,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Megalithic temple"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Mnajdra",
    country:"Malta",
    lat:35.8306, lon:14.4369,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Megalithic temple"]
  },
  {
    region:"D. Europe — Megaliths, Neolithic, Bronze Age",
    name:"Hal Saflieni Hypogeum",
    country:"Malta",
    lat:35.8760, lon:14.5150,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Underground temple"]
  },

  // E. Europe — Caves & Paleolithic Art
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"Lascaux Cave",
    country:"France",
    lat:45.0547, lon:1.1790,
    approxStart:"Main art phases c. 17,000–15,000 years BP",
    approxEnd:"",
    carbonDating:"Radiocarbon on pigments/torches; stylistic links to Magdalenian culture.",
    events:"Represents Upper Paleolithic hunting and cosmology; later sealed naturally.",
    tags:["Paleolithic art","Carbon-dated"]
  },
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"Chauvet Cave",
    country:"France",
    lat:44.3922, lon:4.4140,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Very old cave art"]
  },
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"Cosquer Cave",
    country:"France",
    lat:43.2110, lon:5.3630,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Underwater entrance"]
  },
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"Altamira Cave",
    country:"Spain",
    lat:43.3770, lon:-4.1200,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Paleolithic art"]
  },
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"Cueva de Tito Bustillo",
    country:"Spain",
    lat:43.4580, lon:-5.0650,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Cave art"]
  },
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"Cave of Niaux",
    country:"France",
    lat:42.7900, lon:1.5750,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Cave art"]
  },
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"El Castillo Cave",
    country:"Spain",
    lat:43.2640, lon:-3.9880,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Cave art"]
  },
  {
    region:"E. Europe — Caves & Paleolithic Art",
    name:"Cueva de las Manos",
    country:"Argentina",
    lat:-47.1577, lon:-70.6421,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Rock art"]
  },

  // F. Indus Valley & South Asia
  {
    region:"F. Indus Valley & South Asia",
    name:"Mohenjo-daro",
    country:"Pakistan",
    lat:27.3292, lon:68.1389,
    approxStart:"c. 2600 BCE (mature Harappan)",
    approxEnd:"c. 1900 BCE (urban decline)",
    carbonDating:"Multiple radiocarbon samples; ceramic and stratigraphic sequences.",
    events:"Regional drying of Indus system, possible shifts in river courses and trade.",
    tags:["Indus city","Carbon-dated"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Harappa",
    country:"Pakistan",
    lat:30.6263, lon:72.8724,
    approxStart:"c. 2600 BCE (mature Harappan)",
    approxEnd:"c. 1900 BCE (urban decline)",
    carbonDating:"Radiocarbon and ceramics; standard Indus chronology.",
    events:"Regional hydro-climatic change and trade reorganization.",
    tags:["Indus city","Carbon-dated"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Rakhigarhi",
    country:"India",
    lat:29.3000, lon:76.1500,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Indus site"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Dholavira",
    country:"India",
    lat:23.8889, lon:70.2194,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Indus city"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Lothal",
    country:"India",
    lat:22.5222, lon:72.2486,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Harappan port"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Kalibangan",
    country:"India",
    lat:29.4700, lon:74.1300,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Indus site"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Bhimbetka Rock Shelters",
    country:"India",
    lat:22.9380, lon:77.6120,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Very long occupation"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Sanchi Stupa complex",
    country:"India",
    lat:23.4862, lon:77.7396,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Buddhist"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Taxila (Sirkap area)",
    country:"Pakistan",
    lat:33.7460, lon:72.8380,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Hellenistic/Indian"]
  },
  {
    region:"F. Indus Valley & South Asia",
    name:"Mehrgarh",
    country:"Pakistan",
    lat:29.4000, lon:67.8500,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Neolithic/Chalcolithic"]
  },

  // G. East Asia
  {
    region:"G. East Asia",
    name:"Banpo (Xi’an)",
    country:"China",
    lat:34.2740, lon:109.0300,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Neolithic village"]
  },
  {
    region:"G. East Asia",
    name:"Yangshao Village site (Mianchi)",
    country:"China",
    lat:34.6800, lon:111.8500,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Neolithic"]
  },
  {
    region:"G. East Asia",
    name:"Erlitou",
    country:"China",
    lat:34.6800, lon:112.8100,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Bronze Age"]
  },
  {
    region:"G. East Asia",
    name:"Yinxu (Anyang)",
    country:"China",
    lat:36.1270, lon:114.3200,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Shang capital"]
  },
  {
    region:"G. East Asia",
    name:"Longshan Chengziya",
    country:"China",
    lat:36.6500, lon:117.2000,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Neolithic Longshan"]
  },
  {
    region:"G. East Asia",
    name:"Panlongcheng",
    country:"China",
    lat:30.6570, lon:114.2700,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Bronze Age"]
  },
  {
    region:"G. East Asia",
    name:"Niuheliang",
    country:"China",
    lat:41.0800, lon:119.3500,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Hongshan cult"]
  },
  {
    region:"G. East Asia",
    name:"Jeulmun site Amsa-dong",
    country:"South Korea",
    lat:37.5570, lon:127.2040,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Neolithic"]
  },
  {
    region:"G. East Asia",
    name:"Yoshinogari",
    country:"Japan",
    lat:33.4200, lon:130.3700,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Yayoi period"]
  },
  {
    region:"G. East Asia",
    name:"Jōmon site Sannai-Maruyama",
    country:"Japan",
    lat:40.8060, lon:140.6940,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Jōmon"]
  },

  // H. The Americas — Maya, Aztec, Olmec, others
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Chichén Itzá",
    country:"Mexico",
    lat:20.6764, lon:-88.5678,
    approxStart:"Main monumental phases c. 600–1200 CE",
    approxEnd:"Major political center declines by c. 13th century CE",
    carbonDating:"Combined archaeology, inscriptions, and colonial references.",
    events:"Regional political realignments and possibly drought conditions in northern Yucatán.",
    tags:["Maya-Toltec","Carbon-dated"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Uxmal",
    country:"Mexico",
    lat:20.3607, lon:-89.7685,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Puuc Maya"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Palenque",
    country:"Mexico",
    lat:17.4849, lon:-92.0460,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Classic Maya"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Tikal",
    country:"Guatemala",
    lat:17.2214, lon:-89.6237,
    approxStart:"Major construction c. 200–800 CE",
    approxEnd:"Urban decline and abandonment mostly by 10th century CE",
    carbonDating:"Monumental inscriptions + ceramic sequences; some radiocarbon.",
    events:"Part of broader Classic Maya ‘collapse’ with warfare and multi-decadal droughts.",
    tags:["Maya","Collapse","Carbon-dated"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Copán",
    country:"Honduras",
    lat:14.8400, lon:-89.1400,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Maya"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Calakmul",
    country:"Mexico",
    lat:18.1040, lon:-89.8100,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Maya"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Caracol",
    country:"Belize",
    lat:16.7630, lon:-89.1180,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Maya"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Coba",
    country:"Mexico",
    lat:20.4880, lon:-87.7380,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Maya"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"El Mirador",
    country:"Guatemala",
    lat:17.7500, lon:-90.1000,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Preclassic Maya"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Teotihuacan",
    country:"Mexico",
    lat:19.6925, lon:-98.8438,
    approxStart:"Urban center forms c. 1st century BCE–1st century CE",
    approxEnd:"Major burning and political collapse c. 550–600 CE",
    carbonDating:"Radiocarbon, stratigraphy, and ceramic phases.",
    events:"Internal unrest and political conflict; some evidence for drought and resource stress.",
    tags:["Mesoamerican city","Carbon-dated"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Tenochtitlan (Templo Mayor area)",
    country:"Mexico",
    lat:19.4350, lon:-99.1320,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Aztec capital"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Monte Albán",
    country:"Mexico",
    lat:17.0433, lon:-96.7675,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Zapotec"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Mitla",
    country:"Mexico",
    lat:16.9172, lon:-96.3586,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Zapotec/Mixtec"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"La Venta (Olmec)",
    country:"Mexico",
    lat:18.1000, lon:-94.0500,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Olmec"]
  },
  {
    region:"H. The Americas — Maya, Aztec, Olmec, others",
    name:"Tres Zapotes (Olmec)",
    country:"Mexico",
    lat:18.4500, lon:-95.3500,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Olmec"]
  },

  // I. The Americas — Andes & South America
  {
    region:"I. The Americas — Andes & South America",
    name:"Caral (Sacred City of Caral-Supe)",
    country:"Peru",
    lat:-10.8920, lon:-77.5200,
    approxStart:"c. 2600–2000 BCE",
    approxEnd:"Decline by c. 1900–1800 BCE",
    carbonDating:"Radiocarbon dates on architecture and habitation layers.",
    events:"Changes in river dynamics and regional settlement patterns; possible ENSO (El Niño) variability.",
    tags:["Andean early city","Carbon-dated"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Chavín de Huántar",
    country:"Peru",
    lat:-9.5930, lon:-77.1780,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Ceremonial center"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Kuelap",
    country:"Peru",
    lat:-6.4180, lon:-77.9180,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Fortified site"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Machu Picchu",
    country:"Peru",
    lat:-13.1631, lon:-72.5450,
    approxStart:"c. mid-15th century CE",
    approxEnd:"Likely abandoned in 16th century CE (post-conquest era)",
    carbonDating:"Historical-chronological correlation with Inca rulers; some radiocarbon.",
    events:"Spanish conquest and reorganization of Andean polities.",
    tags:["Inca","Highland","Carbon-dated"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Cusco (Inca core)",
    country:"Peru",
    lat:-13.5317, lon:-71.9675,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Inca capital"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Tiwanaku",
    country:"Bolivia",
    lat:-16.5540, lon:-68.6730,
    approxStart:"Monumental core mainly c. 5th–10th centuries CE",
    approxEnd:"Rapid decline c. 1000–1100 CE",
    carbonDating:"Radiocarbon and ceramic-phase dating.",
    events:"Evidence for multi-century drought in Titicaca basin, plus political changes.",
    tags:["Altiplano center","Drought-linked","Carbon-dated"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Pumapunku",
    country:"Bolivia",
    lat:-16.5610, lon:-68.6790,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Tiwanaku complex"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Chan Chan",
    country:"Peru",
    lat:-8.1090, lon:-79.0740,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Chimú capital"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Nazca Lines (Mirador area)",
    country:"Peru",
    lat:-14.7390, lon:-75.1300,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Geoglyphs"]
  },
  {
    region:"I. The Americas — Andes & South America",
    name:"Sacsayhuamán",
    country:"Peru",
    lat:-13.5090, lon:-71.9810,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Inca fortress"]
  },

  // J. Sub-Saharan Africa & Arabian Peninsula
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Aksum",
    country:"Ethiopia",
    lat:14.1230, lon:38.7240,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Aksumite capital"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Yeha",
    country:"Ethiopia",
    lat:14.3000, lon:39.1830,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Ancient temple-town"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Lalibela (rock-hewn churches)",
    country:"Ethiopia",
    lat:12.0310, lon:39.0470,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Medieval religious center"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Great Enclosure, Great Zimbabwe",
    country:"Zimbabwe",
    lat:-20.2690, lon:30.9340,
    approxStart:"(See Great Zimbabwe entry in section B)",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Stone enclosure"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Mapungubwe Hill",
    country:"South Africa",
    lat:-22.2050, lon:29.3270,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Early state"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Kerma",
    country:"Sudan",
    lat:19.6160, lon:30.4160,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Kushite center"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Napata / Jebel Barkal",
    country:"Sudan",
    lat:18.5330, lon:31.8160,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Sacred mountain"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Marib Dam ruins",
    country:"Yemen",
    lat:15.4510, lon:45.2140,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Ancient dam"]
  },
  {
    region:"J. Sub-Saharan Africa & Arabian Peninsula",
    name:"Shibam (Old Walled City)",
    country:"Yemen",
    lat:15.9240, lon:48.6290,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Mudbrick skyscrapers"]
  },

  // K. Central & Northern Asia
  {
    region:"K. Central & Northern Asia",
    name:"Gonur Tepe",
    country:"Turkmenistan",
    lat:37.9510, lon:62.2680,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Bactria–Margiana"]
  },
  {
    region:"K. Central & Northern Asia",
    name:"Namazga-depe",
    country:"Turkmenistan",
    lat:37.9470, lon:58.3600,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Proto-urban"]
  },
  {
    region:"K. Central & Northern Asia",
    name:"Anau",
    country:"Turkmenistan",
    lat:37.8870, lon:58.5200,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Early farming"]
  },
  {
    region:"K. Central & Northern Asia",
    name:"Saraytoo / Sarazm",
    country:"Tajikistan",
    lat:39.5080, lon:67.5010,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Proto-urban"]
  },
  {
    region:"K. Central & Northern Asia",
    name:"Otrar (Farab)",
    country:"Kazakhstan",
    lat:42.8450, lon:68.3170,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Silk Road"]
  },
  {
    region:"K. Central & Northern Asia",
    name:"Arkaim",
    country:"Russia",
    lat:52.6420, lon:59.5730,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["“Country of Towns”"]
  },
  {
    region:"K. Central & Northern Asia",
    name:"Pazyryk (Scythian kurgans)",
    country:"Russia (Altai)",
    lat:50.0660, lon:87.3930,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Kurgan burials"]
  },

  // L. Oceania & Pacific
  {
    region:"L. Oceania & Pacific",
    name:"Lapita site Talepakemalai",
    country:"Papua New Guinea",
    lat:-2.6310, lon:150.8000,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Lapita"]
  },
  {
    region:"L. Oceania & Pacific",
    name:"Rapa Nui (Ahu Tongariki)",
    country:"Chile (Easter Island)",
    lat:-27.1250, lon:-109.2770,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Moai platform"]
  },
  {
    region:"L. Oceania & Pacific",
    name:"Nan Madol",
    country:"Micronesia",
    lat:6.8390, lon:158.3320,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Artificial islets"]
  },
  {
    region:"L. Oceania & Pacific",
    name:"Taputapuātea",
    country:"French Polynesia (Raiatea)",
    lat:-16.8330, lon:-151.3830,
    approxStart:"",
    approxEnd:"",
    carbonDating:"",
    events:"",
    tags:["Sacred marae"]
  }
];

// ===== Helper: compute hemisphere, lat band, & simple star-focus label =====
function classifySky(site){
  const lat = site.lat;
  const hemi = lat > 0 ? "Northern Hemisphere" : (lat < 0 ? "Southern Hemisphere" : "Equator");
  let band;
  if (Math.abs(lat) < 15) band = "Tropical (0–15°)";
  else if (Math.abs(lat) < 30) band = "Subtropical (15–30°)";
  else if (Math.abs(lat) < 60) band = "Mid-latitude (30–60°)";
  else band = "High latitude (60°+)";
  // Very simple suggestion for star/season focus (you can replace with full CST logic)
  let focus;
  if (Math.abs(lat) < 15){
    focus = "Equinoctial sunrise/sunset, zenith Sun & bright belt stars (Orion / Milky Way crossings).";
  } else if (Math.abs(lat) < 35){
    focus = "Solstice sunrise/sunset azimuths and major lunar standstills on the horizon.";
  } else if (Math.abs(lat) < 55){
    focus = "Solstice and lunar standstill extremes; circumpolar star loops around true north.";
  } else {
    focus = "Long winter nights; circumpolar constellations dominate; solar altitude changes are dramatic.";
  }
  return {hemi, band, focus};
}

// ===== Build region list =====
const regionSelect = document.getElementById("regionSelect");
const regions = [...new Set(sites.map(s => s.region))].sort();
regions.forEach(r => {
  const opt = document.createElement("option");
  opt.value = r;
  opt.textContent = r;
  regionSelect.appendChild(opt);
});
// Default to first region
if (regions.length > 0) regionSelect.value = regions[0];

const searchBox = document.getElementById("searchBox");
const tableBody = document.getElementById("siteTableBody");

// ===== Render table =====
function renderTable(){
  const region = regionSelect.value;
  const term = searchBox.value.trim().toLowerCase();
  tableBody.innerHTML = "";

  const filtered = sites.filter(s => {
    if (region && s.region !== region) return false;
    if (!term) return true;
    const hay = (s.name + " " + s.country).toLowerCase();
    return hay.includes(term);
  });

  filtered.forEach(site => {
    const tr = document.createElement("tr");
    const tdName = document.createElement("td");
    const btn = document.createElement("button");
    btn.className = "link-btn";
    btn.textContent = site.name;
    btn.addEventListener("click", () => showDetails(site));
    tdName.appendChild(btn);

    const tdCountry = document.createElement("td");
    tdCountry.textContent = site.country;

    const tdRegion = document.createElement("td");
    tdRegion.textContent = site.region.split("—")[0].trim(); // show "A.", "B." etc.

    const tdLat = document.createElement("td");
    const tdLon = document.createElement("td");
    tdLat.textContent = site.lat.toFixed(4);
    tdLon.textContent = site.lon.toFixed(4);

    tr.appendChild(tdName);
    tr.appendChild(tdCountry);
    tr.appendChild(tdRegion);
    tr.appendChild(tdLat);
    tr.appendChild(tdLon);
    tableBody.appendChild(tr);
  });

  if (!filtered.length){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.textContent = "No sites match current filters.";
    tr.appendChild(td);
    tableBody.appendChild(tr);
  }
}

// ===== Detail panel fill =====
const detailEmpty = document.getElementById("detailEmpty");
const detailPanel = document.getElementById("detailPanel");

function setOrEmpty(el, text){
  if (!text){
    el.textContent = "— (not yet specified)";
    el.className = "value-empty";
  } else {
    el.textContent = text;
    el.className = "value";
  }
}

function showDetails(site){
  detailEmpty.style.display = "none";
  detailPanel.style.display = "block";

  document.getElementById("d_name").textContent = site.name;
  document.getElementById("d_region").textContent = site.region;
  document.getElementById("d_country").textContent = site.country;
  document.getElementById("d_latlong").textContent =
    `${site.lat.toFixed(4)}°, ${site.lon.toFixed(4)}°`;

  setOrEmpty(document.getElementById("d_start"), site.approxStart);
  setOrEmpty(document.getElementById("d_end"), site.approxEnd);
  setOrEmpty(document.getElementById("d_carbon"), site.carbonDating);
  setOrEmpty(document.getElementById("d_events"), site.events);

  const sky = classifySky(site);
  document.getElementById("d_hemisphere").textContent = sky.hemi;
  document.getElementById("d_latband").textContent = sky.band;
  document.getElementById("d_starFocus").textContent = sky.focus;

  const tagRow = document.getElementById("d_tags");
  tagRow.innerHTML = "";
  if (site.tags && site.tags.length){
    site.tags.forEach(t => {
      const span = document.createElement("span");
      span.className = t.toLowerCase().includes("collapse") ||
                       t.toLowerCase().includes("drought") ||
                       t.toLowerCase().includes("climate") ?
                       "tag event" : "tag";
      span.textContent = t;
      tagRow.appendChild(span);
    });
  }
}

// ===== Events =====
regionSelect.addEventListener("change", renderTable);
searchBox.addEventListener("input", renderTable);

// Initial render (top panels)
renderTable();
// ===== Cosmic Alignment Overlay (bottom panel only) =====

// Minimal alignment dataset focused on key sites.
// Angles are in degrees from TRUE NORTH, measured clockwise (0° = North, 90° = East).
const alignmentSites = [
  {
    key:"Stonehenge",
    label:"Stonehenge (UK)",
    color:"#f97316",
    // Approx summer solstice sunrise axis 
    solarAxes:[50],
    // Rough winter solstice sunset mirror axis
    lunarAxes:[230],
    // Placeholder: bright star belt / Milky Way orientation region
    stellarAxes:[140],
    // Pillar ring sample angles (illustrative)
    pillars:[35,50,70,215,230,250],
    climate:{severity:0.2,note:"No single catastrophe; multiple construction phases."}
  },
  {
    key:"Newgrange",
    label:"Newgrange (Ireland)",
    color:"#22c55e",
    // Winter solstice sunrise in SE quadrant
    solarAxes:[135],
    lunarAxes:[315],
    stellarAxes:[],
    pillars:[120,135,150],
    climate:{severity:0.3,note:"Late Neolithic Atlantic climate; stable enough for monumental building."}
  },
  {
    key:"Giza Pyramids",
    label:"Giza Pyramids (Egypt)",
    color:"#eab308",
    // Almost perfect cardinal alignment 
    solarAxes:[0,90,180,270],
    lunarAxes:[],
    stellarAxes:[0], // Linked to circumpolar stars in some models
    pillars:[0,90,180,270],
    climate:{severity:0.25,note:"Old Kingdom; Nile flooding regime stable, no big ice-core catastrophe flagged."}
  },
  {
    key:"Nabta Playa stone circle",
    label:"Nabta Playa (Egypt)",
    color:"#38bdf8",
    // Suggestive of summer solstice sunrise; modeled near NE 
    solarAxes:[62],
    lunarAxes:[],
    stellarAxes:[120],
    pillars:[40,62,80,200,220],
    climate:{severity:0.7,note:"Green Sahara ending; desertification signal in regional climate."}
  },
  {
    key:"Chichén Itzá",
    label:"Chichén Itzá – El Castillo",
    color:"#a855f7",
    // North face azimuth for key solar dates (approx) 
    solarAxes:[112],
    lunarAxes:[],
    stellarAxes:[290],
    pillars:[100,112,124],
    climate:{severity:0.5,note:"Evidence for drought episodes in northern Yucatán."}
  },
  {
    key:"Teotihuacan",
    label:"Teotihuacan (Mexico)",
    color:"#f97373",
    // Avenue of the Dead ~15.5° east of true north 
    solarAxes:[15.5],
    lunarAxes:[],
    stellarAxes:[195.5],
    pillars:[15.5,30,195.5,210],
    climate:{severity:0.6,note:"Urban stress + possible drought preceding collapse."}
  },
  {
    key:"Nazca Lines (Mirador area)",
    label:"Nazca Lines (Peru)",
    color:"#fb7185",
    // Some long lines cluster around NW–SE axes; sample span
    solarAxes:[291,176],
    lunarAxes:[],
    stellarAxes:[336],
    pillars:[291,305,176],
    climate:{severity:0.65,note:"Hyper-arid regime; ENSO-sensitive coastal climate."}
  },
  {
    key:"Tiwanaku",
    label:"Tiwanaku (Bolivia)",
    color:"#2dd4bf",
    // Kalasasaya-type solar alignments near SE/SW; sample mid-angle 
    solarAxes:[114.5,294.5],
    lunarAxes:[135,315],
    stellarAxes:[],
    pillars:[100,114.5,130,280,294.5,310],
    climate:{severity:0.8,note:"Lake Titicaca basin drought ~AD 1000–1100 in ice-core/lake cores."}
  },
  {
    key:"Callanish Stones",
    label:"Callanish (Scotland)",
    color:"#4ade80",
    // Famous lunar standstill alignments
    solarAxes:[50],
    lunarAxes:[196,224],
    stellarAxes:[],
    pillars:[40,50,60,200,220,240],
    climate:{severity:0.3,note:"North Atlantic Neolithic; gradual cooling over millennia."}
  },
  {
    key:"Rapa Nui (Ahu Tongariki)",
    label:"Rapa Nui – Tongariki",
    color:"#60a5fa",
    solarAxes:[118],
    lunarAxes:[],
    stellarAxes:[300],
    pillars:[110,118,126],
    climate:{severity:0.45,note:"Pacific ENSO-driven variability; later deforestation/human impact."}
  },
  {
    key:"Göbekli Tepe",
    label:"Göbekli Tepe (Türkiye)",
    color:"#facc15",
    solarAxes:[60],
    lunarAxes:[],
    stellarAxes:[210],
    pillars:[40,60,80,220,240],
    climate:{severity:0.35,note:"Early Holocene warming after Younger Dryas; stable enough for ritual building."}
  },
  {
    key:"Machu Picchu",
    label:"Machu Picchu (Peru)",
    color:"#34d399",
    solarAxes:[120,300],
    lunarAxes:[],
    stellarAxes:[150],
    pillars:[110,120,130,290,300,310],
    climate:{severity:0.4,note:"High Andean regime; local microclimate vs. broader glacial changes."}
  }
];

// Build overlay checkbox list
const overlaySiteList = document.getElementById("overlaySiteList");
const overlayLegend = document.getElementById("overlayLegend");
const layerSolar = document.getElementById("layerSolar");
const layerLunar = document.getElementById("layerLunar");
const layerStellar = document.getElementById("layerStellar");
const layerClimate = document.getElementById("layerClimate");

if (overlaySiteList){
  alignmentSites.forEach((site, idx) => {
    const row = document.createElement("label");
    row.className = "overlay-site-row";
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.id = "overlaySite_" + idx;
    cb.dataset.key = site.key;
    // Default: turn on first 3 sites to show something
    if (idx < 3) cb.checked = true;
    cb.addEventListener("change", drawAlignmentOverlay);

    const colorDot = document.createElement("span");
    colorDot.className = "overlay-color-dot";
    colorDot.style.backgroundColor = site.color;

    const text = document.createElement("span");
    text.textContent = site.label;

    row.appendChild(cb);
    row.appendChild(colorDot);
    row.appendChild(text);
    overlaySiteList.appendChild(row);
  });

  [layerSolar, layerLunar, layerStellar, layerClimate].forEach(ctrl => {
    if (ctrl) ctrl.addEventListener("change", drawAlignmentOverlay);
  });
}

// Draw the 0–360° wheel with N/E/S/W and overlays
function drawAlignmentOverlay(){
  const canvas = document.getElementById("alignmentCanvas");
  if (!canvas || !canvas.getContext) return;
  const ctx = canvas.getContext("2d");
  const w = canvas.width;
  const h = canvas.height;
  const cx = w/2;
  const cy = h/2;
  const R = Math.min(w,h)/2 - 20;

  ctx.clearRect(0,0,w,h);
  ctx.save();
  ctx.translate(cx,cy);

  // Outer circle
  ctx.beginPath();
  ctx.arc(0,0,R,0,Math.PI*2);
  ctx.strokeStyle = "rgba(148,163,184,0.9)";
  ctx.lineWidth = 1.3;
  ctx.stroke();

  // Radial grid every 30°
  ctx.strokeStyle = "rgba(51,65,85,0.95)";
  ctx.lineWidth = 0.5;
  for (let deg = 0; deg < 360; deg += 30){
    const rad = (deg - 90) * Math.PI / 180;
    const x = Math.cos(rad) * R;
    const y = Math.sin(rad) * R;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(x,y);
    ctx.stroke();
  }

  // Cardinal axes (N/E/S/W)
  ctx.strokeStyle = "rgba(191,219,254,0.95)";
  ctx.lineWidth = 1;
  [0,90,180,270].forEach(deg => {
    const rad = (deg - 90) * Math.PI / 180;
    const x = Math.cos(rad) * R;
    const y = Math.sin(rad) * R;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(x,y);
    ctx.stroke();
  });

  // Cardinal letters
  ctx.fillStyle = "#e5e7eb";
  ctx.font = "11px system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
  const labelOffset = 10;
  ctx.fillText("N", -4, -R - labelOffset);
  ctx.fillText("S", -3, R + labelOffset + 4);
  ctx.fillText("E", R + labelOffset, 3);
  ctx.fillText("W", -R - labelOffset - 10, 3);

  // Determine which sites & layers are active
  const solarOn = layerSolar && layerSolar.checked;
  const lunarOn = layerLunar && layerLunar.checked;
  const stellarOn = layerStellar && layerStellar.checked;
  const climateOn = layerClimate && layerClimate.checked;

  const activeSites = [];
  alignmentSites.forEach((site, idx) => {
    const cb = document.getElementById("overlaySite_" + idx);
    if (cb && cb.checked){
      activeSites.push(site);
    }
  });

  // Draw each selected site's layers
  activeSites.forEach(site => {
    // Solar axes (solid line)
    if (solarOn && site.solarAxes && site.solarAxes.length){
      ctx.strokeStyle = site.color;
      ctx.lineWidth = 1.7;
      ctx.setLineDash([]);
      site.solarAxes.forEach(deg => {
        const rad = (deg - 90) * Math.PI / 180;
        const x = Math.cos(rad) * R;
        const y = Math.sin(rad) * R;
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.lineTo(x,y);
        ctx.stroke();
      });
    }

    // Lunar axes (dashed line)
    if (lunarOn && site.lunarAxes && site.lunarAxes.length){
      ctx.strokeStyle = site.color;
      ctx.lineWidth = 1;
      ctx.setLineDash([4,3]);
      site.lunarAxes.forEach(deg => {
        const rad = (deg - 90) * Math.PI / 180;
        const x = Math.cos(rad) * R;
        const y = Math.sin(rad) * R;
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.lineTo(x,y);
        ctx.stroke();
      });
      ctx.setLineDash([]);
    }

    // Stellar axes (fine dotted line)
    if (stellarOn && site.stellarAxes && site.stellarAxes.length){
      ctx.strokeStyle = site.color;
      ctx.lineWidth = 0.9;
      ctx.setLineDash([2,3]);
      site.stellarAxes.forEach(deg => {
        const rad = (deg - 90) * Math.PI / 180;
        const x = Math.cos(rad) * R;
        const y = Math.sin(rad) * R;
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.lineTo(x,y);
        ctx.stroke();
      });
      ctx.setLineDash([]);
    }

    // Pillars / stones = dots near rim
    if (site.pillars && site.pillars.length){
      ctx.fillStyle = site.color;
      site.pillars.forEach(deg => {
        const rad = (deg - 90) * Math.PI / 180;
        const rDot = R - 10;
        const x = Math.cos(rad) * rDot;
        const y = Math.sin(rad) * rDot;
        ctx.beginPath();
        ctx.arc(x,y,3,0,Math.PI*2);
        ctx.fill();
      });
    }

    // Climate / catastrophe ring
    if (climateOn && site.climate && site.climate.severity){
      const s = Math.max(0.15, Math.min(1, site.climate.severity));
      const innerR = R * (0.25 + 0.45 * s);
      ctx.beginPath();
      ctx.arc(0,0,innerR,0,Math.PI*2);
      ctx.strokeStyle = site.color;
      ctx.globalAlpha = 0.22;
      ctx.lineWidth = 4;
      ctx.stroke();
      ctx.globalAlpha = 1;
    }
  });

  ctx.restore();

  // Legend text
  if (overlayLegend){
    overlayLegend.innerHTML = "";
    if (!activeSites.length){
      overlayLegend.textContent = "Select one or more sites to overlay their solar, lunar, stellar axes and climate bands.";
    } else {
      activeSites.forEach(site => {
        const row = document.createElement("div");
        row.className = "overlay-legend-row";
        const dot = document.createElement("span");
        dot.className = "overlay-color-dot";
        dot.style.backgroundColor = site.color;
        const label = document.createElement("span");
        label.textContent = site.label;
        row.appendChild(dot);
        row.appendChild(label);
        overlayLegend.appendChild(row);

        const note = document.createElement("div");
        note.className = "overlay-legend-note";
        const parts = [];
        if (site.solarAxes && site.solarAxes.length) parts.push("solar");
        if (site.lunarAxes && site.lunarAxes.length) parts.push("lunar");
        if (site.stellarAxes && site.stellarAxes.length) parts.push("stellar");
        if (site.climate && site.climate.note && layerClimate && layerClimate.checked){
          parts.push("climate: " + site.climate.note);
        }
        note.textContent = parts.join(" • ");
        overlayLegend.appendChild(note);
      });
    }
  }
}

// First draw after page ready
drawAlignmentOverlay();
</script>
</body>
</html>
