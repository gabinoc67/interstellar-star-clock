<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cosmic Catastrophe Hub â€” Cities Â· Volcanoes Â· Quakes Â· Meteors Â· Ice Cores</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #020617;
      color: #e5e7eb;
    }

    header {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(148,163,184,0.4);
      background: radial-gradient(circle at top left, #22c55e 0, #0f172a 45%, #000 100%);
      color: #e5e7eb;
    }

    header h1 {
      margin: 0 0 4px;
      font-size: 24px;
      letter-spacing: 0.04em;
    }

    header p {
      margin: 2px 0;
      font-size: 13px;
      color: #bbf7d0;
    }

    .muted {
      color: #9ca3af;
      font-size: 11px;
    }

    .mini {
      font-size: 11px;
    }

    .container {
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.7fr);
      gap: 16px;
      padding: 16px 20px 20px;
    }

    .panel {
      background: radial-gradient(circle at top, rgba(34,197,94,0.14), rgba(15,23,42,0.98));
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 18px 45px rgba(15,23,42,0.9);
      padding: 14px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .panel h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
    }

    .panel h2 span {
      font-size: 18px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 12px;
    }

    .controls label {
      font-size: 12px;
      color: #bbf7d0;
    }

    select, input[type="text"] {
      background: rgba(15,23,42,0.9);
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: #e5e7eb;
      padding: 4px 10px;
      font-size: 12px;
      outline: none;
    }

    select:focus, input[type="text"]:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.7);
    }

    input[type="text"] {
      min-width: 150px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
    }

    thead {
      position: sticky;
      top: 0;
      background: linear-gradient(to right, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
      z-index: 1;
    }

    th, td {
      padding: 6px 6px;
      text-align: left;
      border-bottom: 1px solid rgba(22,101,52,0.7);
    }

    th {
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #9ca3af;
    }

    tbody tr {
      cursor: pointer;
      transition: background 0.1s ease, transform 0.08s ease;
    }

    tbody tr:hover {
      background: rgba(34,197,94,0.18);
      transform: translateY(-0.5px);
    }

    tbody tr.active-row {
      background: radial-gradient(circle at left, rgba(52,211,153,0.32), rgba(15,23,42,0.95));
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 1px 7px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(148,163,184,0.8);
      color: #e5e7eb;
      background: rgba(15,23,42,0.85);
      white-space: nowrap;
    }

    .tag-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
    }

    .tag-city .tag-dot { background: #22c55e; }
    .tag-volcano .tag-dot { background: #ef4444; }
    .tag-quake .tag-dot { background: #0ea5e9; }
    .tag-meteor .tag-dot { background: #f97316; }

    .tag-scale-global .tag-dot { background: #f97316; }
    .tag-scale-regional .tag-dot { background: #22c55e; }
    .tag-scale-local .tag-dot { background: #e5e7eb; }

    .tag-ice-yes {
      border-color: rgba(96,165,250,0.9);
      color: #bfdbfe;
    }
    .tag-ice-possible {
      border-color: rgba(234,179,8,0.9);
      color: #facc15;
    }
    .tag-ice-no {
      border-color: rgba(148,163,184,0.9);
      color: #e5e7eb;
    }

    .tag-season {
      border-color: rgba(244,114,182,0.7);
      color: #f9a8d4;
    }

    .tag-pop {
      border-color: rgba(52,211,153,0.75);
      color: #a7f3d0;
    }

    .coords {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      color: #bbf7d0;
    }

    .details-header {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 4px;
    }

    .details-title {
      font-size: 17px;
      font-weight: 600;
    }

    .details-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 4px 0;
    }

    .details-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 10px;
      margin-top: 4px;
      font-size: 12px;
    }

    .details-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-bottom: 3px;
    }

    ul {
      padding-left: 16px;
      margin: 3px 0;
    }

    li {
      margin-bottom: 2px;
      line-height: 1.35;
    }

    .scroll {
      max-height: 410px;
      overflow: auto;
      margin: 0 -6px -6px;
      padding: 0 6px 1px;
    }

    @media (max-width: 960px) {
      .container {
        grid-template-columns: minmax(0, 1fr);
      }
      .scroll {
        max-height: 280px;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>Cosmic Catastrophe Hub</h1>
  <p>Unified view of ancient cities, volcanic eruptions, earthquakes & tsunamis, and meteor impacts
     â€” with ice-core evidence to confirm real climate change pulses.</p>
  <p class="muted mini">
    Ice cores (Greenland, Antarctica) record big sulfate spikes, dust and temperature changes.
    Here we flag events that have strong, possible, or no known ice-core climate signal.
  </p>
</header>

<div class="container">
  <section class="panel">
    <h2><span>ðŸ§®</span> Events</h2>
    <div class="controls">
      <label>
        Type:
        <select id="typeFilter">
          <option value="all">All types</option>
          <option value="city">Cities / cultures</option>
          <option value="volcano">Volcanoes</option>
          <option value="quake">Quakes / tsunamis</option>
          <option value="meteor">Meteors / impacts</option>
        </select>
      </label>

      <label>
        Impact scale:
        <select id="scaleFilter">
          <option value="all">All scales</option>
          <option value="Global">Global / hemispheric</option>
          <option value="Regional">Regional</option>
          <option value="Local">Local</option>
        </select>
      </label>

      <label>
        Ice-core signal:
        <select id="iceFilter">
          <option value="all">Any</option>
          <option value="yes">Strong / clear signal</option>
          <option value="possible">Possible / debated</option>
          <option value="no">No known signal</option>
        </select>
      </label>

      <label>
        Search:
        <input type="text" id="searchBox" placeholder="name, region, notesâ€¦">
      </label>
    </div>

    <div class="scroll">
      <table>
        <thead>
        <tr>
          <th>Event</th>
          <th>Type</th>
          <th>Scale</th>
          <th>Lat</th>
          <th>Lon</th>
          <th>Date / Age</th>
        </tr>
        </thead>
        <tbody id="eventTableBody"></tbody>
      </table>
    </div>
  </section>

  <section class="panel">
    <h2><span>ðŸ§­</span> Cosmic Clock Â· Ice Cores Â· People</h2>
    <div id="detailsContent">
      <p class="muted">
        Select an entry on the left to see:
      </p>
      <ul class="muted">
        <li>Latitude, hemisphere and latitude band (cosmic clock position)</li>
        <li>Approximate date or age (city use period, eruption date, quake time, impact age)</li>
        <li>Whether ice cores show a climate change pulse near that time (YES / POSSIBLE / NO)</li>
        <li>Effects on climate and on nearby cities / populations (migration, famine, collapse, etc.)</li>
      </ul>
    </div>
  </section>
</div>

<script>
  // ---------- Helpers ----------
  function latBand(lat) {
    const a = Math.abs(lat);
    if (a < 10) return "Equatorial band (0â€“10Â°)";
    if (a < 23.5) return "Tropical band (10â€“23.5Â°)";
    if (a < 40) return "Subtropical / warm mid-latitudes (23.5â€“40Â°)";
    if (a < 60) return "Mid-latitudes (40â€“60Â°)";
    return "High-latitude / polar (60Â°+)";
  }

  function inferSeason(lat, month, explicitSeasonHint) {
    if (explicitSeasonHint) return explicitSeasonHint;
    if (!month || month < 1 || month > 12) return "Season unknown (month not well constrained)";

    const north = [
      "Winter","Winter","Spring","Spring","Spring",
      "Summer","Summer","Summer","Autumn","Autumn","Autumn","Winter"
    ];
    const south = [
      "Summer","Summer","Autumn","Autumn","Autumn",
      "Winter","Winter","Winter","Spring","Spring","Spring","Summer"
    ];
    const idx = month - 1;
    const hemiNorth = lat >= 0;
    const s = hemiNorth ? north[idx] : south[idx];
    return s + " (approximate, based on month & hemisphere)";
  }

  function typeTagClass(t) {
    if (t === "city") return "tag tag-city";
    if (t === "volcano") return "tag tag-volcano";
    if (t === "quake") return "tag tag-quake";
    if (t === "meteor") return "tag tag-meteor";
    return "tag";
  }

  function scaleTagClass(scale) {
    if (scale === "Global") return "tag tag-scale-global";
    if (scale === "Regional") return "tag tag-scale-regional";
    return "tag tag-scale-local";
  }

  function iceTagClass(flag) {
    if (flag === "yes") return "tag tag-ice-yes";
    if (flag === "possible") return "tag tag-ice-possible";
    return "tag tag-ice-no";
  }

  function iceLabel(flag) {
    if (flag === "yes") return "Strong ice-core support (sulfate / temp signal)";
    if (flag === "possible") return "Possible / debated ice-core match";
    return "No clear ice-core signal known";
  }

  // ---------- Dataset ----------
  // Common schema:
  // id, name, type, region, lat, lon, scale, dateText, month, explicitSeasonHint,
  // datingMethod, climateImpact, humanImpact, populationEffectFlag,
  // nearbySettlements, notes, iceCoreFlag ("yes"/"possible"/"no"), iceCoreNotes
  const events = [
    // --- Cities / cultures (a couple of examples, you can extend with your full city list) ---
    {
      id: "gobekli",
      name: "GÃ¶bekli Tepe (main use phase)",
      type: "city",
      region: "Upper Mesopotamia, TÃ¼rkiye",
      lat: 37.2232,
      lon: 38.9223,
      scale: "Regional",
      dateText: "â‰ˆ9600â€“8000 BCE",
      month: null,
      explicitSeasonHint: null,
      datingMethod: "Radiocarbon dating of organic remains and stratigraphy.",
      climateImpact: "Built during early Holocene warming after the last glacial period; no known single catastrophe.",
      nearbySettlements: "Hunter-gatherer groups in the Euphrates headwaters region.",
      humanImpact: "Represents a major symbolic/ritual center; later intentionally buried or abandoned as agriculture spread.",
      populationEffectFlag: true,
      notes: "Interesting to compare with end of Younger Dryas cooling in ice cores, but the site itself is not a climate catastrophe.",
      iceCoreFlag: "possible",
      iceCoreNotes: "Chronology overlaps with the end of the Younger Dryas in ice cores, but no single spike specifically â€˜fromâ€™ GÃ¶bekli Tepe."
    },
    {
      id: "akrotiri_city",
      name: "Akrotiri (Thera/Santorini) destruction",
      type: "city",
      region: "Santorini, Aegean Sea, Greece",
      lat: 36.3580,
      lon: 25.4010,
      scale: "Regional",
      dateText: "â‰ˆ1600â€“1500 BCE (Minoan eruption)",
      month: null,
      explicitSeasonHint: null,
      datingMethod: "Radiocarbon, tephra layers, Aegean/Egyptian synchronisms.",
      climateImpact: "Likely regional cooling and crop disruption; not a huge global signal compared to larger eruptions.",
      nearbySettlements: "Akrotiri, coastal Minoan sites on Crete and nearby islands.",
      humanImpact: "City buried in ash; tsunamis and ashfall damaged Aegean coastal communities, contributing to stress on Minoan civilization.",
      populationEffectFlag: true,
      notes: "Useful for comparing city collapse to regional volcano and modest climate changes.",
      iceCoreFlag: "possible",
      iceCoreNotes: "Some candidates for tephra in Greenland ice, but association and exact date are still debated."
    },

    // --- Volcanoes (with strong or suspected ice core links) ---
    {
      id: "toba",
      name: "Youngest Toba supereruption",
      type: "volcano",
      region: "Toba, Sumatra, Indonesia",
      lat: 2.6845,
      lon: 98.8756,
      scale: "Global",
      dateText: "â‰ˆ74,000 years ago",
      month: null,
      explicitSeasonHint: null,
      datingMethod: "Tephrochronology, radiometric dating, ice cores and marine sediments.",
      climateImpact: "Likely multi-year global cooling and major environmental stress (â€˜volcanic winterâ€™).",
      nearbySettlements: "Early Homo sapiens populations, especially in South Asia.",
      humanImpact: "Proposed human population bottleneck (severity debated).",
      populationEffectFlag: true,
      notes: "Anchor point for extreme volcanic forcing in your cosmic clock.",
      iceCoreFlag: "yes",
      iceCoreNotes: "Correlated with tephra and chemical signatures in long ice-core and sediment records."
    },
    {
      id: "tambora",
      name: "1815 Mount Tambora eruption",
      type: "volcano",
      region: "Sumbawa, Indonesia",
      lat: -8.25,
      lon: 118.0,
      scale: "Global",
      dateText: "10â€“11 April 1815",
      month: 4,
      explicitSeasonHint: null,
      datingMethod: "Historical records, ice cores, tree rings, climate data.",
      climateImpact: "Triggered the â€˜Year Without a Summerâ€™ (1816) with global cooling and crop failures.",
      nearbySettlements: "Sumbawa villages, Lombok and neighboring islands.",
      humanImpact: "Tens of thousands killed locally; widespread famine and migration in Europe and North America.",
      populationEffectFlag: true,
      notes: "Gold-standard example of a volcanic event you can see in ice cores and human history at the same time.",
      iceCoreFlag: "yes",
      iceCoreNotes: "Large sulfate spike in Greenland and Antarctic ice cores around 1815â€“1816."
    },
    {
      id: "samalas",
      name: "1257 Samalas eruption",
      type: "volcano",
      region: "Lombok, Indonesia",
      lat: -8.39,
      lon: 116.47,
      scale: "Global",
      dateText: "â‰ˆ1257 CE",
      month: null,
      explicitSeasonHint: null,
      datingMethod: "Ice cores, radiocarbon, historical and geological evidence.",
      climateImpact: "Major global cooling; one of the strongest sulfate spikes of the last 2000 years.",
      nearbySettlements: "Local populations in Lombok and nearby islands.",
      humanImpact: "Likely severe agricultural stress and famines across Eurasia.",
      populationEffectFlag: true,
      notes: "Huge marker eruption for Medieval climate anomalies.",
      iceCoreFlag: "yes",
      iceCoreNotes: "Strong, well-dated sulfate signal in multiple ice cores around 1257 CE."
    },
    {
      id: "pinatubo",
      name: "1991 Mount Pinatubo eruption",
      type: "volcano",
      region: "Luzon, Philippines",
      lat: 15.13,
      lon: 120.35,
      scale: "Global",
      dateText: "15 June 1991",
      month: 6,
      explicitSeasonHint: null,
      datingMethod: "Satellites, aerosols, climate measurements.",
      climateImpact: "Global cooling (~0.5Â°C for a couple of years).",
      nearbySettlements: "Clark Air Base, towns in Zambales, Tarlac and Pampanga.",
      humanImpact: "Hundreds killed, large long-term resettlements due to lahars.",
      populationEffectFlag: true,
      notes: "Modern calibration case for volcanic radiative forcing.",
      iceCoreFlag: "yes",
      iceCoreNotes: "Recognizable sulfate layer in polar ice cores dated to early 1990s."
    },

    // --- Quakes & tsunamis ---
    {
      id: "indianocean2004",
      name: "2004 Indian Ocean earthquake & tsunami",
      type: "quake",
      region: "Off Sumatra, Indonesia",
      lat: 3.32,
      lon: 95.85,
      scale: "Global",
      dateText: "26 December 2004",
      month: 12,
      explicitSeasonHint: null,
      datingMethod: "Seismic, GPS, tsunami and satellite data.",
      climateImpact: "No climate shift; but ocean-basin tsunami and huge social/economic impact.",
      nearbySettlements: "Aceh, coastal Thailand, Sri Lanka, India, Maldives, East Africa.",
      humanImpact: "â‰ˆ230,000 deaths; millions displaced; long-term migration and reconstruction.",
      populationEffectFlag: true,
      notes: "Critical example of non-climatic but globally important catastrophe.",
      iceCoreFlag: "no",
      iceCoreNotes: "No significant global climate anomaly visible in ice-core records from this event."
    },
    {
      id: "lisbon1755",
      name: "1755 Lisbon earthquake & tsunami",
      type: "quake",
      region: "Offshore Portugal, NE Atlantic",
      lat: 38.72,
      lon: -9.14,
      scale: "Global",
      dateText: "1 November 1755",
      month: 11,
      explicitSeasonHint: null,
      datingMethod: "Historical and tsunami records, geological modeling.",
      climateImpact: "No climate change; strong Atlantic tsunami and global philosophical impact.",
      nearbySettlements: "Lisbon, CÃ¡diz, other Atlantic coasts; waves across the Atlantic.",
      humanImpact: "Tens of thousands killed; major rebuilding of Lisbon; influenced thinking about natural disasters.",
      populationEffectFlag: true,
      notes: "Good comparison with volcanic/global events to show: big human disaster, but no ice-core pulse.",
      iceCoreFlag: "no",
      iceCoreNotes: "No distinct sulfate or temperature signal associated with this seismic event."
    },
    {
      id: "cascadia1700",
      name: "1700 Cascadia megathrust",
      type: "quake",
      region: "Pacific Northwest, North America",
      lat: 45.0,
      lon: -125.0,
      scale: "Global",
      dateText: "26 January 1700",
      month: 1,
      explicitSeasonHint: null,
      datingMethod: "Tree rings, drowned forests, Japanese tsunami records.",
      climateImpact: "No global climate effect; Pacific-wide tsunami.",
      nearbySettlements: "Coastal Indigenous communities in NW North America; Japanese coastal towns.",
      humanImpact: "Local deaths and relocations; preserved in Indigenous oral histories.",
      populationEffectFlag: true,
      notes: "Beautiful example of linking oral tradition and written records without climate impact.",
      iceCoreFlag: "no",
      iceCoreNotes: "No distinct ice-core climate change layer tied directly to this quake."
    },

    // --- Meteors / impacts ---
    {
      id: "chicxulub",
      name: "Chicxulub impact (Kâ€“Pg extinction)",
      type: "meteor",
      region: "YucatÃ¡n Peninsula, Mexico",
      lat: 21.33,
      lon: -89.50,
      scale: "Global",
      dateText: "â‰ˆ66 million years ago",
      month: null,
      explicitSeasonHint: "Spring in Northern Hemisphere (inferred from Tanis fish fossils)",
      datingMethod: "High-precision radiometric dating of ejecta and global boundary clay.",
      climateImpact: "Global â€˜impact winterâ€™ with drastic cooling and darkness; mass extinction (~75% of species).",
      nearbySettlements: "No humans yet; ecosystems worldwide affected.",
      humanImpact: "Cleared ecological space for mammals and, eventually, humans.",
      populationEffectFlag: false,
      notes: "Ultimate deep-time anchor for impact catastrophes in your model.",
      iceCoreFlag: "no",
      iceCoreNotes: "Far older than existing ice cores (which only go back ~800,000 years); evidence comes from rocks, not ice."
    },
    {
      id: "tunguska",
      name: "1908 Tunguska airburst",
      type: "meteor",
      region: "Siberia, Russia",
      lat: 60.9,
      lon: 101.9,
      scale: "Regional",
      dateText: "30 June 1908",
      month: 6,
      explicitSeasonHint: null,
      datingMethod: "Eyewitness accounts, tree rings, seismic and atmospheric data.",
      climateImpact: "Short-lived atmospheric effects; no measurable long-term climate change.",
      nearbySettlements: "Sparse population; flattened ~2,000 kmÂ² of forest.",
      humanImpact: "Very few direct casualties; a modern demonstration of what could happen to a city.",
      populationEffectFlag: true,
      notes: "Good comparison case vs Chelyabinsk, and vs true climate-changing impacts.",
      iceCoreFlag: "no",
      iceCoreNotes: "Does not produce a strong sulfate or temperature anomaly in ice cores."
    },

    // --- Volcanoes & quakes with uncertain / subtle signals (possible) ---
    {
      id: "huaynaputina",
      name: "1600 Huaynaputina eruption",
      type: "volcano",
      region: "Southern Peru, Andes",
      lat: -16.61,
      lon: -70.85,
      scale: "Global",
      dateText: "19 February 1600",
      month: 2,
      explicitSeasonHint: null,
      datingMethod: "Historical accounts, tephra mapping, radiocarbon and ice-core correlation.",
      climateImpact: "Cool summers and harsh winters in early 1600s; crop failures especially in Europe and Russia.",
      nearbySettlements: "Andean villages and agriculture.",
      humanImpact: "Severe famines and social crises; local depopulation in some areas.",
      populationEffectFlag: true,
      notes: "Shows connection between tropical eruptions and Northern Hemisphere food stress.",
      iceCoreFlag: "yes",
      iceCoreNotes: "Strong candidate for large sulfate spikes seen in ice cores around 1600 CE."
    },
    {
      id: "laki",
      name: "1783â€“1784 Laki fissure eruption",
      type: "volcano",
      region: "Iceland",
      lat: 64.0,
      lon: -17.0,
      scale: "Global",
      dateText: "June 1783 â€“ February 1784",
      month: 6,
      explicitSeasonHint: null,
      datingMethod: "Historical observations, ice cores, geologic fieldwork.",
      climateImpact: "Regional cooling and haze; crop failures in Europe; possible wider disruptions.",
      nearbySettlements: "Icelandic farms and towns; impacts reported as far as Europe.",
      humanImpact: "Mass livestock deaths and human famine in Iceland; respiratory and crop effects across Europe.",
      populationEffectFlag: true,
      notes: "Key example of huge SOâ‚‚ release in high latitudes.",
      iceCoreFlag: "yes",
      iceCoreNotes: "Distinct sulfate layers in Greenland ice around 1783â€“84."
    },
    {
      id: "hunga_tonga_2022",
      name: "2022 Hunga Tongaâ€“Hunga HaÊ»apai eruption",
      type: "volcano",
      region: "Tonga, SW Pacific",
      lat: -20.55,
      lon: -175.39,
      scale: "Global",
      dateText: "15 January 2022",
      month: 1,
      explicitSeasonHint: null,
      datingMethod: "Satellites, infrasound, atmospheric sensors.",
      climateImpact: "Injected record-breaking water vapor into the stratosphere; long-term climate effect still being studied.",
      nearbySettlements: "Tongan islands and coastal infrastructure.",
      humanImpact: "Tsunami and ash damage; communication and infrastructure loss.",
      populationEffectFlag: true,
      notes: "Future ice-core layers will likely record this event as a water-rich anomaly.",
      iceCoreFlag: "possible",
      iceCoreNotes: "Too recent to be fully resolved in long ice-core time series yet."
    }
  ];

  // ---------- UI wiring ----------
  const tbody = document.getElementById("eventTableBody");
  const detailsContent = document.getElementById("detailsContent");
  const typeFilter = document.getElementById("typeFilter");
  const scaleFilter = document.getElementById("scaleFilter");
  const iceFilter = document.getElementById("iceFilter");
  const searchBox = document.getElementById("searchBox");

  function renderTable() {
    const t = typeFilter.value;
    const s = scaleFilter.value;
    const ice = iceFilter.value;
    const q = (searchBox.value || "").toLowerCase();

    tbody.innerHTML = "";

    const filtered = events.filter(ev => {
      if (t !== "all" && ev.type !== t) return false;
      if (s !== "all" && ev.scale !== s) return false;
      if (ice !== "all" && ev.iceCoreFlag !== ice) return false;

      if (q) {
        const hay = (ev.name + " " + ev.region + " " + ev.notes).toLowerCase();
        if (!hay.includes(q)) return false;
      }
      return true;
    });

    filtered.forEach(ev => {
      const tr = document.createElement("tr");
      tr.dataset.id = ev.id;

      const tdName = document.createElement("td");
      tdName.textContent = ev.name;

      const tdType = document.createElement("td");
      const spanType = document.createElement("span");
      spanType.className = typeTagClass(ev.type);
      const dot = document.createElement("span");
      dot.className = "tag-dot";
      const label = document.createElement("span");
      label.textContent = ev.type.charAt(0).toUpperCase() + ev.type.slice(1);
      spanType.appendChild(dot);
      spanType.appendChild(label);
      tdType.appendChild(spanType);

      const tdScale = document.createElement("td");
      const spanScale = document.createElement("span");
      spanScale.className = scaleTagClass(ev.scale);
      const dotS = document.createElement("span");
      dotS.className = "tag-dot";
      const labelS = document.createElement("span");
      labelS.textContent = ev.scale;
      spanScale.appendChild(dotS);
      spanScale.appendChild(labelS);
      tdScale.appendChild(spanScale);

      const tdLat = document.createElement("td");
      tdLat.textContent = ev.lat.toFixed(2);

      const tdLon = document.createElement("td");
      tdLon.textContent = ev.lon.toFixed(2);

      const tdDate = document.createElement("td");
      tdDate.textContent = ev.dateText;

      tr.appendChild(tdName);
      tr.appendChild(tdType);
      tr.appendChild(tdScale);
      tr.appendChild(tdLat);
      tr.appendChild(tdLon);
      tr.appendChild(tdDate);

      tr.addEventListener("click", () => {
        document.querySelectorAll("#eventTableBody tr").forEach(r => r.classList.remove("active-row"));
        tr.classList.add("active-row");
        renderDetails(ev);
      });

      tbody.appendChild(tr);
    });

    if (!filtered.length) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 6;
      td.className = "muted";
      td.textContent = "No events match the current filters.";
      tr.appendChild(td);
      tbody.appendChild(tr);
    }
  }

  function renderDetails(ev) {
    const hemisphere = ev.lat >= 0 ? "Northern" : "Southern";
    const band = latBand(ev.lat);
    const season = inferSeason(ev.lat, ev.month, ev.explicitSeasonHint);
    const iceClass = iceTagClass(ev.iceCoreFlag);
    const iceText = iceLabel(ev.iceCoreFlag);

    const popTag = ev.populationEffectFlag
      ? `<span class="tag tag-pop"><span class="tag-dot" style="background:#22c55e;"></span><span>Strong population impact</span></span>`
      : `<span class="tag tag-pop"><span class="tag-dot" style="background:#4b5563;"></span><span>Limited population impact</span></span>`;

    const typeTag = `
      <div class="${typeTagClass(ev.type)}">
        <span class="tag-dot"></span>
        <span>${ev.type.charAt(0).toUpperCase() + ev.type.slice(1)}</span>
      </div>`;

    const scaleTag = `
      <div class="${scaleTagClass(ev.scale)}">
        <span class="tag-dot"></span>
        <span>${ev.scale} impact scale</span>
      </div>`;

    const seasonTag = `
      <span class="tag tag-season">
        <span class="tag-dot" style="background:#f472b6;"></span>
        <span>${season}</span>
      </span>`;

    const iceTag = `
      <span class="${iceClass}">
        <span class="tag-dot" style="background:#60a5fa;"></span>
        <span>${iceText}</span>
      </span>`;

    detailsContent.innerHTML = `
      <div class="details-header">
        <div class="details-title">${ev.name}</div>
        <div class="details-subtitle">${ev.region}</div>
        <div class="coords">Lat ${ev.lat.toFixed(4)}Â°, Lon ${ev.lon.toFixed(4)}Â° (${hemisphere} Hemisphere)</div>
      </div>

      <div class="pill-row">
        ${typeTag}
        ${scaleTag}
        ${seasonTag}
        ${iceTag}
        ${popTag}
      </div>

      <div class="details-grid">
        <div>
          <div class="details-section-title">Cosmic Clock Position</div>
          <ul>
            <li><strong>Latitude band:</strong> ${band}</li>
            <li><strong>Hemisphere:</strong> ${hemisphere} Hemisphere</li>
            <li><strong>Season inference:</strong> ${season}</li>
          </ul>

          <div class="details-section-title">Dating &amp; Chronology</div>
          <ul>
            <li><strong>Date / age used:</strong> ${ev.dateText}</li>
            <li><strong>Dating methods:</strong> ${ev.datingMethod}</li>
          </ul>
        </div>

        <div>
          <div class="details-section-title">Climate, Ice Cores &amp; People</div>
          <ul>
            <li><strong>Climate impact:</strong> ${ev.climateImpact}</li>
            <li><strong>Ice-core notes:</strong> ${ev.iceCoreNotes}</li>
            <li><strong>Nearby cities / populations:</strong> ${ev.nearbySettlements}</li>
            <li><strong>Human impact:</strong> ${ev.humanImpact}</li>
          </ul>

          <div class="details-section-title">Notes</div>
          <p class="mini">${ev.notes}</p>
        </div>
      </div>

      <p class="muted mini" style="margin-top:6px;">
        Use this hub to hunt for coincidences: when a city decline or migration overlaps a strong ice-core spike
        from a volcano, or when a big tsunami or meteor sits in a quiet ice-core period. Thatâ€™s your
        <strong>evidence filter</strong> to separate real climate catastrophes from local disasters.
      </p>
    `;
  }

  // Filters wiring
  typeFilter.addEventListener("change", renderTable);
  scaleFilter.addEventListener("change", renderTable);
  iceFilter.addEventListener("change", renderTable);
  searchBox.addEventListener("input", renderTable);

  // Initial render
  renderTable();
</script>
</body>
</html>
