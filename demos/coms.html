<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>CST Warp vs Fluorescent Comms – Planet Domes</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#020617;
    --panel:#02091b;
    --panel-alt:#040f26;
    --accent:#38bdf8;
    --accent-soft:#0ea5e9;
    --ink:#e5e7eb;
    --muted:#9ca3af;
    --danger:#f97373;
    --good:#22c55e;
    --border:#1f2937;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:radial-gradient(circle at top,#0f172a 0,#020617 55%);
    color:var(--ink);
    min-height:100vh;
    padding:16px;
  }
  .wrap{
    max-width:1100px;
    margin:0 auto;
  }
  h1{
    font-size:24px;
    letter-spacing:.08em;
    text-transform:uppercase;
    color:#e5f2ff;
    margin-bottom:4px;
  }
  .subtitle{
    font-size:13px;
    color:var(--muted);
    margin-bottom:16px;
  }
  .grid{
    display:grid;
    grid-template-columns: minmax(0, 360px) minmax(0, 1fr);
    gap:16px;
  }
  .panel{
    background:linear-gradient(145deg,var(--panel),var(--panel-alt));
    border-radius:18px;
    border:1px solid var(--border);
    padding:14px 16px 16px;
    box-shadow:0 18px 40px rgba(0,0,0,.7);
    margin-top:10px;
  }
  .panel h2{
    font-size:14px;
    text-transform:uppercase;
    letter-spacing:.14em;
    color:var(--muted);
    margin-bottom:8px;
  }
  .badge-row{
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:10px;
    flex-wrap:wrap;
  }
  .badge{
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:.12em;
    padding:3px 8px;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.6);
    color:var(--muted);
  }
  .badge.hot{
    border-color:var(--accent-soft);
    color:var(--accent-soft);
    background:radial-gradient(circle at top,var(--accent-soft)22%,transparent 60%);
    box-shadow:0 0 12px rgba(56,189,248,.45);
  }

  .mode-toggle{
    display:flex;
    gap:8px;
    margin-bottom:12px;
  }
  .mode-btn{
    flex:1;
    font-size:12px;
    letter-spacing:.08em;
    text-transform:uppercase;
    padding:6px 8px;
    border-radius:999px;
    border:1px solid var(--border);
    background:rgba(15,23,42,.8);
    color:var(--muted);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    transition:.16s all ease-out;
  }
  .mode-btn span.dot{
    width:8px;height:8px;border-radius:50%;
    background:var(--muted);
    box-shadow:0 0 0 1px rgba(148,163,184,.3);
  }
  .mode-btn.active{
    border-color:var(--accent-soft);
    color:var(--accent);
    box-shadow:0 0 16px rgba(56,189,248,.5);
    background:radial-gradient(circle at top,var(--accent-soft)20%,rgba(15,23,42,.96) 70%);
  }
  .mode-btn.active span.dot{
    background:var(--accent);
    box-shadow:0 0 8px rgba(56,189,248,.9);
  }
  .mode-btn.danger.active span.dot{
    background:var(--danger);
    box-shadow:0 0 9px rgba(248,113,113,.9);
  }

  .field{
    margin-bottom:10px;
  }
  .field label{
    display:flex;
    justify-content:space-between;
    font-size:12px;
    color:var(--muted);
    margin-bottom:3px;
  }
  .field label span.value{
    color:var(--accent);
  }
  input[type="number"],
  select{
    width:100%;
    padding:6px 8px;
    border-radius:10px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--ink);
    font-size:13px;
  }
  input[type="range"]{
    width:100%;
  }
  .inline{
    display:flex;
    gap:8px;
  }
  .inline > .field{
    flex:1;
  }
  .note{
    font-size:11px;
    color:var(--muted);
    margin-top:2px;
  }
  .status-bar{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    align-items:center;
    margin-top:8px;
    padding-top:6px;
    border-top:1px solid rgba(15,23,42,.9);
    font-size:11px;
    color:var(--muted);
  }
  .pill{
    padding:2px 8px;
    border-radius:999px;
    border:1px solid var(--border);
  }
  .pill.good{border-color:var(--good);color:var(--good);}
  .pill.warn{border-color:var(--accent-soft);color:var(--accent-soft);}
  .pill.bad{border-color:var(--danger);color:var(--danger);}

  button.send{
    width:100%;
    margin-top:8px;
    padding:8px 10px;
    border-radius:999px;
    border:none;
    font-size:13px;
    letter-spacing:.12em;
    text-transform:uppercase;
    cursor:pointer;
    background:linear-gradient(to right,var(--accent-soft),#22c55e);
    color:#0b1120;
    font-weight:600;
    box-shadow:0 12px 30px rgba(34,197,94,.4);
    transition:.12s transform ease-out,.12s box-shadow ease-out;
  }
  button.send:hover{
    transform:translateY(-1px);
    box-shadow:0 16px 40px rgba(56,189,248,.45);
  }
  button.send:active{
    transform:translateY(0);
    box-shadow:0 10px 24px rgba(15,23,42,.8);
  }

  button.reset{
    width:100%;
    margin-top:10px;
    padding:7px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    font-size:12px;
    letter-spacing:.12em;
    text-transform:uppercase;
    cursor:pointer;
    background:#020617;
    color:var(--muted);
  }
  button.reset:hover{
    border-color:var(--danger);
    color:var(--danger);
  }

  /* Log panel */
  .log{
    font-family: "JetBrains Mono","SF Mono",Menlo,Consolas,monospace;
    font-size:11px;
    background:radial-gradient(circle at top,#020617,#000);
    border-radius:14px;
    border:1px solid var(--border);
    padding:10px;
    height:380px;
    overflow:auto;
  }
  .log-line{
    padding:4px 0;
    border-bottom:1px dashed rgba(31,41,55,.6);
  }
  .log-line:last-child{
    border-bottom:none;
  }
  .log-line span.tag{
    color:var(--accent-soft);
  }
  .log-line span.mode-public{
    color:#facc15;
  }
  .log-line span.mode-secure{
    color:#22c55e;
  }
  .log-line span.mode-lamp{
    color:#f97316;
  }
  .log-line span.time{
    color:var(--muted);
  }
  .log-line span.latency{
    color:#a5b4fc;
  }
  .log-line span.target{
    color:#a7f3d0;
  }

  .ts-row{
    font-size:11px;
    color:var(--muted);
    margin-bottom:8px;
  }
  .ts-row strong{color:var(--ink);}

  .compare-text{
    font-size:12px;
    color:var(--muted);
    margin-bottom:6px;
    line-height:1.4;
  }
  .compare-highlight{
    color:#f97316;
    font-weight:600;
  }

  /* Visualization lanes */
  .viz{
    margin-top:10px;
    padding:8px 10px;
    border-radius:12px;
    border:1px solid rgba(15,23,42,.9);
    background:radial-gradient(circle at top,#020617,#020617);
  }
  .viz-caption{
    font-size:11px;
    color:var(--muted);
    margin-bottom:4px;
  }
  .viz-lane{
    position:relative;
    height:70px;
    margin-top:4px;
  }
  .viz-path{
    position:absolute;
    left:40px;
    right:40px;
    top:50%;
    height:2px;
    background:linear-gradient(to right,rgba(148,163,184,.35),rgba(148,163,184,.1));
  }
  .viz-endpoint{
    position:absolute;
    top:8px;
    font-size:11px;
    color:var(--muted);
  }
  .viz-endpoint.left{
    left:10px;
    text-align:left;
  }
  .viz-endpoint.right{
    right:10px;
    text-align:right;
  }

  .burst-dot{
    position:absolute;
    left:40px;
    width:12px;
    height:12px;
    border-radius:50%;
    opacity:0;
    transform:translate(-50%,-50%);
  }
  .warp-burst-big{
    top:32px;
    width:18px;
    height:18px;
    background:radial-gradient(circle,#38bdf8,#0f172a);
    box-shadow:0 0 16px rgba(56,189,248,.9);
  }
  .warp-burst-small{
    top:48px;
    background:radial-gradient(circle,#22c55e,#0f172a);
    box-shadow:0 0 10px rgba(34,197,94,.8);
  }
  .lamp-burst-bright{
    top:32px;
    width:18px;
    height:18px;
    background:radial-gradient(circle,#facc15,#0f172a);
    box-shadow:0 0 18px rgba(250,204,21,.95);
  }
  .lamp-burst-dim{
    top:48px;
    background:radial-gradient(circle,rgba(248,250,252,.6),#020617);
    box-shadow:0 0 6px rgba(148,163,184,.7);
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>CST WARP VS FLUORESCENT COMMS – PLANET DOMES</h1>
  <div class="subtitle">
    From Earth Dome / Ship to Selected Planet Dome • Top: RF Bursts Inside Warp Bubble • Bottom: Fluorescent / Normal Light Signals (No Warp) • Compare Arrival Times and Visual Bursts A → B
  </div>

  <!-- Global target planet selector -->
  <div class="panel">
    <h2>Target Dome Selection</h2>
    <div class="badge-row">
      <div class="badge hot">Origin: Earth Dome / Ship</div>
      <div class="badge">Destination: Selected Planet Dome</div>
    </div>
    <div class="field">
      <label>
        <span>Target Planet Dome</span>
      </label>
      <select id="targetPlanet">
        <option value="Mercury">Mercury Dome</option>
        <option value="Venus">Venus Dome</option>
        <option value="Mars" selected>Mars Dome</option>
        <option value="Jupiter">Jupiter Dome</option>
        <option value="Saturn">Saturn Dome</option>
        <option value="Uranus">Uranus Dome</option>
        <option value="Neptune">Neptune Dome</option>
        <option value="Pluto">Pluto Dome</option>
      </select>
      <div class="note">
        Planet selection automatically sets the approximate one-way **normal light-time** for Earth → Planet in minutes.
      </div>
    </div>
  </div>

  <!-- TOP: Warp Comms Grid -->
  <div class="grid">
    <!-- LEFT: Warp Control Panel -->
    <div class="panel">
      <h2>Warp RF Burst – Mode & Burst Configuration</h2>
      <div class="badge-row">
        <div class="badge hot">CST-Locked Warp Corridor</div>
        <div class="badge">RF Bursts Inside Bubble</div>
        <div class="badge">From Earth Dome to Target Dome</div>
      </div>

      <!-- Mode toggle -->
      <div class="mode-toggle">
        <button class="mode-btn danger active" id="modePublic">
          <span class="dot"></span>
          Distress / Public<br>
          <small style="font-size:10px; text-transform:none; letter-spacing:0;">
            No entanglement • Any nearby ship or dome may receive
          </small>
        </button>
        <button class="mode-btn" id="modeSecure">
          <span class="dot"></span>
          Secure / Command<br>
          <small style="font-size:10px; text-transform:none; letter-spacing:0;">
            Entanglement authentication • Only trusted endpoints
          </small>
        </button>
      </div>

      <!-- Burst level -->
      <div class="field">
        <label>
          <span>Burst Level (Warp RF Intensity / Duration)</span>
          <span class="value" id="burstLevelLabel">5</span>
        </label>
        <input type="range" min="1" max="10" value="5" id="burstLevel" />
        <div class="note">1 = low-intensity ping • 10 = maximum-intensity warp burst</div>
      </div>

      <!-- K factor and normal light-time -->
      <div class="inline">
        <div class="field">
          <label>
            <span>Warp Compression Factor <small>(K)</small></span>
            <span class="value" id="kLabel">10×</span>
          </label>
          <input type="number" id="kFactor" min="1" step="1" value="10" />
          <div class="note">K = 1 → no warp · K > 1 → spacetime path shortened for the RF burst</div>
        </div>
        <div class="field">
          <label>
            <span>Normal Light-Time (min)</span>
            <span class="value" id="normalDelayLabel">22</span>
          </label>
          <input type="number" id="normalDelay" min="0.1" step="0.5" value="22" />
          <div class="note">Auto-set from target planet, but you can override to test other scenarios.</div>
        </div>
      </div>

      <!-- CST timestamp preview & predicted arrival -->
      <div class="ts-row" id="tsRow">
        <strong>CST Timestamp (sim):</strong> <span id="cstNow">--</span><br>
        <strong>Predicted Warp Arrival:</strong> <span id="arrivalPreview">--</span>
      </div>

      <!-- Visualization: Warp bursts from A to B -->
      <div class="viz">
        <div class="viz-caption">Warp RF Bursts Inside Bubble – Big Burst and Small Burst Moving A → B</div>
        <div class="viz-lane">
          <div class="viz-path"></div>
          <div class="viz-endpoint left">Earth Dome / Ship</div>
          <div class="viz-endpoint right" id="warpTargetLabel">Mars Dome</div>
          <div class="burst-dot warp-burst-big" id="warpBurstBig"></div>
          <div class="burst-dot warp-burst-small" id="warpBurstSmall"></div>
        </div>
      </div>

      <button class="send" id="sendBtn">Send Warp RF Burst</button>

      <div class="status-bar">
        <div class="pill warn" id="modeStatus">Mode: Distress / Public</div>
        <div class="pill" id="secStatus">Quantum Auth: OFF</div>
        <div class="pill" id="latencyStatus">Warp Latency: --</div>
      </div>
    </div>

    <!-- RIGHT: Event Log -->
    <div class="panel">
      <h2>Event Log – Ship / Dome Link</h2>
      <div class="log" id="logBox">
        <!-- Log lines injected here -->
      </div>
    </div>
  </div>

  <!-- BOTTOM: Fluorescent / Normal Light Comms Panel -->
  <div class="panel">
    <h2>Fluorescent / Normal Light Comms – No Warp (Comparison)</h2>
    <div class="badge-row">
      <div class="badge">Classical Light / RF Lamp in Normal Space</div>
      <div class="badge">No Warp Bubble</div>
      <div class="badge">Speed Limited by c</div>
    </div>

    <div class="compare-text">
      This panel represents a **simple ship using a fluorescent-style lamp or RF beacon**
      to signal a dome on the selected planet **without warp geometry**. The signal travels
      at (or below) the speed of light in normal spacetime, so the full **uncompressed delay**
      from Earth → Target Dome applies.
    </div>
    <div class="compare-text">
      We reuse the same <strong>Normal Light-Time (min)</strong> value. Warp mode compresses that delay
      by <strong>K</strong>. This fluorescent panel shows the
      <span class="compare-highlight">true expected arrival time</span> for a bright and a dim light traveling from A → B.
    </div>

    <div class="field">
      <label>
        <span>Normal Light-Time Delay (Earth → Target Dome)</span>
        <span class="value" id="lampDelayLabel">22 min</span>
      </label>
      <div class="note">
        Mirrors the <strong>Normal Light-Time (min)</strong> above. Adjust planet or override the value to experiment.
      </div>
    </div>

    <div class="field">
      <label>
        <span>Lamp Brightness Mode (for log label)</span>
      </label>
      <select id="lampBrightness">
        <option value="dim">Dim / Less Bright</option>
        <option value="bright">Bright / High Intensity</option>
      </select>
      <div class="note">
        Conceptual: **bright light** vs **less bright light** being sent from Earth Dome to the selected planet dome.
        Brightness does not change speed, only detectability.
      </div>
    </div>

    <div class="ts-row">
      <strong>CST Timestamp (sim):</strong> <span id="lampCstNow">--</span><br>
      <strong>Predicted Fluorescent Arrival:</strong> <span id="lampArrivalPreview">--</span>
    </div>

    <!-- Visualization: Fluorescent light from A to B -->
    <div class="viz">
      <div class="viz-caption">Fluorescent / Lamp Bursts – Bright Light and Dim Light Moving A → B</div>
      <div class="viz-lane">
        <div class="viz-path"></div>
        <div class="viz-endpoint left">Earth Dome / Ship</div>
        <div class="viz-endpoint right" id="lampTargetLabel">Mars Dome</div>
        <div class="burst-dot lamp-burst-bright" id="lampBurstBright"></div>
        <div class="burst-dot lamp-burst-dim" id="lampBurstDim"></div>
      </div>
    </div>

    <button class="send" id="sendLampBtn">Send Fluorescent / Lamp Burst (No Warp)</button>

    <div class="status-bar">
      <div class="pill bad">Mode: Classical Lamp / Fluorescent</div>
      <div class="pill">Warp Compression: OFF (K = 1)</div>
      <div class="pill" id="lampLatencyStatus">Latency: --</div>
    </div>
  </div>

  <!-- Reset -->
  <button class="reset" id="resetBtn">Reset Log & Status</button>
</div>

<script>
(function(){
  // Elements
  const targetPlanet = document.getElementById('targetPlanet');

  const modePublicBtn = document.getElementById('modePublic');
  const modeSecureBtn = document.getElementById('modeSecure');
  const burstLevel = document.getElementById('burstLevel');
  const burstLevelLabel = document.getElementById('burstLevelLabel');
  const kFactor = document.getElementById('kFactor');
  const kLabel = document.getElementById('kLabel');
  const normalDelay = document.getElementById('normalDelay');
  const normalDelayLabel = document.getElementById('normalDelayLabel');
  const cstNowEl = document.getElementById('cstNow');
  const arrivalPreview = document.getElementById('arrivalPreview');
  const sendBtn = document.getElementById('sendBtn');
  const modeStatus = document.getElementById('modeStatus');
  const secStatus = document.getElementById('secStatus');
  const latencyStatus = document.getElementById('latencyStatus');
  const logBox = document.getElementById('logBox');

  // Warp visualization elements
  const warpBurstBig = document.getElementById('warpBurstBig');
  const warpBurstSmall = document.getElementById('warpBurstSmall');
  const warpTargetLabel = document.getElementById('warpTargetLabel');

  // Lamp / fluorescent panel elements
  const lampDelayLabel = document.getElementById('lampDelayLabel');
  const lampCstNow = document.getElementById('lampCstNow');
  const lampArrivalPreview = document.getElementById('lampArrivalPreview');
  const lampLatencyStatus = document.getElementById('lampLatencyStatus');
  const sendLampBtn = document.getElementById('sendLampBtn');
  const lampBrightness = document.getElementById('lampBrightness');
  const lampBurstBright = document.getElementById('lampBurstBright');
  const lampBurstDim = document.getElementById('lampBurstDim');
  const lampTargetLabel = document.getElementById('lampTargetLabel');

  // Reset
  const resetBtn = document.getElementById('resetBtn');

  let mode = 'public'; // 'public' or 'secure'

  // Approximate average one-way Earth -> planet light-time in minutes
  const planetLightMinutes = {
    Mercury: 7,
    Venus: 5,
    Mars: 12,
    Jupiter: 35,
    Saturn: 70,
    Uranus: 145,
    Neptune: 235,
    Pluto: 300
  };

  function updatePlanetDelay(){
    const p = targetPlanet.value;
    const m = planetLightMinutes[p] || 22;
    normalDelay.value = m;
    normalDelayLabel.textContent = m.toString();
    const domeName = p + ' Dome';
    warpTargetLabel.textContent = domeName;
    lampTargetLabel.textContent = domeName;
    updatePreview();
  }

  targetPlanet.addEventListener('change', updatePlanetDelay);

  function updateModeButtons(){
    if(mode === 'public'){
      modePublicBtn.classList.add('active');
      modeSecureBtn.classList.remove('active');
      modeStatus.textContent = 'Mode: Distress / Public';
      secStatus.textContent = 'Quantum Auth: OFF';
    }else{
      modePublicBtn.classList.remove('active');
      modeSecureBtn.classList.add('active');
      modeStatus.textContent = 'Mode: Secure / Command';
      secStatus.textContent = 'Quantum Auth: ON';
    }
  }

  modePublicBtn.addEventListener('click', () => {
    mode = 'public';
    updateModeButtons();
    updatePreview();
  });

  modeSecureBtn.addEventListener('click', () => {
    mode = 'secure';
    updateModeButtons();
    updatePreview();
  });

  burstLevel.addEventListener('input', () => {
    burstLevelLabel.textContent = burstLevel.value;
  });

  kFactor.addEventListener('input', () => {
    const k = Math.max(1, Number(kFactor.value) || 1);
    kLabel.textContent = k.toFixed(0) + '×';
    updatePreview();
  });

  normalDelay.addEventListener('input', () => {
    const d = Math.max(0.1, Number(normalDelay.value) || 0.1);
    normalDelayLabel.textContent = d.toString();
    updatePreview();
  });

  function formatSeconds(sec){
    if(sec < 1) return (sec*1000).toFixed(0) + ' ms';
    if(sec < 60) return sec.toFixed(1) + ' s';
    const m = Math.floor(sec/60);
    const s = sec - m*60;
    if(m < 60) return m + ' min ' + s.toFixed(0) + ' s';
    const h = Math.floor(m/60);
    const mm = m - h*60;
    return h + ' h ' + mm + ' min';
  }

  function getCSTNow(){
    const d = new Date();
    return d.toLocaleString('en-US',{hour12:false});
  }

  function updatePreview(){
    const normMin = Math.max(0.1, Number(normalDelay.value) || 0.1);
    const k = Math.max(1, Number(kFactor.value) || 1);
    const normSec = normMin * 60;
    const effSec = normSec / k;
    const latStr = formatSeconds(effSec);
    latencyStatus.textContent = 'Warp Latency: ~' + latStr;

    const nowStr = getCSTNow();
    cstNowEl.textContent = nowStr;
    arrivalPreview.textContent = '~' + latStr + ' after CST send';

    // Lamp / fluorescent panel from the same normal delay
    lampDelayLabel.textContent = normMin + ' min';
    const lampLatStr = formatSeconds(normSec);
    lampLatencyStatus.textContent = 'Latency: ~' + lampLatStr;
    lampCstNow.textContent = nowStr;
    lampArrivalPreview.textContent = '~' + lampLatStr + ' after CST send';
  }

  function animateBurst(el, durationMs){
    if(!el) return;
    el.style.transition = 'none';
    el.style.left = '40px';
    el.style.opacity = '1';
    requestAnimationFrame(() => {
      el.style.transition = 'left '+durationMs+'ms linear, opacity 300ms ease-out';
      el.style.left = 'calc(100% - 40px)';
      setTimeout(() => {
        el.style.opacity = '0';
      }, durationMs);
    });
  }

  function logWarpEvent(){
    const normMin = Math.max(0.1, Number(normalDelay.value) || 0.1);
    const k = Math.max(1, Number(kFactor.value) || 1);
    const normSec = normMin * 60;
    const effSec = normSec / k;
    const latStr = formatSeconds(effSec);
    const now = new Date();
    const nowStr = now.toLocaleString('en-US',{hour12:false});
    const modeClass = (mode === 'public') ? 'mode-public' : 'mode-secure';
    const modeLabel = (mode === 'public') ? 'PUBLIC' : 'SECURE';
    const target = targetPlanet.value + ' Dome';
    const line = document.createElement('div');
    line.className = 'log-line';
    line.innerHTML =
      '<span class="time">['+ nowStr + ' CST]</span> ' +
      '<span class="tag">WARP BURST L'+ burstLevel.value +'</span> ' +
      '<span class="'+modeClass+'">['+ modeLabel +']</span> ' +
      '<span class="target">Target: '+ target +'</span> ' +
      'K='+k.toFixed(0)+' · NormDelay='+normMin+' min ' +
      '<span class="latency">→ Warp ETA ~'+ latStr +'</span>';
    logBox.prepend(line);
  }

  function logLampEvent(){
    const normMin = Math.max(0.1, Number(normalDelay.value) || 0.1);
    const normSec = normMin * 60;
    const lampLatStr = formatSeconds(normSec);
    const now = new Date();
    const nowStr = now.toLocaleString('en-US',{hour12:false});
    const target = targetPlanet.value + ' Dome';
    const bright = lampBrightness.value === 'bright' ? 'BRIGHT' : 'DIM';
    const line = document.createElement('div');
    line.className = 'log-line';
    line.innerHTML =
      '<span class="time">['+ nowStr + ' CST]</span> ' +
      '<span class="tag">LAMP BURST</span> ' +
      '<span class="mode-lamp">['+ bright +' LIGHT]</span> ' +
      '<span class="target">Target: '+ target +'</span> ' +
      'NormDelay='+normMin+' min ' +
      '<span class="latency">→ Classical ETA ~'+ lampLatStr +'</span>';
    logBox.prepend(line);
  }

  sendBtn.addEventListener('click', () => {
    updatePreview(); // refresh timestamp and ETA

    const normMin = Math.max(0.1, Number(normalDelay.value) || 0.1);
    const k = Math.max(1, Number(kFactor.value) || 1);
    const normSec = normMin * 60;
    const effSec = normSec / k;

    // Map delays to animation time (short for demo)
    const baseMs = 5000; // 5 seconds for normal path
    // Warp duration proportional to effSec / normSec (<=1)
    const ratio = effSec / normSec;
    const warpDuration = Math.max(500, baseMs * ratio); // at least 0.5s

    animateBurst(warpBurstBig, warpDuration);
    animateBurst(warpBurstSmall, warpDuration);

    logWarpEvent();
  });

  sendLampBtn.addEventListener('click', () => {
    updatePreview(); // keep timestamps aligned

    const normMin = Math.max(0.1, Number(normalDelay.value) || 0.1);
    const normSec = normMin * 60;

    const baseMs = 5000; // 5s baseline for classical
    // Classical: full base duration regardless of normMin, for demo
    const lampDuration = baseMs;

    animateBurst(lampBurstBright, lampDuration);
    animateBurst(lampBurstDim, lampDuration);

    logLampEvent();
  });

  resetBtn.addEventListener('click', () => {
    logBox.innerHTML = '';
    latencyStatus.textContent = 'Warp Latency: --';
    lampLatencyStatus.textContent = 'Latency: --';
    cstNowEl.textContent = '--';
    arrivalPreview.textContent = '--';
    lampCstNow.textContent = '--';
    lampArrivalPreview.textContent = '--';
  });

  // Initial state
  updateModeButtons();
  updatePlanetDelay(); // also calls updatePreview()
})();
</script>
</body>
</html>
