<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ice-Core Climate Change Cosmic Clock Simulator</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #020617;
      color: #e5e7eb;
    }

    header {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(148,163,184,0.4);
      background: radial-gradient(circle at top left, #0ea5e9 0, #0f172a 40%, #000 100%);
      color: #e5e7eb;
    }

    header h1 {
      margin: 0 0 4px;
      font-size: 24px;
      letter-spacing: 0.04em;
    }

    header p {
      margin: 2px 0;
      font-size: 13px;
      color: #bae6fd;
    }

    .muted {
      color: #9ca3af;
      font-size: 11px;
    }

    .mini {
      font-size: 11px;
    }

    .container {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.7fr);
      gap: 16px;
      padding: 16px 20px 20px;
    }

    .panel {
      background: radial-gradient(circle at top, rgba(56,189,248,0.14), rgba(15,23,42,0.98));
      border-radius: 16px;
      border: 1px solid rgba(148,163,184,0.35);
      box-shadow: 0 18px 45px rgba(15,23,42,0.9);
      padding: 14px 16px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .panel h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
    }

    .panel h2 span {
      font-size: 18px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 12px;
    }

    .controls label {
      font-size: 12px;
      color: #bae6fd;
    }

    select, input[type="text"] {
      background: rgba(15,23,42,0.9);
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: #e5e7eb;
      padding: 4px 10px;
      font-size: 12px;
      outline: none;
    }

    select:focus, input[type="text"]:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.7);
    }

    input[type="text"] {
      min-width: 150px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 12px;
    }

    thead {
      position: sticky;
      top: 0;
      background: linear-gradient(to right, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
      z-index: 1;
    }

    th, td {
      padding: 6px 6px;
      text-align: left;
      border-bottom: 1px solid rgba(15,118,110,0.7);
    }

    th {
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #9ca3af;
    }

    tbody tr {
      cursor: pointer;
      transition: background 0.1s ease, transform 0.08s ease;
    }

    tbody tr:hover {
      background: rgba(56,189,248,0.18);
      transform: translateY(-0.5px);
    }

    tbody tr.active-row {
      background: radial-gradient(circle at left, rgba(56,189,248,0.35), rgba(15,23,42,0.95));
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 1px 7px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(148,163,184,0.85);
      color: #e5e7eb;
      background: rgba(15,23,42,0.85);
      white-space: nowrap;
    }

    .tag-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
    }

    .tag-type-glacial .tag-dot { background: #0ea5e9; }
    .tag-type-abrupt .tag-dot { background: #f97316; }
    .tag-type-warm .tag-dot { background: #22c55e; }
    .tag-type-drought .tag-dot { background: #eab308; }
    .tag-type-anthro .tag-dot { background: #facc15; }

    .tag-scale-global .tag-dot { background: #f97316; }
    .tag-scale-hemisphere .tag-dot { background: #22c55e; }
    .tag-scale-regional .tag-dot { background: #e5e7eb; }

    .tag-driver {
      border-color: rgba(248,250,252,0.6);
      color: #e5e7eb;
    }

    .tag-season {
      border-color: rgba(244,114,182,0.7);
      color: #f9a8d4;
    }

    .tag-core {
      border-color: rgba(96,165,250,0.8);
      color: #bfdbfe;
    }

    .coords {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      color: #bae6fd;
    }

    .details-header {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 4px;
    }

    .details-title {
      font-size: 17px;
      font-weight: 600;
    }

    .details-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 4px 0;
    }

    .details-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.1fr);
      gap: 10px;
      margin-top: 4px;
      font-size: 12px;
    }

    .details-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-bottom: 3px;
    }

    ul {
      padding-left: 16px;
      margin: 3px 0;
    }

    li {
      margin-bottom: 2px;
      line-height: 1.35;
    }

    .scroll {
      max-height: 410px;
      overflow: auto;
      margin: 0 -6px -6px;
      padding: 0 6px 1px;
    }

    @media (max-width: 960px) {
      .container {
        grid-template-columns: minmax(0, 1fr);
      }
      .scroll {
        max-height: 280px;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>Ice-Core Climate Change Cosmic Clock</h1>
  <p>Major climate shifts seen in ice cores ‚Äî from the oldest Antarctic ice to modern warming ‚Äî with likely drivers
     (volcanoes, orbital cycles, greenhouse gases, meltwater, solar) and their position on your cosmic clock.</p>
  <p class="muted mini">
    Ages are approximate. ‚ÄúYears BP‚Äù = years before 1950 CE (radiocarbon convention). Ice cores mainly: Antarctic (EPICA/BEYOND EPICA, Dome C)
    and Greenland (GRIP/GISP2/NGRIP/NEEM).
  </p>
</header>

<div class="container">
  <section class="panel">
    <h2><span>üßä</span> Climate Events from Ice Cores</h2>
    <div class="controls">
      <label>
        Type:
        <select id="typeFilter">
          <option value="all">All types</option>
          <option value="glacial">Glacial cycles / major transitions</option>
          <option value="abrupt">Abrupt cool/warm jumps</option>
          <option value="warm">Warm periods</option>
          <option value="drought">Drought / aridification</option>
          <option value="anthro">Modern & anthropogenic</option>
        </select>
      </label>

      <label>
        Scale:
        <select id="scaleFilter">
          <option value="all">All scales</option>
          <option value="Global">Global</option>
          <option value="Hemisphere">Hemisphere-dominant</option>
          <option value="Regional">Regional / monsoon belts</option>
        </select>
      </label>

      <label>
        Driver:
        <select id="driverFilter">
          <option value="all">Any</option>
          <option value="orbital">Orbital / insolation</option>
          <option value="volcanic">Volcanic</option>
          <option value="greenhouse">Greenhouse gases / CO‚ÇÇ</option>
          <option value="meltwater">Ice-sheet meltwater</option>
          <option value="solar">Solar / sunspots</option>
          <option value="internal">Internal ocean‚Äìatmosphere</option>
          <option value="anthropogenic">Human forcing</option>
        </select>
      </label>

      <label>
        Search:
        <input type="text" id="searchBox" placeholder="name, core, notes‚Ä¶">
      </label>
    </div>

    <div class="scroll">
      <table>
        <thead>
        <tr>
          <th>Event</th>
          <th>Type</th>
          <th>Scale</th>
          <th>Core</th>
          <th>Lat</th>
          <th>Age / Date</th>
        </tr>
        </thead>
        <tbody id="eventTableBody"></tbody>
      </table>
    </div>
  </section>

  <section class="panel">
    <h2><span>üß≠</span> Cosmic Clock ¬∑ Drivers ¬∑ Impacts</h2>
    <div id="detailsContent">
      <p class="muted">
        Select a climate event on the left to see:
      </p>
      <ul class="muted">
        <li>Which ice core sees it best (Greenland vs Antarctica) and its latitude band on the cosmic clock</li>
        <li>Approximate age or historical date, and how fast the change happened</li>
        <li>Likely main drivers (volcanic aerosols, orbital cycles, greenhouse gases, meltwater pulses, etc.)</li>
        <li>Impact on temperature, monsoons and known societies (where archaeology overlaps)</li>
      </ul>
    </div>
  </section>
</div>

<script>
  // ---------- Helpers ----------
  function latBand(lat) {
    const a = Math.abs(lat);
    if (a < 10) return "Equatorial band (0‚Äì10¬∞)";
    if (a < 23.5) return "Tropical band (10‚Äì23.5¬∞)";
    if (a < 40) return "Subtropical / warm mid-latitudes (23.5‚Äì40¬∞)";
    if (a < 60) return "Mid-latitudes (40‚Äì60¬∞)";
    return "High-latitude / polar (60¬∞+)";
  }

  function inferSeason(lat, month, explicitSeasonHint) {
    if (explicitSeasonHint) return explicitSeasonHint;
    if (!month || month < 1 || month > 12) return "Season unknown (month not well constrained)";

    const north = [
      "Winter","Winter","Spring","Spring","Spring",
      "Summer","Summer","Summer","Autumn","Autumn","Autumn","Winter"
    ];
    const south = [
      "Summer","Summer","Autumn","Autumn","Autumn",
      "Winter","Winter","Winter","Spring","Spring","Spring","Summer"
    ];
    const idx = month - 1;
    const hemiNorth = lat >= 0;
    const s = hemiNorth ? north[idx] : south[idx];
    return s + " (approximate, based on month & hemisphere)";
  }

  function typeTagClass(t) {
    if (t === "glacial") return "tag tag-type-glacial";
    if (t === "abrupt") return "tag tag-type-abrupt";
    if (t === "warm") return "tag tag-type-warm";
    if (t === "drought") return "tag tag-type-drought";
    if (t === "anthro") return "tag tag-type-anthro";
    return "tag";
  }

  function scaleTagClass(scale) {
    if (scale === "Global") return "tag tag-scale-global";
    if (scale === "Hemisphere") return "tag tag-scale-hemisphere";
    return "tag tag-scale-regional";
  }

  // ---------- Dataset ----------
  // Common fields:
  // id, name, type, scale, coreName, coreLat, coreLon,
  // dateText, ageRangeBP, month, explicitSeasonHint,
  // mainDrivers (array), tempChangeText, greenhouseInfo,
  // hydrologyInfo, humanLinks, notes

  const events = [
    {
      id: "mpt",
      name: "Mid-Pleistocene Transition (41k ‚Üí 100k yr ice-age cycles)",
      type: "glacial",
      scale: "Global",
      coreName: "Antarctica ‚Äî Dome C / Little Dome C",
      coreLat: -75.1,
      coreLon: 123.3,
      dateText: "‚âà1,200,000 ‚Äì 900,000 years BP",
      ageRangeBP: [1200000, 900000],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["orbital", "greenhouse", "internal"],
      tempChangeText: "Shift from smaller, more frequent glacial cycles to larger, ~100,000-year cycles with colder glacials.",
      greenhouseInfo: "CO‚ÇÇ amplitude and baseline changed; feedbacks between ice sheets, CO‚ÇÇ, and dust became stronger.",
      hydrologyInfo: "Stronger growth and decay of ice sheets, changes to global sea level and monsoon belts.",
      humanLinks: "Pre-Homo sapiens; sets the overall ‚Äòrhythm‚Äô of climate that later humans evolved in.",
      notes: "Best seen in long Antarctic cores (EPICA/BEYOND EPICA) as repeating Œ¥¬π‚Å∏O / deuterium cycles and greenhouse-gas changes."
    },
    {
      id: "lgm",
      name: "Last Glacial Maximum (LGM)",
      type: "glacial",
      scale: "Global",
      coreName: "Antarctica ‚Äî Dome C; Greenland summit cores",
      coreLat: -75.1,
      coreLon: 123.3,
      dateText: "‚âà26,000 ‚Äì 19,000 years BP",
      ageRangeBP: [26000, 19000],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["orbital", "greenhouse", "internal"],
      tempChangeText: "Global mean ‚âà4‚Äì7 ¬∞C colder than today; Greenland and Antarctica much colder.",
      greenhouseInfo: "CO‚ÇÇ ‚âà180‚Äì190 ppm (vs ~280 ppm pre-industrial, ~420+ ppm today).",
      hydrologyInfo: "Massive ice sheets over N America and N Europe; sea level ‚âà120 m lower; deserts and dustier atmosphere.",
      humanLinks: "Modern humans existed; people were confined to refugia. Sets background before post-glacial expansions.",
      notes: "Shows up clearly as coldest section of last glacial in ice cores, with high dust in both Greenland and Antarctic records."
    },
    {
      id: "termination1",
      name: "Termination I / Last Deglaciation & B√∏lling‚ÄìAller√∏d Warming",
      type: "abrupt",
      scale: "Global",
      coreName: "Greenland ‚Äî NGRIP / GISP2; Antarctica ‚Äî Dome C",
      coreLat: 75.1,
      coreLon: -42.3,
      dateText: "‚âà19,000 ‚Äì 14,700 years BP (warming), sharp jump at ‚âà14.7 ka",
      ageRangeBP: [19000, 14700],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["orbital", "greenhouse", "internal"],
      tempChangeText: "Fast jump of up to ~10 ¬∞C in Greenland over a few decades at onset of B√∏lling‚ÄìAller√∏d.",
      greenhouseInfo: "CO‚ÇÇ rising from glacial (~190 ppm) toward ~260 ppm as ice sheets melt and ocean circulation changes.",
      hydrologyInfo: "Retreat of ice sheets, stronger Atlantic overturning, expansion of monsoons and forests.",
      humanLinks: "Re-expansion of humans into deglaciated Europe; foundations for later farming cultures.",
      notes: "Classic deglacial abrupt warming seen as steep Œ¥¬π‚Å∏O/deuterium shift in both Greenland and Antarctic cores."
    },
    {
      id: "younger_dryas",
      name: "Younger Dryas cold reversal",
      type: "abrupt",
      scale: "Hemisphere",
      coreName: "Greenland ‚Äî GISP2 / NGRIP",
      coreLat: 72.6,
      coreLon: -38.5,
      dateText: "‚âà12,900 ‚Äì 11,700 years BP",
      ageRangeBP: [12900, 11700],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["meltwater", "internal"],
      tempChangeText: "Rapid cooling of ~5‚Äì10 ¬∞C over Greenland; North Atlantic region back to near-glacial conditions.",
      greenhouseInfo: "CO‚ÇÇ continued to rise slowly; change is mainly circulation, not gas concentration.",
      hydrologyInfo: "Likely linked to meltwater pulses into N Atlantic and a weakened AMOC; shifts in storm tracks and monsoons.",
      humanLinks: "Overlaps with late Pleistocene hunter-gatherers; proposed links to population changes and megafaunal stress.",
      notes: "Shows up as a sharp zig-zag in Greenland Œ¥¬π‚Å∏O; cause still debated (meltwater forcing vs internal ocean variability vs other)."
    },
    {
      id: "82ka",
      name: "8.2 ka cold event",
      type: "abrupt",
      scale: "Hemisphere",
      coreName: "Greenland ‚Äî GRIP / GISP2 / NGRIP",
      coreLat: 72.6,
      coreLon: -38.5,
      dateText: "‚âà8,200 years BP, lasting ~150‚Äì200 years",
      ageRangeBP: [8300, 8000],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["meltwater", "internal"],
      tempChangeText: "Cooling of ~1‚Äì3 ¬∞C across much of the Northern Hemisphere; ~3‚Äì6 ¬∞C in central Greenland.",
      greenhouseInfo: "CO‚ÇÇ and CH‚ÇÑ show only modest wiggles; main signal is temperature / Œ¥¬π‚Å∏O drop.",
      hydrologyInfo: "Meltwater pulse from final collapse of Laurentide ice-dam lakes into N Atlantic; changes in monsoons and rainfall patterns.",
      humanLinks: "Early Neolithic cultures in Europe and Near East; some evidence of crop stress and settlement changes.",
      notes: "Very clear, sharp event in Greenland ice cores, widely used as an example of abrupt climate change in the early Holocene."
    },
    {
      id: "holocene_thermal_max",
      name: "Holocene Thermal Maximum",
      type: "warm",
      scale: "Hemisphere",
      coreName: "Greenland & high-latitude cores",
      coreLat: 72.6,
      coreLon: -38.5,
      dateText: "‚âà10,000 ‚Äì 6,000 years BP (timing varies by region)",
      ageRangeBP: [10000, 6000],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["orbital", "internal"],
      tempChangeText: "Northern high latitudes warmer than 20th century in summer; global mean only slightly warmer than preindustrial.",
      greenhouseInfo: "CO‚ÇÇ slowly rising from ~260 to ~270‚Äì280 ppm; not main driver of this plateau.",
      hydrologyInfo: "Stronger Northern Hemisphere monsoons, greener Sahara phases, expanded lakes in many regions.",
      humanLinks: "Expansion of early farming cultures in many parts of the world; favorable climate for Neolithic growth.",
      notes: "In ice cores, expressed as relatively warm, stable early Holocene with modest variability and fewer big cold pulses."
    },
    {
      id: "42ka",
      name: "4.2 ka megadrought / Meghalayan onset",
      type: "drought",
      scale: "Regional",
      coreName: "Greenland + speleothems / lake sediments",
      coreLat: 72.6,
      coreLon: -38.5,
      dateText: "‚âà4,200 years BP (~2200 BCE), ~100‚Äì200 years",
      ageRangeBP: [4300, 4000],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["internal", "orbital"],
      tempChangeText: "Modest global temperature shift; strong regional hydroclimate anomalies (drier in many monsoon / subtropical zones).",
      greenhouseInfo: "CO‚ÇÇ nearly flat around ~260‚Äì270 ppm; not the main trigger.",
      hydrologyInfo: "Weakening of monsoons and shifts in Atlantic circulation; megadrought in parts of Middle East, South Asia, N Africa.",
      humanLinks: "Often linked to stress or collapse in Akkadian Empire, Old Kingdom Egypt, Indus and other cultures, though impact varies by region.",
      notes: "Seen in multiple proxies (dust, isotopes); in ice cores it‚Äôs a modest kink, dramatic mostly in regional hydro records."
    },
    {
      id: "medieval_mca",
      name: "Medieval Climate Anomaly (Medieval Warm Period)",
      type: "warm",
      scale: "Hemisphere",
      coreName: "Greenland & mid-latitude proxies",
      coreLat: 72.6,
      coreLon: -38.5,
      dateText: "‚âà900 ‚Äì 1300 CE",
      ageRangeBP: [1050, 650],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["solar", "internal", "volcanic"],
      tempChangeText: "Northern Hemisphere extratropics somewhat warmer than surrounding centuries; not as warm as modern global mean.",
      greenhouseInfo: "CO‚ÇÇ slightly above natural baseline (~275‚Äì280 ppm).",
      hydrologyInfo: "Regional droughts (e.g., US Southwest), changes in North Atlantic circulation.",
      humanLinks: "Coincides with Viking expansion in North Atlantic and population growth in parts of Europe and Asia.",
      notes: "In ice cores, modest greenhouse increases and slight temperature wiggles; big volcanic eruptions are less frequent than later centuries."
    },
    {
      id: "little_ice_age",
      name: "Little Ice Age",
      type: "abrupt",
      scale: "Hemisphere",
      coreName: "Greenland, Arctic & Alpine glaciers",
      coreLat: 72.6,
      coreLon: -38.5,
      dateText: "‚âà1300 ‚Äì 1850 CE (multi-centennial)",
      ageRangeBP: [650, 100],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["volcanic", "solar", "internal"],
      tempChangeText: "Northern Hemisphere mean cooling of ~0.5‚Äì1 ¬∞C vs 20th century; stronger in some regions.",
      greenhouseInfo: "CO‚ÇÇ near preindustrial (~275‚Äì285 ppm) until late period.",
      hydrologyInfo: "Advance of mountain glaciers, colder winters, some regional droughts and famines.",
      humanLinks: "Linked to crop failures, famines, and social stress in Europe and parts of Asia; also sea-ice expansions.",
      notes: "Ice cores record clusters of large volcanic sulfate spikes (e.g., 1257 Samalas, 1450s Kuwae candidates, 1600 Huaynaputina, 1815 Tambora) plus lower solar output periods (Maunder Minimum)."
    },
    {
      id: "industrial_warming",
      name: "Early industrial-era warming",
      type: "anthro",
      scale: "Global",
      coreName: "Antarctica ‚Äî Law Dome; Greenland shallow cores",
      coreLat: -66.7,
      coreLon: 112.8,
      dateText: "‚âà1850 ‚Äì 1950 CE",
      ageRangeBP: [100, 0],
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["anthropogenic", "greenhouse", "internal"],
      tempChangeText: "Global temperature begins rising ~0.3‚Äì0.4 ¬∞C above preindustrial by mid-20th century.",
      greenhouseInfo: "CO‚ÇÇ jumps from ~280 ppm to ~310‚Äì315 ppm; CH‚ÇÑ, N‚ÇÇO also rise sharply compared to previous 800,000 years.",
      hydrologyInfo: "Changes in rainfall patterns begin to emerge; some glaciers start receding.",
      humanLinks: "Industrialization, fossil fuel burning, land-use changes; start of human-dominated climate forcing.",
      notes: "Ice cores clearly show greenhouse gases exiting the natural range (based on 800k-year record) right in this interval."
    },
    {
      id: "modern_warming",
      name: "Modern rapid warming",
      type: "anthro",
      scale: "Global",
      coreName: "Atmospheric record + recent ice layers",
      coreLat: 0.0,
      coreLon: 0.0,
      dateText: "‚âà1950 CE ‚Äì present",
      ageRangeBP: [0, -75], // negative to indicate future relative to 1950
      month: null,
      explicitSeasonHint: null,
      mainDrivers: ["anthropogenic", "greenhouse", "internal"],
      tempChangeText: "‚âà1.2‚Äì1.3 ¬∞C global mean warming above 1850‚Äì1900; faster than most natural changes in last 11,000 years.",
      greenhouseInfo: "CO‚ÇÇ >420 ppm, CH‚ÇÑ and N‚ÇÇO at levels unseen in at least 800,000 years in ice-core record.",
      hydrologyInfo: "Stronger hydrological cycle, heatwaves, changing monsoons, glacier/ice-sheet melt and sea-level rise.",
      humanLinks: "Urbanization, sea-level threats to coastal cities, increased heat stress, shifting agriculture and migration pressures.",
      notes: "Beyond EPICA and older Antarctic cores show current greenhouse-gas levels far exceed anything in the last 800k‚Äì1.2M years. This is a unique point on your cosmic clock."
    }
  ];

  // ---------- UI wiring ----------
  const tbody = document.getElementById("eventTableBody");
  const detailsContent = document.getElementById("detailsContent");
  const typeFilter = document.getElementById("typeFilter");
  const scaleFilter = document.getElementById("scaleFilter");
  const driverFilter = document.getElementById("driverFilter");
  const searchBox = document.getElementById("searchBox");

  function renderTable() {
    const t = typeFilter.value;
    const sc = scaleFilter.value;
    const dr = driverFilter.value;
    const q = (searchBox.value || "").toLowerCase();

    tbody.innerHTML = "";

    const filtered = events.filter(ev => {
      if (t !== "all" && ev.type !== t) return false;
      if (sc !== "all" && ev.scale !== sc) return false;
      if (dr !== "all" && !ev.mainDrivers.includes(dr)) return false;

      if (q) {
        const hay = (ev.name + " " + ev.coreName + " " + ev.notes).toLowerCase();
        if (!hay.includes(q)) return false;
      }
      return true;
    });

    filtered.forEach(ev => {
      const tr = document.createElement("tr");
      tr.dataset.id = ev.id;

      const tdName = document.createElement("td");
      tdName.textContent = ev.name;

      const tdType = document.createElement("td");
      const spanType = document.createElement("span");
      spanType.className = typeTagClass(ev.type);
      const dotT = document.createElement("span");
      dotT.className = "tag-dot";
      const labelT = document.createElement("span");
      const typeLabelMap = {
        glacial: "Glacial cycle",
        abrupt: "Abrupt event",
        warm: "Warm period",
        drought: "Drought/aridification",
        anthro: "Anthropogenic"
      };
      labelT.textContent = typeLabelMap[ev.type] || ev.type;
      spanType.appendChild(dotT);
      spanType.appendChild(labelT);
      tdType.appendChild(spanType);

      const tdScale = document.createElement("td");
      const spanScale = document.createElement("span");
      spanScale.className = scaleTagClass(ev.scale);
      const dotS = document.createElement("span");
      dotS.className = "tag-dot";
      const labelS = document.createElement("span");
      labelS.textContent = ev.scale;
      spanScale.appendChild(dotS);
      spanScale.appendChild(labelS);
      tdScale.appendChild(spanScale);

      const tdCore = document.createElement("td");
      tdCore.textContent = ev.coreName.split("‚Äî")[0].trim();

      const tdLat = document.createElement("td");
      tdLat.textContent = ev.coreLat.toFixed(2);

      const tdDate = document.createElement("td");
      tdDate.textContent = ev.dateText;

      tr.appendChild(tdName);
      tr.appendChild(tdType);
      tr.appendChild(tdScale);
      tr.appendChild(tdCore);
      tr.appendChild(tdLat);
      tr.appendChild(tdDate);

      tr.addEventListener("click", () => {
        document.querySelectorAll("#eventTableBody tr").forEach(r => r.classList.remove("active-row"));
        tr.classList.add("active-row");
        renderDetails(ev);
      });

      tbody.appendChild(tr);
    });

    if (!filtered.length) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.colSpan = 6;
      td.className = "muted";
      td.textContent = "No events match the current filters.";
      tr.appendChild(td);
      tbody.appendChild(tr);
    }
  }

  function renderDetails(ev) {
    const hemisphere = ev.coreLat >= 0 ? "Northern" : "Southern";
    const band = latBand(ev.coreLat);
    const season = inferSeason(ev.coreLat, ev.month, ev.explicitSeasonHint);

    const driverTags = ev.mainDrivers.map(d => {
      const labels = {
        orbital: "Orbital / insolation cycles",
        volcanic: "Volcanic aerosols",
        greenhouse: "Greenhouse gases",
        meltwater: "Ice-sheet meltwater pulses",
        solar: "Solar variability",
        internal: "Internal ocean‚Äìatmosphere dynamics",
        anthropogenic: "Human activities"
      };
      return `
        <span class="tag tag-driver">
          <span class="tag-dot" style="background:#facc15;"></span>
          <span>${labels[d] || d}</span>
        </span>`;
    }).join("");

    const typeTag = `
      <div class="${typeTagClass(ev.type)}">
        <span class="tag-dot"></span>
        <span>${ev.name.includes("warming") ? "Warming" : ""}</span>
      </div>`;

    const scaleTag = `
      <div class="${scaleTagClass(ev.scale)}">
        <span class="tag-dot"></span>
        <span>${ev.scale} impact</span>
      </div>`;

    const seasonTag = `
      <span class="tag tag-season">
        <span class="tag-dot" style="background:#f472b6;"></span>
        <span>${season}</span>
      </span>`;

    const coreTag = `
      <span class="tag tag-core">
        <span class="tag-dot" style="background:#60a5fa;"></span>
        <span>${ev.coreName}</span>
      </span>`;

    detailsContent.innerHTML = `
      <div class="details-header">
        <div class="details-title">${ev.name}</div>
        <div class="details-subtitle">${ev.dateText}</div>
        <div class="coords">
          Core reference: ${ev.coreName} ‚Äî Lat ${ev.coreLat.toFixed(4)}¬∞, Lon ${ev.coreLon.toFixed(4)}¬∞ (${hemisphere} Hemisphere)
        </div>
      </div>

      <div class="pill-row">
        ${scaleTag}
        ${coreTag}
        ${seasonTag}
        ${driverTags}
      </div>

      <div class="details-grid">
        <div>
          <div class="details-section-title">Cosmic Clock Position</div>
          <ul>
            <li><strong>Latitude band:</strong> ${band}</li>
            <li><strong>Hemisphere focus:</strong> ${hemisphere} Hemisphere</li>
            <li><strong>Season inference:</strong> ${season}</li>
          </ul>

          <div class="details-section-title">Temperature &amp; Gases</div>
          <ul>
            <li><strong>Temperature change:</strong> ${ev.tempChangeText}</li>
            <li><strong>Greenhouse gases:</strong> ${ev.greenhouseInfo}</li>
          </ul>
        </div>

        <div>
          <div class="details-section-title">Water, Monsoons &amp; Societies</div>
          <ul>
            <li><strong>Hydrology / monsoons:</strong> ${ev.hydrologyInfo}</li>
            <li><strong>Human connections:</strong> ${ev.humanLinks}</li>
          </ul>

          <div class="details-section-title">Notes</div>
          <p class="mini">${ev.notes}</p>
        </div>
      </div>

      <p class="muted mini" style="margin-top:6px;">
        Each row is a ‚Äúpulse‚Äù in the ice-core record: a big tilt of Earth‚Äôs climate clock. For your
        catastrophe project, match these pulses against your city, volcano, quake/tsunami and meteor
        simulators: if a culture shift lines up with a strong global pulse (LGM, 8.2 ka, Little Ice Age,
        modern warming), that‚Äôs a <strong>climate-forced</strong> candidate. If not, it may be a
        <strong>local disaster</strong> or purely social change.
      </p>
    `;
  }

  // Filters
  typeFilter.addEventListener("change", renderTable);
  scaleFilter.addEventListener("change", renderTable);
  driverFilter.addEventListener("change", renderTable);
  searchBox.addEventListener("input", renderTable);

  // Initial render
  renderTable();
</script>
</body>
</html>
