<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UFO + Warp Engine Console (Simple + Working)</title>
<style>
  :root{
    color-scheme: dark;
    --bg:#070b14;
    --panel:#0f172a;
    --ink:#e5e7eb;
    --muted:#9aa4c7;
    --accent:#60a5fa;
    --good:#34d399;
    --warn:#fbbf24;
    --bad:#fb7185;
    --line:rgba(148,163,184,.22);
    --radius:16px;
    --shadow:0 18px 40px rgba(0,0,0,.45);
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(900px 520px at 30% -10%, rgba(96,165,250,.16), transparent 60%),
      radial-gradient(700px 520px at 95% 0%, rgba(52,211,153,.10), transparent 55%),
      radial-gradient(circle at top, #020617 0, #000 60%, #000 100%);
    color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{max-width:1280px;margin:0 auto;padding:18px 14px 36px}
  header{display:flex;justify-content:space-between;gap:12px;align-items:flex-end;margin-bottom:12px}
  h1{margin:0;font-size:1.15rem;letter-spacing:.02em}
  .sub{margin-top:6px;color:var(--muted);font-size:.92rem;line-height:1.25}
  .grid{display:grid;grid-template-columns: 440px 1fr;gap:14px}
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

  .card{
    background:linear-gradient(135deg, rgba(15,23,42,.96), rgba(11,18,34,.86));
    border:1px solid var(--line);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:14px;
  }
  .card h2{margin:0 0 10px;font-size:1.02rem}
  .group{margin-top:10px;padding-top:10px;border-top:1px solid var(--line)}
  label{display:flex;justify-content:space-between;gap:10px;color:var(--muted);font-size:.86rem}
  input[type="range"]{width:100%}
  input[type="number"]{
    width:100%;
    font-size:12px;
    padding:6px 8px;
    border-radius:10px;
    border:1px solid var(--line);
    background:rgba(2,6,23,.55);
    color:var(--ink);
    outline:none;
  }
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{
    border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(96,165,250,.22), rgba(15,23,42,.78));
    color:var(--ink);
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    font-weight:800;
  }
  button:hover{filter:brightness(1.06)}
  .ghost{background:linear-gradient(180deg, rgba(148,163,184,.10), rgba(15,23,42,.78));color:var(--muted)}
  .danger{background:linear-gradient(180deg, rgba(251,113,133,.16), rgba(15,23,42,.78))}
  .kpiRow{display:flex;gap:10px;flex-wrap:wrap}
  .kpi{
    flex:1 1 190px;
    border:1px solid var(--line);
    background:rgba(2,6,23,.35);
    border-radius:14px;
    padding:10px;
  }
  .kpi .t{color:var(--muted);font-size:.78rem}
  .kpi .v{margin-top:6px;font-family:var(--mono);font-size:.98rem}
  .callout{
    margin-top:10px;border-left:3px solid rgba(96,165,250,.55);
    padding:10px 12px;background:rgba(96,165,250,.08);
    border-radius:12px;color:var(--muted);line-height:1.35;font-size:.9rem;
  }
  .mini{
    margin-top:10px;
    border:1px dashed rgba(148,163,184,.35);
    border-radius:14px;
    padding:10px;
    color:var(--muted);
    font-size:.86rem;
  }
  .eq{font-family:var(--mono);color:#e5e7eb}
  #err{
    display:none;margin-top:10px;
    border:1px solid rgba(251,113,133,.35);
    background:rgba(251,113,133,.10);
    border-radius:14px;padding:10px;
  }
  #err pre{
    margin:8px 0 0;
    font-family:var(--mono);
    font-size:.85rem;
    color:#ffd1d9;
    white-space:pre-wrap;
  }

  .stage{
    border:1px solid var(--line);
    border-radius:18px;
    overflow:hidden;
    background:rgba(2,6,23,.35);
  }
  canvas{display:block;width:100%;height:560px}

  .legendRow{
    display:flex;gap:10px;flex-wrap:wrap;margin-top:10px
  }
  .pill{
    font-size:11px;
    border:1px solid rgba(148,163,184,.35);
    padding:6px 10px;
    border-radius:999px;
    color:var(--muted);
    background:rgba(2,6,23,.35);
  }
  .pill b{color:var(--ink)}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>UFO Simulator + Warp Engine Console (Simple, Working, Live Telemetry)</h1>
      <div class="sub">
        One canvas: UFO + magnetic field ring + “engine core” glow + live numbers.
        Buttons always work; sliders always update (even when paused).
      </div>
    </div>
    <div class="sub" style="text-align:right">
      Status: <b id="statusText">Ready</b><br/>
      Time: <span id="tText">0.00s</span>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT: CONTROLS + TELEMETRY -->
    <section class="card">
      <h2>Controls</h2>

      <div class="kpiRow">
        <div class="kpi"><div class="t">Warp Factor (WF)</div><div class="v" id="kWarp">4</div></div>
        <div class="kpi"><div class="t">Engine Power (Ė)</div><div class="v" id="kPower">—</div></div>
        <div class="kpi"><div class="t">Magnetic Field (B)</div><div class="v" id="kB">—</div></div>
      </div>

      <div class="group">
        <label><span>Warp Factor</span><span id="sWarp">4</span></label>
        <input id="warp" type="range" min="1" max="10" value="4" />
      </div>

      <div class="group">
        <label><span>Energy (0–100)</span><span id="sEnergy">50</span></label>
        <input id="energy" type="range" min="0" max="100" value="50" />
      </div>

      <div class="group">
        <label><span>Field Strength (0–100)</span><span id="sField">40</span></label>
        <input id="field" type="range" min="0" max="100" value="40" />
      </div>

      <div class="group">
        <label><span>Bubble Size (0–1)</span><span id="sBubble">0.60</span></label>
        <input id="bubble" type="range" min="0" max="100" value="60" />
      </div>

      <div class="group">
        <label><span>Shield Strength (0–1)</span><span id="sShield">0.50</span></label>
        <input id="shield" type="range" min="0" max="100" value="50" />
      </div>

      <div class="group">
        <label><span>Wobble (0–1)</span><span id="sWobble">0.30</span></label>
        <input id="wobble" type="range" min="0" max="100" value="30" />
      </div>

      <div class="btns">
        <button id="btnStart">Start</button>
        <button class="ghost" id="btnPause">Pause</button>
        <button class="ghost" id="btnReset">Reset</button>
        <button class="danger" id="btnPanic">Panic Stop</button>
      </div>

      <div class="mini">
        <div style="font-weight:800;color:#e5e7eb;margin-bottom:6px;">Live Math (simple, stable)</div>
        <div class="eq">1) &nbsp; Ė = P₀ · (0.25 + 0.75·E) · (0.30 + 0.70·WF/10)</div>
        <div class="eq">2) &nbsp; ṁ = Ė / c²</div>
        <div class="eq">3) &nbsp; B ≈ B₀ · (Field/100) · (1 + 0.06·WF)</div>
        <div class="eq">4) &nbsp; v_app/c ≈ 0.2 + 0.06·WF &nbsp; (clamped &lt; 0.92)</div>
        <div class="eq">5) &nbsp; ClockRate ≈ 1 / ( (1+0.06·WF) · γ )</div>
        <div class="callout" style="margin-top:10px">
          <b>Goal:</b> a clean “UFO cockpit” outline with a magnetic ring + a simple warp-engine telemetry model.
          You can upgrade later (more panels, plots, jump planner) without breaking the base.
        </div>

        <div class="legendRow">
          <div class="pill"><b>Blue ring</b> = magnetic field bubble</div>
          <div class="pill"><b>Green ring</b> = shield ring</div>
          <div class="pill"><b>Gold plume</b> = energy exhaust</div>
        </div>
      </div>

      <div id="err">
        <b>Script error</b>
        <pre id="errText"></pre>
      </div>
    </section>

    <!-- RIGHT: CANVAS -->
    <section class="card">
      <h2>Stage</h2>
      <div class="stage">
        <canvas id="cv" width="1200" height="560"></canvas>
      </div>

      <div class="kpiRow" style="margin-top:12px">
        <div class="kpi"><div class="t">ṁ (mass-rate)</div><div class="v" id="kMdot">—</div></div>
        <div class="kpi"><div class="t">v_app (apparent)</div><div class="v" id="kVapp">—</div></div>
        <div class="kpi"><div class="t">Clock Rate (ship/CST)</div><div class="v" id="kClock">—</div></div>
      </div>
    </section>
  </div>
</div>

<script>
(() => {
  "use strict";

  // Hard error catcher (so you always see what broke)
  window.addEventListener("error", (e)=>{
    const box = document.getElementById("err");
    const pre = document.getElementById("errText");
    if (!box || !pre) return;
    box.style.display = "block";
    pre.textContent = (e && e.error && e.error.stack) ? e.error.stack : (e.message || String(e));
  });

  const $ = (id)=>document.getElementById(id);

  // Canvas
  const cv = $("cv");
  const ctx = cv.getContext("2d");

  // Inputs
  const ui = {
    warp: $("warp"),
    energy: $("energy"),
    field: $("field"),
    bubble: $("bubble"),
    shield: $("shield"),
    wobble: $("wobble"),
    start: $("btnStart"),
    pause: $("btnPause"),
    reset: $("btnReset"),
    panic: $("btnPanic")
  };

  // Outputs
  const out = {
    sWarp: $("sWarp"),
    sEnergy: $("sEnergy"),
    sField: $("sField"),
    sBubble: $("sBubble"),
    sShield: $("sShield"),
    sWobble: $("sWobble"),

    kWarp: $("kWarp"),
    kPower: $("kPower"),
    kB: $("kB"),
    kMdot: $("kMdot"),
    kVapp: $("kVapp"),
    kClock: $("kClock"),

    status: $("statusText"),
    tText: $("tText")
  };

  // Constants for simple physics model
  const TAU = Math.PI*2;
  const C_LIGHT = 299792458;           // m/s
  const P0 = 2.0e14;                   // W (conceptual base power)
  const B0 = 3.0;                      // "Tesla-ish" scale for demo

  // State
  const S = {
    running:false,
    t:0,
    warp:4,
    energy:50,       // 0..100
    field:40,        // 0..100
    bubble:0.60,     // 0..1
    shield:0.50,     // 0..1
    wobble:0.30      // 0..1
  };

  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  function fmtExp(n){
    if (!isFinite(n)) return "—";
    return n.toExponential(2);
  }
  function fmt(n, d=2){
    if (!isFinite(n)) return "—";
    return n.toFixed(d);
  }

  // Read UI into state + update labels
  function readUI(){
    S.warp   = +ui.warp.value;
    S.energy = +ui.energy.value;
    S.field  = +ui.field.value;
    S.bubble = (+ui.bubble.value)/100;
    S.shield = (+ui.shield.value)/100;
    S.wobble = (+ui.wobble.value)/100;

    out.sWarp.textContent   = String(S.warp);
    out.sEnergy.textContent = String(S.energy);
    out.sField.textContent  = String(S.field);
    out.sBubble.textContent = S.bubble.toFixed(2);
    out.sShield.textContent = S.shield.toFixed(2);
    out.sWobble.textContent = S.wobble.toFixed(2);

    out.kWarp.textContent   = String(S.warp);
  }

  // Simple equations (stable)
  function powerW(){
    const E = S.energy/100;
    const WF = S.warp/10;
    return P0 * (0.25 + 0.75*E) * (0.30 + 0.70*WF);
  }
  function mdotKgPerSec(P){
    return P / (C_LIGHT*C_LIGHT);
  }
  function vLocalFrac(){
    // "local plasma / internal motion" stays subluminal (0.2..0.92 c)
    const v = 0.2 + 0.06*S.warp;
    return clamp(v, 0.2, 0.92);
  }
  function gammaSR(vfrac){
    // γ = 1/sqrt(1 - v^2)
    return 1/Math.sqrt(1 - vfrac*vfrac);
  }
  function clockRate(vfrac){
    // very simple: ship clock slows with gamma and with a small warp scaling factor
    const warpScale = 1 + 0.06*S.warp;
    return 1/(warpScale * gammaSR(vfrac));
  }
  function magneticB(){
    // B ≈ B0*(Field/100)*(1 + 0.06*WF)
    return B0 * (S.field/100) * (1 + 0.06*S.warp);
  }

  function updateTelemetry(){
    const P = powerW();
    const md = mdotKgPerSec(P);
    const v = vLocalFrac();
    const cr = clockRate(v);
    const B  = magneticB();

    out.kPower.textContent = fmtExp(P) + " W";
    out.kMdot.textContent  = fmtExp(md) + " kg/s";
    out.kVapp.textContent  = fmt(v, 3) + " c (local)";
    out.kClock.textContent = fmt(cr, 3) + " ×";
    out.kB.textContent     = fmt(B, 2) + " (arb)";

    // Also paint these values into the HUD inside the canvas
    return {P, md, v, cr, B};
  }

  // Responsive canvas scaling (keeps drawing crisp)
  function resizeCanvas(){
    const rect = cv.getBoundingClientRect();
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const w = Math.floor(rect.width * dpr);
    const h = Math.floor(rect.height * dpr);
    if (cv.width !== w || cv.height !== h){
      cv.width = w;
      cv.height = h;
    }
  }

  // Draw functions
  function drawRing(x,y,rx,ry, color, alpha, lineW){
    ctx.save();
    ctx.globalAlpha = alpha;
    ctx.strokeStyle = color;
    ctx.lineWidth = lineW;
    ctx.beginPath();
    ctx.ellipse(x,y,rx,ry,0,0,TAU);
    ctx.stroke();
    ctx.restore();
  }

  function draw(){
    resizeCanvas();
    const W = cv.width, H = cv.height;
    ctx.clearRect(0,0,W,H);

    const scale = W/1200;
    const cx = W*0.58;
    const cy = H*0.52;

    const P = powerW();
    const v = vLocalFrac();
    const B = magneticB();

    // wobble reduced by shield
    const wobEff = S.wobble * (1 - 0.75*S.shield);
    const wobX = Math.sin(S.t*2.0) * (10 + 22*wobEff) * scale;
    const wobY = Math.cos(S.t*1.6) * (8  + 18*wobEff) * scale;
    const roll = Math.sin(S.t*1.3) * (0.06 + 0.12*wobEff);

    // UFO size
    const uW = 600*scale;
    const uH = 250*scale;

    // Magnetic bubble size
    const bubbleScale = (0.85 + 0.70*S.bubble) * (1.00 + 0.25*(S.field/100));
    const bx = uW*0.78*bubbleScale;
    const by = uH*0.56*bubbleScale;

    // Background subtle grid
    ctx.save();
    ctx.globalAlpha = 0.08;
    ctx.strokeStyle = "rgba(148,163,184,.35)";
    ctx.lineWidth = 1;
    for(let x=0; x<W; x+=Math.floor(40*scale)){
      ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke();
    }
    for(let y=0; y<H; y+=Math.floor(40*scale)){
      ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke();
    }
    ctx.restore();

    // === Magnetic field glow (blue) ===
    ctx.save();
    ctx.translate(cx+wobX*0.7, cy+wobY*0.7);
    ctx.rotate(roll*0.45);

    const haloR = Math.max(bx,by)*1.35;
    const glow = ctx.createRadialGradient(0,0, haloR*0.08, 0,0, haloR);
    const glowA = 0.06 + 0.16*(S.field/100) + 0.10*(S.energy/100);
    glow.addColorStop(0, `rgba(96,165,250,${glowA})`);
    glow.addColorStop(0.55, `rgba(96,165,250,${0.03 + 0.10*(S.field/100)})`);
    glow.addColorStop(1, "rgba(96,165,250,0)");
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.ellipse(0,0, bx*1.20, by*1.20, 0, 0, TAU);
    ctx.fill();

    // magnetic ring
    drawRing(0,0, bx*1.04, by*1.04, "rgba(96,165,250,.65)", 0.55 + 0.35*(S.field/100), (2.0 + 4.0*(S.field/100))*scale);

    // shield ring (green)
    drawRing(0,0, bx*0.94, by*0.94, "rgba(52,211,153,.70)", 0.10 + 0.70*S.shield, (2.0 + 6.0*S.shield)*scale);

    ctx.restore();

    // === UFO saucer ===
    ctx.save();
    ctx.translate(cx+wobX, cy+wobY);
    ctx.rotate(roll);

    // body
    ctx.fillStyle = "rgba(148,163,184,.10)";
    ctx.strokeStyle = "rgba(148,163,184,.26)";
    ctx.lineWidth = 2*scale;
    ctx.beginPath();
    ctx.ellipse(0, 0, uW*0.56, uH*0.32, 0, 0, TAU);
    ctx.fill();
    ctx.stroke();

    // rim highlight depends on field
    ctx.strokeStyle = `rgba(96,165,250,${0.14 + 0.62*(S.field/100)})`;
    ctx.lineWidth = 3*scale;
    ctx.beginPath();
    ctx.ellipse(0, 0, uW*0.59, uH*0.34, 0, 0, TAU);
    ctx.stroke();

    // dome
    ctx.fillStyle = "rgba(148,163,184,.14)";
    ctx.strokeStyle = "rgba(148,163,184,.30)";
    ctx.lineWidth = 2*scale;
    ctx.beginPath();
    ctx.ellipse(0,-uH*0.18, uW*0.22, uH*0.18, 0, Math.PI, 0, true);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    // underside
    ctx.fillStyle = "rgba(15,23,42,.60)";
    ctx.strokeStyle = "rgba(148,163,184,.22)";
    ctx.lineWidth = 1.6*scale;
    ctx.beginPath();
    ctx.ellipse(0, uH*0.18, uW*0.35, uH*0.18, 0, 0, TAU);
    ctx.fill();
    ctx.stroke();

    // engine core glow inside UFO (simple “warp core”)
    const coreR = uW*0.10 * (0.75 + 0.45*(S.energy/100));
    const core = ctx.createRadialGradient(0, uH*0.04, coreR*0.15, 0, uH*0.04, coreR);
    core.addColorStop(0, `rgba(251,191,36,${0.14 + 0.55*(S.energy/100)})`);
    core.addColorStop(0.6, `rgba(96,165,250,${0.05 + 0.25*(S.field/100)})`);
    core.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = core;
    ctx.beginPath();
    ctx.arc(0, uH*0.04, coreR, 0, TAU);
    ctx.fill();

    // exhaust plume depends on energy
    const plume = 0.1 + 0.9*(S.energy/100);
    const len = uH*(0.30 + 0.55*plume);
    const w0  = uW*(0.03 + 0.07*plume);
    const w1  = uW*(0.08 + 0.20*plume);

    const pg = ctx.createRadialGradient(0, 0, 1, 0, len*0.7, len*1.2);
    pg.addColorStop(0, `rgba(251,191,36,${0.10 + 0.45*plume})`);
    pg.addColorStop(0.55, `rgba(251,191,36,${0.05 + 0.20*plume})`);
    pg.addColorStop(1, "rgba(251,191,36,0)");
    ctx.fillStyle = pg;
    ctx.save();
    ctx.translate(0, uH*0.28);
    ctx.beginPath();
    ctx.moveTo(-w0, 0);
    ctx.lineTo(-w1, len);
    ctx.lineTo( w1, len);
    ctx.lineTo( w0, 0);
    ctx.closePath();
    ctx.fill();
    ctx.restore();

    ctx.restore();

    // === HUD overlay ===
    const {md, cr} = updateTelemetry();
    ctx.save();
    ctx.fillStyle = "rgba(229,231,235,.86)";
    ctx.font = `${Math.max(12, 14*(W/1200))}px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}, ui-monospace`;
    ctx.fillText(`t=${S.t.toFixed(2)}s  WF=${S.warp}  E=${S.energy}  Field=${S.field}  Bubble=${S.bubble.toFixed(2)}  Shield=${S.shield.toFixed(2)}`, 14*scale, 24*scale);
    ctx.fillStyle = "rgba(159,164,199,.95)";
    ctx.font = `${Math.max(11, 12*(W/1200))}px ${getComputedStyle(document.documentElement).getPropertyValue('--mono')}, ui-monospace`;
    ctx.fillText(`Ė≈${P.toExponential(2)} W  ṁ≈${md.toExponential(2)} kg/s  B≈${B.toFixed(2)}  v_local≈${v.toFixed(3)}c  clock≈${cr.toFixed(3)}×`, 14*scale, 44*scale);
    ctx.restore();

    // status corner
    ctx.save();
    ctx.fillStyle = "rgba(229,231,235,.72)";
    ctx.font = `${Math.max(11, 12*(W/1200))}px system-ui`;
    ctx.textAlign = "right";
    ctx.fillText(S.running ? "RUNNING" : "PAUSED", W-14*scale, 24*scale);
    ctx.restore();
  }

  // Hook sliders
  [ui.warp, ui.energy, ui.field, ui.bubble, ui.shield, ui.wobble].forEach(el=>{
    el.addEventListener("input", ()=>{ readUI(); draw(); });
  });

  // Buttons
  ui.start.addEventListener("click", ()=>{ S.running=true; out.status.textContent="Running"; });
  ui.pause.addEventListener("click", ()=>{ S.running=false; out.status.textContent="Paused"; });
  ui.reset.addEventListener("click", ()=>{
    S.running=false;
    S.t=0;
    out.status.textContent="Reset";
    out.tText.textContent="0.00s";
    draw();
  });
  ui.panic.addEventListener("click", ()=>{
    S.running=false;
    S.t=0;
    // slam safe values
    ui.warp.value=1;
    ui.energy.value=10;
    ui.field.value=10;
    ui.bubble.value=10;
    ui.wobble.value=0;
    ui.shield.value=100;
    readUI();
    out.status.textContent="PANIC STOP";
    out.tText.textContent="0.00s";
    draw();
  });

  // Main loop
  let last = performance.now();
  function loop(now){
    const dt = Math.min(0.05, Math.max(0, (now - last)/1000));
    last = now;

    if (S.running){
      S.t += dt;
      out.tText.textContent = S.t.toFixed(2) + "s";
    }
    // Always draw so UI stays live
    draw();
    requestAnimationFrame(loop);
  }

  // Init
  readUI();
  updateTelemetry();
  draw();
  requestAnimationFrame(loop);
  window.addEventListener("resize", ()=>{ last = performance.now(); draw(); });

})();
</script>
</body>
</html>
