<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>UFO Simulator — Base (Step 0)</title>
<style>
  :root{
    color-scheme: dark;
    --bg:#070b14;
    --panel:#0f172a;
    --ink:#e5e7eb;
    --muted:#9aa4c7;
    --accent:#60a5fa;
    --good:#34d399;
    --warn:#fbbf24;
    --bad:#fb7185;
    --line:rgba(148,163,184,.22);
    --radius:16px;
    --shadow:0 18px 40px rgba(0,0,0,.45);
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(900px 520px at 30% -10%, rgba(96,165,250,.16), transparent 60%),
      radial-gradient(700px 520px at 95% 0%, rgba(52,211,153,.10), transparent 55%),
      radial-gradient(circle at top, #020617 0, #000 60%, #000 100%);
    color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{max-width:1200px;margin:0 auto;padding:18px 14px 36px}
  header{display:flex;justify-content:space-between;gap:12px;align-items:flex-end;margin-bottom:12px}
  h1{margin:0;font-size:1.18rem}
  .sub{margin-top:6px;color:var(--muted);font-size:.95rem;line-height:1.25}
  .grid{display:grid;grid-template-columns: 420px 1fr;gap:14px}
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

  .card{
    background:linear-gradient(135deg, rgba(15,23,42,.96), rgba(11,18,34,.86));
    border:1px solid var(--line);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:14px;
  }
  .card h2{margin:0 0 10px;font-size:1.02rem}
  .group{margin-top:10px;padding-top:10px;border-top:1px solid var(--line)}
  label{display:flex;justify-content:space-between;gap:10px;color:var(--muted);font-size:.86rem}
  input[type="range"]{width:100%}
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{
    border:1px solid var(--line);
    background:linear-gradient(180deg, rgba(96,165,250,.22), rgba(15,23,42,.78));
    color:var(--ink);
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    font-weight:800;
  }
  .ghost{background:linear-gradient(180deg, rgba(148,163,184,.10), rgba(15,23,42,.78));color:var(--muted)}
  .danger{background:linear-gradient(180deg, rgba(251,113,133,.16), rgba(15,23,42,.78))}
  .kpiRow{display:flex;gap:10px;flex-wrap:wrap}
  .kpi{
    flex:1 1 180px;
    border:1px solid var(--line);
    background:rgba(2,6,23,.35);
    border-radius:14px;
    padding:10px;
  }
  .kpi .t{color:var(--muted);font-size:.78rem}
  .kpi .v{margin-top:6px;font-family:var(--mono);font-size:.98rem}
  .callout{
    margin-top:10px;border-left:3px solid rgba(96,165,250,.55);
    padding:10px 12px;background:rgba(96,165,250,.08);
    border-radius:12px;color:var(--muted);line-height:1.35;font-size:.92rem;
  }
  #err{
    display:none;margin-top:10px;
    border:1px solid rgba(251,113,133,.35);
    background:rgba(251,113,133,.10);
    border-radius:14px;padding:10px;
  }
  #err pre{
    margin:8px 0 0;
    font-family:var(--mono);
    font-size:.85rem;
    color:#ffd1d9;
    white-space:pre-wrap;
  }

  .stage{
    border:1px solid var(--line);
    border-radius:18px;
    overflow:hidden;
    background:rgba(2,6,23,.35);
  }
  canvas{display:block;width:100%;height:520px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>UFO Simulator — Base (Step 0)</h1>
      <div class="sub">Goal: guaranteed working sliders + Start/Pause/Reset + simple UFO + magnetic bubble. No complex math yet.</div>
    </div>
    <div class="sub" style="text-align:right">
      Status: <b id="statusText">Ready</b><br/>
      Time: <span id="tText">0.00s</span>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <h2>Controls</h2>

      <div class="kpiRow">
        <div class="kpi"><div class="t">Energy</div><div class="v" id="kEnergy">50</div></div>
        <div class="kpi"><div class="t">Field</div><div class="v" id="kField">40</div></div>
        <div class="kpi"><div class="t">Bubble</div><div class="v" id="kBubble">0.60</div></div>
      </div>
      <div class="group">
        <label><span>Energy</span><span id="sEnergy">50</span></label>
        <input id="energy" type="range" min="0" max="100" value="50" />
      </div>

      <div class="group">
        <label><span>Field strength</span><span id="sField">40</span></label>
        <input id="field" type="range" min="0" max="100" value="40" />
      </div>

      <div class="group">
        <label><span>Bubble size</span><span id="sBubble">0.60</span></label>
        <input id="bubble" type="range" min="0" max="100" value="60" />
      </div>

      <div class="group">
        <label><span>Wobble</span><span id="sWobble">0.30</span></label>
        <input id="wobble" type="range" min="0" max="100" value="30" />
      </div>

      <div class="group">
        <label><span>Shield strength</span><span id="sShield">0.50</span></label>
        <input id="shield" type="range" min="0" max="100" value="50" />
      </div>

      <div class="btns">
        <button id="btnStart">Start</button>
        <button class="ghost" id="btnPause">Pause</button>
        <button class="ghost" id="btnReset">Reset</button>
        <button class="danger" id="btnPanic">Panic Stop</button>
      </div>

      <div class="callout">
        This Step 0 is intentionally simple so it cannot “break”. Once this runs perfectly, we upgrade Step 1: add labels + panels, then Step 2: tile map, then Step 3: plot, then Step 4: CST lock.
      </div>

      <div id="err">
        <b>Script error</b>
        <pre id="errText"></pre>
      </div>
    </section>

    <section class="card">
      <h2>Stage</h2>
      <div class="stage">
        <canvas id="cv" width="1100" height="520"></canvas>
      </div>
    </section>
  </div>
</div>
<script>
(() => {
  "use strict";

  // Hard error catcher
  window.addEventListener("error", (e)=>{
    const box = document.getElementById("err");
    const pre = document.getElementById("errText");
    if (!box || !pre) return;
    box.style.display = "block";
    pre.textContent = (e && e.error && e.error.stack) ? e.error.stack : (e.message || String(e));
  });

  const $ = (id)=>document.getElementById(id);

  const cv = $("cv");
  const ctx = cv.getContext("2d");

  // Inputs
  const ui = {
    energy: $("energy"),
    field: $("field"),
    bubble: $("bubble"),
    wobble: $("wobble"),
    shield: $("shield"),
    start: $("btnStart"),
    pause: $("btnPause"),
    reset: $("btnReset"),
    panic: $("btnPanic")
  };

  // Output labels
  const out = {
    sEnergy: $("sEnergy"),
    sField: $("sField"),
    sBubble: $("sBubble"),
    sWobble: $("sWobble"),
    sShield: $("sShield"),
    kEnergy: $("kEnergy"),
    kField: $("kField"),
    kBubble: $("kBubble"),
    status: $("statusText"),
    tText: $("tText")
  };

  // State (super basic)
  const S = {
    running:false,
    t:0,            // seconds
    energy:50,
    field:40,
    bubble:0.60,    // 0..1
    wobble:0.30,    // 0..1
    shield:0.50     // 0..1
  };

  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  function readUI(){
    S.energy = +ui.energy.value;
    S.field  = +ui.field.value;
    S.bubble = (+ui.bubble.value)/100;
    S.wobble = (+ui.wobble.value)/100;
    S.shield = (+ui.shield.value)/100;

    out.sEnergy.textContent = String(S.energy);
    out.sField.textContent  = String(S.field);
    out.sBubble.textContent = S.bubble.toFixed(2);
    out.sWobble.textContent = S.wobble.toFixed(2);
    out.sShield.textContent = S.shield.toFixed(2);

    out.kEnergy.textContent = String(S.energy);
    out.kField.textContent  = String(S.field);
    out.kBubble.textContent = S.bubble.toFixed(2);
  }

  // Hook sliders
  [ui.energy,ui.field,ui.bubble,ui.wobble,ui.shield].forEach(el=>{
    el.addEventListener("input", readUI);
  });

  // Hook buttons
  ui.start.addEventListener("click", ()=>{ S.running=true; out.status.textContent="Running"; });
  ui.pause.addEventListener("click", ()=>{ S.running=false; out.status.textContent="Paused"; });
  ui.reset.addEventListener("click", ()=>{
    S.running=false;
    S.t=0;
    out.status.textContent="Reset";
    out.tText.textContent="0.00s";
  });
  ui.panic.addEventListener("click", ()=>{
    S.running=false;
    S.t=0;
    // also slam safe values so it “visibly stops”
    ui.energy.value=10;
    ui.field.value=10;
    ui.bubble.value=10;
    ui.wobble.value=0;
    ui.shield.value=100;
    readUI();
    out.status.textContent="PANIC STOP";
    out.tText.textContent="0.00s";
  });

  function resizeCanvas(){
    const rect = cv.getBoundingClientRect();
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    const w = Math.floor(rect.width * dpr);
    const h = Math.floor(rect.height * dpr);
    if (cv.width !== w || cv.height !== h){
      cv.width = w;
      cv.height = h;
    }
  }
  function draw(){
    resizeCanvas();
    const w = cv.width, h = cv.height;
    ctx.clearRect(0,0,w,h);

    const scale = w/1100;
    const cx = w*0.55;
    const cy = h*0.50;

    // Simple wobble motion (shield reduces wobble)
    const wobEff = S.wobble * (1 - 0.75*S.shield);
    const wobX = Math.sin(S.t*2.2) * (10 + 22*wobEff) * scale;
    const wobY = Math.cos(S.t*1.7) * (8  + 18*wobEff) * scale;
    const roll = Math.sin(S.t*1.3) * (0.06 + 0.12*wobEff);

    // Sizes (very basic)
    const uW = 560*scale;
    const uH = 240*scale;

    const bubbleR = (0.85 + 0.70*S.bubble) * (1.00 + 0.25*(S.field/100));
    const bx = uW*0.78*bubbleR;
    const by = uH*0.55*bubbleR;

    // Magnetic bubble (blue glow)
    ctx.save();
    ctx.translate(cx+wobX*0.7, cy+wobY*0.7);
    ctx.rotate(roll*0.45);

    const haloR = Math.max(bx,by)*1.35;
    const glow = ctx.createRadialGradient(0,0, haloR*0.10, 0,0, haloR);
    glow.addColorStop(0, `rgba(96,165,250,${0.06 + 0.18*(S.field/100) + 0.10*(S.energy/100)})`);
    glow.addColorStop(0.55, `rgba(96,165,250,${0.03 + 0.12*(S.field/100)})`);
    glow.addColorStop(1, `rgba(96,165,250,0)`);
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.ellipse(0,0, bx*1.18, by*1.18, 0, 0, Math.PI*2);
    ctx.fill();

    // Shield ring (green)
    ctx.lineWidth = (2 + 6*S.shield)*scale;
    ctx.strokeStyle = `rgba(52,211,153,${0.10 + 0.55*S.shield})`;
    ctx.beginPath();
    ctx.ellipse(0,0, bx, by, 0, 0, Math.PI*2);
    ctx.stroke();

    ctx.restore();

    // UFO outline (generic saucer)
    ctx.save();
    ctx.translate(cx+wobX, cy+wobY);
    ctx.rotate(roll);

    ctx.fillStyle = "rgba(148,163,184,.10)";
    ctx.strokeStyle = "rgba(148,163,184,.26)";
    ctx.lineWidth = 2*scale;
    ctx.beginPath();
    ctx.ellipse(0, 0, uW*0.56, uH*0.32, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();

    // rim highlight depends on field
    ctx.strokeStyle = `rgba(96,165,250,${0.12 + 0.60*(S.field/100)})`;
    ctx.lineWidth = 3*scale;
    ctx.beginPath();
    ctx.ellipse(0, 0, uW*0.59, uH*0.34, 0, 0, Math.PI*2);
    ctx.stroke();

    // dome
    ctx.fillStyle = "rgba(148,163,184,.14)";
    ctx.strokeStyle = "rgba(148,163,184,.30)";
    ctx.lineWidth = 2*scale;
    ctx.beginPath();
    ctx.ellipse(0,-uH*0.18, uW*0.22, uH*0.18, 0, Math.PI, 0, true);
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    // underside
    ctx.fillStyle = "rgba(15,23,42,.55)";
    ctx.strokeStyle = "rgba(148,163,184,.22)";
    ctx.lineWidth = 1.6*scale;
    ctx.beginPath();
    ctx.ellipse(0, uH*0.18, uW*0.35, uH*0.18, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();

    // tiny exhaust indicator (yellow) depends on energy
    const plume = 0.1 + 0.9*(S.energy/100);
    const len = uH*(0.30 + 0.55*plume);
    const w0  = uW*(0.03 + 0.07*plume);
    const w1  = uW*(0.08 + 0.20*plume);

    const pg = ctx.createRadialGradient(0, 0, 1, 0, len*0.7, len*1.2);
    pg.addColorStop(0, `rgba(251,191,36,${0.10 + 0.45*plume})`);
    pg.addColorStop(0.55, `rgba(251,191,36,${0.05 + 0.20*plume})`);
    pg.addColorStop(1, `rgba(251,191,36,0)`);
    ctx.fillStyle = pg;
    ctx.save();
    ctx.translate(0, uH*0.28);
    ctx.beginPath();
    ctx.moveTo(-w0, 0);
    ctx.lineTo(-w1, len);
    ctx.lineTo( w1, len);
    ctx.lineTo( w0, 0);
    ctx.closePath();
    ctx.fill();
    ctx.restore();

    ctx.restore();

    // HUD
    ctx.save();
    ctx.fillStyle = "rgba(229,231,235,.78)";
    ctx.font = `${Math.max(12, 14*(w/1100))}px ui-monospace, Menlo, Consolas, monospace`;
    ctx.fillText(`t=${S.t.toFixed(2)}s  energy=${S.energy}  field=${S.field}  bubble=${S.bubble.toFixed(2)}  shield=${S.shield.toFixed(2)}`, 14*scale, 24*scale);
    ctx.restore();
  }
  let last = performance.now();
  function loop(now){
    const dt = Math.min(0.05, Math.max(0, (now - last)/1000));
    last = now;

    if (S.running){
      S.t += dt;
      out.tText.textContent = S.t.toFixed(2) + "s";
    }
    // Always draw so sliders update even when paused
    draw();

    requestAnimationFrame(loop);
  }

  // init
  readUI();
  draw();
  requestAnimationFrame(loop);

  window.addEventListener("resize", ()=>{ last = performance.now(); draw(); });

})();
</script>
</body>
</html>
