<!-- ======================= PART 1 / 4 ======================= -->
<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Interstellar Star Clock ‚Äî Link Matrix + Right Panel Viewer</title>
<style>
  :root{
    color-scheme: dark;
    --bg:#020617;
    --ink:#e5e7eb;
    --muted:#9ca3af;
    --accent:#38bdf8;
    --accent2:#60a5fa;
    --panelA:rgba(15,23,42,0.96);
    --panelB:rgba(15,23,42,0.85);
    --line:rgba(148,163,184,0.28);
    --card:rgba(15,23,42,0.90);
    --cardLine:rgba(51,65,85,0.80);
    --good:#22c55e;
    --warn:#f59e0b;
  }
  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, var(--bg) 0, #000 55%, #000 100%);
    color: var(--ink);
    overflow:hidden;
  }
  .page-wrap{ min-height:100vh; padding:16px; display:flex; justify-content:center; }
  .panel{
    width:100%;
    max-width:1400px;
    height:calc(100vh - 32px);
    background: linear-gradient(135deg, var(--panelA), var(--panelB));
    border-radius: 18px;
    border: 1px solid rgba(56,189,248,0.35);
    box-shadow: 0 0 25px rgba(37,99,235,0.35), 0 0 80px rgba(15,23,42,0.85);
    position:relative;
    overflow:hidden;
  }
  .panel::before{
    content:"";
    position:absolute; inset:-40%;
    background-image:
      radial-gradient(circle at 10% 20%, rgba(59,130,246,0.15) 0, transparent 55%),
      radial-gradient(circle at 90% 15%, rgba(56,189,248,0.12) 0, transparent 55%),
      radial-gradient(circle at 50% 100%, rgba(129,140,248,0.12) 0, transparent 60%);
    opacity:0.85;
    pointer-events:none;
    z-index:0;
  }
  .panel-inner{ position:relative; z-index:1; height:100%; display:flex; flex-direction:column; }

  header{
    position:sticky; top:0; z-index:5;
    padding:14px 14px 10px;
    border-bottom:1px solid rgba(148,163,184,0.22);
    background: linear-gradient(to bottom, rgba(15,23,42,0.98) 0, rgba(15,23,42,0.90) 55%, rgba(15,23,42,0.0) 100%);
  }
  .title-row{ display:flex; flex-wrap:wrap; align-items:baseline; gap:10px; justify-content:space-between; }
  h1{ font-size: 1.15rem; margin: 0; color: #bfdbfe; letter-spacing: 0.04em; text-transform: uppercase; }
  .subtitle{ font-size: 0.76rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.18em; }

  .bar{ margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .search-bar{
    flex:1; min-width:280px;
    display:flex; align-items:center; gap:8px;
    background: rgba(15,23,42,0.9);
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.65);
    padding: 6px 10px;
  }
  .search-icon{ opacity:0.9; }
  #searchInput{
    flex:1; border:none; outline:none; background:transparent;
    color: var(--ink); font-size:0.88rem;
  }
  #searchInput::placeholder{ color:#6b7280; }

  .btn{
    border:none; outline:none; border-radius:999px;
    padding:6px 10px;
    font-size:0.72rem;
    text-transform:uppercase;
    letter-spacing:0.12em;
    background: rgba(31,41,55,0.9);
    color: #e5e7eb;
    border:1px solid rgba(55,65,81,0.9);
    cursor:pointer;
    white-space:nowrap;
  }
  .btn:hover{ background: rgba(55,65,81,0.95); }
  .btn:active{ transform: translateY(1px); }
  .btn.secondary{ color: var(--muted); }

  .status-row{ font-size:0.72rem; color: var(--muted); display:flex; gap:8px; flex-wrap:wrap; }
  .pill{
    border-radius:999px;
    padding:3px 10px;
    border: 1px solid rgba(55,65,81,0.9);
    background: rgba(15,23,42,0.55);
  }
  .pill b{ color:#e5e7eb; font-weight:800; }

  .content{
    flex:1; min-height:0;
    padding:12px;
    display:grid;
    grid-template-columns: 520px 1fr;
    gap:12px;
  }

  .left, .right{
    border-radius:14px;
    border:1px solid rgba(51,65,85,0.75);
    background: rgba(2,6,23,0.35);
    overflow:hidden;
    min-height:0;
  }
  .section-head{
    padding:10px 10px;
    border-bottom:1px solid rgba(148,163,184,0.18);
    background: linear-gradient(to right, rgba(15,23,42,0.92), rgba(15,23,42,0.78));
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .section-head .label{
    font-size:0.74rem;
    letter-spacing:0.16em;
    text-transform:uppercase;
    color: var(--muted);
  }

  .list{ height:100%; overflow:auto; padding:10px; }
  .category-group{
    border-radius: 14px;
    border: 1px solid rgba(55,65,81,0.9);
    background: radial-gradient(circle at top left, rgba(30,64,175,0.22), rgba(15,23,42,0.96));
    overflow:hidden;
    margin-bottom:10px;
  }
  .category-header{
    width:100%;
    border:none; outline:none;
    background: linear-gradient(to right, rgba(15,23,42,0.98), rgba(15,23,42,0.92));
    padding:10px 12px;
    display:flex; align-items:center; justify-content:space-between;
    color: var(--ink);
    cursor:pointer;
  }
  .category-main{ display:flex; align-items:center; gap:10px; }
  .cat-icon{ font-size:1.1rem; }
  .cat-text{ display:flex; flex-direction:column; align-items:flex-start; }
  .cat-name{ font-size:0.92rem; font-weight:800; color:#e5e7eb; }
  .cat-meta{ font-size:0.70rem; color: var(--muted); text-transform:uppercase; letter-spacing:0.14em; }
  .cat-toggle{ font-size:0.9rem; opacity:0.9; transition: transform .18s ease; }
  .category-group.collapsed .cat-toggle{ transform: rotate(-90deg); }
  .category-body{
    border-top:1px solid rgba(31,41,55,0.9);
    padding:10px;
    display:grid;
    gap:8px;
  }
  .category-group.collapsed .category-body{ display:none; }

  .card{
    border-radius:12px;
    border:1px solid var(--cardLine);
    background: var(--card);
    padding:10px 10px;
    cursor:pointer;
    transition: border-color 0.18s ease, box-shadow 0.18s ease, transform 0.12s ease, background 0.18s ease;
  }
  .card:hover{
    border-color: rgba(96,165,250,0.9);
    box-shadow: 0 0 12px rgba(59,130,246,0.55);
    transform: translateY(-1px);
    background: radial-gradient(circle at top, rgba(30,64,175,0.55), rgba(15,23,42,0.96));
  }
  .card.active{
    border-color: rgba(56,189,248,0.95);
    box-shadow: 0 0 14px rgba(56,189,248,0.35);
  }
  .card-title{ font-weight:900; color:#bfdbfe; margin:0 0 4px; font-size:0.94rem; }
  .card-desc{ margin:0 0 8px; font-size:0.76rem; line-height:1.25; color:#cbd5e1; opacity:0.95; }
  .card-meta{ display:flex; justify-content:space-between; gap:10px; font-size:0.70rem; color: var(--muted); }
  .card-meta span{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 250px; }
  .tagline{ font-size:0.68rem; color:#c4b5fd; margin-top:6px; }
<!-- ======================= PART 2 / 4 ======================= -->
  .viewer{ height:100%; display:flex; flex-direction:column; min-height:0; }
  .viewer-bar{
    padding:10px;
    border-bottom:1px solid rgba(148,163,184,0.18);
    background: rgba(15,23,42,0.72);
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .viewer-title{
    min-width:0;
    display:flex; flex-direction:column; gap:2px;
  }
  .viewer-title .top{
    font-weight:900;
    font-size:0.94rem;
    color:#e5e7eb;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width: 760px;
  }
  .viewer-title .bottom{
    font-size:0.72rem;
    color: var(--muted);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width: 760px;
  }
  .viewer-actions{ display:flex; gap:8px; flex-wrap:wrap; }
  iframe{
    border:none;
    width:100%;
    flex:1;
    min-height:0;
    background:#000;
  }
  .note{
    padding:10px;
    font-size:0.78rem;
    color: var(--muted);
    border-top:1px solid rgba(148,163,184,0.18);
    background: rgba(15,23,42,0.55);
  }
  .note b{ color:#e5e7eb; }
  .note .dot{ display:inline-block; width:8px; height:8px; border-radius:999px; background: rgba(34,197,94,0.9); margin-right:6px; }
  .note .dot.warn{ background: rgba(245,158,11,0.9); }

  @media (max-width: 1100px){
    body{ overflow:auto; }
    .panel{ height:auto; }
    .content{ grid-template-columns:1fr; }
    iframe{ height:70vh; }
  }
</style>
</head>

<body>
  <div class="page-wrap">
    <div class="panel">
      <div class="panel-inner">

        <header>
          <div class="title-row">
            <div>
              <h1>Interstellar Star Clock ‚Äî Link Matrix + Viewer</h1>
              <div class="subtitle">Search ‚Üí click a page ‚Üí loads in the right panel (iframe)</div>
            </div>
          </div>

          <div class="bar">
            <div class="search-bar">
              <div class="search-icon">üîç</div>
              <input id="searchInput" type="text" placeholder="Filter: warp, time, engine, ufo, hex, water, lotto, dyson..." />
              <button class="btn" type="button" id="clearBtn">Clear</button>
            </div>

            <button class="btn secondary" type="button" id="expandAllBtn">Expand All</button>
            <button class="btn secondary" type="button" id="collapseAllBtn">Collapse All</button>

            <div class="status-row">
              <div class="pill"><b id="countPill">0</b> links</div>
              <div class="pill" id="filterPill">Showing all</div>
            </div>
          </div>
        </header>

        <div class="content">
          <section class="left">
            <div class="section-head">
              <div class="label">Categories + Pages</div>
              <div class="label">Click to load</div>
            </div>
            <div class="list" id="list"></div>
          </section>

          <section class="right">
            <div class="section-head">
              <div class="label">Right Panel</div>
              <div class="label">Embedded Live Page</div>
            </div>

            <div class="viewer">
              <div class="viewer-bar">
                <div class="viewer-title">
                  <div class="top" id="vTitle">Select a page on the left</div>
                  <div class="bottom" id="vUrl">‚Äî</div>
                </div>
                <div class="viewer-actions">
                  <button class="btn" type="button" id="openBtn">Open</button>
                  <button class="btn" type="button" id="reloadBtn">Reload</button>
                </div>
              </div>

              <iframe id="frame" title="Right Panel Viewer"></iframe>

              <div class="note" id="note">
                <span class="dot"></span><b>Tip:</b> If a page ever shows blank in the iframe, it usually means that page has a script error or uses something that doesn‚Äôt like iframes.
                <span class="dot warn"></span><b>Open</b> will still work in a new tab.
              </div>
            </div>
          </section>
        </div>
<!-- ======================= PART 3 / 4 ======================= -->
      </div>
    </div>
  </div>

<script>
  // ========= YOUR FULL LINKS ARRAY (from the Link Matrix) =========
  // (Kept as-is; viewer uses it directly.)
  const links = [
    // =========================
    // Warp Systems & Tunnels
    // =========================
    { title: "Warp Control Even Grid v3.5", file: "warp_control_even_grid_v3_5.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warp_control_even_grid_v3_5.html", category: "Warp Systems & Tunnels", tags: ["warp", "grid", "control", "reset"] },
    { title: "Warp Drive Concept", file: "warpdriveconcept.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdriveconcept.html", category: "Warp Systems & Tunnels", tags: ["warp", "concept", "geometry"] },
    { title: "Warp Master Equation Reset Hub", file: "warp_master_equation_reset_hub_simulator.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warp_master_equation_reset_hub_simulator.html", category: "Warp Systems & Tunnels", tags: ["warp", "master equation", "reset", "simulator"] },
    { title: "Warp Tunnels", file: "warptunnels.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warptunnels.html", category: "Warp Systems & Tunnels", tags: ["warp", "tunnel", "curvature"] },
    { title: "Warp Transporter", file: "warptransporter.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warptransporter.html", category: "Warp Systems & Tunnels", tags: ["warp", "transporter", "teleport"] },
    { title: "FTL vs Expansion Warp Tunnel Simulator", file: "ftl_vs_expansion_curvature_warp_tunnel_simulator.html", url: "https://gabinoc67.github.io/interstellar-star-clock/ftl_vs_expansion_curvature_warp_tunnel_simulator.html", category: "Warp Systems & Tunnels", tags: ["FTL", "expansion", "warp", "tunnel"] },

    // warpdrive folder
    { title: "Warpdrive ‚Äî Index", file: "warpdrive/index.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/index.html", category: "Warp Systems & Tunnels", tags: ["warpdrive", "index", "hub"] },
    { title: "Warpdrive ‚Äî Bubble Engine", file: "warpdrive/bubbleegine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/bubbleegine.html", category: "Warp Systems & Tunnels", tags: ["warp", "bubble", "engine"] },
    { title: "Warp Engine Chamber", file: "warpdrive/enginechamber.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/enginechamber.html", category: "Warp Systems & Tunnels", tags: ["warp", "engine", "chamber"] },
    { title: "Warpdrive ‚Äî Harmonic", file: "warpdrive/harmonic.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/harmonic.html", category: "Warp Systems & Tunnels", tags: ["warp", "harmonic", "field"] },
    { title: "Warpdrive ‚Äî Vectors Panel", file: "warpdrive/vectors-panel.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/vectors-panel.html", category: "Warp Systems & Tunnels", tags: ["warp", "vectors", "panel"] },
    { title: "Warpdrive ‚Äî Warp Control Even Grid v3.5", file: "warpdrive/warp_control_even_grid_v3_5.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/warp_control_even_grid_v3_5.html", category: "Warp Systems & Tunnels", tags: ["warp", "grid", "control", "warpdrive"] },
    { title: "Star Trek Warp", file: "warpdrive/startreck.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/startreck.html", category: "Warp Systems & Tunnels", tags: ["warp", "startrek", "visual"] },

    // =========================
    // Engines & Propulsion
    // =========================
    { title: "Accustic Engine", file: "accustic.html", url: "https://gabinoc67.github.io/interstellar-star-clock/accustic.html", category: "Engines & Propulsion", tags: ["engine", "sound", "accustic"] },
    { title: "Engine 3 Update", file: "engine3update.html", url: "https://gabinoc67.github.io/interstellar-star-clock/engine3update.html", category: "Engines & Propulsion", tags: ["engine", "update", "v3"] },
    { title: "Engine 4 Update", file: "engine4update.html", url: "https://gabinoc67.github.io/interstellar-star-clock/engine4update.html", category: "Engines & Propulsion", tags: ["engine", "update", "v4"] },
    { title: "Engine 5 Update", file: "engine5update.html", url: "https://gabinoc67.github.io/interstellar-star-clock/engine5update.html", category: "Engines & Propulsion", tags: ["engine", "update", "v5"] },
    { title: "Engine Demo", file: "enginedemo.html", url: "https://gabinoc67.github.io/interstellar-star-clock/enginedemo.html", category: "Engines & Propulsion", tags: ["engine", "demo"] },
    { title: "Engine Demo 2", file: "enginedemo2.html", url: "https://gabinoc67.github.io/interstellar-star-clock/enginedemo2.html", category: "Engines & Propulsion", tags: ["engine", "demo", "v2"] },
    { title: "Engine Real 2", file: "enginereal2.html", url: "https://gabinoc67.github.io/interstellar-star-clock/enginereal2.html", category: "Engines & Propulsion", tags: ["engine", "real", "warp"] },
    { title: "Real Engine", file: "realengine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/realengine.html", category: "Engines & Propulsion", tags: ["engine", "real"] },
    { title: "Regular Fuel Engine", file: "Regularfuel.html", url: "https://gabinoc67.github.io/interstellar-star-clock/Regularfuel.html", category: "Engines & Propulsion", tags: ["engine", "fuel"] },
    { title: "Shield Engine", file: "shieldengine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/shieldengine.html", category: "Engines & Propulsion", tags: ["shield", "engine", "protection"] },
    { title: "Super Ship", file: "supership.html", url: "https://gabinoc67.github.io/interstellar-star-clock/supership.html", category: "Engines & Propulsion", tags: ["ship", "engine", "warp"] },
    { title: "Warp Rocket Engine", file: "warpdrive/rocketengine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpdrive/rocketengine.html", category: "Engines & Propulsion", tags: ["warp", "rocket", "engine"] },
    { title: "2D Style Engine Demo", desc: "Simple 2D engine panel so anyone can view the concept without Python or heavy 3D.", file: "demo/2dstyleengine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/2dstyleengine.html", category: "Engines & Propulsion", tags: ["demo", "engine", "2D", "panel"] },
    { title: "Mach 10 Demo", desc: "Mach-10 performance demo panel (speed/heat/stability concept view).", file: "demo/mach10.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/mach10.html", category: "Engines & Propulsion", tags: ["demo", "mach", "mach10", "hypersonic", "engine"] },
    { title: "Mach Trip Demo", desc: "Mach trip demo (route-style speed profile with stability/controls view).", file: "demo/mach10trip.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/mach10trip.html", category: "Engines & Propulsion", tags: ["demo", "mach", "trip", "route", "stability"] },
    { title: "Mach 10 RCS Demo", desc: "Mach-10 RCS stability demo (reaction-control style correction concept).", file: "demo/mach10rcs.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/mach10rcs.html", category: "Engines & Propulsion", tags: ["demo", "mach10", "rcs", "stability", "hypersonic", "control"] },
    { title: "Mach 10 Trip RCS Demo", desc: "Route-style Mach trip demo with RCS stability assist overlays.", file: "demo/mach10triprcs.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/mach10triprcs.html", category: "Engines & Propulsion", tags: ["demo", "mach10", "trip", "rcs", "route", "control"] },
    { title: "Mach 10 RCS Slim Demo", desc: "Slim RCS demo layout for quick viewing (compact Mach-10 stability controls).", file: "demo/mach10rcsslim.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/mach10rcsslim.html", category: "Engines & Propulsion", tags: ["demo", "mach10", "rcs", "slim", "compact", "control"] },

    // =========================
    // Time, Clocks & Dimensions
    // =========================
    { title: "Ancient Clock", file: "time/ancientclock.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/ancientclock.html", category: "Time, Clocks & Dimensions", tags: ["clock", "ancient", "time"] },
    { title: "Cosmic Clock Gears Syn v3", file: "time/cosmic_clock_gears_syn_v3.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/cosmic_clock_gears_syn_v3.html", category: "Time, Clocks & Dimensions", tags: ["cosmic", "clock", "gears", "sync", "v3"] },
    { title: "Dimensions (Time)", file: "time/dimensions.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/dimensions.html", category: "Time, Clocks & Dimensions", tags: ["dimensions", "time"] },
    { title: "Time Dilation", file: "dilation.html", url: "https://gabinoc67.github.io/interstellar-star-clock/dilation.html", category: "Time, Clocks & Dimensions", tags: ["time", "dilation"] },
    { title: "Time Machine", file: "time/timemachine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/timemachine.html", category: "Time, Clocks & Dimensions", tags: ["time", "machine", "travel"] },
    { title: "Time Machine 2", file: "time/timemachine2.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/timemachine2.html", category: "Time, Clocks & Dimensions", tags: ["time", "machine", "v2"] },
    { title: "Time Travel", file: "time/timetravel.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/timetravel.html", category: "Time, Clocks & Dimensions", tags: ["time", "travel"] },
    { title: "UGT Time Convert", file: "ugttimeconvet.html", url: "https://gabinoc67.github.io/interstellar-star-clock/ugttimeconvet.html", category: "Time, Clocks & Dimensions", tags: ["time", "converter", "UGT"] },
    { title: "Updated Dimensions", file: "time/updatedimensions.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/updatedimensions.html", category: "Time, Clocks & Dimensions", tags: ["dimensions", "update"] },
    { title: "Updated Time Machine", file: "time/updatetimemachine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/time/updatetimemachine.html", category: "Time, Clocks & Dimensions", tags: ["time", "machine", "update"] },
    { title: "4 Dimension", file: "4dimension.html", url: "https://gabinoc67.github.io/interstellar-star-clock/4dimension.html", category: "Time, Clocks & Dimensions", tags: ["4D", "dimension", "geometry"] },
    { title: "Dilation Sat Demo", desc: "Satellite-style time dilation visualization (orbital clock offset intuition).", file: "demo/dilationsat.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/dilationsat.html", category: "Time, Clocks & Dimensions", tags: ["demo", "dilation", "satellite", "time"] },
    { title: "Kinetic Dilation Demo", desc: "Velocity-based time dilation demo (motion ‚Üí clock slowing).", file: "demo/kineticdilation.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/kineticdilation.html", category: "Time, Clocks & Dimensions", tags: ["demo", "kinetic", "dilation", "relativity"] },
    { title: "Emotion PC Time Demo", desc: "Emotion PC + time discipline demo (time-anchored interface concept).", file: "demo/emotionpctime.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/emotionpctime.html", category: "Time, Clocks & Dimensions", tags: ["demo", "emotion", "pc", "time", "CST"] },

    // =========================
    // Quantum, EM & Theory
    // =========================
    { title: "Einstein Theory", file: "einsteintheory.html", url: "https://gabinoc67.github.io/interstellar-star-clock/einsteintheory.html", category: "Quantum, EM & Theory", tags: ["Einstein", "theory", "relativity"] },
    { title: "Electro Warp", file: "electronwarp.html", url: "https://gabinoc67.github.io/interstellar-star-clock/electronwarp.html", category: "Quantum, EM & Theory", tags: ["electro", "warp", "field"] },
    { title: "EM Strings", file: "emstring.html", url: "https://gabinoc67.github.io/interstellar-star-clock/emstring.html", category: "Quantum, EM & Theory", tags: ["EM", "strings", "field"] },
    { title: "Entanglement Logic Visual Diagram", file: "entanglement_logic_visual_diagram.html", url: "https://gabinoc67.github.io/interstellar-star-clock/entanglement_logic_visual_diagram.html", category: "Quantum, EM & Theory", tags: ["entanglement", "logic", "diagram"] },
    { title: "Master Equation", file: "masterequation.html", url: "https://gabinoc67.github.io/interstellar-star-clock/masterequation.html", category: "Quantum, EM & Theory", tags: ["equation", "theory"] },
    { title: "Methods", file: "methods.html", url: "https://gabinoc67.github.io/interstellar-star-clock/methods.html", category: "Quantum, EM & Theory", tags: ["methods", "derivation"] },
    { title: "Real Symphony", file: "realsmphony.html", url: "https://gabinoc67.github.io/interstellar-star-clock/realsmphony.html", category: "Quantum, EM & Theory", tags: ["symphony", "field"] },
    { title: "Stability Simulator", file: "stable.html", url: "https://gabinoc67.github.io/interstellar-star-clock/stable.html", category: "Quantum, EM & Theory", tags: ["stability", "simulation"] },
    { title: "Symphony Generator", file: "symphonygen.html", url: "https://gabinoc67.github.io/interstellar-star-clock/symphonygen.html", category: "Quantum, EM & Theory", tags: ["symphony", "generator"] },
    { title: "Update Real Symphony", file: "updaterealsmphony.html", url: "https://gabinoc67.github.io/interstellar-star-clock/updaterealsmphony.html", category: "Quantum, EM & Theory", tags: ["symphony", "update"] },
    { title: "Wave Simulation", file: "wave.html", url: "https://gabinoc67.github.io/interstellar-star-clock/wave.html", category: "Quantum, EM & Theory", tags: ["wave", "simulation"] },
    { title: "Dyson Calculator Demo", desc: "Quick Dyson-related calculator panel for energy/mass/scale checks.", file: "demo/dysoncalculator.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/dysoncalculator.html", category: "Quantum, EM & Theory", tags: ["demo", "dyson", "calculator", "energy"] },
    { title: "Dyson Einstein Equation Demo", desc: "Einstein equation / CST-style equation view inside the Dyson workflow.", file: "demo/dysoneinsteineq.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/dysoneinsteineq.html", category: "Quantum, EM & Theory", tags: ["demo", "dyson", "einstein", "equation"] },
    { title: "Holy Grail Formula Demo", desc: "Single-page formula focus: show the core relationship clearly and fast.", file: "demo/holygrailformula.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/holygrailformula.html", category: "Quantum, EM & Theory", tags: ["demo", "formula", "core", "equation"] },
    { title: "Maryam Demo", desc: "Maryam concept page (theory/notes demo) in the CST / equation workspace.", file: "demo/maryam.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/maryam.html", category: "Quantum, EM & Theory", tags: ["demo", "maryam", "theory", "CST"] },
    { title: "Dyson Sentient Geometry Demo", desc: "Dyson + sentient geometry concept demo (geometry-driven control intuition).", file: "demo/dysonsentigeometry.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/dysonsentigeometry.html", category: "Quantum, EM & Theory", tags: ["demo", "dyson", "sentient", "geometry", "theory"] },

    // =========================
    // Navigation & GPS
    // =========================
    { title: "Destinations Map", file: "destinations.html", url: "https://gabinoc67.github.io/interstellar-star-clock/destinations.html", category: "Navigation & GPS", tags: ["destinations", "map"] },
    { title: "Directions", file: "directions.html", url: "https://gabinoc67.github.io/interstellar-star-clock/directions.html", category: "Navigation & GPS", tags: ["directions", "navigation"] },
    { title: "GPS Time / Nav", file: "gps.html", url: "https://gabinoc67.github.io/interstellar-star-clock/gps.html", category: "Navigation & GPS", tags: ["GPS", "time", "navigation"] },
    { title: "Navigation Spaceship", file: "navspaceship.html", url: "https://gabinoc67.github.io/interstellar-star-clock/navspaceship.html", category: "Navigation & GPS", tags: ["navigation", "spaceship"] },
    { title: "Mars Demo", desc: "Mars mission / concept demo page for navigation + environment idea testing.", file: "demo/marsdemo.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/marsdemo.html", category: "Navigation & GPS", tags: ["demo", "mars", "mission", "navigation"] },

    // =========================
    // Lotto & Cash Simulators
    // =========================
    { title: "Cash Simulator", file: "cash.html", url: "https://gabinoc67.github.io/interstellar-star-clock/cash.html", category: "Lotto & Cash Simulators", tags: ["cash", "money"] },
    { title: "Lotto", file: "lotto.html", url: "https://gabinoc67.github.io/interstellar-star-clock/lotto.html", category: "Lotto & Cash Simulators", tags: ["lotto", "numbers"] },
    { title: "Lotto Simulator Exclusive", file: "lotto_sim_exclusive.html", url: "https://gabinoc67.github.io/interstellar-star-clock/lotto_sim_exclusive.html", category: "Lotto & Cash Simulators", tags: ["lotto", "simulator", "exclusive"] },
    { title: "Lotto Loco", file: "lottoloco.html", url: "https://gabinoc67.github.io/interstellar-star-clock/lottoloco.html", category: "Lotto & Cash Simulators", tags: ["lotto", "loco"] },
    { title: "Lotto Dyson", file: "lottodyson.html", url: "https://gabinoc67.github.io/interstellar-star-clock/lottodyson.html", category: "Lotto & Cash Simulators", tags: ["lotto", "dyson", "numbers"] },
    { title: "Lotto Loco Dyson", file: "lottolocodyson.html", url: "https://gabinoc67.github.io/interstellar-star-clock/lottolocodyson.html", category: "Lotto & Cash Simulators", tags: ["lotto", "loco", "dyson"] },
    { title: "Cash Dyson Demo", desc: "Cash simulation with Dyson-style filtering / constraint concept.", file: "demo/cashdyson.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/cashdyson.html", category: "Lotto & Cash Simulators", tags: ["demo", "cash", "dyson", "money", "simulator"] },
    { title: "Lotto Stroke (Stokes) Panel", desc: "Lotto + stroke/circulation visualization for your Dyson/Prune/Decay workflow.", file: "lottostroke.html", url: "https://gabinoc67.github.io/interstellar-star-clock/lottostroke.html", category: "Lotto & Cash Simulators", tags: ["lotto", "stroke", "stokes", "dyson", "prune", "decay"] },

    // =========================
    // Robotics, AI & Sentience
    // =========================
    { title: "Advanced Robot", file: "advancerobot.html", url: "https://gabinoc67.github.io/interstellar-star-clock/advancerobot.html", category: "Robotics, AI & Sentience", tags: ["robot", "advanced"] },
    { title: "Emotion PC", file: "emotionpc.html", url: "https://gabinoc67.github.io/interstellar-star-clock/emotionpc.html", category: "Robotics, AI & Sentience", tags: ["emotion", "PC", "AI"] },
    { title: "Home Quantum Computer", file: "homequantumcomputer.html", url: "https://gabinoc67.github.io/interstellar-star-clock/homequantumcomputer.html", category: "Robotics, AI & Sentience", tags: ["quantum", "computer", "home"] },
    { title: "Sentient Computer", file: "sentientcomputer.html", url: "https://gabinoc67.github.io/interstellar-star-clock/sentientcomputer.html", category: "Robotics, AI & Sentience", tags: ["sentient", "computer", "AI"] },
    { title: "Dyson Advanced Robot Demo", desc: "Dyson workflow version of the advanced robot concept panel.", file: "demo/dysonadvancerobot.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/dysonadvancerobot.html", category: "Robotics, AI & Sentience", tags: ["demo", "dyson", "robot", "AI"] },
    { title: "Dyson Emotion PC Demo", desc: "Dyson workflow version of Emotion PC (AI/sentience interface concept).", file: "demo/dysonemotionpc.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/dysonemotionpc.html", category: "Robotics, AI & Sentience", tags: ["demo", "dyson", "emotion", "AI"] },
    { title: "Quantum Dyson PC Demo", desc: "Quantum-style Dyson PC interface demo (stochastic quantum UI + Dyson constraints).", file: "demo/quantumdysonpc.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/quantumdysonpc.html", category: "Robotics, AI & Sentience", tags: ["demo", "quantum", "dyson", "pc", "AI", "interface"] },

    // =========================
    // Demos & Labs
    // =========================
    { title: "3I Atlas Demo", file: "demos/3iatlas.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/3iatlas.html", category: "Demos & Labs", tags: ["demos", "atlas", "3i"] },
    { title: "5G EN Demo", file: "demos/5gen.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/5gen.html", category: "Demos & Labs", tags: ["demos", "5g", "network"] },
    { title: "FTAMCS Demo", file: "demos/FTAMCS.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/FTAMCS.html", category: "Demos & Labs", tags: ["demos", "ftamcs", "systems"] },
    { title: "All Data Demo", file: "demos/alldata.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/alldata.html", category: "Demos & Labs", tags: ["demos", "data", "all"] },
    { title: "Cities Demo", file: "demos/cities.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/cities.html", category: "Demos & Labs", tags: ["demos", "cities", "geo"] },
    { title: "City Compare Demo", file: "demos/citycompare.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/citycompare.html", category: "Demos & Labs", tags: ["demos", "cities", "compare"] },
    { title: "Coms Demo", file: "demos/coms.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/coms.html", category: "Demos & Labs", tags: ["demos", "communications", "coms"] },
    { title: "Cores Demo", file: "demos/cores.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/cores.html", category: "Demos & Labs", tags: ["demos", "cores", "physics"] },
    { title: "Diseases Demo", file: "demos/diseases.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/diseases.html", category: "Demos & Labs", tags: ["demos", "diseases", "bio"] },
    { title: "Dy Matter Demo", file: "demos/dymatter.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/dymatter.html", category: "Demos & Labs", tags: ["demos", "matter", "dy"] },
    { title: "Earthquake Demo", file: "demos/earthquake.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/earthquake.html", category: "Demos & Labs", tags: ["demos", "earthquake", "seismic"] },
    { title: "Email Demo", file: "demos/email.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/email.html", category: "Demos & Labs", tags: ["demos", "email", "panel"] },
    { title: "Human Demo", file: "demos/human.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/human.html", category: "Demos & Labs", tags: ["demos", "human", "bio"] },
    { title: "Human Intel Demo", desc: "Human intelligence continuum demo (maturity, resets, imagination sliders).", file: "demos/humanintel.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/humanintel.html", category: "Demos & Labs", tags: ["demos", "human", "intel", "intelligence", "continuum"] },
    { title: "Matlab Demo (Demos)", file: "demos/matlab.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/matlab.html", category: "Demos & Labs", tags: ["demos", "matlab", "notes"] },
    { title: "Memory Panel Demo", file: "demos/memorypanel.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/memorypanel.html", category: "Demos & Labs", tags: ["demos", "memory", "panel"] },
    { title: "Meteor Demo", file: "demos/meteor.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/meteor.html", category: "Demos & Labs", tags: ["demos", "meteor", "space"] },
    { title: "Miracles Demo", file: "demos/miracless.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/miracless.html", category: "Demos & Labs", tags: ["demos", "miracles", "notes"] },
    { title: "Non-Theory Diseases Demo", file: "demos/nontheorydiseases.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/nontheorydiseases.html", category: "Demos & Labs", tags: ["demos", "diseases", "nontheory"] },
    { title: "RM Kit Demo", file: "demos/rmkit.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/rmkit.html", category: "Demos & Labs", tags: ["demos", "rmkit", "tools"] },
    { title: "Supernova Demo (Demos)", file: "demos/supernova.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/supernova.html", category: "Demos & Labs", tags: ["demos", "supernova", "astronomy"] },
    { title: "Test Lab Demo", file: "demos/testlab.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/testlab.html", category: "Demos & Labs", tags: ["demos", "testlab", "lab"] },
    { title: "Volcano Demo", file: "demos/volcano.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/volcano.html", category: "Demos & Labs", tags: ["demos", "volcano", "geo"] },
    { title: "VRMS Demo", file: "demos/vrms.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/vrms.html", category: "Demos & Labs", tags: ["demos", "vrms", "systems"] },
    { title: "Comprecisance Forces Demo", file: "demos/ccompresicance_forces.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/ccompresicance_forces.html", category: "Demos & Labs", tags: ["demos", "comprecisance", "forces"] },
    { title: "Torsion-Coherence Demo", file: "demos/Torsion-Coherence.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demos/Torsion-Coherence.html", category: "Demos & Labs", tags: ["demos", "torsion", "coherence"] },

    // =========================
    // Simulators, Tools & Misc
    // =========================
    { title: "Disclaimer", file: "disclaimer.html", url: "https://gabinoc67.github.io/interstellar-star-clock/disclaimer.html", category: "Simulators, Tools & Misc", tags: ["disclaimer", "legal"] },
    { title: "Arrow Shield", file: "arrow_shield.html", url: "https://gabinoc67.github.io/interstellar-star-clock/arrow_shield.html", category: "Simulators, Tools & Misc", tags: ["shield", "defense"] },
    { title: "Bubbles Field", file: "bubbles.html", url: "https://gabinoc67.github.io/interstellar-star-clock/bubbles.html", category: "Simulators, Tools & Misc", tags: ["bubbles", "field"] },
    { title: "Collider 2", file: "colider2.html", url: "https://gabinoc67.github.io/interstellar-star-clock/colider2.html", category: "Simulators, Tools & Misc", tags: ["collider", "v2"] },
    { title: "Collider 3", file: "colider3.html", url: "https://gabinoc67.github.io/interstellar-star-clock/colider3.html", category: "Simulators, Tools & Misc", tags: ["collider", "v3"] },
    { title: "Collider Engine", file: "colidengine.html", url: "https://gabinoc67.github.io/interstellar-star-clock/colidengine.html", category: "Simulators, Tools & Misc", tags: ["collider", "engine"] },
    { title: "Company Simo", file: "companysimo.html", url: "https://gabinoc67.github.io/interstellar-star-clock/companysimo.html", category: "Simulators, Tools & Misc", tags: ["company", "sim", "tools"] },
    { title: "Cone Dynamics", file: "cone.html", url: "https://gabinoc67.github.io/interstellar-star-clock/cone.html", category: "Simulators, Tools & Misc", tags: ["cone", "geometry"] },
    { title: "Event Horizon", file: "eventhorizon.html", url: "https://gabinoc67.github.io/interstellar-star-clock/eventhorizon.html", category: "Simulators, Tools & Misc", tags: ["event", "horizon", "gravity"] },
    { title: "E=mc¬≤ Calculator", file: "emecalculator.html", url: "https://gabinoc67.github.io/interstellar-star-clock/emecalculator.html", category: "Simulators, Tools & Misc", tags: ["E=mc2", "calculator"] },
    { title: "Firefox Test Page", file: "firefox.html", url: "https://gabinoc67.github.io/interstellar-star-clock/firefox.html", category: "Simulators, Tools & Misc", tags: ["firefox", "test"] },
    { title: "FOBAS AEWFC", file: "fobasaewfc.html", url: "https://gabinoc67.github.io/interstellar-star-clock/fobasaewfc.html", category: "Simulators, Tools & Misc", tags: ["FOBAS", "AEWFC"] },
    { title: "Limits Simulator", file: "limits.html", url: "https://gabinoc67.github.io/interstellar-star-clock/limits.html", category: "Simulators, Tools & Misc", tags: ["limits", "math"] },
    { title: "MATLAB Notes", file: "matlab.html", url: "https://gabinoc67.github.io/interstellar-star-clock/matlab.html", category: "Simulators, Tools & Misc", tags: ["MATLAB", "code"] },
    { title: "Planet Age Calculator", file: "planet-age-calculator.html", url: "https://gabinoc67.github.io/interstellar-star-clock/planet-age-calculator.html", category: "Simulators, Tools & Misc", tags: ["planet", "age", "calculator"] },
    { title: "Planet Clock", file: "planet_clock.html", url: "https://gabinoc67.github.io/interstellar-star-clock/planet_clock.html", category: "Simulators, Tools & Misc", tags: ["planet", "clock", "time"] },
    { title: "SPR COMCW", file: "sprcomcw.html", url: "https://gabinoc67.github.io/interstellar-star-clock/sprcomcw.html", category: "Simulators, Tools & Misc", tags: ["SPR", "COMCW"] },
    { title: "Taylor Calculator", file: "taylor.html", url: "https://gabinoc67.github.io/interstellar-star-clock/taylor.html", category: "Simulators, Tools & Misc", tags: ["Taylor", "series"] },
    { title: "Update Computer", file: "updatecomputer.html", url: "https://gabinoc67.github.io/interstellar-star-clock/updatecomputer.html", category: "Simulators, Tools & Misc", tags: ["update", "computer"] },
    { title: "Write Calculator", file: "writecalculator.html", url: "https://gabinoc67.github.io/interstellar-star-clock/writecalculator.html", category: "Simulators, Tools & Misc", tags: ["write", "calculator"] },
    { title: "Warp Calculator", file: "warpcalculator.html", url: "https://gabinoc67.github.io/interstellar-star-clock/warpcalculator.html", category: "Simulators, Tools & Misc", tags: ["warp", "calculator"] },
    { title: "Failure Injection Demo", desc: "Failure / fault demo page for stress-testing your system controls and recovery.", file: "demo/failure.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/failure.html", category: "Simulators, Tools & Misc", tags: ["demo", "failure", "fault", "recovery"] },
    { title: "Hexagon Demo", desc: "Hexagon baseline demo for lattice/geometry regulation visualization.", file: "demo/hexagon.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/hexagon.html", category: "Simulators, Tools & Misc", tags: ["demo", "hexagon", "lattice", "geometry"] },
    { title: "Hexagon Demo 2", desc: "Second hexagon variant (alternate parameters / layout version).", file: "demo/hexagon2.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/hexagon2.html", category: "Simulators, Tools & Misc", tags: ["demo", "hexagon", "variant", "v2"] },
    { title: "Hex Prune + Decay Demo", desc: "Prune/decay demo for stability cleanup (memory decay / surplus trim).", file: "demo/hexprunededcay.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/hexprunededcay.html", category: "Simulators, Tools & Misc", tags: ["demo", "hex", "prune", "decay", "stability"] },
    { title: "Pyramids Demo (Pry-Machine / Lever-Crane Line)", file: "demo/pyramaids.html", url: "https://gabinoc67.github.io/interstellar-star-clock/demo/pyramaids.html", category: "Simulators, Tools & Misc", tags: ["demo", "pyramids", "stonehenge", "maya", "lever", "crane"] }
  ];

  const categoryOrder = [
    "Warp Systems & Tunnels",
    "Engines & Propulsion",
    "Time, Clocks & Dimensions",
    "Quantum, EM & Theory",
    "Navigation & GPS",
    "Lotto & Cash Simulators",
    "Robotics, AI & Sentience",
    "Demos & Labs",
    "Simulators, Tools & Misc"
  ];

  const categoryMeta = {
    "Warp Systems & Tunnels": { icon:"üåÄ", meta:"Warp bubbles, tunnels, reset hubs" },
    "Engines & Propulsion": { icon:"üöÄ", meta:"Engines, shields, ship performance" },
    "Time, Clocks & Dimensions": { icon:"‚è±Ô∏è", meta:"Time, clocks, 4D geometry" },
    "Quantum, EM & Theory": { icon:"üß™", meta:"Quantum, EM, equations, symphonies" },
    "Navigation & GPS": { icon:"üß≠", meta:"Navigation, GPS, destinations" },
    "Lotto & Cash Simulators": { icon:"üé∞", meta:"Lotto & cash simulations" },
    "Robotics, AI & Sentience": { icon:"ü§ñ", meta:"Robots, AI, quantum computers" },
    "Demos & Labs": { icon:"üß´", meta:"Earth/data/health/physics lab demos" },
    "Simulators, Tools & Misc": { icon:"üß∞", meta:"Tools, math, tests, other sims" }
  };

  const $ = (id)=>document.getElementById(id);
  const listEl = $("list");
  const searchInput = $("searchInput");
  const clearBtn = $("clearBtn");
  const expandAllBtn = $("expandAllBtn");
  const collapseAllBtn = $("collapseAllBtn");
  const countPill = $("countPill");
  const filterPill = $("filterPill");

  const frame = $("frame");
  const vTitle = $("vTitle");
  const vUrl = $("vUrl");
  const openBtn = $("openBtn");
  const reloadBtn = $("reloadBtn");

  let activeIdx = -1;

  function groupLinks(){
    const groups = {};
    for (let i=0; i<links.length; i++){
      const l = links[i];
      if (!groups[l.category]) groups[l.category] = [];
      groups[l.category].push({ ...l, _idx:i });
    }
    for (const k of Object.keys(groups)){
      groups[k].sort((a,b)=> (a.title||"").localeCompare(b.title||""));
    }
    return groups;
  }
<!-- ======================= PART 4 / 4 ======================= -->
  function buildUI(){
    const groups = groupLinks();
    listEl.innerHTML = "";

    for (const cat of categoryOrder){
      const items = groups[cat];
      if (!items || items.length === 0) continue;

      const meta = categoryMeta[cat] || { icon:"üìÅ", meta:"" };

      const wrap = document.createElement("section");
      wrap.className = "category-group";
      wrap.dataset.category = cat;

      const header = document.createElement("button");
      header.type = "button";
      header.className = "category-header";

      const main = document.createElement("div");
      main.className = "category-main";

      const icon = document.createElement("div");
      icon.className = "cat-icon";
      icon.textContent = meta.icon;

      const txt = document.createElement("div");
      txt.className = "cat-text";

      const name = document.createElement("div");
      name.className = "cat-name";
      name.textContent = cat;

      const metaLine = document.createElement("div");
      metaLine.className = "cat-meta";
      metaLine.textContent = `${meta.meta} ¬∑ ${items.length} link(s)`;

      txt.appendChild(name);
      txt.appendChild(metaLine);
      main.appendChild(icon);
      main.appendChild(txt);

      const toggle = document.createElement("div");
      toggle.className = "cat-toggle";
      toggle.textContent = "‚ñæ";

      header.appendChild(main);
      header.appendChild(toggle);

      const body = document.createElement("div");
      body.className = "category-body";

      for (const l of items){
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.idx = String(l._idx);
        card.dataset.search = [
          l.title || "",
          l.desc || "",
          l.file || "",
          l.category || "",
          (l.tags || []).join(" "),
          l.url || ""
        ].join(" ").toLowerCase();

        const t = document.createElement("div");
        t.className = "card-title";
        t.textContent = l.title || "(untitled)";

        card.appendChild(t);

        if (l.desc){
          const d = document.createElement("div");
          d.className = "card-desc";
          d.textContent = l.desc;
          card.appendChild(d);
        }

        const metaRow = document.createElement("div");
        metaRow.className = "card-meta";
        const left = document.createElement("span");
        left.textContent = l.file || "";
        const right = document.createElement("span");
        right.textContent = (l.tags && l.tags.length) ? ("#" + l.tags.slice(0,5).join(" ¬∑ #")) : "";
        metaRow.appendChild(left);
        metaRow.appendChild(right);

        const tagLine = document.createElement("div");
        tagLine.className = "tagline";
        tagLine.textContent = l.category;

        card.appendChild(metaRow);
        card.appendChild(tagLine);

        card.addEventListener("click", ()=> load(l._idx));

        body.appendChild(card);
      }

      wrap.appendChild(header);
      wrap.appendChild(body);
      listEl.appendChild(wrap);

      header.addEventListener("click", ()=>{
        wrap.classList.toggle("collapsed");
      });
    }
  }

  function markActive(){
    const cards = Array.from(document.querySelectorAll(".card"));
    for (const c of cards) c.classList.remove("active");
    const target = cards.find(c => Number(c.dataset.idx) === activeIdx);
    if (target) target.classList.add("active");
  }

  function load(idx){
    const l = links[idx];
    if (!l) return;
    activeIdx = idx;
    markActive();
    vTitle.textContent = l.title || "(untitled)";
    vUrl.textContent = l.url || "‚Äî";
    frame.src = l.url || "";
  }

  function countVisibleCards(){
    const cards = Array.from(document.querySelectorAll(".card"));
    let n = 0;
    for (const c of cards){
      if (c.style.display !== "none") n++;
    }
    return n;
  }

  function applyFilter(){
    const term = (searchInput.value || "").trim().toLowerCase();
    const groups = Array.from(document.querySelectorAll(".category-group"));

    if (!term){
      for (const g of groups){
        g.style.display = "";
        // expand by default when cleared
        g.classList.remove("collapsed");
        const cards = Array.from(g.querySelectorAll(".card"));
        cards.forEach(c => c.style.display = "");
      }
      const total = countVisibleCards();
      countPill.textContent = total;
      filterPill.textContent = "Showing all";
      return;
    }

    let shown = 0;
    let catsWithMatches = 0;

    for (const g of groups){
      const cards = Array.from(g.querySelectorAll(".card"));
      let matchCount = 0;

      for (const c of cards){
        const hay = c.dataset.search || "";
        const ok = hay.includes(term);
        c.style.display = ok ? "" : "none";
        if (ok){ shown++; matchCount++; }
      }

      if (matchCount === 0){
        g.style.display = "none";
      } else {
        g.style.display = "";
        g.classList.remove("collapsed");
        catsWithMatches++;
      }
    }

    countPill.textContent = shown;

    if (shown === 0){
      filterPill.textContent = `No matches for "${term}"`;
    } else {
      filterPill.textContent = `Filter "${term}" ¬∑ ${shown} shown ¬∑ ${catsWithMatches} categor(ies)`;
    }
  }

  function expandAll(){
    document.querySelectorAll(".category-group").forEach(g => g.classList.remove("collapsed"));
  }
  function collapseAll(){
    document.querySelectorAll(".category-group").forEach(g => g.classList.add("collapsed"));
  }

  // Buttons
  clearBtn.addEventListener("click", ()=>{
    searchInput.value = "";
    applyFilter();
    searchInput.focus();
  });
  expandAllBtn.addEventListener("click", expandAll);
  collapseAllBtn.addEventListener("click", collapseAll);

  searchInput.addEventListener("input", applyFilter);
  searchInput.addEventListener("keydown", (e)=>{
    if (e.key === "Escape"){
      searchInput.value = "";
      applyFilter();
      searchInput.blur();
    }
  });

  openBtn.addEventListener("click", ()=>{
    if (activeIdx < 0) return;
    window.open(links[activeIdx].url, "_blank", "noopener,noreferrer");
  });

  reloadBtn.addEventListener("click", ()=>{
    if (!frame.src) return;
    frame.src = frame.src;
  });

  // Init
  buildUI();
  applyFilter();

  // Auto-load first link
  if (links.length) load(0);
</script>
</body>
</html>
