<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CST String-Dimension Jump Simulator — v3 (Lock-on Jump)</title>
<meta name="description" content="Present-time ball follows CST on current dimension until Jump is commanded; then locks at selected time and dimension." />
<style>
  :root{
    --bg:#0b1020;--panel:#111735;--ink:#eaf0ff;--muted:#a9b3d6;--accent:#8fb4ff;
    --grid:#20306b;--ring:#ff324f;--halo:#e9f4ff;--cursor:#7fb1ff;
    --border:#1a2550;--good:#35e6a2;--amber:#ffd15a;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  a{color:var(--accent)}
  .wrap{max-width:1300px;margin:0 auto;padding:16px}
  h1{margin:0 0 8px;font-size:1.6rem;letter-spacing:.2px}
  .sub{color:var(--muted);font-size:.95rem;margin-bottom:16px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:16px;align-items:start}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
  .card .hd{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
  .card .bd{padding:14px}
  .pill{font-size:.75rem;color:var(--muted);background:#0e1430;border:1px solid var(--border);padding:4px 8px;border-radius:999px}
  label{display:block;font-size:.85rem;color:var(--muted);margin:10px 0 6px}
  input[type="number"],input[type="time"],select{width:100%}
  input,select,button{background:#0c1330;color:var(--ink);border:1px solid var(--border);border-radius:10px;padding:8px}
  button{cursor:pointer}
  button.primary{background:linear-gradient(180deg,#2446b3,#1b2f7d);border-color:#1a2f7a}
  button.ghost{background:transparent}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  /* WALL */
  .wall{height:540px;position:relative;border-top:1px solid var(--border);border-bottom:1px solid var(--border);
    background:
      repeating-linear-gradient(to right, rgba(255,255,255,.05) 0 1px, transparent 1px 40px),
      linear-gradient(180deg, rgba(159,210,255,.04), rgba(159,210,255,.02));
    overflow:hidden;border-radius:14px;margin:8px 12px}
  .axis{position:absolute;left:0;right:0;height:1px;background:var(--grid);opacity:.7}
  .axis .lbl{position:absolute;left:8px;top:-10px;font-size:.7rem;color:var(--muted)}
  .hourTick{position:absolute;top:0;bottom:0;width:2px;background:#21316b;opacity:.35}
  .hourLbl{position:absolute;top:6px;font-size:.65rem;color:var(--muted);transform:translateX(-50%)}
  .legend{display:flex;gap:10px;flex-wrap:wrap;margin:8px 12px}
  .legend span{display:inline-flex;align-items:center;gap:6px;font-size:.8rem;color:var(--muted)}
  .dot{width:10px;height:10px;border-radius:50%}
  .stable{background:var(--ring)}
  .note{color:var(--muted);font-size:.8rem}
  .reading{font-variant-numeric:tabular-nums;font-weight:600}
  canvas#viz{position:absolute;inset:0}
</style>
</head>
<body>
<div class="wrap">
  <h1>CST String-Dimension Jump Simulator — v3</h1>
  <div class="sub">Ball with <strong>red rim</strong> rides the <strong>current CST time</strong> on the <strong>current dimension</strong>. Enter a <em>target hour</em> and <em>target dimension</em>, click <strong>Jump</strong>, and the ball will animate and <strong>lock</strong> there.</div>

  <div class="grid">
    <!-- LEFT: Controls -->
    <section class="card">
      <div class="hd"><div>Mission Planner</div><span class="pill">Inputs</span></div>
      <div class="bd">
        <div class="row">
          <div>
            <label>Current Dimension</label>
            <input type="number" id="curDim" min="1" max="12" value="1" />
          </div>
          <div>
            <label>CST Offset (hrs vs UTC)</label>
            <input type="number" id="cstOffset" step="0.25" value="0" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Target Dimension (1–12)</label>
            <input type="number" id="targetDim" min="1" max="12" value="5" />
          </div>
          <div>
            <label>Jump Hour (0–24)</label>
            <input type="number" id="destHour" min="0" max="24" step="0.1" value="23" />
          </div>
        </div>
        <div class="row" style="align-items:end">
          <button id="btnJump" class="primary">Jump & Lock</button>
          <button id="btnUnlock" class="ghost">Unlock (Return to Live)</button>
        </div>
        <div class="note" style="margin-top:8px">
          Live mode: ball follows CST hour on <strong>Current Dimension</strong>. Locked mode: ball stays at <strong>Target Dimension @ Jump Hour</strong> until you press <em>Unlock</em>.
        </div>
      </div>
    </section>

    <!-- RIGHT: Visualization -->
    <section class="card">
      <div class="hd"><div>String-Wall (24h)</div><span class="pill">CST Live</span></div>
      <div class="bd">
        <div class="legend">
          <span><span class="dot stable"></span> Ball rim (red) = present or locked point</span>
          <span><span class="dot" style="background:var(--cursor)"></span> Dashed line = selected Jump Hour</span>
          <span class="note">Ticks every 1h • Dimensions 1–12 labeled on left</span>
        </div>
        <div class="wall" id="wall">
          <canvas id="viz"></canvas>
        </div>
        <div class="row">
          <div>
            <label>UTC</label>
            <div class="reading" id="utcClock">—</div>
          </div>
          <div>
            <label>CST</label>
            <div class="reading" id="cstClock">—</div>
          </div>
        </div>
        <div class="note" style="margin-top:8px">Today (CST frame): <span id="todayStr">—</span></div>
      </div>
    </section>
  </div>
</div>

<script>
(function(){
  // DOM refs
  const wall = document.getElementById('wall');
  const canvas = document.getElementById('viz');
  const ctx = canvas.getContext('2d');

  const curDim    = document.getElementById('curDim');
  const targetDim = document.getElementById('targetDim');
  const destHour  = document.getElementById('destHour');
  const cstOffset = document.getElementById('cstOffset');

  const utcClock  = document.getElementById('utcClock');
  const cstClock  = document.getElementById('cstClock');
  const todayStr  = document.getElementById('todayStr');

  const btnJump   = document.getElementById('btnJump');
  const btnUnlock = document.getElementById('btnUnlock');

  // Layout helpers
  function resize(){
    const rect = wall.getBoundingClientRect();
    canvas.width  = Math.floor(rect.width);
    canvas.height = Math.floor(rect.height);
    buildGrid();
  }
  window.addEventListener('resize', resize);

  // Grid build (axes + hour ticks)
  function buildGrid(){
    // clear old DOM ticks/labels
    [...wall.querySelectorAll('.hourTick,.hourLbl,.axis')].forEach(n=>n.remove());
    // dimension axes
    for(let i=1;i<=12;i++){
      const y = lineY(i);
      const axis = document.createElement('div');
      axis.className='axis'; axis.style.top = `${y}px`;
      const lbl = document.createElement('div');
      lbl.className='lbl'; lbl.textContent=`Dim ${i}`;
      axis.appendChild(lbl);
      wall.appendChild(axis);
    }
    // hour ticks/labels
    for(let h=0;h<=24;h++){
      const x = hourX(h);
      const tick = document.createElement('div');
      tick.className='hourTick'; tick.style.left = `${x-1}px`;
      wall.appendChild(tick);
      const hl = document.createElement('div');
      hl.className='hourLbl'; hl.style.left = `${x}px`; hl.textContent = `${h}`;
      wall.appendChild(hl);
    }
  }

  function lineY(i){
    const H = canvas.height; const pad=26; const usable = H - pad*2; const step = usable/11;
    return Math.round(pad + (i-1)*step);
  }
  function hourX(h){
    const W = canvas.width; const pad=20; const usable=W-pad*2;
    return Math.round(pad + (h/24)*usable);
  }

  // Time helpers
  function getCSTDate(){
    const now = new Date();
    const utcMs = now.getTime() + now.getTimezoneOffset()*60000;
    return new Date(utcMs + (+cstOffset.value)*3600000);
  }
  function getCSTHour(){
    const d = getCSTDate();
    return d.getHours() + d.getMinutes()/60 + d.getSeconds()/3600;
  }
  function fmtTime(d){
    const hh = String(d.getHours()).padStart(2,'0');
    const mm = String(d.getMinutes()).padStart(2,'0');
    const ss = String(d.getSeconds()).padStart(2,'0');
    return `${hh}:${mm}:${ss}`;
  }

  // State: live vs locked
  let locked = false;
  let lockDim = 1;
  let lockHour = 0;
  let anim = null;

  // Draw background wallpaper
  function drawWallpaper(){
    const W = canvas.width, H = canvas.height; ctx.clearRect(0,0,W,H);
    const t = performance.now()/1000;
    for(let n=0;n<70;n++){
      const x = (Math.sin(n*12.7 + t*0.7)*0.5+0.5) * (W-40) + 20;
      const y = (Math.cos(n*9.3 + t*0.6)*0.5+0.5) * (H-40) + 20;
      const r = 0.6 + 0.6*Math.sin(t*1.5 + n);
      ctx.globalAlpha = 0.08 + 0.08*Math.sin(t*2 + n);
      ctx.fillStyle = '#d9ecff';
      ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); ctx.globalAlpha = 1;
    }
  }

  // Draw planned hour cursor (dashed)
  function drawPlannedHour(){
    const xPlan = hourX(+destHour.value);
    ctx.save();
    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--cursor') || '#7fb1ff';
    ctx.setLineDash([6,6]);
    ctx.lineWidth=1.5;
    ctx.beginPath(); ctx.moveTo(xPlan,0); ctx.lineTo(xPlan,canvas.height); ctx.stroke();
    ctx.restore();
  }

  // Draw present/locked ball
  function drawBall(x, y, pulsing=true){
    ctx.save(); ctx.translate(x,y);
    const R = 12 + (pulsing ? 2*Math.sin(performance.now()/160) : 0);
    const g = ctx.createRadialGradient(0,0,0,0,0,R*3);
    g.addColorStop(0,'rgba(233,244,255,0.95)');
    g.addColorStop(1,'rgba(159,210,255,0.06)');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(0,0,R*3,0,Math.PI*2); ctx.fill();
    ctx.fillStyle= '#e9f4ff'; ctx.beginPath(); ctx.arc(0,0,R,0,Math.PI*2); ctx.fill();
    ctx.lineWidth=3; ctx.strokeStyle = '#ff324f'; // red rim
    ctx.beginPath(); ctx.arc(0,0,R+2,0,Math.PI*2); ctx.stroke();
    ctx.restore();
  }

  // Draw dimension strings (subtle wobble)
  function drawStrings(){
    const now = performance.now();
    for(let i=1;i<=12;i++){
      const y = lineY(i);
      ctx.strokeStyle = 'rgba(255,50,79,0.55)'; // soft red
      ctx.lineWidth = 2;
      ctx.beginPath(); ctx.moveTo(hourX(0), y);
      for(let h=1; h<=24; h++){
        ctx.lineTo(hourX(h), y + Math.sin((h+now/1000)*0.2 + i)*0.6);
      }
      ctx.stroke();
    }
  }

  // Animation for jump
  function startJump(){
    const cd = +curDim.value;
    const td = +targetDim.value;
    const dh = +destHour.value;

    if(td<1 || td>12) return;
    if(dh<0 || dh>24) return;

    // if user picked current dimension & exact current hour, just lock in place
    const liveHr = getCSTHour();
    const x0 = hourX(liveHr), y0 = lineY(cd);
    const x1 = hourX(dh),     y1 = lineY(td);

    const DUR = 1200 + 200*Math.abs(td - cd);
    const t0  = performance.now();
    anim = {t0, DUR, x0, y0, x1, y1, td, dh};

    // during animation we are not "locked" yet
    locked = false;
  }

  function stepAnimation(now){
    if(!anim) return false;
    const {t0,DUR,x0,y0,x1,y1,td,dh} = anim;
    const p = Math.max(0, Math.min(1, (now - t0)/DUR));
    // quadratic bezier control (arch)
    const cx = x0 + (x1-x0)*0.5;
    const cy = Math.min(y0,y1) - 60 - 40*Math.sin(now/300);
    const x = (1-p)*(1-p)*x0 + 2*(1-p)*p*cx + p*p*x1;
    const y = (1-p)*(1-p)*y0 + 2*(1-p)*p*cy + p*p*y1;

    drawWallpaper(); drawStrings(); drawPlannedHour(); drawBall(x,y);
    if(p>=1){
      // lock at destination
      locked = true; lockDim = td; lockHour = dh; anim = null;
    }
    return true;
  }

  // Main loop
  function loop(){
    const now = performance.now();
    if(anim){
      stepAnimation(now);
    }else{
      drawWallpaper(); drawStrings(); drawPlannedHour();
      if(locked){
        // locked at selected time & dimension (no movement with time)
        const x = hourX(lockHour);
        const y = lineY(lockDim);
        drawBall(x,y,false);
      }else{
        // live: follow current CST hour on current dimension
        const liveHr = getCSTHour();
        const x = hourX(liveHr);
        const y = lineY(+curDim.value);
        drawBall(x,y,true);
      }
    }
    tickClocks();
    requestAnimationFrame(loop);
  }

  // Clocks
  function tickClocks(){
    const now = new Date();
    const utc = new Date(now.getTime() + now.getTimezoneOffset()*60000);
    const cst = getCSTDate();
    utcClock.textContent = fmtTime(utc);
    cstClock.textContent = fmtTime(cst);
    todayStr.textContent = cst.toDateString();
  }

  // Events
  btnJump.addEventListener('click', ()=>{
    // prevent jumping to the same dimension & hour as already locked—just keep locked
    if(locked && +targetDim.value===lockDim && +destHour.value===lockHour) return;
    startJump();
  });
  btnUnlock.addEventListener('click', ()=>{
    locked = false; anim = null;
  });

  [curDim,targetDim,destHour,cstOffset].forEach(el=>{
    el.addEventListener('input', ()=>{ /* reactive via loop */ });
  });

  function init(){ resize(); requestAnimationFrame(loop); }
  window.addEventListener('load', init);
})();
</script>
</body>
</html>
