<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ğŸª Cosmic Clock (Dual Panel)</title>
  <style>
    :root{ --gap:22px; }
    body{
      margin:0; background:#0a0f1f; color:#fff; font-family:Arial, Helvetica, sans-serif;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
    }
    #container{
      display:flex; align-items:flex-start; justify-content:center; gap:var(--gap);
      padding:18px; max-width:calc(100vw - 18px); overflow:auto; flex-wrap:wrap;
    }

    /* Left control panel (20% bigger inputs) */
    #infoPanel{ width:400px; text-align:left; line-height:1.7em; }
    #infoPanel h1{ color:gold; font-size:28px; margin:0 0 12px 0; }
    label{ display:block; margin:8px 0 4px; font-size:1.05em; }
    input{
      width:100%; padding:9px 10px; font-size:1.2em;
      border:1px solid #334155; background:#0f172a; color:#e5e7eb; border-radius:8px;
    }
    .btnRow{ margin-top:10px; display:flex; gap:10px; }
    .btn{
      background:#2563eb; color:#fff; border:none; border-radius:8px; cursor:pointer;
      padding:9px 16px; font-size:1.05em;
    }
    .btn:hover{ background:#1d4ed8; }
    #output{ font-size:1.05em; margin-top:12px; }
    .note{ font-size:0.95em; color:#bbb; margin-top:10px; }

    /* Right clocks column */
    #clocks{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:var(--gap); }

    /* Canvases (+30% from 550 â†’ 715) */
    canvas{ background:#111; border:2px solid #333; display:block; }
    #cosmicClock, #bottomClock{ width:715px; height:715px; }
  </style>
</head>
<body>
  <div id="container">
    <!-- Left: controls -->
    <div id="infoPanel">
      <h1>ğŸª Cosmic Clock</h1>

      <label for="dateInput">Birthday</label>
      <input type="date" id="dateInput" placeholder="mm/dd/yyyy" />

      <label for="latInput">Latitude (Â°)</label>
      <input type="number" id="latInput" step="0.0001" placeholder="e.g. 34.05" />

      <label for="lonInput">Longitude (Â°)</label>
      <input type="number" id="lonInput" step="0.0001" placeholder="e.g. -118.25" />

      <div class="btnRow">
        <button class="btn" onclick="startClock()">Start</button>
        <button class="btn" onclick="resetClock()">Reset</button>
      </div>

      <div id="output">Enter either a <b>Birthday</b> OR <b>Latitude/Longitude</b>.</div>
      <div class="note">
        âš ï¸ Antikythera-style mechanism.<br>
        Choose ONE mode:<br>
        â€“ Birthday â†’ Sun, Moon & calendars.<br>
        â€“ Latitude/Longitude â†’ sky alignment.<br>
        Not both at once.
      </div>
    </div>

    <!-- Right: stacked clocks -->
    <div id="clocks">
      <canvas id="cosmicClock" width="715" height="715"></canvas>
      <canvas id="bottomClock" width="715" height="715"></canvas>
    </div>
  </div>

  <script>
    /* ------------------ shared helpers ------------------ */
    function dims(canvas){
      const cx = canvas.width/2, cy = canvas.height/2;
      const rMax = Math.min(cx, cy) - 18; // safety margin
      return { cx, cy, rMax };
    }
    function setMid(ctx){ ctx.textAlign="center"; ctx.textBaseline="middle"; }
    function circle(ctx, cx, cy, r, color="#333", lw=1){
      ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2);
      ctx.strokeStyle=color; ctx.lineWidth=lw; ctx.stroke(); ctx.lineWidth=1;
    }
    function deg2rad(deg){ return (deg-90)*Math.PI/180; }

    /* ------------------ TOP CLOCK (unchanged) ------------------ */
    const topCanvas = document.getElementById("cosmicClock");
    const tctx = topCanvas.getContext("2d");

    const tepeSymbols = ["ğŸ¦‚","ğŸ¦Š","ğŸ¦…","ğŸ‚","ğŸ","ğŸ‡","ğŸº","ğŸŸ","ğŸ¦","ğŸ¦Œ","ğŸ¦ƒ","ğŸ¢"];
    const mayaSigns  = ["ğŸŠ","ğŸŒ¬ï¸","ğŸŒŠ","ğŸ”¥","ğŸ¦…","ğŸ","ğŸŒ½","ğŸ¢","ğŸ•·ï¸","ğŸ’","ğŸ•","ğŸŒ¿","ğŸŒ","ğŸŒ‘","ğŸŒ½","ğŸ¦Œ","ğŸŒ´","ğŸ¦‚","ğŸŒ•","ğŸŸ"];
    const zodiac     = ["â™ˆ","â™‰","â™Š","â™‹","â™Œ","â™","â™","â™","â™","â™‘","â™’","â™“"];

    function pointer(ctx, cx, cy, r, angleDeg, color){
      const a = deg2rad(angleDeg);
      const tipX = cx + r*Math.cos(a), tipY = cy + r*Math.sin(a);
      const back = 18, half = 6;
      ctx.strokeStyle=color; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(tipX,tipY); ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(tipX, tipY);
      ctx.lineTo(tipX - back*Math.cos(a) + half*Math.sin(a), tipY - back*Math.sin(a) - half*Math.cos(a));
      ctx.lineTo(tipX - back*Math.cos(a) - half*Math.sin(a), tipY - back*Math.sin(a) + half*Math.cos(a));
      ctx.closePath(); ctx.fillStyle=color; ctx.fill();
      ctx.beginPath(); ctx.arc(cx,cy,6,0,Math.PI*2); ctx.fillStyle=color; ctx.fill();
      ctx.lineWidth=1;
    }

    function drawTopClock(){
      const {cx, cy, rMax} = dims(topCanvas);
      tctx.clearRect(0,0,topCanvas.width,topCanvas.height);
      setMid(tctx);

      const outer = 0.96*rMax, inner = 0.40*rMax;
      const steps = 7, step = (outer-inner)/steps;
      const R = {
        degRing:  outer,
        mansions: outer - step*1,
        decans :  outer - step*2,
        maya   :  outer - step*3,
        tepe   :  outer - step*4,
        zodiac :  outer - step*5,
        metonic:  outer - step*6,
        moonPh :  outer - step*7
      };

      // Degree ring
      circle(tctx, cx, cy, R.degRing, "#444");
      for(let d=0; d<360; d+=5){
        const a=deg2rad(d), major = d%30===0, len = major?14:7;
        const x1=cx+(R.degRing-len)*Math.cos(a), y1=cy+(R.degRing-len)*Math.sin(a);
        const x2=cx+R.degRing*Math.cos(a),      y2=cy+R.degRing*Math.sin(a);
        tctx.beginPath(); tctx.moveTo(x1,y1); tctx.lineTo(x2,y2);
        tctx.strokeStyle="#667085"; tctx.stroke();
        if(major){
          tctx.fillStyle="#aab4c8"; tctx.font="12px Arial";
          tctx.fillText(String(d), cx+(R.degRing-28)*Math.cos(a), cy+(R.degRing-28)*Math.sin(a));
        }
      }

      ["mansions","decans","maya","tepe","zodiac","metonic"].forEach(k=>circle(tctx,cx,cy,R[k],"#2a3347"));

      tctx.fillStyle="violet"; tctx.font="22px Arial";
      zodiac.forEach((z,i)=>{ const a=deg2rad(i*30); tctx.fillText(z, cx+R.zodiac*Math.cos(a), cy+R.zodiac*Math.sin(a)); });

      tctx.fillStyle="orange";
      for(let i=0;i<19;i++){ const a=deg2rad(i*(360/19)); tctx.fillRect(cx+R.metonic*Math.cos(a)-2, cy+R.metonic*Math.sin(a)-2, 4,4); }

      tctx.fillStyle="cyan"; tctx.font="18px Arial";
      tepeSymbols.forEach((s,i)=>{ const a=deg2rad(i*30); tctx.fillText(s, cx+R.tepe*Math.cos(a), cy+R.tepe*Math.sin(a)); });

      tctx.fillStyle="lime"; tctx.font="16px Arial";
      mayaSigns.forEach((s,i)=>{ const a=deg2rad(i*(360/20)); tctx.fillText(s, cx+R.maya*Math.cos(a), cy+R.maya*Math.sin(a)); });

      tctx.fillStyle="red"; tctx.font="13px Arial";
      for(let i=0;i<36;i++){ const a=deg2rad(i*10); tctx.fillText(String(i+1), cx+R.decans*Math.cos(a), cy+R.decans*Math.sin(a)); }

      tctx.fillStyle="yellow"; tctx.font="13px Arial";
      for(let i=0;i<28;i++){ const a=deg2rad(i*(360/28)); tctx.fillText(String(i+1), cx+R.mansions*Math.cos(a), cy+R.mansions*Math.sin(a)); }

      tctx.fillStyle="white"; tctx.font="18px Arial";
      ["ğŸŒ‘","ğŸŒ“","ğŸŒ•","ğŸŒ—"].forEach((p,i)=>{ const a=deg2rad(i*90); tctx.fillText(p, cx+R.moonPh*Math.cos(a), cy+R.moonPh*Math.sin(a)); });

      const dialColors = { mansions:"#ffd166", decans:"#ff4d4d", maya:"#98fb98", tepe:"#6ee7ff", zodiac:"#c084fc", metonic:"#ffa500", moonPh:"#ffffff" };
      pointer(tctx,cx,cy,R.mansions,0,dialColors.mansions);
      pointer(tctx,cx,cy,R.decans,  0,dialColors.decans);
      pointer(tctx,cx,cy,R.maya,    0,dialColors.maya);
      pointer(tctx,cx,cy,R.tepe,    0,dialColors.tepe);
      pointer(tctx,cx,cy,R.zodiac,  0,dialColors.zodiac);
      pointer(tctx,cx,cy,R.metonic, 0,dialColors.metonic);
      pointer(tctx,cx,cy,R.moonPh,  0,dialColors.moonPh);
    }

    /* ------------------ BOTTOM CLOCK ------------------ */
    const bottomCanvas = document.getElementById("bottomClock");
    const bctx = bottomCanvas.getContext("2d");

    // Base fonts (bottom clock previously âˆ’10%)
    const BASE_NUM_PX = 12.6;              // numbers (auto-throttled if overlapping)
    const BASE_LABEL_PX = 13.5;            // ring titles above each ring

    // Center â†’ outer order (Moon Cycle is the core guide)
    const rings = [
      {label:"Moon Cycle (Phases)", key:"moon",     color:"white",   divisions:8,   symbols:["ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜"], showNumbers:false, numbersFontPx:BASE_NUM_PX, tickLen:5},
      {label:"Moon Days 1â€“29",      key:"moondays", color:"white",   divisions:29,  showNumbers:true, numbersFontPx:BASE_NUM_PX, tickLen:6},
      {label:"Olympiad 4y",         key:"olymp",    color:"blue",    divisions:4,   showNumbers:true, numbersFontPx:BASE_NUM_PX, tickLen:7},
      {label:"Agricultural 12",     key:"farm",     color:"green",   divisions:12,  showNumbers:true, numbersFontPx:BASE_NUM_PX*0.90, tickLen:7}, // per previous request
      {label:"Metonic 19y",         key:"meton",    color:"orange",  divisions:19,  showNumbers:true, numbersFontPx:BASE_NUM_PX, tickLen:7},
      {label:"Saros 18y+11d",       key:"saros",    color:"red",     divisions:18,  showNumbers:true, numbersFontPx:BASE_NUM_PX, tickLen:7},
      {label:"Exeligmos 54y",       key:"exel",     color:"cyan",    divisions:54,  showNumbers:true, numbersFontPx:BASE_NUM_PX*0.90, tickLen:7}, // dense â†’ slightly smaller
      {label:"Mesoamerican 52y",    key:"meso",     color:"yellow",  divisions:52,  showNumbers:true, numbersFontPx:BASE_NUM_PX*0.90, tickLen:7},
      {label:"Native American Days (1â€“365)", key:"native365", color:"#9acd32", divisions:365, showNumbers:true, labelEvery:10, numbersFontPx:11, tickLen:6}
    ];

    // Compute label cadence to avoid overlap when not explicitly set
    function computeLabelEvery(ctx, r, divisions, fontPx, padding=10){
      const radiusForLabels = r - 20;
      const circumference = 2 * Math.PI * Math.max(radiusForLabels, 1);
      // worst-case width based on digits in highest number
      const sample = String(divisions);
      ctx.font = `${fontPx}px Arial`;
      const sampleWidth = Math.max(ctx.measureText(sample).width, ctx.measureText("88").width);
      const needed = sampleWidth + padding;
      const maxLabels = Math.max(1, Math.floor(circumference / needed));
      return Math.max(1, Math.ceil(divisions / maxLabels));
    }

    function ringTicksAndNumbers(ctx,cx,cy,r,ring){
      const {
        divisions, color, showNumbers, symbols,
        numbersFontPx=BASE_NUM_PX, tickLen=7
      } = ring;

      // ring stroke & title
      circle(ctx,cx,cy,r,color);
      setMid(ctx);
      const labelPx = (ring.key === 'farm') ? BASE_LABEL_PX * 0.90 : BASE_LABEL_PX;
      ctx.fillStyle=color; ctx.font=`${labelPx}px Arial`;
      ctx.fillText(ring.label, cx, cy - r - 13);

      // ticks + labels
      ctx.strokeStyle=color; ctx.fillStyle=color; ctx.font=`${numbersFontPx}px Arial`;

      // Decide label cadence
      const every = ring.labelEvery ?? computeLabelEvery(ctx, r, divisions, numbersFontPx);

      for(let i=0;i<divisions;i++){
        const a=deg2rad(i*(360/divisions));
        // tick
        const x1=cx+(r-tickLen)*Math.cos(a), y1=cy+(r-tickLen)*Math.sin(a);
        const x2=cx+(r)*Math.cos(a),         y2=cy+(r)*Math.sin(a);
        ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();

        // label (throttled)
        const tx=cx+(r-20)*Math.cos(a), ty=cy+(r-20)*Math.sin(a);
        if(symbols){ ctx.fillText(symbols[i%symbols.length], tx, ty); }
        else if(showNumbers){
          if(i % every === 0){ ctx.fillText(String(i+1), tx, ty); }
        }
      }
    }

    function drawBottomClock(){
      const {cx, cy, rMax} = dims(bottomCanvas);
      bctx.clearRect(0,0,bottomCanvas.width,bottomCanvas.height);
      setMid(bctx);

      // Even spacing, center â†’ outer
      const inner = 0.18*rMax, outer = 0.95*rMax;
      const step = (outer-inner)/(rings.length-1);
      rings.forEach((ring,i)=> ring.r = inner + i*step);

      // Draw rings
      rings.forEach(ring => ringTicksAndNumbers(bctx,cx,cy,ring.r,ring));

      // Central reference hand (to outermost)
      bctx.beginPath(); bctx.moveTo(cx,cy);
      bctx.lineTo(cx, cy - rings[rings.length-1].r);
      bctx.strokeStyle="yellow"; bctx.lineWidth=2; bctx.stroke();
      bctx.beginPath(); bctx.arc(cx,cy,6,0,Math.PI*2); bctx.fillStyle="yellow"; bctx.fill();
    }

    /* ------------------ draw ------------------ */
    function draw(){ drawTopClock(); drawBottomClock(); }
    draw();

    function startClock(){ draw(); }
    function resetClock(){ draw(); }
  </script>
</body>
</html>
