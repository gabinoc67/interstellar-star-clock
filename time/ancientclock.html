<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cosmic Clock (Dual Clocks)</title>
  <style>
    body { background:#0a0f1f; color:#fff; font-family:Arial; margin:0; display:flex; justify-content:center; align-items:center; height:100vh; }
    #container { display:flex; align-items:flex-start; gap:20px; }
    #infoPanel {
      width: 360px;
      text-align:left;
      margin-right:25px;
      font-size: 16px;
      line-height:1.7em;
    }
    #infoPanel h1 { color:gold; font-size:26px; margin-bottom:14px; }
    label, input, button { margin: 6px 0; font-size: 1.05em; }
    input { width: 95%; padding:6px; font-size:1em; }
    button {
      background: #2563eb; color: white; border: none; padding: 10px 20px;
      border-radius: 6px; cursor: pointer; font-size:1.1em;
    }
    button:hover { background: #1d4ed8; }
    canvas { background:#111; border:2px solid #333; margin-top:10px; }
    .note { font-size: 14px; color:#bbb; margin-top:8px; }
    .clocks { display:flex; flex-direction:column; align-items:center; }
  </style>
</head>
<body>
  <div id="container">
    <div id="infoPanel">
      <h1>ü™ê Cosmic Clock</h1>
      <label for="dateInput">Birthday:</label><br>
      <input type="date" id="dateInput" placeholder="mm/dd/yyyy"><br>
      <label for="latInput">Latitude (¬∞):</label><br>
      <input type="number" id="latInput" step="0.0001" placeholder="e.g. 34.05"><br>
      <label for="lonInput">Longitude (¬∞):</label><br>
      <input type="number" id="lonInput" step="0.0001" placeholder="e.g. -118.25"><br>
      <button onclick="startClock()">Start</button>
      <button onclick="resetClock()">Reset</button>
      <div id="output">Enter either a <b>Birthday</b> OR <b>Latitude/Longitude</b>.</div>
      <div class="note">‚ö†Ô∏è This is an Antikythera-style mechanism.  
        To work accurately, you must choose ONE mode:<br>
        ‚Äì Birthday ‚Üí cycles of Sun, Moon & calendars.<br>
        ‚Äì Latitude/Longitude ‚Üí sky alignment at location.<br>
        Using both together is not possible.</div>
    </div>

    <div class="clocks">
      <canvas id="cosmicClock" width="600" height="600"></canvas>
      <canvas id="bottomClock" width="600" height="600"></canvas>
    </div>
  </div>

  <script>
    // --- Top Clock (unchanged) ---
    const topCanvas = document.getElementById("cosmicClock");
    const topCtx = topCanvas.getContext("2d");
    const topCx = topCanvas.width/2, topCy = topCanvas.height/2;

    const bottomCanvas = document.getElementById("bottomClock");
    const bottomCtx = bottomCanvas.getContext("2d");
    const bottomCx = bottomCanvas.width/2, bottomCy = bottomCanvas.height/2;

    const zeroEpoch = new Date(-3110, 7, 11);
    const cycles = { Sun:365, Moon:29.53, Mercury:116, Venus:584, Mars:780, Jupiter:399, Saturn:378 };

    let hands = [
      {label:"‚òâ", cycle:"Sun", angle:0, target:0, color:"gold", r:250}, 
      {label:"‚òø", cycle:"Mercury", angle:0, target:0, color:"orange", r:200},
      {label:"‚ôÄ", cycle:"Venus", angle:0, target:0, color:"violet", r:220},
      {label:"‚ôÇ", cycle:"Mars", angle:0, target:0, color:"red", r:230},
      {label:"‚ôÉ", cycle:"Jupiter", angle:0, target:0, color:"cyan", r:240},
      {label:"‚ôÑ", cycle:"Saturn", angle:0, target:0, color:"lightgreen", r:260}
    ];

    let moonDial = { angle:0, target:0 };
    let animating = false;

    const zodiacSymbols = ["‚ôà","‚ôâ","‚ôä","‚ôã","‚ôå","‚ôç","‚ôé","‚ôè","‚ôê","‚ôë","‚ôí","‚ôì"];

    function parseLocalDate(input) {
      const [y, m, d] = input.split("-").map(Number);
      return new Date(y, m - 1, d);
    }

    function startClock(){
      let inputDate = document.getElementById("dateInput").value;
      let latVal = document.getElementById("latInput").value;
      let lonVal = document.getElementById("lonInput").value;

      if (inputDate && (latVal || lonVal)) {
        alert("‚ö†Ô∏è Please enter either Birthday OR Latitude/Longitude, not both.");
        return;
      }

      if (inputDate) {
        let gDate = parseLocalDate(inputDate);
        let daysSinceZero = Math.floor((gDate - zeroEpoch)/86400000);
        setTargets(daysSinceZero, 0);
        animating = true;
        animate();
      }
      else if (lonVal) {
        let longitude = parseFloat(lonVal) || 0;
        let lonShift = -(longitude/360*2*Math.PI);
        setTargets(0, lonShift);
        animating = true;
        animate();
      }
    }

    function resetClock(){
      hands.forEach(h=>{ h.angle=0; h.target=0; });
      moonDial.angle = 0; moonDial.target=0;
      animating=false;
      document.getElementById("dateInput").value = "";
      document.getElementById("latInput").value = "";
      document.getElementById("lonInput").value = "";
      draw();
    }

    function setTargets(daysSinceZero, lonShift=0){
      let venusPhase = ((daysSinceZero % cycles.Venus) / cycles.Venus) * 2*Math.PI;
      let venusShift = -venusPhase;

      hands.forEach(h=>{
        if(h.label==="‚òâ"){ 
          let rawPhase = ((daysSinceZero % 365) / 365) * 2*Math.PI;
          h.target = rawPhase + lonShift;
        } else {
          let rawPhase = ((daysSinceZero % cycles[h.cycle]) / cycles[h.cycle]) * 2*Math.PI;
          h.target = (rawPhase + venusShift) + lonShift;
        }
      });

      let moonPhaseAngle = ((daysSinceZero % cycles.Moon) / cycles.Moon) * 2*Math.PI;
      moonDial.target = (moonPhaseAngle + venusShift) + lonShift;
    }

    // --- Draw Functions ---
    function drawArrow(ctx,x1,y1,x2,y2,color){
      ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2);
      ctx.strokeStyle=color; ctx.lineWidth=2; ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x2,y2);
      ctx.lineTo(x2-10*Math.cos(Math.atan2(y2-y1,x2-x1)-0.3), y2-10*Math.sin(Math.atan2(y2-y1,x2-x1)-0.3));
      ctx.lineTo(x2-10*Math.cos(Math.atan2(y2-y1,x2-x1)+0.3), y2-10*Math.sin(Math.atan2(y2-y1,x2-x1)+0.3));
      ctx.closePath(); ctx.fillStyle=color; ctx.fill();
    }

    function drawTopClock(){
      topCtx.clearRect(0,0,topCanvas.width,topCanvas.height);
      topCtx.beginPath(); topCtx.arc(topCx,topCy,250,0,Math.PI*2); topCtx.strokeStyle="#555"; topCtx.stroke();
      zodiacSymbols.forEach((symbol,i)=>{
        let angle=(i*(360/zodiacSymbols.length)-90)*Math.PI/180;
        let tx=topCx+150*Math.cos(angle), ty=topCy+150*Math.sin(angle);
        topCtx.fillStyle="white"; topCtx.font="20px Arial"; topCtx.fillText(symbol, tx, ty);
      });
      hands.forEach(h=>{
        let dx=topCx+h.r*Math.cos(h.angle-Math.PI/2), dy=topCy+h.r*Math.sin(h.angle-Math.PI/2);
        drawArrow(topCtx,topCx,topCy,dx,dy,h.color);
      });
    }

    function drawBottomClock(){
      bottomCtx.clearRect(0,0,bottomCanvas.width,bottomCanvas.height);
      let cyclesBottom = [
        {name:"Metonic 235m", r:120, color:"gold"},
        {name:"Saros 223m", r:150, color:"red"},
        {name:"Exeligmos 669m", r:180, color:"orange"},
        {name:"Olympiad 50m", r:210, color:"cyan"},
        {name:"Mesoamerican 52y", r:240, color:"lime"},
        {name:"Native Agricultural", r:270, color:"white"},
      ];
      cyclesBottom.forEach(c=>{
        bottomCtx.beginPath(); bottomCtx.arc(bottomCx,bottomCy,c.r,0,Math.PI*2);
        bottomCtx.strokeStyle=c.color; bottomCtx.stroke();
        bottomCtx.fillStyle=c.color; bottomCtx.font="12px Arial";
        bottomCtx.fillText(c.name,bottomCx,bottomCy-c.r-10);
      });

      // Draw one main dial arrow pointing to outermost ring
      let dx=bottomCx+270*Math.cos(moonDial.angle-Math.PI/2);
      let dy=bottomCy+270*Math.sin(moonDial.angle-Math.PI/2);
      drawArrow(bottomCtx,bottomCx,bottomCy,dx,dy,"yellow");
    }

    function draw(){
      drawTopClock();
      drawBottomClock();
    }

    function animate(){ if(!animating) return; let still=false;
      hands.forEach(h=>{ let diff=h.target-h.angle; if(Math.abs(diff)>0.001){h.angle+=diff*0.05; still=true;} else{h.angle=h.target;} });
      let diff=moonDial.target-moonDial.angle; if(Math.abs(diff)>0.001){moonDial.angle+=diff*0.05; still=true;} else{moonDial.angle=moonDial.target;}
      draw(); if(still) requestAnimationFrame(animate); else animating=false; }

    draw();
  </script>
</body>
</html>
