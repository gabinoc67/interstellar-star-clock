<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CST Time-Machine Simulator — Rings • Photons • 4 Clocks</title>
<style>
  :root{
    --bg:#0b1020; --ink:#eaf0ff; --mut:#9fb0d0; --panel:#121936; --line:#223062;
    --beam-color:rgba(190,245,255,.9);          /* white-cyan = stable */
    --intensity:.25;                             /* 0..1 visual power */
    --vibe:1;                                    /* ring horizontal quiver */
    --bob-amp:10px;                              /* ring vertical bob amplitude */
    --bob-speed:3.6s;                            /* ring vertical bob speed */
    --particle-speed:6s;                         /* orbiters (lower = faster) */
    --photon-speed:3s;                           /* vertical photon streams */
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1200px;margin:0 auto;padding:18px}
  h1{margin:0 0 8px;font-weight:900;letter-spacing:.2px}
  .pill{display:inline-block;border:1px solid var(--line);padding:4px 10px;border-radius:999px;font-size:12px;color:#bcd}
  .grid{display:grid;gap:14px}
  .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
  .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:18px;padding:16px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .label{font-size:12px;color:var(--mut)}
  .value{font-weight:800}
  .button{cursor:pointer;font-weight:900;border-radius:14px;border:1px solid var(--line);
          padding:10px 16px;background:#0f1841;color:var(--ink)}
  .button:active{transform:translateY(1px)}
  .button.small{padding:6px 10px;font-size:11px}
  .button.activeBtn{border-color:#8fb4ff;box-shadow:0 0 0 1px #8fb4ff}
  input[type="datetime-local"]{width:100%;background:#0d1536;border:1px solid #243468;border-radius:8px;padding:8px;color:#eaf0ff}
  .clockbox{font-family:ui-monospace,Consolas,monospace;font-size:16px;background:#0d1536;border-radius:10px;padding:10px;border:1px solid #2a3a6e;text-align:center}
  .clock-title{font-size:12px;color:#9fb0d0;margin-bottom:4px}
  .ok{color:#7cff9e} .bad{color:#ff9090}
  .hidden{display:none !important}

  /* ------ Warp Chamber ------ */
  .chamber{position:relative;overflow:hidden;min-height:380px;border-radius:18px;margin-top:12px}
  .beam{position:absolute;left:50%;top:6%;bottom:10%;transform:translateX(-50%);
    width:22%;background:radial-gradient(ellipse at center,var(--beam-color),transparent 70%);
    opacity:calc(.25 + .75*var(--intensity)); filter:blur(8px); transition:background .3s linear}
  /* Ring wrappers bob up/down; inner rings quiver horizontally */
  .ringWrap{position:absolute;left:50%;transform:translateX(-50%) translateY(0); animation: bob var(--bob-speed) ease-in-out infinite alternate}
  .ringWrap.top{top:8%}
  .ringWrap.bot{bottom:10%}
  @keyframes bob{
    from{ transform:translateX(-50%) translateY(calc(var(--bob-amp)*-1)); }
    to  { transform:translateX(-50%) translateY(var(--bob-amp)); }
  }
  .ring{width:80%;height:74px;border:2px solid #2aa8ff66;border-radius:999px;
        box-shadow:0 0 20px #6ff6ff33 inset,0 0 25px #2aa8ff55;
        transform:scaleX(calc(1 + .03*var(--vibe))); animation:vibe calc(.5s/var(--vibe)) linear infinite;position:relative}
  .ring::after{content:"";position:absolute;inset:0;border-radius:inherit;border:1px dashed #aef7ff7a;animation:dash 8s linear infinite}
  @keyframes dash{to{transform:rotate(360deg)}}
  @keyframes vibe{0%{transform:scaleX(1)}50%{transform:scaleX(1.04)}100%{transform:scaleX(1)}}

  /* Particles in elliptical orbits */
  .orbit{position:absolute;inset:0;pointer-events:none}
  .particle{position:absolute;top:50%;left:50%;width:6px;height:6px;border-radius:50%;
    background:#dfffff;box-shadow:0 0 8px #dfffff,0 0 14px #66e1ff}

  /* Vertical photon streams */
  .photons{position:absolute;left:50%;top:2%;bottom:12%;width:34%;transform:translateX(-50%);pointer-events:none}
  .photon{position:absolute;left:50%;width:3px;height:12px;background:#bfffff;box-shadow:0 0 8px #bfffff,0 0 16px #66e1ff;opacity:.85}
  .photon.up{animation:rise var(--photon-speed) linear infinite}
  .photon.down{animation:fall var(--photon-speed) linear infinite}
  @keyframes rise{from{transform:translate(-50%,100%)} to{transform:translate(-50%,-10%)}}
  @keyframes fall{from{transform:translate(-50%,-10%)} to{transform:translate(-50%,100%)}}

  .floor{position:absolute;left:5%;right:5%;bottom:8%;height:12%;background:linear-gradient(#16244f,#0b1020);border-top:1px solid #2aa8ff33}

  /* Equations block */
  .eq{font-size:14px;line-height:1.6}
  .eq code{background:#0d1536;border:1px solid #2a3a6e;border-radius:8px;padding:2px 6px}
  .bul{margin:6px 0 0 18px}
  .bul li{margin:4px 0}
</style>
</head>
<body>
<div class="wrap">
  <h1>CST Time-Machine Simulator</h1>
  <div class="pill">Two bobbing rings • Orbiting particles • Photon streams • 4 live clocks</div>

  <div class="grid grid-2" style="margin-top:12px">
    <!-- Controls -->
    <div class="card">
      <div class="row"><strong>Destination Control</strong></div>
      <div style="margin-top:8px">
        <label class="label">Destination (Local calendar)</label>
        <input id="destDT" type="datetime-local" />
      </div>
      <div class="row" style="margin-top:12px">
        <button class="button" id="travelBtn">Travel to Destination</button>
        <button class="button" id="resetBtn">Reset</button>
      </div>
      <div class="row" style="margin-top:10px;justify-content:space-between">
        <span class="label">Advanced Physics Layer</span>
        <button class="button" id="advToggle">Advanced: OFF</button>
      </div>
      <div class="label" id="status" style="margin-top:6px">Status: <span class="ok">STABLE</span></div>
    </div>

    <!-- Clocks -->
    <div class="card">
      <div class="grid grid-2">
        <div class="clockbox">
          <div class="clock-title">UTC Cosmic Clock</div>
          <div id="utcClock">—</div>
        </div>
        <div class="clockbox">
          <div class="clock-title">Current Local Time</div>
          <div id="localClock">—</div>
        </div>
        <div class="clockbox">
          <div class="clock-title">Destination Time</div>
          <div id="destClock">—</div>
        </div>
        <div class="clockbox">
          <div class="clock-title">Δt (Difference)</div>
          <div id="diffClock">—</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Physics Panel -->
  <div class="card hidden" id="advPanel" style="margin-top:12px">
    <div class="row">
      <strong>Advanced Physics Layer — SR • GR • Sidereal Drift</strong>
      <span class="label">These are comparison readouts: CST stays the narrative layer; physics adds the engineering layer.</span>
    </div>
    <div class="grid grid-3" style="margin-top:10px;gap:10px">
      <!-- SR -->
      <div>
        <div class="label">Special Relativity — Velocity Time Dilation</div>
        <div style="margin-top:4px">
          <span class="label">Ship velocity (fraction of c)</span>
          <input id="srVel" type="range" min="0" max="0.99" step="0.01" value="0" style="width:100%" />
          <div class="row" style="margin-top:4px;justify-content:space-between">
            <span id="srVelVal" class="value">0.0% c</span>
            <span class="label">γ = <span id="srGamma">1.0000</span></span>
          </div>
        </div>
        <div class="clockbox" style="margin-top:6px">
          <div class="clock-title">CST Δt (ideal)</div>
          <div id="srDt">—</div>
        </div>
        <div class="clockbox" style="margin-top:6px">
          <div class="clock-title">Proper Δt′ (SR)</div>
          <div id="srDtPrime">—</div>
        </div>
      </div>

      <!-- GR -->
      <div>
        <div class="label">Gravitational Time Dilation — Deep Wells</div>
        <div style="margin-top:4px">
          <span class="label">Reference body</span>
          <select id="grBody" style="width:100%;background:#0d1536;border:1px solid #243468;border-radius:8px;padding:6px;color:#eaf0ff">
            <option value="earth">Earth surface</option>
            <option value="leo">Low Earth orbit (400 km)</option>
            <option value="neutron">Toy neutron star</option>
          </select>
        </div>
        <div class="clockbox" style="margin-top:6px">
          <div class="clock-title">GR factor √(1 − 2GM/rc²)</div>
          <div id="grFactor">—</div>
        </div>
        <div class="clockbox" style="margin-top:6px">
          <div class="clock-title">CST Δt baseline</div>
          <div id="grDtBase">—</div>
        </div>
        <div class="clockbox" style="margin-top:6px">
          <div class="clock-title">Δt′ near body (GR)</div>
          <div id="grDtPrime">—</div>
        </div>
      </div>

      <!-- Sidereal vs Solar -->
      <div>
        <div class="label">Sidereal vs Solar — Star Drift</div>
        <div class="clockbox" style="margin-top:4px">
          <div class="clock-title">Per-day drift (solar−sidereal)</div>
          <div id="sidDaily">—</div>
        </div>
        <div class="clockbox" style="margin-top:6px">
          <div class="clock-title">Accumulated drift over |Δt|</div>
          <div id="sidAccum">—</div>
        </div>
        <p class="label" style="margin-top:6px">
          As |Δt| grows, the sidereal star field slowly slips relative to the Sun-based CST clock, revealing the true galactic rhythm.
        </p>
      </div>
    </div>
  </div>

  <!-- Sky Dome Panel -->
  <div class="card hidden" id="skyPanel" style="margin-top:12px">
    <div class="row">
      <strong>Sky Dome View — Artistic vs RA/Dec + Light-Time</strong>
    </div>
    <div class="row" style="margin-top:6px;justify-content:space-between">
      <span class="label">
        <b>Artistic</b> = CST poetic sky layout. <b>RA/Dec + Light-time</b> = real coordinates & label distances (light-years) for a catalog-based sky.
      </span>
      <div class="row">
        <button class="button small" data-starmode="art">Artistic</button>
        <button class="button small" data-starmode="radec">RA/Dec + Light-time</button>
      </div>
    </div>
    <div style="margin-top:10px">
      <svg id="starView" viewBox="0 0 300 200" style="width:100%;height:220px;"></svg>
    </div>
  </div>

  <!-- Chamber -->
  <div class="card chamber">
    <div class="ringWrap top"><div class="ring"></div></div>
    <div class="ringWrap bot"><div class="ring"></div></div>
    <div class="beam" id="beam"></div>
    <div class="orbit" id="orbitLayer"></div>
    <div class="photons" id="photonsLayer"></div>
    <div class="floor"></div>
    <div class="label" style="text-align:center;margin-top:6px">
      White = stable equilibrium • Red = traveling • Rings bob faster in transit; particles & photons accelerate
    </div>
  </div>

  <!-- Explanation & Equations -->
  <div class="card" style="margin-top:12px">
    <div class="row"><strong>How This Time Machine Model Works — Clocks, Equilibrium & Equations</strong></div>
    <div class="eq">
      <p><b>Clocks used (always live):</b></p>
      <ul class="bul">
        <li><b>UTC Cosmic Clock</b> — Universal reference for synchronization.</li>
        <li><b>Current Local Clock</b> — Your device’s local time.</li>
        <li><b>Destination Clock</b> — Target local date/time you dial.</li>
        <li><b>Δt Clock</b> — Signed difference from <i>now → destination</i>, which smoothly goes to zero during travel.</li>
      </ul>

      <p style="margin-top:8px"><b>Equilibrium condition (visual demo):</b> The machine holds a stable field when thermal, rotation, and phase terms are small. During travel, energy rises and the beam glows red; upon arrival, it returns to white, indicating equilibrium.</p>

      <p><b>Key relations (illustrative):</b></p>
      <ul class="bul">
        <li><code>Δt = t_dest − t_now</code></li>
        <li><code>LOD(Δt) ≈ 24 h + (1.7 ms / 100 yr) × (Δt / yr)</code>  (tidal friction trend → future days slightly longer)</li>
        <li><code>rotFactor(Δt) = 24 h / LOD(Δt)</code></li>
        <li><code>ω_⊕(Δt) = 2π / (86400 s · rotFactor)</code></li>
        <li><code>P ∝ |Δt| · (1 + |rotFactor−1|·k)</code>  (more offset → more power to maintain the bubble)</li>
      </ul>

      <p><b>Cosmic motion notes:</b> For geologic-scale jumps, you must account for Earth’s rotation change (LOD) and long-term orbital/axial effects. In this demo, the rings’ bob and intensity encode that: larger |Δt| → faster bobbing and brighter beam. Historically, tidal friction slows Earth’s rotation; orbital period changes are smaller but can be modeled if desired.</p>

      <p><b>Interpretation:</b> If the destination is far, |Δt| is large → the simulator shows higher field activity (faster bob, photons, particles). When you press <b>Travel</b>, Δt converges toward zero, the beam transitions red→white, and the rings/particles return to stable rates, indicating synchronized arrival.</p>
      <p class="label" style="margin-top:6px">
        When <b>Advanced Physics</b> is ON, the CST ring stays your ideal time layer; the SR/GR & sidereal panels show how a relativistic engineer would correct and compare that ideal against real spacetime slippage.
      </p>
    </div>
  </div>
</div>

<script>
(function(){
  const utcClock = document.getElementById('utcClock');
  const localClock = document.getElementById('localClock');
  const destClock = document.getElementById('destClock');
  const diffClock = document.getElementById('diffClock');
  const destDT = document.getElementById('destDT');
  const travelBtn = document.getElementById('travelBtn');
  const resetBtn = document.getElementById('resetBtn');
  const status = document.getElementById('status');
  const beam = document.getElementById('beam');
  const orbitLayer = document.getElementById('orbitLayer');
  const photonsLayer = document.getElementById('photonsLayer');

  const advToggle = document.getElementById('advToggle');
  const advPanel = document.getElementById('advPanel');
  const skyPanel = document.getElementById('skyPanel');

  const srVel = document.getElementById('srVel');
  const srVelVal = document.getElementById('srVelVal');
  const srGamma = document.getElementById('srGamma');
  const srDt = document.getElementById('srDt');
  const srDtPrime = document.getElementById('srDtPrime');

  const grBody = document.getElementById('grBody');
  const grFactor = document.getElementById('grFactor');
  const grDtBase = document.getElementById('grDtBase');
  const grDtPrime = document.getElementById('grDtPrime');

  const sidDaily = document.getElementById('sidDaily');
  const sidAccum = document.getElementById('sidAccum');

  const starView = document.getElementById('starView');
  const starModeButtons = document.querySelectorAll('[data-starmode]');

  let destination = null;
  let traveling = false;
  let travelStart = 0, travelDuration = 8000; // ms
  let initialDiff = 0;
  let lastDiffMs = 0;
  let advancedOn = false;
  let starMode = 'art';

  const G = 6.674e-11;
  const C = 299792458;
  const bodies = {
    earth:{ M:5.972e24, r:6.371e6 },
    leo:{ M:5.972e24, r:6.771e6 },     // Earth radius + ~400 km
    neutron:{ M:2e30, r:1e4 }          // toy compact object
  };

  const stars = [
    { name:'Sirius',     raHours:6.752,  decDeg:-16.716, distLy:8.6 },
    { name:'Betelgeuse', raHours:5.9195, decDeg: 7.407, distLy:642 },
    { name:'Vega',       raHours:18.6156,decDeg:38.784, distLy:25 },
    { name:'Rigel',      raHours:5.2423, decDeg:-8.202, distLy:863 }
  ];

  // Format helpers
  const pad = n => String(n).padStart(2,'0');
  const fmtFullLocal = d => `${d.toLocaleDateString()} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  const fmtFullUTC = d => d.toUTCString().replace('GMT','UTC');
  function fmtDiff(ms){
    const sign = ms>=0?'+':'−';
    const A = Math.abs(ms);
    const d = Math.floor(A/86400000);
    const h = Math.floor((A%86400000)/3600000);
    const m = Math.floor((A%3600000)/60000);
    const s = Math.floor((A%60000)/1000);
    return `${sign}${d}d ${pad(h)}:${pad(m)}:${pad(s)}`;
  }
  function fmtHMSFromSeconds(sec){
    const sign = sec>=0?'+':'−';
    const A = Math.abs(sec);
    const h = Math.floor(A/3600);
    const m = Math.floor((A%3600)/60);
    const s = Math.floor(A%60);
    return `${sign}${pad(h)}:${pad(m)}:${pad(s)}`;
  }
  // Build photons
  function buildPhotons(){
    photonsLayer.innerHTML='';
    const n=30;
    for(let i=0;i<n;i++){
      const p=document.createElement('div');
      p.className='photon ' + (i%2===0?'up':'down');
      p.style.left = (18 + (i%15)*4.8) + '%';
      p.style.animationDelay = (-i*0.12)+'s';
      photonsLayer.appendChild(p);
    }
  }
  buildPhotons();

  // Build orbiting particles
  function buildParticles(){
    orbitLayer.innerHTML='';
    const N=26;
    for(let i=0;i<N;i++){
      const dot=document.createElement('div');
      dot.className='particle';
      dot.dataset.angle0 = (i/N)*Math.PI*2;
      dot.dataset.radius = 44 + (i%13)*7;
      orbitLayer.appendChild(dot);
    }
  }
  buildParticles();

  // Animate particles according to --particle-speed
  function animateParticles(sec){
    const dots = orbitLayer.children;
    const t = performance.now()/1000;
    for(let i=0;i<dots.length;i++){
      const el=dots[i];
      const a0=Number(el.dataset.angle0);
      const r =Number(el.dataset.radius);
      const dir=i%2===0?1:-1;
      const ang=a0 + dir*(t/sec)*Math.PI*2;
      const x=Math.cos(ang)*(r+190);
      const y=Math.sin(ang)*(r/2)*0.8;
      el.style.transform=`translate(${x}px,${y}px)`;
    }
  }

  // Sky dome rendering
  function renderStarView(){
    if(!starView) return;
    const w=300,h=200;
    let svg = '';
    svg += `<rect x="0" y="0" width="${w}" height="${h}" rx="16" ry="16" fill="#050817" />`;
    svg += `<path d="M0 ${h/2} H${w}" stroke="#1b2744" stroke-width="0.5"/>`;
    svg += `<path d="M${w/2} 0 V${h}" stroke="#1b2744" stroke-width="0.5"/>`;

    if(starMode==='art' || !advancedOn){
      stars.forEach((s,idx)=>{
        const x = 40 + idx*60;
        const y = 60 + (idx%2)*50;
        svg += `<circle cx="${x}" cy="${y}" r="3" fill="#fdfdfd" />`;
        svg += `<text x="${x+6}" y="${y-4}" font-size="8" fill="#9fb0d0">${s.name}</text>`;
      });
    } else {
      // RA/Dec mapping + light-time labels
      stars.forEach(s=>{
        const x = (s.raHours/24)*w;
        const y = (1 - ((s.decDeg+90)/180))*h;
        svg += `<circle cx="${x.toFixed(1)}" cy="${y.toFixed(1)}" r="3.4" fill="#fafafa" />`;
        svg += `<text x="${(x+6).toFixed(1)}" y="${(y-4).toFixed(1)}" font-size="8" fill="#9fb0d0">${s.name} · ${s.distLy} ly</text>`;
      });
    }
    starView.innerHTML = svg;
  }

  // Advanced panels update
  function updateAdvancedPanels(){
    if(!advancedOn) return;

    // SR gamma always available
    const v = parseFloat(srVel.value)||0;
    const beta = Math.max(0,Math.min(0.9999,v));
    let gamma = 1;
    if(beta>0 && beta<1){
      gamma = 1/Math.sqrt(1 - beta*beta);
    }
    srGamma.textContent = gamma.toFixed(4);

    const hasDest = !!destination;

    if(hasDest){
      // SR time dilation based on current Δt
      srDt.textContent = fmtDiff(lastDiffMs);
      const properMs = lastDiffMs * Math.sqrt(Math.max(0,1 - beta*beta));
      srDtPrime.textContent = fmtDiff(properMs);
    } else {
      srDt.textContent = '—';
      srDtPrime.textContent = '—';
    }

    // GR factor (depends on body only)
    const body = bodies[grBody.value] || bodies.earth;
    const factor = Math.sqrt(1 - (2*G*body.M)/(body.r*C*C));
    grFactor.textContent = isNaN(factor)?'—':factor.toExponential(6);

    if(hasDest){
      grDtBase.textContent = fmtDiff(lastDiffMs);
      const grMs = lastDiffMs * factor;
      grDtPrime.textContent = fmtDiff(grMs);
    } else {
      grDtBase.textContent = '—';
      grDtPrime.textContent = '—';
    }

    // Sidereal vs solar drift (per-day constant)
    const solar = 86400;         // s
    const sid = 86164.1;         // s
    const perDay = solar - sid;  // ~235.9 s
    sidDaily.textContent = '≈ ' + fmtHMSFromSeconds(perDay);

    if(hasDest){
      const days = Math.abs(lastDiffMs)/86400000;
      const driftSec = days*perDay;
      const signedDrift = driftSec * (lastDiffMs>=0?1:-1);
      sidAccum.textContent = fmtHMSFromSeconds(signedDrift);
    } else {
      sidAccum.textContent = '—';
    }
  }

  // Travel button
  travelBtn.addEventListener('click',()=>{
    if(!destDT.value){ alert('Select a destination date & time.'); return; }
    destination = new Date(destDT.value);
    if(isNaN(destination)){ alert('Invalid date/time.'); return; }
    initialDiff = destination - new Date();

    traveling = true;
    travelStart = performance.now();
    status.innerHTML = 'Status: <span class="bad">TRAVELING…</span>';
    // Speed up visuals
    document.documentElement.style.setProperty('--bob-amp','28px');
    document.documentElement.style.setProperty('--bob-speed','1.2s');
    document.documentElement.style.setProperty('--vibe','8');
    document.documentElement.style.setProperty('--particle-speed','1.4s');
    document.documentElement.style.setProperty('--photon-speed','0.7s');
    document.documentElement.style.setProperty('--intensity','1');
    document.documentElement.style.setProperty('--beam-color','rgba(255,82,82,.95)'); // red
  });

  // Reset
  resetBtn.addEventListener('click',()=>{
    destination = null;
    traveling = false;
    initialDiff = 0;
    lastDiffMs = 0;

    // Reset UI state
    destDT.value = '';
    destClock.textContent='—';
    diffClock.textContent='—';

    // Reset SR controls
    srVel.value = '0';
    srVelVal.textContent = '0.0% c';
    srGamma.textContent = '1.0000';
    srDt.textContent = '—';
    srDtPrime.textContent = '—';

    // Reset GR controls
    grBody.value = 'earth';
    grFactor.textContent = '—';
    grDtBase.textContent = '—';
    grDtPrime.textContent = '—';

    // Reset sidereal drift accumulated
    sidAccum.textContent = '—';

    status.innerHTML = 'Status: <span class="ok">STABLE</span>';
    document.documentElement.style.setProperty('--bob-amp','10px');
    document.documentElement.style.setProperty('--bob-speed','3.6s');
    document.documentElement.style.setProperty('--vibe','1.4');
    document.documentElement.style.setProperty('--particle-speed','6s');
    document.documentElement.style.setProperty('--photon-speed','3s');
    document.documentElement.style.setProperty('--intensity','.25');
    document.documentElement.style.setProperty('--beam-color','rgba(190,245,255,.9)');

    updateAdvancedPanels();
  });

  // Advanced toggle
  advToggle.addEventListener('click',()=>{
    advancedOn = !advancedOn;
    advToggle.textContent = advancedOn ? 'Advanced: ON' : 'Advanced: OFF';
    if(advancedOn){
      advPanel.classList.remove('hidden');
      skyPanel.classList.remove('hidden');
    } else {
      advPanel.classList.add('hidden');
      skyPanel.classList.add('hidden');
    }
    renderStarView();
    updateAdvancedPanels();
  });

  // SR slider label
  srVel.addEventListener('input',()=>{
    const v = parseFloat(srVel.value)||0;
    srVelVal.textContent = (v*100).toFixed(1) + '% c';
    updateAdvancedPanels();
  });
  srVelVal.textContent = '0.0% c';

  // Star mode buttons
  starModeButtons.forEach(btn=>{
    btn.addEventListener('click',()=>{
      starMode = btn.dataset.starmode || 'art';
      starModeButtons.forEach(b=>b.classList.remove('activeBtn'));
      btn.classList.add('activeBtn');
      renderStarView();
    });
  });
  if(starModeButtons[0]) starModeButtons[0].classList.add('activeBtn');
  renderStarView();

  // Main loop
  function tick(){
    const now = new Date();
    utcClock.textContent = fmtFullUTC(now);
    localClock.textContent = fmtFullLocal(now);

    // Destination & Δt
    if(destination){
      destClock.textContent = fmtFullLocal(destination);
      let diff = destination - now;

      if(traveling){
        const e = (performance.now() - travelStart)/travelDuration;
        const p = Math.min(Math.max(e,0),1);
        // Ease-in-out toward zero difference
        const ease = p<0.5 ? 2*p*p : -1 + (4-2*p)*p;
        diff = initialDiff * (1 - ease);

        // Beam color & intensity interpolate red -> white
        const r = Math.floor(255*(1 - ease) + 190*ease);
        const g = Math.floor(82*(1 - ease) + 245*ease);
        const b = Math.floor(82*(1 - ease) + 255*ease);
        document.documentElement.style.setProperty('--beam-color',`rgba(${r},${g},${b},.95)`);
        document.documentElement.style.setProperty('--intensity',(1 - 0.75*ease).toFixed(2));

        // At arrival, restore stable parameters
        if(p >= 1){
          traveling = false;
          status.innerHTML = 'Status: <span class="ok">ARRIVED — STABLE</span>';
          document.documentElement.style.setProperty('--bob-amp','10px');
          document.documentElement.style.setProperty('--bob-speed','3.6s');
          document.documentElement.style.setProperty('--vibe','1.4');
          document.documentElement.style.setProperty('--particle-speed','6s');
          document.documentElement.style.setProperty('--photon-speed','3s');
          document.documentElement.style.setProperty('--intensity','.25');
          document.documentElement.style.setProperty('--beam-color','rgba(190,245,255,.9)');
          diff = 0;
        }
      }

      diffClock.textContent = fmtDiff(diff);
      lastDiffMs = diff;
    } else {
      destClock.textContent = '—';
      diffClock.textContent = '—';
      lastDiffMs = 0;
    }

    updateAdvancedPanels();

    // Keep particles moving using the current variable speed
    const ps = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--particle-speed'));
    animateParticles(isNaN(ps)?6:ps);

    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>
