<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Einstein–Casanova Unified Action Playground — v3</title>

<script>
  window.MathJax = { tex: { inlineMath: [['$','$'], ['\\(','\\)']] } };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

<style>
:root{
  --bg:#050815;--panel:#111735;--ink:#eaf0ff;--muted:#9fa8d6;--accent:#8fb4ff;
  --border:#1c2750;--ok:#35e6a2;--warn:#ffd15a;--bad:#ff6b8b;
  --term-grav:#35e6a2;--term-gauge:#8fb4ff;--term-dm:#ff9ec1;
  --term-de:#ffd15a;--term-vac:#f97373;--term-warp:#7dd3fc;--term-cons:#c4b5fd;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
.wrap{max-width:1460px;margin:0 auto;padding:16px}
.panel{
  background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px 14px;margin-bottom:16px;
}
h1{margin:0 0 10px;font-size:1.55rem}
h2{margin:4px 0;font-size:1.15rem}
h3{margin:4px 0}
.muted{color:var(--muted);font-size:0.9rem}
label{display:block;margin-top:10px;font-size:0.9rem}
select,input,textarea{
  width:100%;background:#050b20;color:var(--ink);
  border-radius:6px;border:1px solid var(--border);
}
textarea{min-height:60px;padding:6px 8px}
input[type="range"]{padding:0}
.slider-row{display:flex;align-items:center;gap:8px}
.slider-row span.value{min-width:32px;text-align:right;font-size:0.85rem;color:var(--muted)}
.checkbox-row{display:flex;gap:8px;margin-top:6px}
.checkbox-row input{width:auto}
.btn-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
button{
  border:none;border-radius:999px;padding:8px 14px;cursor:pointer;
  color:#050815;font-weight:600;font-size:0.88rem;
}
button.primary{background:var(--accent)}
button.secondary{background:#18204a;color:var(--ink)}
button.danger{background:var(--bad)}
button:active{transform:translateY(1px)}
.results{background:#0a1230;border:1px solid var(--border);border-radius:10px;margin-top:10px;padding:10px}
.tag-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:5px}
.tag{padding:2px 8px;border-radius:999px;font-size:0.75rem;border:1px solid var(--border);color:var(--muted)}
.tag.ok{border-color:var(--ok);color:var(--ok)}
.tag.warn{border-color:var(--warn);color:var(--warn)}
.tag.bad{border-color:var(--bad);color:var(--bad)}
.bars{margin-top:10px}
.bar{margin:3px 0}
.bar-track{height:8px;border-radius:999px;background:#0b1535}
.bar-fill{height:100%;width:0;background:var(--accent);transition:width 0.24s}
.section-grid{display:grid;grid-template-columns:1.1fr 1.2fr;gap:12px}
@media(max-width:900px){.section-grid{grid-template-columns:1fr}}
.eq-box{background:#050b20;border:1px solid var(--border);border-radius:12px;padding:10px 14px;margin-top:14px}
.term{padding:2px 4px;border-radius:4px;border:1px solid transparent}
.term.active{box-shadow:0 0 10px rgba(255,255,255,0.15)}
.term-grav.active{border-color:var(--term-grav)}
.term-gauge.active{border-color:var(--term-gauge)}
.term-dm.active{border-color:var(--term-dm)}
.term-de.active{border-color:var(--term-de)}
.term-vac.active{border-color:var(--term-vac)}
.term-warp.active{border-color:var(--term-warp)}
.term-cons.active{border-color:var(--term-cons)}
.log-table{width:100%;font-size:0.8rem;margin-top:10px;border-collapse:collapse}
.log-table th,.log-table td{border:1px solid var(--border);padding:4px;text-align:left}
</style>
</head>
<body>
<div class="wrap">

<h1>Einstein–Casanova Unified Action Playground — v3</h1>
<p class="muted">
Interactive testbed for tuning each term of the Unified Lagrangian and attaching researcher notes for export.
</p>

<!-- HOW TO -->
<div class="panel">
<h2>How to use:</h2>
<ol class="muted" style="padding-left:20px">
<li>Select scenario</li>
<li>Toggle which fields are relevant</li>
<li>Adjust strength sliders + scenario-specific inputs</li>
<li>Enter optional log notes</li>
<li>Press <strong>Calculate + Add to Log</strong></li>
<li>Export log to JSON/CSV for comparison</li>
</ol>
</div>

<!-- SCENARIO + TOGGLES -->
<div class="section-grid">
<div class="panel">
<h2>Scenario</h2>
<select id="scenario">
<option value="cosmo">Cosmology — Universe evolution</option>
<option value="collider">Particle Collider — QFT Regime</option>
<option value="blackhole">Near Black Hole — Strong Curvature</option>
<option value="warp">Warp Engine — Φ₍warp₎ bubble</option>
<option value="cst">CST Star Clock</option>
<option value="sprc">SPR-C / Consciousness Lab</option>
</select>

<hr style="border:none;border-top:1px solid var(--border);margin:12px 0" />

<h3>Active Fields</h3>

<div class="checkbox-row"><input type="checkbox" id="gravActive" checked><label>Gravity $R$</label></div>
<div class="checkbox-row"><input type="checkbox" id="gaugeActive" checked><label>Gauge: $F,G,W$</label></div>
<div class="checkbox-row"><input type="checkbox" id="dmActive" checked><label>Dark Matter $χ$</label></div>
<div class="checkbox-row"><input type="checkbox" id="deActive" checked><label>Dark Energy $Λ,σ$</label></div>
<div class="checkbox-row"><input type="checkbox" id="vacActive" checked><label>Vacuum Energy $ρ_{vac}$</label></div>
<div class="checkbox-row"><input type="checkbox" id="warpActive" checked><label>Warp Field $Φ_{warp},κ$</label></div>
<div class="checkbox-row"><input type="checkbox" id="consActive" checked><label>Consciousness $Φ_{cons},γ,η$</label></div>

</div>

<!-- SLIDERS + EXTRA INPUTS -->
<div class="panel">
<h2>Sector Strengths</h2>

<label>Gravity $R$
  <div class="slider-row">
    <input type="range" id="gravStrength" min="0" max="10" step="0.1" value="6">
    <span id="gravVal">6.0</span>
  </div>
</label>

<label>Gauge $F,G,W$
  <div class="slider-row">
    <input type="range" id="gaugeStrength" min="0" max="10" step="0.1" value="7">
    <span id="gaugeVal">7.0</span>
  </div>
</label>

<label>Dark Matter $χ$
  <div class="slider-row">
    <input type="range" id="dmStrength" min="0" max="10" step="0.1" value="5">
    <span id="dmVal">5.0</span>
  </div>
</label>

<label>Dark Energy $Λ,σ$
  <div class="slider-row">
    <input type="range" id="deStrength" min="0" max="10" step="0.1" value="4">
    <span id="deVal">4.0</span>
  </div>
</label>

<label>Vacuum Energy $ρ_{vac}$
  <div class="slider-row">
    <input type="range" id="vacStrength" min="0" max="10" step="0.1" value="3">
    <span id="vacVal">3.0</span>
  </div>
</label>

<label>Warp $Φ_{warp},κ$
  <div class="slider-row">
    <input type="range" id="warpStrength" min="0" max="10" step="0.1" value="2">
    <span id="warpVal">2.0</span>
  </div>
</label>

<label>Consciousness $Φ_{cons},γ,η$
  <div class="slider-row">
    <input type="range" id="consStrength" min="0" max="10" step="0.1" value="1">
    <span id="consVal">1.0</span>
  </div>
</label>

<hr style="border:none;border-top:1px solid var(--border);margin:12px 0" />

<h3>Per-Scenario Inputs</h3>
<div id="scenarioInputs"></div>

</div>
</div>

<!-- RESULTS -->
<div class="panel">
<h2>Output</h2>
<div class="results" id="resultsBox">
  <div id="summaryText" class="muted">Click Calculate after entering parameters.</div>
  <div id="tagRow" class="tag-row"></div>
  <div id="bars" class="bars"></div>
</div>
</div>

<!-- RESEARCH LOG -->
<div class="panel">
<h2>Research Log</h2>
<label>Add notes for this run:</label>
<textarea id="logNotes" placeholder="Observations, stability comments, theoretical expectations..."></textarea>

<div class="btn-row">
  <button class="primary" id="btnAddLog">Calculate + Add to Log</button>
  <button class="secondary" id="btnExportJSON">Export JSON</button>
  <button class="secondary" id="btnExportCSV">Export CSV</button>
</div>

<table class="log-table" id="logTable">
  <thead>
    <tr><th>#</th><th>Scenario</th><th>Dominant Sector</th><th>S_eff</th><th>Notes</th></tr>
  </thead>
  <tbody></tbody>
</table>

</div>

<!-- EQUATION VIEW -->
<div class="panel eq-box" id="eqBox">
<h2>Unified Action — Highlighted</h2>
<p class="muted">Terms glow when active:</p>

$$Z_{total}=\int \mathcal{D}(\text{Fields})e^{i\int d^4x\sqrt{-g}[ $$

<p>
<span class="term term-grav" data-sector="grav">R</span>
-
<span class="term term-gauge" data-sector="gauge">
F_{\mu\nu}F^{\mu\nu}+G_{\mu\nu}G^{\mu\nu}+W_{\mu\nu}W^{\mu\nu}
</span>
</p>

<p>
-
<span class="term term-dm" data-sector="dm">
\frac{1}{2}\nabla_\mu\chi\nabla^\mu\chi + V_{DM}(\chi)
</span>
</p>

<p>
-
<span class="term term-de" data-sector="de">
\Lambda_{DE}\;\text{or}\;\frac{1}{2}\nabla_\mu\sigma\nabla^\mu\sigma + V_{DE}(\sigma)
</span>
</p>

<p>
-
<span class="term term-vac" data-sector="vac">\rho_{vac}</span>
-
<span class="term term-warp" data-sector="warp">
\frac{1}{2}\nabla_\mu\Phi_{warp}\nabla^\mu\Phi_{warp}
+ U(\Phi_{warp})+\kappa\Phi_{warp}\nabla_\mu J^\mu_{E\leftrightarrow m}
</span>
</p>

<p>
+
<span class="term term-cons" data-sector="cons">
\gamma\Phi^*_{cons}\Phi_{cons}+\eta(S-F)
</span>
] )$$

</div>

<script>
/* Slider label hookup */
["grav","gauge","dm","de","vac","warp","cons"].forEach(prefix=>{
  const s = document.getElementById(prefix+"Strength");
  const v = document.getElementById(prefix+"Val");
  s.addEventListener("input",()=>{ v.textContent=parseFloat(s.value).toFixed(1); });
});

/* Scenario-specific input templates */
const inputTemplates = {
  cosmo: `
    <label>Redshift z
      <input type="number" id="in_z" step="0.001" value="1.2">
    </label>
  `,
  collider: `
    <label>Center-of-Mass Energy √s (TeV)
      <input type="number" id="in_s" step="0.1" value="13.0">
    </label>
  `,
  blackhole: `
    <label>r / rₛ (distance relative to Schwarzschild radius)
      <input type="number" id="in_rrs" step="0.01" value="1.1">
    </label>
  `,
  warp: `
    <label>Bubble Radius R₍bubble₎ (m)
      <input type="number" id="in_Rb" step="0.1" value="12.0">
    </label>
    <label>Energy↔Mass Transfer Rate J₍E↔m₎
      <input type="number" id="in_Jem" step="0.001" value="0.24">
    </label>
  `,
  cst: `
    <label>CST Offset Δτ (ns)
      <input type="number" id="in_dtau" step="0.01" value="0.74">
    </label>
  `,
  sprc: `
    <label>SPR-C Network Size N (nodes)
      <input type="number" id="in_N" value="512">
    </label>
    <label>Consciousness Coupling Θ
      <input type="number" id="in_theta" step="0.01" value="1.35">
    </label>
  `
};

/* Inject scenario inputs */
function refreshScenarioInputs(){
  const s = document.getElementById("scenario").value;
  document.getElementById("scenarioInputs").innerHTML = inputTemplates[s] || "";
}

/* When scenario changes → inject its inputs */
document.getElementById("scenario").addEventListener("change", refreshScenarioInputs);

/* Scenario weights for base sector influence (toy) */
const scenarioWeights = {
  cosmo:{grav:2.3,gauge:1.1,dm:1.9,de:2.2,vac:1.9,warp:0.6,cons:0.3},
  collider:{grav:0.6,gauge:2.7,dm:0.8,de:0.2,vac:0.3,warp:0.4,cons:0.2},
  blackhole:{grav:3.1,gauge:1.2,dm:0.9,de:0.6,vac:1.2,warp:1.3,cons:0.3},
  warp:{grav:0.9,gauge:1.4,dm:0.6,de:1.1,vac:2.4,warp:3.0,cons:0.7},
  cst:{grav:1.8,gauge:1.8,dm:1.3,de:0.8,vac:0.9,warp:1.2,cons:0.5},
  sprc:{grav:0.5,gauge:1.3,dm:0.4,de:0.4,vac:0.7,warp:0.9,cons:3.1}
};

/* Compute value × weight if active */
function sectorVal(key){
  if(!document.getElementById(key+"Active").checked) return 0;
  const slider = parseFloat(document.getElementById(key+"Strength").value);
  const s = document.getElementById("scenario").value;
  return slider * (scenarioWeights[s][key] || 1);
}

/* Highlight full equation terms */
function updateEquationActive(){
  ["grav","gauge","dm","de","vac","warp","cons"].forEach(sec=>{
    const act = document.getElementById(sec+"Active").checked;
    const els = document.querySelectorAll('.term[data-sector="'+sec+'"]');
    els.forEach(e=>e.classList.toggle("active",act));
  });
}

/* Scenario modifiers from extra inputs */
function scenarioExtras(s){
  switch(s){
    case "cosmo": {
      const z = parseFloat(document.getElementById("in_z").value);
      return {DEboost:1 + 0.12*z, VACboost:1 + 0.06*z};
    }
    case "collider":{
      const sTeV = parseFloat(document.getElementById("in_s").value);
      return {GaugeBoost:1 + 0.05*sTeV};
    }
    case "blackhole":{
      const rrs = parseFloat(document.getElementById("in_rrs").value);
      return {GravBoost: Math.min(5, 1/rrs)};
    }
    case "warp":{
      const Rb = parseFloat(document.getElementById("in_Rb").value);
      const Jem = parseFloat(document.getElementById("in_Jem").value);
      return {WarpBoost: 1 + 0.03*Rb + 0.4*Jem};
    }
    case "cst":{
      const dt = parseFloat(document.getElementById("in_dtau").value);
      return {GaugeTimeBoost: 1 + 0.1*dt};
    }
    case "sprc":{
      const N = parseFloat(document.getElementById("in_N").value);
      const th = parseFloat(document.getElementById("in_theta").value);
      return {ConsBoost:1 + 0.002*N + 0.25*th};
    }
  }
  return {};
}

/* Main Run Calculation */
function runCalculation(){
  const s = document.getElementById("scenario").value;
  const e = scenarioExtras(s);

  let grav  = sectorVal("grav");
  let gauge = sectorVal("gauge");
  let dm    = sectorVal("dm");
  let de    = sectorVal("de");
  let vac   = sectorVal("vac");
  let warp  = sectorVal("warp");
  let cons  = sectorVal("cons");

  /* Apply scenario extra effects */
  if(e.DEboost) de *= e.DEboost;
  if(e.VACboost) vac *= e.VACboost;
  if(e.GaugeBoost) gauge *= e.GaugeBoost;
  if(e.GravBoost) grav *= e.GravBoost;
  if(e.WarpBoost) warp *= e.WarpBoost;
  if(e.GaugeTimeBoost) gauge *= e.GaugeTimeBoost;
  if(e.ConsBoost) cons *= e.ConsBoost;

  const total = grav + gauge + dm + de + vac + warp + cons;
  updateEquationActive();

  if(!total){
    document.getElementById("summaryText").innerHTML =
      "No sectors active — turn on at least one field.";
    document.getElementById("tagRow").innerHTML = "";
    document.getElementById("bars").innerHTML = "";
    return {dominant:"None",Seff:0};
  }

  const fGrav=grav/total,fGauge=gauge/total,fDM=dm/total,fDE=de/total,
        fVac=vac/total,fWarp=warp/total,fCons=cons/total;

  /* Effective Action Score (toy) */
  const classical = grav + gauge + dm;
  const exotic = de + vac + warp + cons;
  const Seff = (0.7*classical + 1.3*exotic).toFixed(2);

  /* Stability = classical vs vacuum/DE */
  const stability = (classical/(classical + de + vac + 1e-9));
  const stabPct = (100*stability).toFixed(1);

  const sectors = [
    {name:"Gravity",v:fGrav},
    {name:"Gauge",v:fGauge},
    {name:"Dark Matter",v:fDM},
    {name:"Dark Energy",v:fDE},
    {name:"Vacuum",v:fVac},
    {name:"Warp",v:fWarp},
    {name:"Consciousness",v:fCons},
  ].sort((a,b)=>b.v-a.v);
  const dom = sectors[0].name;

  /* UI update */
  document.getElementById("summaryText").innerHTML = `
    <strong>S_eff:</strong> ${Seff}<br>
    <strong>Stability:</strong> ${stabPct}%<br>
    <strong>Dominant sector:</strong> ${dom}
  `;

  let tags="";
  if(stability>0.7) tags+=`<span class="tag ok">Classical-gravity/gauge regime</span>`;
  else if(stability>0.4) tags+=`<span class="tag warn">Mixed stability</span>`;
  else tags+=`<span class="tag bad">Vacuum-dominated regime</span>`;
  if(fWarp>0.2) tags+=`<span class="tag warn">Warp-reinforced</span>`;
  if(fCons>0.2) tags+=`<span class="tag ok">Consciousness-coupled</span>`;
  document.getElementById("tagRow").innerHTML = tags;

  document.getElementById("bars").innerHTML =
    secBar("Gravity",fGrav)+secBar("Gauge",fGauge)+secBar("Dark Matter",fDM)+
    secBar("Dark Energy",fDE)+secBar("Vacuum",fVac)+secBar("Warp",fWarp)+secBar("Consciousness",fCons);

  return {dominant:dom,Seff:Seff};
}

/* helper for bars */
function secBar(name,f){
  const pct=(100*f).toFixed(1);
  return `
    <div class="bar">
      <div style="font-size:0.8rem;color:var(--muted)">${name}: ${pct}%</div>
      <div class="bar-track"><div class="bar-fill" style="width:${pct}%;"></div></div>
    </div>`;
}

/* LOGGING */
const log = [];
document.getElementById("btnAddLog").addEventListener("click",()=>{
  const r = runCalculation();
  const notes = document.getElementById("logNotes").value.trim();
  log.push({
    scenario: document.getElementById("scenario").value,
    dominant:r.dominant,
    Seff:r.Seff,
    notes
  });
  updateTable();
  document.getElementById("logNotes").value="";
});
function updateTable(){
  const tbody = document.querySelector("#logTable tbody");
  tbody.innerHTML="";
  log.forEach((L,i)=>{
    tbody.innerHTML+=`<tr><td>${i+1}</td><td>${L.scenario}</td><td>${L.dominant}</td><td>${L.Seff}</td><td>${L.notes}</td></tr>`;
  });
}

/* EXPORT JSON */
document.getElementById("btnExportJSON").addEventListener("click",()=>{
  const blob = new Blob([JSON.stringify(log,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Unified_Playground_Log.json";
  a.click();
});

/* EXPORT CSV */
document.getElementById("btnExportCSV").addEventListener("click",()=>{
  let csv="index,scenario,dominant,Seff,notes\n";
  log.forEach((L,i)=>{
    csv+=`${i+1},${L.scenario},${L.dominant},${L.Seff},"${(L.notes||"").replace(/"/g,'""')}"\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Unified_Playground_Log.csv";
  a.click();
});

/* === INITIALIZATION AFTER FUNCTIONS === */

/* Sync equation highlights with Active Field checkboxes */
["grav","gauge","dm","de","vac","warp","cons"].forEach(sec=>{
  const cb = document.getElementById(sec + "Active");
  cb.addEventListener("change", updateEquationActive);
});

/* On first load: inject default scenario inputs and highlight terms */
refreshScenarioInputs();
updateEquationActive();
</script>
</div>
</body>
</html>
