<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lotto Pattern Coach — 3+ Hit Learning (1–54, 6 numbers, 10 tickets)</title>
<style>
  :root{
    --bg:#0b1222;
    --panel:#121a33;
    --ink:#edf2ff;
    --muted:#a9b7e3;
    --accent:#8fb4ff;
    --grid:#1b2550;
    --chip:#1e2a59;
    --warn:#ffd37a;
    --bad:#ff8c8c;
    --good:#7bffb1;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
  }
  .wrap{
    max-width:1100px;
    margin:0 auto;
    padding:16px;
  }
  h1{
    margin:6px 0 4px;
    font-size:1.6rem;
  }
  .tagline{
    margin:0 0 12px;
    color:var(--muted);
    font-size:0.9rem;
  }
  .grid{
    display:grid;
    grid-template-columns:1.3fr 1fr;
    gap:16px;
  }
  @media(max-width:880px){
    .grid{grid-template-columns:1fr}
  }
  section{
    background:var(--panel);
    border:1px solid var(--grid);
    border-radius:10px;
    padding:12px;
  }
  h2{
    margin:0 0 8px;
    font-size:1.05rem;
  }
  label{
    font-size:0.85rem;
    color:var(--muted);
    display:block;
    margin-bottom:4px;
  }
  textarea{
    width:100%;
    min-height:90px;
    background:#070c19;
    color:var(--ink);
    border:1px solid var(--grid);
    border-radius:8px;
    padding:8px;
    font-family:ui-monospace,Consolas,monospace;
    font-size:0.8rem;
    resize:vertical;
    white-space:pre;
  }
  textarea.small{
    min-height:70px;
  }
  .hint{
    font-size:0.75rem;
    color:var(--muted);
    margin:4px 0 8px;
  }
  .btn-row{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin:8px 0;
  }
  button{
    border:none;
    border-radius:999px;
    padding:7px 14px;
    font-size:0.85rem;
    cursor:pointer;
    background:var(--chip);
    color:var(--ink);
  }
  button.primary{
    background:var(--accent);
    color:#050816;
    font-weight:600;
  }
  button:disabled{
    opacity:0.55;
    cursor:not-allowed;
  }
  .summary{
    margin-top:8px;
    padding:8px;
    border-radius:8px;
    background:#0c1630;
    border:1px dashed var(--grid);
    font-size:0.8rem;
  }
  .summary strong{
    color:var(--accent);
  }
  .pill-row{
    display:flex;
    flex-wrap:wrap;
    gap:6px;
    margin-top:4px;
  }
  .pill{
    font-size:0.7rem;
    padding:2px 8px;
    border-radius:999px;
    border:1px solid var(--grid);
    background:#0a142b;
    color:var(--muted);
  }
  .pill.good{
    border-color:var(--good);
    color:var(--good);
  }
  .pill.bad{
    border-color:var(--bad);
    color:var(--bad);
  }
  .tiny-diag{
    margin-top:4px;
    font-size:0.78rem;
    color:var(--muted);
  }
  .tiny-diag.safe{
    color:var(--good);
  }
  .tiny-diag.risky{
    color:var(--bad);
  }
  .tiny-diag.hot{
    color:var(--warn);
  }
  .spread{
    margin-top:6px;
    font-size:0.75rem;
    color:var(--muted);
  }
  .spread.tight{color:var(--bad);}
  .spread.loose{color:var(--warn);}
  .spread.balanced{color:var(--good);}
  .footer-note{
    margin-top:12px;
    font-size:0.72rem;
    color:var(--muted);
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>Lotto Pattern Coach — 3+ Hit Learning</h1>
  <p class="tagline">
    6 numbers • 1–54 • 10 tickets • Learns from full history + recent draws + your 3+ hit rows (pattern coach, not magic).
  </p>

  <div class="grid">
    <!-- LEFT: ALL INPUTS + ANALYSIS -->
    <section>
      <h2>1. History input &amp; analysis</h2>

      <label for="allDraws">All historical winning draws (REQUIRED, oldest → newest)</label>
      <textarea id="allDraws" placeholder="Example (one line per draw):&#10;03 12 24 33 41 52&#10;01 05 18 27 36 49&#10;... paste ALL main results you have"></textarea>
      <div class="hint">
        REQUIRED: paste as many past draws as you have (months/years). Each line: 6 numbers (1–54), spaces or commas.
      </div>

      <label for="recentDraws">Last ~20 official draws (optional extra weight)</label>
      <textarea id="recentDraws" placeholder="Example (one line per draw):&#10;14 21 32 38 44 51&#10;02 09 19 27 42 54&#10;... last 15–25 draws (extra bias)"></textarea>
      <div class="hint">
        Optional: these draws get extra weight as &quot;recent behavior&quot;. You can repeat some lines from the box above.
      </div>

      <label for="ticketsIn">Your past played / generated tickets (250–400+ rows)</label>
      <textarea id="ticketsIn" placeholder="Example (one line per ticket):&#10;02 11 19 34 42 54&#10;03 12 24 33 41 52&#10;... all tickets you've actually played/tested"></textarea>
      <div class="hint">
        Paste all tickets you bought or tested with these draws. The code will find which rows hit 3+ and treat them as &quot;good&quot;.
      </div>

      <div class="btn-row">
        <button class="primary" onclick="analyzeHistory()">Analyze (3+ hits, safe zone &amp; scores)</button>
        <button onclick="clearAll()">Reset all</button>
      </div>

      <div id="summary" class="summary">
        Paste your history, then click <strong>Analyze</strong> to see 3+ hit rate and number scores.
      </div>

      <div id="safeDiag" class="tiny-diag">
        Safe zone target: ~8–20% of your tickets reaching ≥3 matches (3, 4, 5, or 6 hits) across your history.
      </div>
    </section>

    <!-- RIGHT: GENERATION + SCORES -->
    <section>
      <h2>2. Generate 10 new tickets (biased by history)</h2>

      <label for="ticketsOut">New 10-ticket set (play candidates)</label>
      <textarea id="ticketsOut" class="small" placeholder="After Analyze, click &quot;Generate 10 tickets&quot;."></textarea>

      <div class="btn-row">
        <button class="primary" onclick="generateTickets()">Generate 10 tickets (weighted by scores)</button>
        <button onclick="copyTickets()">Copy tickets</button>
      </div>

      <div id="spreadDiag" class="spread">
        Spread diagnostic will appear here (tight / balanced / loose) after generation.
      </div>

      <div class="summary">
        <strong>Number score bands (how the coach sees the field)</strong>
        <div id="scoreBands" class="pill-row">
          <span class="pill">No scores yet — run Analyze first.</span>
        </div>
      </div>

      <div class="footer-note">
        ⚠️ This does <em>not</em> beat true random lottery odds. It only shapes your tickets using:
        all draws, recent draws, and which of your rows actually hit 3+ numbers. Still gambling, still risky.
      </div>
    </section>
  </div>
</div>

<script>
  const MAX_N = 54;
  const NUM_PER_TICKET = 6;
  const TICKETS_TO_GEN = 10;

  let lastScores = null;      // score[1..54]
  let lastAnalyzeInfo = null; // summary data (for future debugging if needed)

  function parseTickets(raw){
    const lines = raw.split(/[\r\n]+/).map(l=>l.trim()).filter(l=>l.length>0);
    const tickets = [];
    for(const line of lines){
      const nums = line
        .replace(/,/g,' ')
        .split(/\s+/)
        .map(x=>parseInt(x,10))
        .filter(n=>Number.isFinite(n) && n>=1 && n<=MAX_N);
      if(nums.length === NUM_PER_TICKET){
        const uniq = Array.from(new Set(nums)).sort((a,b)=>a-b);
        if(uniq.length === NUM_PER_TICKET){
          tickets.push(uniq);
        }
      }
    }
    return tickets;
  }

  function countMatches(a,b){
    let i=0,j=0,hit=0;
    while(i<a.length && j<b.length){
      if(a[i] === b[j]){ hit++; i++; j++; }
      else if(a[i]<b[j]) i++;
      else j++;
    }
    return hit;
  }

  function analyzeHistory(){
    const allDrawsRaw    = document.getElementById('allDraws').value;
    const recentDrawsRaw = document.getElementById('recentDraws').value;
    const ticketsRaw     = document.getElementById('ticketsIn').value;

    const summaryEl = document.getElementById('summary');
    const safeDiagEl= document.getElementById('safeDiag');

    const allDraws    = parseTickets(allDrawsRaw);
    const recentDraws = parseTickets(recentDrawsRaw);
    const tickets     = parseTickets(ticketsRaw);

    // REQUIRE: allDraws and tickets must exist
    if(allDraws.length === 0 || tickets.length === 0){
      summaryEl.innerHTML =
        'You must paste <strong>all historical winning draws</strong> ' +
        'and your <strong>played tickets</strong> to analyze. ' +
        'Each line must have exactly 6 numbers between 1 and 54.';
      safeDiagEl.className = 'tiny-diag';
      safeDiagEl.textContent =
        'Safe zone target: ~8–20% of your tickets reaching ≥3 matches (3, 4, 5, or 6 hits).';
      lastScores = null;
      lastAnalyzeInfo = null;
      updateScoreBands(null);
      return;
    }

    // Reference draws for hit-testing = all history + recent (recent = extra examples, not required)
    const refDraws = allDraws.concat(recentDraws);

    // Frequency arrays
    const freqAllDraws    = Array(MAX_N+1).fill(0);
    const freqRecent20    = Array(MAX_N+1).fill(0);
    const freqGoodTickets = Array(MAX_N+1).fill(0);
    const freqBadTickets  = Array(MAX_N+1).fill(0);

    // Fill freqAllDraws from all historical draws
    for(const d of allDraws){
      for(const n of d) freqAllDraws[n]++;
    }

    // Fill freqRecent20 from recent draws (optional)
    for(const d of recentDraws){
      for(const n of d) freqRecent20[n]++;
    }

    // Classify tickets as good/bad based on best hit vs any refDraw
    let goodTickets = 0;
    let badTickets  = 0;
    const hitHist = [0,0,0,0,0,0,0]; // index = hits (0..6)
    const goodRows = []; // store rows that hit 3+ (for reference if needed)

    for(const t of tickets){
      let bestHit = 0;
      for(const d of refDraws){
        const h = countMatches(t,d);
        if(h>bestHit) bestHit = h;
        if(bestHit === NUM_PER_TICKET) break;
      }
      hitHist[bestHit]++;

      if(bestHit>=3){
        goodTickets++;
        goodRows.push(t);
        for(const n of t) freqGoodTickets[n]++;
      }else{
        badTickets++;
        for(const n of t) freqBadTickets[n]++;
      }
    }

    const totalTickets = tickets.length;
    const threePlus = goodTickets;
    const threePlusPct = totalTickets>0 ? (threePlus*100/totalTickets) : 0;

    // Build scores using formula:
    // score[n] = 2.0*freqAllDraws[n] + 1.5*freqRecent20[n]
    //          + 1.5*freqGoodTickets[n] - 0.5*freqBadTickets[n]
    const scores = Array(MAX_N+1).fill(0);
    let anyPos = false;
    for(let n=1;n<=MAX_N;n++){
      let s =
        2.0 * freqAllDraws[n] +
        1.5 * freqRecent20[n] +
        1.5 * freqGoodTickets[n] -
        0.5 * freqBadTickets[n];
      if(s<0) s = 0;
      if(s>0) anyPos = true;
      scores[n] = s;
    }

    if(!anyPos){
      // History too thin or all flat → fallback to 1 each
      for(let n=1;n<=MAX_N;n++) scores[n] = 1;
    }

    lastScores = scores;
    lastAnalyzeInfo = {
      allDrawsCount: allDraws.length,
      recentDrawsCount: recentDraws.length,
      totalTickets,
      hitHist,
      threePlus,
      threePlusPct,
      goodTickets,
      badTickets,
      goodRowsCount: goodRows.length
    };

    updateScoreBands(scores);

    // Build summary text
    const lines = [];
    lines.push(
      `Analyzed <strong>${allDraws.length}</strong> all-time draws, ` +
      `<strong>${recentDraws.length}</strong> recent draws, and ` +
      `<strong>${totalTickets}</strong> of your tickets.`
    );

    lines.push(
      `Tickets by best match vs any draw: ` +
      `${hitHist[0]}×0, ${hitHist[1]}×1, ${hitHist[2]}×2, ` +
      `${hitHist[3]}×3, ${hitHist[4]}×4, ${hitHist[5]}×5, ${hitHist[6]}×6.`
    );

    lines.push(
      `You had <strong>${threePlus}</strong> tickets reaching ` +
      `<strong>3 or more</strong> matches (~${threePlusPct.toFixed(1)}% of your tickets).`
    );

    let zoneText = '';
    let diagClass = 'tiny-diag';
    if(threePlusPct < 8){
      zoneText = 'You are in the <strong>cold / risky zone</strong> (&lt;8% 3+-hit rate). ' +
        'Your pattern is not producing many 3+ hit tickets. ' +
        'Consider mixing in more under-used numbers and checking spacing.';
      diagClass += ' risky';
    }else if(threePlusPct <= 20){
      zoneText = 'You are in the <strong>safe zone</strong> (8–20% 3+-hit rate). ' +
        'You are getting some 3+ activity without it looking like a pure fluke.';
      diagClass += ' safe';
    }else{
      zoneText = 'You are in a <strong>hot / suspicious zone</strong> (&gt;20% 3+-hit rate). ' +
        'This may be short-term luck; do not assume it will continue.';
      diagClass += ' hot';
    }
    lines.push(zoneText);

    summaryEl.innerHTML = lines.join('<br>');

    safeDiagEl.className = diagClass;
    safeDiagEl.innerHTML =
      `3+ hit rate: <strong>${threePlusPct.toFixed(1)}%</strong> — ` +
      (threePlusPct < 8
        ? 'Below safe zone (pattern too cold).'
        : threePlusPct <= 20
          ? 'Inside safe zone.'
          : 'Above safe zone (likely just luck / overfit).');
  }

  function updateScoreBands(scores){
    const el = document.getElementById('scoreBands');
    el.innerHTML = '';
    if(!scores){
      el.innerHTML = '<span class="pill">No scores yet — run Analyze first.</span>';
      return;
    }
    const vals = scores.slice(1);
    const max = Math.max(...vals);
    const min = Math.min(...vals);
    const span = max - min || 1;

    const bands = { low:0, mid:0, high:0 };
    for(let n=1;n<=MAX_N;n++){
      const norm = (scores[n]-min)/span; // 0..1
      if(norm < 0.33) bands.low++;
      else if(norm < 0.66) bands.mid++;
      else bands.high++;
    }

    const low = document.createElement('span');
    low.className = 'pill bad';
    low.textContent = `Low-score numbers: ${bands.low}`;

    const mid = document.createElement('span');
    mid.className = 'pill';
    mid.textContent = `Mid-score numbers: ${bands.mid}`;

    const high = document.createElement('span');
    high.className = 'pill good';
    high.textContent = `High-score numbers: ${bands.high}`;

    el.appendChild(low);
    el.appendChild(mid);
    el.appendChild(high);
  }

  function weightedPick(scores, usedSet){
    let total = 0;
    for(let n=1;n<=MAX_N;n++){
      if(usedSet.has(n)) continue;
      total += scores[n];
    }
    if(total <= 0){
      // flat fallback
      while(true){
        const r = 1 + Math.floor(Math.random()*MAX_N);
        if(!usedSet.has(r)) return r;
      }
    }
    let r = Math.random()*total;
    for(let n=1;n<=MAX_N;n++){
      if(usedSet.has(n)) continue;
      r -= scores[n];
      if(r<=0) return n;
    }
    // safety fallback
    for(let n=1;n<=MAX_N;n++){
      if(!usedSet.has(n)) return n;
    }
    return 1;
  }

  function generateTickets(){
    const ticketsOutEl = document.getElementById('ticketsOut');
    const spreadDiagEl = document.getElementById('spreadDiag');

    if(!lastScores){
      alert('Please run "Analyze" first with your draws and tickets.');
      return;
    }

    const scores = lastScores;
    const out = [];
    const allTicketsNums = []; // for spread check

    for(let t=0;t<TICKETS_TO_GEN;t++){
      const used = new Set();
      while(used.size < NUM_PER_TICKET){
        const n = weightedPick(scores, used);
        used.add(n);
      }
      const ticket = Array.from(used).sort((a,b)=>a-b);
      out.push(ticket.map(n=>String(n).padStart(2,'0')).join(' '));
      allTicketsNums.push(ticket);
    }

    ticketsOutEl.value = out.join('\n');

    // Simple spread diagnostic on generated tickets
    let totalGap = 0;
    let gapsCount = 0;
    let minGapAll = Infinity;
    let maxGapAll = -Infinity;
    for(const t of allTicketsNums){
      for(let i=1;i<t.length;i++){
        const g = t[i]-t[i-1];
        totalGap += g;
        gapsCount++;
        if(g<minGapAll) minGapAll = g;
        if(g>maxGapAll) maxGapAll = g;
      }
    }
    const avgGap = gapsCount>0 ? (totalGap/gapsCount) : 0;
    let spreadClass = 'spread';
    let label = '';
    if(avgGap < 6){
      spreadClass += ' tight';
      label = 'tight (numbers are bunched together more)';
    }else if(avgGap > 10){
      spreadClass += ' loose';
      label = 'loose (numbers are very spread out)';
    }else{
      spreadClass += ' balanced';
      label = 'balanced (mix of near and far gaps)';
    }
    spreadDiagEl.className = spreadClass;
    spreadDiagEl.textContent =
      `Spread: avg gap ~ ${avgGap.toFixed(2)} (min gap ${minGapAll}, max gap ${maxGapAll}) → ${label}.`;
  }

  function copyTickets(){
    const ta = document.getElementById('ticketsOut');
    if(!ta.value.trim()){
      alert('No tickets to copy yet. Generate first.');
      return;
    }
    ta.select();
    ta.setSelectionRange(0, ta.value.length);
    document.execCommand('copy');
    alert('Generated tickets copied to clipboard.');
  }

  function clearAll(){
    document.getElementById('allDraws').value = '';
    document.getElementById('recentDraws').value = '';
    document.getElementById('ticketsIn').value = '';
    document.getElementById('ticketsOut').value = '';
    document.getElementById('summary').innerHTML =
      'Paste your history, then click <strong>Analyze</strong> to see 3+ hit rate and number scores.';
    const safeDiagEl = document.getElementById('safeDiag');
    safeDiagEl.className = 'tiny-diag';
    safeDiagEl.textContent =
      'Safe zone target: ~8–20% of your tickets reaching ≥3 matches (3, 4, 5, or 6 hits) across your history.';
    const spreadDiagEl = document.getElementById('spreadDiag');
    spreadDiagEl.className = 'spread';
    spreadDiagEl.textContent =
      'Spread diagnostic will appear here (tight / balanced / loose) after generation.';
    lastScores = null;
    lastAnalyzeInfo = null;
    updateScoreBands(null);
  }
</script>
</body>
</html>
