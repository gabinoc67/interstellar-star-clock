<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lotto Simulator ‚Äî Paste-Only (10 tickets ‚Ä¢ 6 numbers ‚Ä¢ 1‚Äì54)</title>
<style>
  :root{--bg:#0b1222;--panel:#121a33;--ink:#edf2ff;--muted:#a9b7e3;--accent:#8fb4ff;--grid:#1b2550;--chip:#1e2a59;--warn:#ffd37a}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{margin:6px 0 10px;font-size:1.6rem}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
  .card{background:var(--panel);border:1px solid var(--grid);border-radius:14px;padding:14px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  textarea{width:100%;min-height:160px;background:#0e1530;color:var(--ink);border:1px solid var(--grid);border-radius:10px;padding:10px;font-family:ui-monospace,Menlo,Consolas}
  label{font-size:0.9rem;color:var(--muted)}
  input[type="number"],select{width:100%;background:#0e1530;color:var(--ink);border:1px solid var(--grid);border-radius:10px;padding:8px}
  button{background:linear-gradient(180deg,#96b8ff,#6c96ff);color:#06102e;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  button.secondary{background:#1f2a57;color:var(--ink);border:1px solid var(--grid)}
  .pill{display:inline-block;background:var(--chip);border:1px solid var(--grid);padding:4px 8px;border-radius:999px;color:var(--muted);font-size:0.8rem}
  .note{color:var(--muted);font-size:0.9rem}
  .numchip{display:inline-block;background:#0e1737;border:1px solid var(--grid);padding:3px 7px;border-radius:8px;margin:2px;font-variant-numeric:tabular-nums}
  .ticket{display:flex;gap:6px;flex-wrap:wrap}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border-bottom:1px solid var(--grid);padding:6px 8px;font-variant-numeric:tabular-nums}
  th{text-align:left;color:var(--muted);font-weight:600}
</style>
</head>
<body>
<div class="wrap">
  <h1>üéØ Lotto Simulator ‚Äî Paste-Only (No Uploads)</h1>
  <p class="note">Paste your draws below. One line per draw, six integers 1‚Äì54 separated by spaces/commas. Example: <code>3, 12, 18, 27, 41, 52</code></p>

  <!-- PRIMARY INPUT PANELS -->
  <div class="grid">
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:baseline">
        <h3>Winning Draws (any prize)</h3>
        <span class="pill">favored</span>
      </div>
      <textarea id="winTxt" placeholder="Paste winners here...\n3, 12, 18, 27, 41, 52\n..."></textarea>
      <div class="row">
        <label>Total parsed: <span id="winCount">0</span></label>
        <label>Sum range: <span id="winSumRange">-</span></label>
        <label>Distinct pairs: <span id="winPairs">0</span></label>
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:baseline">
        <h3>Non-Winning (rollovers)</h3>
        <span class="pill">penalized</span>
      </div>
      <textarea id="nonTxt" placeholder="Paste non-winners here...\n1 5 11 22 33 44\n..."></textarea>
      <div class="row">
        <label>Total parsed: <span id="nonCount">0</span></label>
        <label>Sum range: <span id="nonSumRange">-</span></label>
        <label>Distinct pairs: <span id="nonPairs">0</span></label>
      </div>
    </div>
  </div>

  <!-- NEW: RECENT DRAWS PANEL -->
  <div class="card" style="margin-top:16px">
    <div class="row" style="justify-content:space-between;align-items:baseline">
      <h3>Last 20 Draws (most recent)</h3>
      <span class="pill">recency prior</span>
    </div>
    <textarea id="recTxt" placeholder="Paste the last 20 official draws here (most recent first or last ‚Äî any order is fine)..."></textarea>
    <div class="row">
      <label>Total parsed: <span id="recCount">0</span></label>
      <label>Sum range: <span id="recSumRange">-</span></label>
      <label>Distinct pairs: <span id="recPairs">0</span></label>
    </div>
    <p class="note">These recent draws are blended into the winners with weight œÅ (below) for numbers, pairs, and sums.</p>
  </div>

  <!-- CONTROLS -->
  <div class="card" style="margin-top:16px">
    <h3>Exclusion & Scoring Controls</h3>
    <div class="grid" style="grid-template-columns:repeat(7,1fr);gap:8px">
      <div><label>Œª (non-winner penalty)</label><input id="lambda" type="number" step="0.05" value="0.7"></div>
      <div><label>Œ∫ (sum penalty)</label><input id="kappa" type="number" step="0.05" value="0.7"></div>
      <div><label>œÅ (recent weight)</label><input id="rho" type="number" step="0.1" value="0.6"></div>
      <div>
        <label>Exclusion mode</label>
        <select id="excludeMode"><option value="hard">Hard: drop ‚â§ 0</option><option value="soft">Soft: drop bottom %</option></select>
      </div>
      <div><label>Soft % (numbers)</label><input id="softPctNum" type="number" step="1" value="15"></div>
      <div><label>Soft % (sums)</label><input id="softPctSum" type="number" step="1" value="25"></div>
      <div><label>Samples / ticket</label><input id="attempts" type="number" value="450"></div>
    </div>

    <h4 style="margin-top:12px">Scoring Weights</h4>
    <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:8px">
      <div><label>Œ≤ pair</label><input id="beta" type="number" step="0.05" value="0.15"></div>
      <div><label>Œ≥ balance</label><input id="gamma" type="number" step="0.05" value="0.10"></div>
      <div><label>Œ¥ sum-band</label><input id="delta" type="number" step="0.05" value="0.25"></div>
      <div><label>Tickets</label><input id="kTickets" type="number" value="10"></div>
    </div>

    <div class="row" style="margin-top:10px">
      <button id="analyzeBtn">Analyze</button>
      <button id="genBtn" class="secondary">Generate Tickets</button>
      <span class="note">Analyze shows hot/cold, exclusions, top pairs, balance. Generate makes tickets from allowed pools.</span>
    </div>
  </div>

  <!-- ANALYTICS -->
  <div class="grid" style="margin-top:16px">
    <div class="card">
      <h3>Winners ‚Äî Hot / Cold</h3>
      <div id="wHot" class="note"></div>
      <div id="wCold" class="note" style="margin-top:6px"></div>
      <h3 style="margin-top:14px">Winners ‚Äî Top Pairs</h3>
      <div id="wPairsTop" class="note"></div>
      <h3 style="margin-top:14px">Winners ‚Äî Balance</h3>
      <div id="wBal" class="note"></div>
    </div>
    <div class="card">
      <h3>Non-Winners ‚Äî Hot / Cold</h3>
      <div id="nHot" class="note"></div>
      <div id="nCold" class="note" style="margin-top:6px"></div>
      <h3 style="margin-top:14px">Non-Winners ‚Äî Top Pairs</h3>
      <div id="nPairsTop" class="note"></div>
      <h3 style="margin-top:14px">Non-Winners ‚Äî Balance</h3>
      <div id="nBal" class="note"></div>
    </div>
  </div>

  <!-- EXCLUSIONS -->
  <div class="card" style="margin-top:16px">
    <h3>Excluded (Non-Possibility) ‚Äî Numbers & Sums</h3>
    <div class="row">
      <div id="excludedNums" style="flex:1"></div>
      <div id="excludedSums" style="flex:1"></div>
    </div>
  </div>

  <!-- OUTPUT TICKETS -->
  <div class="card" style="margin-top:16px">
    <h3>Suggested Tickets</h3>
    <div id="tickets"></div>
    <p class="note" style="margin-top:8px">Lotteries are random by design; this narrows to winner-like regions but can‚Äôt guarantee profit.</p>
  </div>

  <!-- METHOD -->
  <div class="card" style="margin-top:16px">
    <h3>Method (Equations)</h3>
    <p class="note">
      Per-number (with recency): <code>w(n) ‚àù (c_win(n)+œÅ¬∑c_recent(n)+Œ±)/(C_win+œÅ¬∑C_recent+Œ±N) ‚àí Œª¬∑(c_non(n)+Œ±)/(C_non+Œ±N)</code>, Œ±=1, N=54.<br/>
      Sums (with recency): <code>W_sum(S) ‚àù (H_win(S)+œÅ¬∑H_recent(S)) ‚àí Œ∫¬∑H_non(S)</code>. Hard mode excludes ‚â§0; soft excludes bottom p%.<br/>
      Pairs (with recency): counts mixed as <code>P = P_win + œÅ¬∑P_recent</code> before normalization.<br/>
      Ticket score: <code>(1‚àíŒ≤‚àíŒ≥‚àíŒ¥)¬∑Œ£w(n) + Œ≤¬∑Pair + Œ≥¬∑Balance + Œ¥¬∑Sum</code>.
    </p>
  </div>
</div>

<script>
(function(){
  const NMIN=1, NMAX=54, PICK=6;
  // ---------- helpers ----------
  const $ = sel => document.querySelector(sel);
  function parseText(txt){
    const lines=(txt||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const draws=[];
    for(const ln of lines){
      const parts = ln.replace(/;/g,',').replace(/-/g,',').split(/[ ,\t]+/).filter(Boolean);
      const nums = [...new Set(parts.map(p=>parseInt(p,10)).filter(x=>Number.isInteger(x) && x>=NMIN && x<=NMAX))].sort((a,b)=>a-b);
      if(nums.length>=PICK) draws.push(nums.slice(0,PICK));
    }
    return draws;
  }
  function pairsOf(d){ const ps=[]; for(let i=0;i<d.length;i++){ for(let j=i+1;j<d.length;j++){ ps.push([d[i],d[j]].sort((a,b)=>a-b).join('-')); } } return ps; }
  function histogram(arr){ const m=new Map(); for(const x of arr){ m.set(x,(m.get(x)||0)+1); } return m; }
  function bottomPercentKeys(mapObj,pct){ const arr=[...mapObj.entries()].sort((a,b)=> a[1]-b[1] || a[0]-b[0]); const cut=Math.floor(arr.length*Math.max(0,Math.min(100,pct))/100); return new Set(arr.slice(0,cut).map(([k])=>k)); }
  function describeBalance(draws){
    const rows = draws.map(d=>{const sum=d.reduce((s,x)=>s+x,0); const odd=d.filter(x=>x%2===1).length; const low=d.filter(x=>x<=Math.floor((NMAX+NMIN)/2)).length; const spread=Math.max(...d)-Math.min(...d); return {sum,odd,low,spread};});
    const desc={};
    function stat(get){ const v=rows.map(get).sort((a,b)=>a-b); if(!v.length) return {mean:null,std:null,min:null,max:null, count:0}; const m=v.reduce((s,x)=>s+x,0)/v.length; const varc=v.reduce((s,x)=>s+(x-m)*(x-m),0)/Math.max(1,v.length-1); return {mean:m,std:Math.sqrt(varc),min:v[0],max:v[v.length-1], count:v.length}; }
    desc.sum=stat(r=>r.sum); desc.odd=stat(r=>r.odd); desc.low=stat(r=>r.low); desc.spread=stat(r=>r.spread); desc._count=rows.length; desc._sumRange=rows.length? `${Math.min(...rows.map(r=>r.sum))}‚Äì${Math.max(...rows.map(r=>r.sum))}`:'-'; return desc;
  }
  function z(val,mu,sd){ if(!isFinite(sd)||sd<=0) return 0; return -Math.abs((val-mu)/sd); }

  // ---------- state ----------
  const winTxt = $('#winTxt');
  const nonTxt = $('#nonTxt');
  const recTxt = $('#recTxt');
  const winCount = $('#winCount');
  const nonCount = $('#nonCount');
  const recCount = $('#recCount');
  const winSumRange = $('#winSumRange');
  const nonSumRange = $('#nonSumRange');
  const recSumRange = $('#recSumRange');
  const winPairs = $('#winPairs');
  const nonPairs = $('#nonPairs');
  const recPairs = $('#recPairs');

  function sumRange(draws){ if(!draws.length) return '-'; const s=draws.map(d=>d.reduce((a,b)=>a+b,0)); return `${Math.min(...s)}‚Äì${Math.max(...s)}`; }
  function distinctPairs(ds){ const s=new Set(); for(const d of ds) for(const pk of pairsOf(d)) s.add(pk); return s.size; }

  function refreshCounts(){
    const W = parseText(winTxt.value);
    const N = parseText(nonTxt.value);
    const R = parseText(recTxt.value);

    winCount.textContent = W.length;
    nonCount.textContent = N.length;
    recCount.textContent = R.length;

    winSumRange.textContent = sumRange(W);
    nonSumRange.textContent = sumRange(N);
    recSumRange.textContent = sumRange(R);

    winPairs.textContent = distinctPairs(W);
    nonPairs.textContent = distinctPairs(N);
    recPairs.textContent = distinctPairs(R);
  }
  winTxt.addEventListener('input', refreshCounts);
  nonTxt.addEventListener('input', refreshCounts);
  recTxt.addEventListener('input', refreshCounts);

  // ---------- analysis core (now includes recency) ----------
  function analyze(lambda=0.7,kappa=0.7,rho=0.6){
    const W=parseText(winTxt.value), N=parseText(nonTxt.value), R=parseText(recTxt.value);

    // number freqs
    const wf=new Map(), nf=new Map(), rf=new Map();
    for(let n=NMIN;n<=NMAX;n++){ wf.set(n,0); nf.set(n,0); rf.set(n,0); }
    for(const d of W) for(const x of d) wf.set(x, wf.get(x)+1);
    for(const d of N) for(const x of d) nf.set(x, nf.get(x)+1);
    for(const d of R) for(const x of d) rf.set(x, rf.get(x)+1);

    const Cw=[...wf.values()].reduce((s,x)=>s+x,0);
    const Cn=[...nf.values()].reduce((s,x)=>s+x,0);
    const Cr=[...rf.values()].reduce((s,x)=>s+x,0);

    const alpha=1, M=(NMAX-NMIN+1);
    const numScore=new Map();
    for(let n=NMIN;n<=NMAX;n++){
      const pW=((wf.get(n)||0) + rho*(rf.get(n)||0) + alpha) / ((Cw + rho*Cr) + alpha*M);
      const pN=((nf.get(n)||0) + alpha) / ((Cn) + alpha*M);
      numScore.set(n, pW - lambda*pN);
    }

    // pairs (winners + rho*recent)
    const pairCountsW=new Map(), pairCountsR=new Map();
    for(const d of W) for(const pk of pairsOf(d)) pairCountsW.set(pk,(pairCountsW.get(pk)||0)+1);
    for(const d of R) for(const pk of pairsOf(d)) pairCountsR.set(pk,(pairCountsR.get(pk)||0)+1);
    const pairCounts=new Map();
    for(const [k,v] of pairCountsW.entries()) pairCounts.set(k,(pairCounts.get(k)||0)+v);
    for(const [k,v] of pairCountsR.entries()) pairCounts.set(k,(pairCounts.get(k)||0)+rho*v);
    const totalPairs=[...pairCounts.values()].reduce((s,x)=>s+x,0);

    // balance (keep for W and N separately)
    const wBal=describeBalance(W), nBal=describeBalance(N);

    // sums (winners + rho*recent) vs non
    const sumsW=W.map(d=>d.reduce((s,x)=>s+x,0)), sumsN=N.map(d=>d.reduce((s,x)=>s+x,0)), sumsR=R.map(d=>d.reduce((s,x)=>s+x,0));
    const hW=histogram(sumsW), hN=histogram(sumsN), hR=histogram(sumsR);
    const sumScore=new Map(); const domain=new Set([...hW.keys(),...hN.keys(),...hR.keys()]);
    for(const S of domain){
      const winLike=(hW.get(S)||0) + rho*(hR.get(S)||0);
      const nonLike=(hN.get(S)||0);
      sumScore.set(S, winLike - kappa*nonLike);
    }
    return {W,N,R,wf,nf,rf,numScore,pairCounts,totalPairs,wBal,nBal,hW,hN,hR,sumScore};
  }

  function excludeSets(A, mode, softPctNum, softPctSum){
    let excludedNums=new Set(); let excludedSums=new Set();
    if(mode==='hard'){
      for(const [n,sc] of A.numScore.entries()) if(sc<=0) excludedNums.add(n);
      for(const [S,sc] of A.sumScore.entries()) if(sc<=0) excludedSums.add(S);
    } else {
      excludedNums = bottomPercentKeys(A.numScore, softPctNum);
      excludedSums = bottomPercentKeys(A.sumScore, softPctSum);
    }
    return {excludedNums, excludedSums};
  }

  // ---------- render helpers ----------
  function renderHotCold(divHot, divCold, map){
    const arr=[...map.entries()].sort((a,b)=> b[1]-a[1] || a[0]-b[0]);
    divHot.innerHTML = arr.length? `<div class="pill">Top 12</div><div>${arr.slice(0,12).map(([n,c])=>`<span class="numchip">${String(n).padStart(2,'0')} ‚Ä¢ ${c}</span>`).join('')}</div>` : '<span class="note">No data</span>';
    const cold=[...map.entries()].sort((a,b)=> a[1]-b[1] || a[0]-b[0]).slice(0,12);
    divCold.innerHTML = arr.length? `<div class="pill">Bottom 12</div><div>${cold.map(([n,c])=>`<span class="numchip">${String(n).padStart(2,'0')} ‚Ä¢ ${c}</span>`).join('')}</div>` : '';
  }
  function renderPairs(div,map){
    const arr=[...map.entries()].sort((a,b)=> b[1]-a[1]).slice(0,25);
    div.innerHTML = arr.length? `<div class="pill">Top 25</div><div>${arr.map(([k,c])=>`<span class="numchip">${k.replace('-', '‚Äì')} ‚Ä¢ ${(+c).toFixed(2)}</span>`).join('')}</div>` : '<span class="note">No pairs</span>';
  }
  function renderBalance(div,b){
    if(!b||!b._count){div.innerHTML='<span class="note">No balance stats</span>';return;}
    const row=(name,o)=>`<tr><th>${name}</th><td>${o.mean?.toFixed(2)??'-'}</td><td>${o.std?.toFixed(2)??'-'}</td><td>${o.min??'-'}</td><td>${o.max??'-'}</td></tr>`;
    div.innerHTML=`<div class="pill">n=${b._count}, sum ${b._sumRange}</div>
      <table><thead><tr><th>Metric</th><th>Mean</th><th>Std</th><th>Min</th><th>Max</th></tr></thead>
      <tbody>${row('Sum',b.sum)}${row('Odd count',b.odd)}${row('Low (‚â§27)',b.low)}${row('Spread',b.spread)}</tbody></table>`;
  }

  // ---------- UI targets ----------
  const wHot=$('#wHot'), wCold=$('#wCold'), wPairsTop=$('#wPairsTop'), wBal=$('#wBal');
  const nHot=$('#nHot'), nCold=$('#nCold'), nPairsTop=$('#nPairsTop'), nBal=$('#nBal');
  const excludedNumsDiv=$('#excludedNums'), excludedSumsDiv=$('#excludedSums');
  const ticketsDiv=$('#tickets');

  function analyzeUI(){
    const lambda=parseFloat($('#lambda').value||'0.7');
    const kappa=parseFloat($('#kappa').value||'0.7');
    const rho=parseFloat($('#rho').value||'0.6');
    const mode=$('#excludeMode').value;
    const softPctNum=parseFloat($('#softPctNum').value||'15');
    const softPctSum=parseFloat($('#softPctSum').value||'25');

    const A=analyze(lambda,kappa,rho);

    // render stats
    renderHotCold(wHot,wCold,A.wf);            // winners only
    renderPairs(wPairsTop,A.pairCounts);       // mixed winners+rho*recent
    renderBalance(wBal,A.wBal);

    // non-winners section as-is
    const nfPairs=(()=>{const np=new Map(); for(const d of A.N) for(const pk of pairsOf(d)) np.set(pk,(np.get(pk)||0)+1); return np;})();
    renderHotCold(nHot,nCold,A.nf);
    renderPairs(nPairsTop,nfPairs);
    renderBalance(nBal,A.nBal);

    // exclusions
    const {excludedNums,excludedSums}=excludeSets(A,mode,softPctNum,softPctSum);
    excludedNumsDiv.innerHTML = `<div class="pill">Excluded Numbers (${excludedNums.size})</div><div>${[...excludedNums].sort((a,b)=>a-b).map(n=>`<span class="numchip">${String(n).padStart(2,'0')}</span>`).join('')||'<span class="note">none</span>'}</div>`;
    const sumsSorted=[...excludedSums].sort((a,b)=>a-b);
    excludedSumsDiv.innerHTML = `<div class="pill">Excluded Sums (${excludedSums.size})</div><div>${sumsSorted.length? sumsSorted.map(S=>`<span class="numchip">${S}</span>`).join(''):'<span class="note">none</span>'}</div>`;
  }

  function generateTicketsUI(){
    const lambda=parseFloat($('#lambda').value||'0.7');
    const kappa=parseFloat($('#kappa').value||'0.7');
    const rho=parseFloat($('#rho').value||'0.6');
    const mode=$('#excludeMode').value;
    const softPctNum=parseFloat($('#softPctNum').value||'15');
    const softPctSum=parseFloat($('#softPctSum').value||'25');

    const beta=parseFloat($('#beta').value||'0.15');
    const gamma=parseFloat($('#gamma').value||'0.10');
    const delta=parseFloat($('#delta').value||'0.25');

    const attempts=parseInt($('#attempts').value||'450',10);
    const kTickets=parseInt($('#kTickets').value||'10',10);

    const A=analyze(lambda,kappa,rho);
    const {excludedNums,excludedSums}=excludeSets(A,mode,softPctNum,softPctSum);

    // allowed number pool + weights
    const allowed=[]; for(let n=NMIN;n<=NMAX;n++){ if(!excludedNums.has(n)) allowed.push(n); }
    if(allowed.length<PICK){ ticketsDiv.innerHTML='<span class="note">Too many numbers excluded ‚Äî relax settings.</span>'; return; }

    const weights=new Map(); let sum=0;
    for(const n of allowed){ const sc=Math.max(0, A.numScore.get(n)||0); weights.set(n, sc); sum+=sc; }
    if(sum<=0){ const u=1/allowed.length; for(const n of allowed) weights.set(n,u); }
    else{ for(const n of allowed) weights.set(n, (weights.get(n)/sum)); }

    // allowed sums (by score)
    const allowedSums=new Set();
    if(A.sumScore.size){
      if(mode==='hard'){ for(const [S,sc] of A.sumScore.entries()) if(sc>0) allowedSums.add(S); }
      else { const excl = bottomPercentKeys(A.sumScore, softPctSum); for(const [S] of A.sumScore.entries()) if(!excl.has(S)) allowedSums.add(S); }
    }

    function sampleWithoutReplacement(weightsMap,k){
      const entries=[...weightsMap.entries()].filter(([n,w])=>w>0);
      if(entries.length<k){ const pool=[...weightsMap.keys()]; pool.sort(()=>Math.random()-0.5); return pool.slice(0,k).sort((a,b)=>a-b);}
      let nums=[], used=new Set();
      for(let i=0;i<k;i++){
        let s=0; for(const [n,w] of entries) if(!used.has(n)) s+=w;
        let r=Math.random()*s, acc=0, pick=null;
        for(const [n,w] of entries){ if(used.has(n)) continue; acc+=w; if(r<=acc){ pick=n; break; } }
        if(pick==null){ const rest=entries.map(e=>e[0]).filter(n=>!used.has(n)); pick=rest[Math.floor(Math.random()*rest.length)]; }
        used.add(pick); nums.push(pick);
      }
      return nums.sort((a,b)=>a-b);
    }

    function scoreTicket(nums){
      let base=0; for(const n of nums) base += Math.max(0, A.numScore.get(n)||0);

      // pair score using mixed counts already (winners + œÅ*recent)
      let pairS=0;
      for(let i=0;i<nums.length;i++){
        for(let j=i+1;j<nums.length;j++){
          const pk=[nums[i],nums[j]].sort((a,b)=>a-b).join('-');
          const c=A.pairCounts.get(pk)||0;
          if(A.totalPairs>0) pairS += c/A.totalPairs;
        }
      }

      // balance guidance from winners
      const sumV = nums.reduce((a,b)=>a+b,0);
      const b=A.wBal||{};
      const balS=(z(sumV,b.sum?.mean,b.sum?.std)
                + z(nums.filter(x=>x%2===1).length,b.odd?.mean,b.odd?.std)
                + z(nums.filter(x=>x<=Math.floor((NMAX+NMIN)/2)).length,b.low?.mean,b.low?.std)
                + z(Math.max(...nums)-Math.min(...nums),b.spread?.mean,b.spread?.std))/4;

      // sum score (if exact S missing, blend nearby)
      let sumS=0;
      if(A.sumScore.size){
        if(A.sumScore.has(sumV) && (!allowedSums.size || allowedSums.has(sumV))) {
          sumS=Math.max(0,A.sumScore.get(sumV));
        } else {
          let num=0,den=0;
          for(const [S,w] of A.sumScore.entries()){
            if(allowedSums.size && !allowedSums.has(S)) continue;
            const k=1/(1+Math.abs(S-sumV));
            num+=k*Math.max(0,w);
            den+=k;
          }
          sumS=den>0? num/den:0;
        }
      }
      const baseW=Math.max(0,1-beta-gamma-delta);
      return baseW*base + beta*pairS + gamma*balS + delta*sumS;
    }

    const out=[]; const seen=new Set();
    for(let t=0;t<kTickets;t++){
      let best=null, bestScore=-1e9; let tries=attempts;
      while(tries--){
        const cand=sampleWithoutReplacement(weights,PICK);
        const sc=scoreTicket(cand);
        const key=cand.join('-');
        if(sc>bestScore && !seen.has(key)){ best=cand; bestScore=sc; }
      }
      if(!best){
        const pool=[...allowed]; pool.sort(()=>Math.random()-0.5);
        best=pool.slice(0,PICK).sort((a,b)=>a-b);
        bestScore=scoreTicket(best);
      }
      seen.add(best.join('-'));
      out.push({nums:best, score:bestScore});
    }

    ticketsDiv.innerHTML = out.map((t,i)=>`<div class="row" style="justify-content:space-between;border-bottom:1px solid var(--grid);padding:6px 0">
      <div><span class="pill">Ticket ${i+1}</span></div>
      <div class="ticket">${t.nums.map(n=>`<span class="numchip">${String(n).padStart(2,'0')}</span>`).join('')}</div>
      <div class="note">score ${t.score.toFixed(4)}</div>
    </div>`).join('');
  }

  // wire buttons
  document.getElementById('analyzeBtn').addEventListener('click', analyzeUI);
  document.getElementById('genBtn').addEventListener('click', generateTicketsUI);

  // initial counters
  refreshCounts();
})();
</script>
</body>
</html>
