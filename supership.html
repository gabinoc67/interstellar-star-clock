<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fire Fox — CST Spaceplane-Arrow Fighter</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  html,body{
    margin:0;
    height:100%;
    background:#020617;
    overflow:hidden;
    font-family:Segoe UI,Roboto,Arial,sans-serif;
    color:#e8f3ff;
  }
  canvas{ position:fixed; inset:0; }
  .hudpanel{
    position:fixed;
    background:rgba(12,22,52,0.78);
    padding:12px 16px;
    border:1px solid rgba(130,190,255,0.65);
    border-radius:12px;
    backdrop-filter:blur(10px);
    font-size:13px;
  }
  h2{
    margin:0 0 6px;
    font-size:16px;
    letter-spacing:.06em;
  }
  .label{
    margin-top:8px;
    font-size:11px;
    color:#8dbaff;
    text-transform:uppercase;
    letter-spacing:.12em;
  }
  .value{ margin-top:3px; font-size:13px; }
  select,button{
    width:100%;
    padding:7px 8px;
    margin-top:6px;
    background:#0c1634;
    color:#d5e9ff;
    border:1px solid #3d67b8;
    border-radius:6px;
    font-size:14px;
    cursor:pointer;
  }
  #engageBtn{ background:#003ae3; }
  #engageBtn:hover{ background:#0d4aff; }
  #stopBtn{ background:#3a0a0a; border-color:#b84747; }
  #stopBtn:hover{ background:#5a1010; }
  #msg{ margin-top:8px; font-size:12px; color:#9fd7ff; min-height:18px; }
  #safeMsg{ margin-top:4px; font-size:12px; }
</style>
</head>
<body>
<canvas id="sim"></canvas>

<!-- MAIN CONTROL PANEL -->
<div class="hudpanel" id="panelMain" style="top:10px; right:10px; width:360px;">
  <h2>Fire Fox CST Navigation Panel</h2>

  <div class="label">Departure City</div>
  <select id="fromCity">
    <option>New York</option>
    <option>Los Angeles</option>
    <option>London</option>
    <option>Paris</option>
    <option>Tokyo</option>
    <option>Mexico City</option>
    <option>São Paulo</option>
    <option>Mumbai</option>
    <option>Shanghai</option>
    <option>Jakarta</option>
    <option>Instanbul</option>
    <option>Cairo</option>
  </select>

  <div class="label">Arrival City</div>
  <select id="toCity">
    <option>New York</option>
    <option>Los Angeles</option>
    <option>London</option>
    <option>Paris</option>
    <option>Tokyo</option>
    <option>Mexico City</option>
    <option>São Paulo</option>
    <option>Mumbai</option>
    <option>Shanghai</option>
    <option>Jakarta</option>
    <option>Instanbul</option>
    <option>Cairo</option>
  </select>

  <div class="label">Engine Mode</div>
  <select id="modeSelect">
    <option value="1">Jet Mode</option>
    <option value="2">Scramjet</option>
    <option value="3">CST Field (M = E/c²)</option>
  </select>

  <button id="calcBtn">1 — Calculate Trip</button>
  <button id="engageBtn">2 — Engage Engine</button>
  <button id="stopBtn">STOP ENGINE</button>
  <button id="safetyBtn">Recalculate Safety</button>
  <button id="resetBtn">Reset Simulation</button>

  <div id="msg"></div>
  <div id="safeMsg"></div>
</div>

<!-- CLOCKS -->
<div class="hudpanel" id="panelClocks" style="bottom:10px; left:10px; width:280px;">
  <h2>Time Synchronization</h2>
  <div class="label">CST Time</div>
  <div class="value" id="cstClock">--:--:--</div>

  <div class="label">Ship Proper Time</div>
  <div class="value" id="shipClock">--:--:--</div>

  <div class="label">Estimated Arrival (CST)</div>
  <div class="value" id="arrivalClock">--:--:--</div>

  <div class="label">Countdown</div>
  <div class="value" id="countdownVal">--</div>
</div>

<!-- PHYSICS -->
<div class="hudpanel" id="panelPhysics" style="bottom:10px; right:10px; width:360px;">
  <h2>Flight Physics Readout</h2>
  <div class="label">Distance</div><div class="value" id="distVal">--</div>
  <div class="label">Atmospheric Drag Model</div><div class="value" id="dragVal">--</div>
  <div class="label">Speed</div><div class="value" id="speedVal">--</div>
  <div class="label">Time Dilation</div><div class="value" id="dilationVal">--</div>
  <div class="label">G-Force Raw vs Adjusted</div><div class="value" id="gVal">--</div>
  <div class="label">Energy Field (M ↔ E)</div><div class="value" id="emcVal">--</div>
</div>

<script>
/* ═══════════════════════════════════════════════
   GLOBALS & LAT/LONG DATABASE
═══════════════════════════════════════════════ */
const canvas=document.getElementById("sim");
const ctx=canvas.getContext("2d");
let W,H,cx,cy;
function resize(){ W=canvas.width=innerWidth;H=canvas.height=innerHeight;cx=W/2;cy=H/2; }
addEventListener("resize",resize); resize();

const cityCoords={
  "New York":[40.7128,-74.0060],
  "Los Angeles":[34.0522,-118.2437],
  "London":[51.5074,-0.1278],
  "Paris":[48.8566,2.3522],
  "Tokyo":[35.6762,139.6503],
  "Mexico City":[19.4326,-99.1332],
  "São Paulo":[-23.5558,-46.6396],
  "Mumbai":[19.0760,72.8777],
  "Shanghai":[31.2304,121.4737],
  "Jakarta":[-6.2088,106.8456],
  "Instanbul":[41.0082,28.9784],
  "Cairo":[30.0444,31.2357]
};

/* ═══════════════════════════════════════════════
   HAVERSINE DISTANCE
═══════════════════════════════════════════════ */
function havDist(lat1,lon1,lat2,lon2){
  const R=6371; // km
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2 +
          Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180) *
          Math.sin(dLon/2)**2;
  return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

/* ═══════════════════════════════════════════════
   HUD ELEMENTS
═══════════════════════════════════════════════ */
const fromCity=document.getElementById("fromCity");
const toCity=document.getElementById("toCity");
const modeSelect=document.getElementById("modeSelect");
const msgEl=document.getElementById("msg");
const safeMsgEl=document.getElementById("safeMsg");

const cstClockEl=document.getElementById("cstClock");
const shipClockEl=document.getElementById("shipClock");
const arrivalClockEl=document.getElementById("arrivalClock");
const countdownEl=document.getElementById("countdownVal");

const distValEl=document.getElementById("distVal");
const dragValEl=document.getElementById("dragVal");
const speedValEl=document.getElementById("speedVal");
const dilationValEl=document.getElementById("dilationVal");
const gValEl=document.getElementById("gVal");
const emcValEl=document.getElementById("emcVal");

/* ═══════════════════════════════════════════════
   TRIP PROPERTIES
═══════════════════════════════════════════════ */
let running=false;
let trip=null;
let arrivalTimeCST=null;
let countdownFrozen=false;

/* ═══════════════════════════════════════════════
   CALCULATE TRIP
═══════════════════════════════════════════════ */
document.getElementById("calcBtn").onclick=()=>{
  const A=fromCity.value;
  const B=toCity.value;
  if(A===B){ msgEl.textContent="Departure and arrival cannot be same.";return;}
  const [lat1,lon1]=cityCoords[A];
  const [lat2,lon2]=cityCoords[B];
  const km=havDist(lat1,lon1,lat2,lon2);

  // Atmospheric drag simplified
  const drag=1+Math.log1p(km/5000);

  trip={A,B,km,drag};
  arrivalClockEl.textContent="--:--:--";
  countdownEl.textContent="--";
  msgEl.textContent=`Route locked: ${A} → ${B}`;
  updatePhysicsPanel();
};

/* ═══════════════════════════════════════════════
   SAFETY
═══════════════════════════════════════════════ */
document.getElementById("safetyBtn").onclick=()=>{
  if(modeSelect.value=="3"){
    safeMsgEl.style.color="#7bff9f";
    safeMsgEl.textContent="✔ Stable CST Corridor - Field Safe";
  } else {
    safeMsgEl.style.color="#ff7272";
    safeMsgEl.textContent="⚠ Full safety requires CST Field mode.";
  }
};

/* ═══════════════════════════════════════════════
   START / STOP
═══════════════════════════════════════════════ */
document.getElementById("engageBtn").onclick=()=>{ running=true; };
document.getElementById("stopBtn").onclick=()=>{ running=false; countdownFrozen=false; };
document.getElementById("resetBtn").onclick=()=>{
  running=false; trip=null; arrivalTimeCST=null; countdownFrozen=false;
  msgEl.textContent="Simulation reset"; clearPhysics();
};

/* ═══════════════════════════════════════════════
   PHYSICS UPDATE
═══════════════════════════════════════════════ */
function clearPhysics(){
  distValEl.textContent=timeVal="--";
  dragValEl.textContent=speedValEl.textContent=dilationValEl.textContent="--";
  gValEl.textContent=emcValEl.textContent="--";
}
function updatePhysicsPanel(){
  if(!trip){ clearPhysics();return; }
  distValEl.textContent = trip.km.toFixed(0)+" km";
  dragValEl.textContent = trip.drag.toFixed(3);

  let mode=Number(modeSelect.value);

  let speed;      // km/s
  let gRaw;       // g-force
  if(mode===1){ speed=0.8; gRaw=2; }             // jet
  if(mode===2){ speed=3.5; gRaw=6; }             // scramjet
  if(mode===3){ speed=299792.458*0.99; gRaw=10;} // CST Field ~0.99c

  const gamma=mode===3?1/Math.sqrt(1-(speed/299792.458)**2):1;
  const gAdj=Math.min(gRaw,3);

  speedValEl.textContent = speed<300 ? speed.toFixed(1)+" km/s" :
    (speed/300000*100).toFixed(2)+"% of c";
  dilationValEl.textContent = ((1-1/gamma)*100).toFixed(2)+"%";
  gValEl.textContent = `Raw ${gRaw.toFixed(1)} g → Cockpit ${gAdj.toFixed(1)} g`;
  emcValEl.textContent = mode===3 ? "Active E ↔ m conversion field" : "Idle";
}

/* ═══════════════════════════════════════════════
   TIME SYSTEM
═══════════════════════════════════════════════ */
function getCST(){ const n=new Date(); return new Date(n.getTime()+n.getTimezoneOffset()*60000-6*3600000);}
function updateClocks(){
  const cst=getCST();
  cstClockEl.textContent=cst.toTimeString().split(" ")[0];

  if(running && trip && !arrivalTimeCST){
    let mode=Number(modeSelect.value);
    let speed = mode===3 ? 299792.458*0.99 : (mode===2?3.5:0.8);
    const seconds = trip.km / speed;
    arrivalTimeCST = new Date(cst.getTime() + seconds*1000);
  }

  if(arrivalTimeCST){
    arrivalClockEl.textContent = arrivalTimeCST.toTimeString().split(" ")[0];
    const diff = (arrivalTimeCST - cst)/1000;
    if(diff <= 0){
      countdownEl.textContent="ARRIVED";
      running=false;
      return;
    }
    if(!countdownFrozen)
      countdownEl.textContent = diff.toFixed(0)+" sec";
  }

  // Ship proper time
  if(running && trip){
    let mode=Number(modeSelect.value);
    let speed = mode===3 ? 299792.458*0.99 : (mode===2?3.5:0.8);
    const gamma = mode===3 ? 1/Math.sqrt(1-(speed/299792.458)**2) : 1;
    const shipNow = new Date(cst.getTime() - (1-1/gamma)*500); 
    shipClockEl.textContent = shipNow.toTimeString().split(" ")[0];
  }
}

/* ═══════════════════════════════════════════════
   STARFIELD + FIGHTER + PARTICLES
═══════════════════════════════════════════════ */
const stars=Array.from({length:260},()=>({x:Math.random()*W,y:Math.random()*H,s:0.5+Math.random()*1.5}));
function updateStars(dt){
  let boost=1+(Number(modeSelect.value))*0.5;
  for(let s of stars){ s.y+=s.s*boost; if(s.y>H){s.y=-5;s.x=Math.random()*W;} }
}
function drawStars(){
  ctx.fillStyle="white";
  for(let s of stars) ctx.fillRect(s.x,s.y,2,2);
}

function drawSpaceplane(){
  ctx.save(); ctx.translate(cx,cy); ctx.strokeStyle="rgba(120,180,255,0.7)"; ctx.lineWidth=2;
  ctx.beginPath();
  // nose
  ctx.moveTo(0,-220);
  // arrow body
  ctx.lineTo(65,-140); ctx.lineTo(90,-40);
  ctx.lineTo(70,160); ctx.lineTo(0,200);
  ctx.lineTo(-70,160); ctx.lineTo(-90,-40);
  ctx.lineTo(-65,-140); ctx.closePath(); ctx.stroke();
  // fins
  ctx.beginPath();
  ctx.moveTo(70,160); ctx.lineTo(105,205); ctx.lineTo(65,190);
  ctx.moveTo(-70,160); ctx.lineTo(-105,205); ctx.lineTo(-65,190);
  ctx.stroke();
  ctx.restore();
}

/* exhausts */
const engL=[],engR=[],scrL=[],scrR=[];
function newP(){ return {x:0,y:0,vx:(Math.random()-0.5)*1,vy:2+Math.random()*2,life:0.7+Math.random()}; }
for(let i=0;i<150;i++){engL.push(newP());engR.push(newP());scrL.push(newP());scrR.push(newP());}

function updateExhaust(arr,dt){ let m=Number(modeSelect.value); let b=1+m*1.5; 
  for(let p of arr){ p.x+=p.vx*b; p.y+=p.vy*b; p.life-=dt*0.6; if(p.life<=0) Object.assign(p,newP()); }
}
function drawExhaust(arr,ox,oy){
  ctx.save(); ctx.translate(cx+ox,cy+oy);
  for(let p of arr){ ctx.globalAlpha=p.life; ctx.fillStyle="rgba(140,220,255,1)"; ctx.beginPath(); ctx.arc(p.x,p.y,2,0,Math.PI*2); ctx.fill(); }
  ctx.restore();
}

function drawShield(t){
  let m=Number(modeSelect.value);
  let R=200*(1+m*0.3);
  ctx.save(); ctx.translate(cx,cy);
  const g=ctx.createRadialGradient(0,0,20,0,0,R);
  g.addColorStop(0,`rgba(220,255,255,${0.12*m})`);
  g.addColorStop(1,"rgba(20,40,90,0)");
  ctx.fillStyle=g; ctx.beginPath(); ctx.arc(0,0,R,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

/* ═══════════════════════════════════════════════
   MAIN LOOP
═══════════════════════════════════════════════ */
let last=0;
function loop(ts){
  const dt=(ts-last)/1000 || 0; last=ts;
  ctx.clearRect(0,0,W,H);

  updateStars(dt); drawStars();
  drawSpaceplane();

  updateExhaust(engL,dt); updateExhaust(engR,dt);
  updateExhaust(scrL,dt); updateExhaust(scrR,dt);

  drawExhaust(engL,-60,90);
  drawExhaust(engR,60,90);
  drawExhaust(scrL,-120,20);
  drawExhaust(scrR,120,20);

  drawShield(ts);

  if(running && trip) updatePhysicsPanel();
  updateClocks();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
