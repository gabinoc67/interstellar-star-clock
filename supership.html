<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CST Warp Navigation — Full Simulation</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  html,body{
    margin:0;
    height:100%;
    background:#020617;
    overflow:hidden;
    font-family:Segoe UI,Roboto,Arial,sans-serif;
    color:#e8f3ff;
  }
  canvas{
    position:fixed;
    inset:0;
  }
  .hudpanel{
    position:fixed;
    background:rgba(12,22,52,0.78);
    padding:12px 16px;
    border:1px solid rgba(130,190,255,0.65);
    border-radius:12px;
    backdrop-filter:blur(10px);
    font-size:13px;
  }
  #panelMain{
    top:10px;
    right:10px;
    max-width:360px;
  }
  #panelClocks{
    bottom:10px;
    left:10px;
    max-width:300px;
  }
  #panelPhysics{
    bottom:10px;
    right:10px;
    max-width:360px;
  }
  h2{
    margin:0 0 6px;
    font-size:16px;
    letter-spacing:.06em;
  }
  .label{
    margin-top:8px;
    font-size:11px;
    color:#8dbaff;
    text-transform:uppercase;
    letter-spacing:.12em;
  }
  .value{
    margin-top:3px;
    font-size:13px;
  }
  select,button{
    width:100%;
    padding:7px 8px;
    margin-top:6px;
    background:#0c1634;
    color:#d5e9ff;
    border:1px solid #3d67b8;
    border-radius:6px;
    font-size:14px;
    cursor:pointer;
  }
  #engageBtn{ background:#003ae3; }
  #engageBtn:hover{ background:#0d4aff; }
  #stopBtn{ background:#3a0a0a; border-color:#b84747; }
  #stopBtn:hover{ background:#5a1010; }
  #msg{
    margin-top:8px;
    font-size:12px;
    color:#9fd7ff;
    min-height:18px;
  }
  #safeMsg{
    margin-top:4px;
    font-size:12px;
  }
</style>
</head>
<body>
<canvas id="sim"></canvas>

<!-- MAIN CONTROL PANEL -->
<div class="hudpanel" id="panelMain">
  <h2>Warp Navigation Panel</h2>

  <div class="label">Destination Planet</div>
  <select id="planetSelect">
    <option value="Mercury">Mercury</option>
    <option value="Venus">Venus</option>
    <option value="Mars">Mars</option>
    <option value="Jupiter">Jupiter</option>
    <option value="Saturn">Saturn</option>
    <option value="Uranus">Uranus</option>
    <option value="Neptune">Neptune</option>
    <option value="Pluto">Pluto</option>
  </select>

  <div class="label">Warp Factor (0 – 10)</div>
  <select id="warpSelect">
    <option value="0">0 — Idle</option>
    <option value="1">Warp 1</option>
    <option value="2">Warp 2</option>
    <option value="3">Warp 3</option>
    <option value="4">Warp 4</option>
    <option value="5">Warp 5</option>
    <option value="6">Warp 6</option>
    <option value="7">Warp 7</option>
    <option value="8">Warp 8</option>
    <option value="9">Warp 9</option>
    <option value="10">Warp 10</option>
  </select>

  <button id="calcBtn">1 — Calculate Trip</button>
  <button id="engageBtn">2 — Engage Warp Drive</button>
  <button id="stopBtn">STOP ENGINE</button>
  <button id="safetyBtn">5 — Recalculate Safety</button>
  <button id="resetBtn">Reset Simulation</button>

  <div id="msg"></div>
  <div id="safeMsg"></div>
</div>

<!-- CLOCKS PANEL -->
<div class="hudpanel" id="panelClocks">
  <h2>Time Synchronization</h2>
  <div class="label">CST Synchronized Time</div>
  <div class="value" id="cstClock">--:--:--</div>

  <div class="label">Ship Proper Time</div>
  <div class="value" id="shipClock">--:--:--</div>

  <div class="label">Estimated Arrival (CST)</div>
  <div class="value" id="arrivalClock">--:--:--</div>
</div>

<!-- PHYSICS PANEL -->
<div class="hudpanel" id="panelPhysics">
  <h2>Warp Physics Readout</h2>

  <div class="label">Distance</div>
  <div class="value" id="distVal">--</div>

  <div class="label">Travel Time (CST Frame)</div>
  <div class="value" id="timeVal">--</div>

  <div class="label">Ship Time & Difference</div>
  <div class="value" id="shipTimeVal">--</div>

  <div class="label">Time Dilation</div>
  <div class="value" id="dilationVal">--</div>

  <div class="label">Space Expansion Correction</div>
  <div class="value" id="expandVal">--</div>

  <div class="label">Mass–Energy Conversion (E ↔ m)</div>
  <div class="value" id="emcVal">--</div>
</div>

<script>
/* ========== CANVAS SETUP ========== */
const canvas = document.getElementById("sim");
const ctx = canvas.getContext("2d");
let W=0,H=0,cx=0,cy=0;
function resize(){
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  cx = W/2;
  cy = H/2;
}
window.addEventListener("resize", resize);
resize();

/* ========== STATE ========== */
let warp = 0;          // 0..10
let running = false;
let trip = null;       // { planet, km, seconds, shipSeconds }

/* AU distances (Sun-centered); Earth fixed at 1 AU static) */
const AU = 149597870.7; // km
const distAU = {
  Mercury:0.387,
  Venus:0.723,
  Mars:1.524,
  Jupiter:5.203,
  Saturn:9.539,
  Uranus:19.18,
  Neptune:30.06,
  Pluto:39.48
};

/* ========== PARTICLES ========== */
const coreParticles = [];
const engineLeft = [];
const engineRight = [];

for(let i=0;i<220;i++) coreParticles.push(newCoreParticle());
for(let i=0;i<180;i++) engineLeft.push(newEngineParticle());
for(let i=0;i<180;i++) engineRight.push(newEngineParticle());

function newCoreParticle(){
  return {
    a:Math.random()*Math.PI*2,
    r:Math.random()*10,
    max:70+Math.random()*50,
    sp:0.06+Math.random()*0.14,
    size:1+Math.random()*2,
    life:Math.random()
  };
}

// Engine jets DOWNWARD (vy positive)
function newEngineParticle(){
  return {
    x:0,
    y:0,
    vx:(Math.random()-0.5)*0.6,   // slight sideways spread
    vy:2+Math.random()*2.5,       // downward
    life:0.7+Math.random()*1.1
  };
}

/* ========== DOM HELPERS ========== */
const planetSelect = document.getElementById("planetSelect");
const warpSelect   = document.getElementById("warpSelect");
const msgEl        = document.getElementById("msg");
const safeMsgEl    = document.getElementById("safeMsg");

const cstClockEl   = document.getElementById("cstClock");
const shipClockEl  = document.getElementById("shipClock");
const arrClockEl   = document.getElementById("arrivalClock");

const distValEl    = document.getElementById("distVal");
const timeValEl    = document.getElementById("timeVal");
const shipTimeValEl= document.getElementById("shipTimeVal");
const dilationValEl= document.getElementById("dilationVal");
const expandValEl  = document.getElementById("expandVal");
const emcValEl     = document.getElementById("emcVal");

/* ========== CST TIME (UTC - 6) ========== */
function getCSTDate(){
  const now = new Date();
  const utcMs = now.getTime() + now.getTimezoneOffset()*60000;
  return new Date(utcMs - 6*3600000);
}

/* ========== BUTTON WIRES ========== */
document.getElementById("calcBtn").onclick = () => {
  calculateTrip();
};

document.getElementById("engageBtn").onclick = () => {
  running = true;
  // Engage bumps warp up by 1 until 10 (or uses manual setting)
  if(warp < 10) warp++;
  warpSelect.value = String(warp);
  calculateTrip();
};

document.getElementById("stopBtn").onclick = () => {
  running = false;
  warp = 0;
  warpSelect.value = "0";
  updatePhysicsPanel();
};

document.getElementById("safetyBtn").onclick = () => {
  recalcSafety();
};

document.getElementById("resetBtn").onclick = () => {
  warp = 0;
  running = false;
  warpSelect.value = "0";
  trip = null;
  msgEl.textContent = "";
  safeMsgEl.textContent = "";
  clearPhysicsPanel();
};

warpSelect.onchange = () => {
  warp = Number(warpSelect.value);
  calculateTrip();
};

/* ========== TRIP CALCULATIONS ========== */
function calculateTrip(){
  const planet = planetSelect.value;
  const dAU = distAU[planet] - 1;   // Earth static at 1 AU
  const km = Math.abs(dAU)*AU;
  const c = 299792.458;            // km/s

  // Toy warp speed law: v = c * (warp^1.5), min warp=1 when nonzero
  let effWarp = Math.max(warp, 1);
  const v = c * Math.pow(effWarp, 1.5);

  const seconds = km / v;

  // Time dilation (toy): gamma ~ 1 / sqrt(1 - (warp/10)^2)
  const beta = Math.min(warp/10, 0.99);
  const gamma = 1 / Math.sqrt(1 - beta*beta);
  const shipSeconds = seconds / gamma;

  trip = { planet, km, seconds, shipSeconds, gamma };
  updatePhysicsPanel();
}

/* ========== SAFETY CHECK ========== */
function recalcSafety(){
  if(warp >= 4){
    safeMsgEl.style.color = "#7bff9f";
    safeMsgEl.textContent = "✔ Safe to travel: protection field and CST corridor stable.";
    return true;
  } else {
    safeMsgEl.style.color = "#ff7272";
    safeMsgEl.textContent = "⚠ Unsafe: increase warp ≥ 4 for stable CST warp corridor.";
    return false;
  }
}

/* ========== PHYSICS PANEL UPDATE ========== */
function clearPhysicsPanel(){
  distValEl.textContent    = "--";
  timeValEl.textContent    = "--";
  shipTimeValEl.textContent= "--";
  dilationValEl.textContent= "--";
  expandValEl.textContent  = "--";
  emcValEl.textContent     = "--";
}

function updatePhysicsPanel(){
  if(!trip){
    msgEl.textContent = "Select planet and click Calculate Trip.";
    clearPhysicsPanel();
    return;
  }
  msgEl.textContent = `Planet: ${trip.planet} | Warp: ${warp}`;

  // Distance
  distValEl.textContent = `${(trip.km/1e6).toFixed(2)} million km`;

  // Travel time (CST frame)
  const hrs = trip.seconds/3600;
  const days = hrs/24;
  timeValEl.textContent = `${hrs.toFixed(2)} hours (~${days.toFixed(2)} days)`;

  // Ship time + difference
  const shipHrs = trip.shipSeconds/3600;
  const diffHrs = hrs - shipHrs;
  shipTimeValEl.textContent =
    `Ship: ${shipHrs.toFixed(2)} h | Δt = ${diffHrs.toFixed(2)} h`;

  // Time dilation fraction
  const dilation = 1 - (trip.shipSeconds / trip.seconds);
  dilationValEl.textContent =
    `${(dilation*100).toFixed(2)}% time difference (ship vs CST)`;

  // Space expansion correction (toy factor)
  const expansion = Math.log1p(trip.km / 1e10);
  expandValEl.textContent =
    `Correction factor: +${expansion.toFixed(5)} (Δspace metric)`;

  // Mass–energy conversion index (not real units, just intensity)
  const emIndex = warp * 1.5;
  emcValEl.textContent =
    `E = mc² / m = E/c² utilization index ≈ ${emIndex.toFixed(2)}`;
}

/* ========== CLOCK PANEL UPDATE ========== */
function updateClocks(){
  const cstNow = getCSTDate();
  cstClockEl.textContent = cstNow.toTimeString().split(" ")[0];

  if(trip){
    const arrivalCST = new Date(cstNow.getTime() + trip.seconds*1000);
    arrClockEl.textContent = arrivalCST.toTimeString().split(" ")[0];

    // Ship proper time = CST time slowed by dilation
    const dilation = 1 - (trip.shipSeconds / trip.seconds);
    const shipMsOffset = trip.seconds*1000 * (1-dilation);
    const shipNow = new Date(cstNow.getTime() + shipMsOffset*0.000001); // tiny illustrative offset
    shipClockEl.textContent = shipNow.toTimeString().split(" ")[0];
  } else {
    shipClockEl.textContent = "--:--:--";
    arrClockEl.textContent  = "--:--:--";
  }
}

/* ========== WARP VISUAL HELPERS ========== */
function warpEnergy(){
  return 0.25 + (warp/10)*0.75; // 0.25 .. 1.0
}

/* ========== MAIN ANIMATION LOOP ========== */
let lastTs = 0;
function loop(ts){
  const dt = (ts-lastTs)/1000 || 0;
  lastTs = ts;

  ctx.clearRect(0,0,W,H);

  // Draw ship outline
  drawShipOutline();

  // Draw protection field (gets brighter with warp)
  drawProtectionField(ts);

  // Draw core and nuclear/fission rings
  drawCore(ts);

  // Update and draw particles
  updateCoreParticles(dt);
  drawCoreParticles();
  updateEngineParticles(dt);
  drawEngineParticles();

  // Update clock panels
  updateClocks();

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ========== DRAW FUNCTIONS ========== */

function drawShipOutline(){
  ctx.save();
  ctx.translate(cx,cy);
  ctx.strokeStyle = "rgba(120,180,255,0.7)";
  ctx.lineWidth = 2;

  ctx.beginPath();
  // fuselage
  ctx.moveTo(0,-200);
  ctx.quadraticCurveTo(60,-80,60,60);
  ctx.quadraticCurveTo(60,150,0,190);
  ctx.quadraticCurveTo(-60,150,-60,60);
  ctx.quadraticCurveTo(-60,-80,0,-200);

  // left nacelle
  ctx.moveTo(-110,-40);
  ctx.quadraticCurveTo(-160,50,-110,160);
  ctx.quadraticCurveTo(-60,80,-110,-40);

  // right nacelle
  ctx.moveTo(110,-40);
  ctx.quadraticCurveTo(160,50,110,160);
  ctx.quadraticCurveTo(60,80,110,-40);

  ctx.stroke();
  ctx.restore();
}

function drawProtectionField(ts){
  const baseR = 210;
  const pulse = 0.12*Math.sin(ts*0.004) + 0.88;
  const warpBoost = 1 + warp*0.12;
  const R = baseR*pulse*warpBoost;

  const innerAlpha = 0.18 + warp*0.06;
  const midAlpha   = 0.10 + warp*0.05;

  ctx.save();
  ctx.translate(cx,cy);
  const g = ctx.createRadialGradient(0,0,R*0.15, 0,0,R);
  g.addColorStop(0, `rgba(200,250,255,${innerAlpha})`);
  g.addColorStop(0.4,`rgba(130,210,255,${midAlpha})`);
  g.addColorStop(1, "rgba(20,40,90,0)");
  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.arc(0,0,R,0,Math.PI*2);
  ctx.fill();

  // outer outline
  ctx.globalAlpha = 0.4 + warp*0.04;
  ctx.strokeStyle = "rgba(165,225,255,0.95)";
  ctx.lineWidth = 1.5 + warp*0.2;
  ctx.beginPath();
  ctx.arc(0,0,R,0,Math.PI*2);
  ctx.stroke();
  ctx.restore();
}

function drawCore(ts){
  const energy = warpEnergy();
  const t = ts*0.008;

  ctx.save();
  ctx.translate(cx,cy);

  // central pulse
  const coreR = 14 + 10*energy*Math.sin(t*4);
  ctx.beginPath();
  ctx.arc(0,0,coreR,0,Math.PI*2);
  ctx.fillStyle = "rgba(255,255,255,0.96)";
  ctx.fill();

  // corona glow
  const cor = coreR*1.9;
  const cg = ctx.createRadialGradient(0,0,coreR*0.2, 0,0,cor);
  cg.addColorStop(0,"rgba(255,255,255,0.9)");
  cg.addColorStop(0.4,"rgba(255,210,160,0.65)");
  cg.addColorStop(1,"rgba(255,120,80,0)");
  ctx.fillStyle = cg;
  ctx.beginPath();
  ctx.arc(0,0,cor,0,Math.PI*2);
  ctx.fill();

  // Nuclear Reactor ring
  const reactorR = 55;
  ctx.beginPath();
  ctx.strokeStyle = "rgba(0,255,180,0.9)";
  ctx.lineWidth = 1.3;
  ctx.setLineDash([7,4]);
  ctx.arc(0,0,reactorR,0,Math.PI*2);
  ctx.stroke();
  ctx.setLineDash([]);

  // Fission Converter ring
  const fissionR = 95;
  ctx.beginPath();
  ctx.strokeStyle = "rgba(255,190,80,0.9)";
  ctx.lineWidth = 1.3;
  ctx.setLineDash([9,5]);
  ctx.arc(0,0,fissionR,0,Math.PI*2);
  ctx.stroke();
  ctx.setLineDash([]);

  // Labels
  ctx.fillStyle = "rgba(190,235,255,0.9)";
  ctx.font = "12px Segoe UI";
  ctx.fillText("Nuclear Reactor", -60, reactorR+14);
  ctx.fillText("Fission Converter", -68, fissionR+16);
  ctx.fillText("E = mc²", -24, -reactorR-10);
  ctx.fillText("m = E / c²", -32, -fissionR-10);

  ctx.restore();
}

/* ========== PARTICLE ANIMATION ========== */

function updateCoreParticles(dt){
  const speedBoost = 1 + warp*0.7;
  for(let p of coreParticles){
    p.r += p.sp*110*dt*speedBoost;
    p.life += dt*0.5;
    if(p.r > p.max || p.life > 1){
      Object.assign(p, newCoreParticle());
    }
  }
}

function drawCoreParticles(){
  ctx.save();
  ctx.translate(cx,cy);
  for(let p of coreParticles){
    const x = Math.cos(p.a)*p.r;
    const y = Math.sin(p.a)*p.r*0.8;
    const alpha = (1 - p.life) * (0.7 + warp*0.03);
    ctx.globalAlpha = alpha;
    ctx.beginPath();
    ctx.arc(x,y,p.size,0,Math.PI*2);
    ctx.fillStyle = "rgba(190,245,255,1)";
    ctx.fill();
  }
  ctx.restore();
}

function updateEngineParticles(dt){
  const boost = 1 + warp*2.3;
  for(let e of engineLeft){
    e.x += e.vx*boost;
    e.y += e.vy*boost;  // DOWNWARD
    e.life -= dt*0.4;
    if(e.life <= 0){
      Object.assign(e, newEngineParticle());
    }
  }
  for(let e of engineRight){
    e.x += e.vx*boost;
    e.y += e.vy*boost;  // DOWNWARD
    e.life -= dt*0.4;
    if(e.life <= 0){
      Object.assign(e, newEngineParticle());
    }
  }
}

function drawEngineParticles(){
  // Left engine
  ctx.save();
  ctx.translate(cx-110, cy+60);
  for(let e of engineLeft){
    ctx.globalAlpha = e.life;
    ctx.beginPath();
    ctx.arc(e.x, e.y, 2, 0, Math.PI*2);
    ctx.fillStyle = "rgba(120,220,255,1)";
    ctx.fill();
  }
  ctx.restore();

  // Right engine
  ctx.save();
  ctx.translate(cx+110, cy+60);
  for(let e of engineRight){
    ctx.globalAlpha = e.life;
    ctx.beginPath();
    ctx.arc(e.x, e.y, 2, 0, Math.PI*2);
    ctx.fillStyle = "rgba(120,220,255,1)";
    ctx.fill();
  }
  ctx.restore();
}
</script>
</body>
</html>
