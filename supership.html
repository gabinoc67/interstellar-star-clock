<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fire Fox â€” CST Spaceplane-Arrow Fighter</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
html,body{
  margin:0;height:100%;background:#010514;overflow:hidden;
  font-family:Segoe UI,Roboto,Arial;color:#e8f3ff;
}
canvas{position:fixed;inset:0;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HUD PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hudpanel{
  position:fixed;background:rgba(10,20,48,0.9);
  padding:16px 20px;border:1px solid rgba(130,190,255,0.75);
  border-radius:16px;backdrop-filter:blur(12px);
  font-size:15px;min-width:340px;
  box-shadow:0 0 16px rgba(0,60,120,.5);
}
h2{
  margin:0 0 10px;font-size:19px;letter-spacing:.06em;color:#bfe1ff;
}
.label{
  margin-top:12px;font-size:12px;color:#8dbaff;
  text-transform:uppercase;letter-spacing:.12em;
}
.value{
  margin-top:4px;font-size:15px;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ INPUTS + BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
select,button{
  width:100%;padding:10px;margin-top:8px;
  background:#0c1634;color:#d5e9ff;font-size:15px;
  border:1px solid #3d67b8;border-radius:8px;cursor:pointer;
}
select:hover,button:hover{filter:brightness(1.22);}

#engageBtn{
  background:#0040ff;font-weight:bold;
}
.engageBlink{
  animation:blink 0.7s infinite alternate;box-shadow:0 0 18px rgba(0,125,255,0.95);
}
@keyframes blink{
  0%{background:#0030cc;} 100%{background:#0090ff;}
}
button:disabled{opacity:0.35;cursor:not-allowed;}

#stopBtn{background:#5a1010;border-color:#d05050;}
#resetBtn{background:#164d76;border-color:#4d96d7;}

#msg{margin-top:14px;font-size:13px;color:#b6e2ff;min-height:24px;}
#safeMsg{margin-top:8px;font-size:13px;font-weight:bold;min-height:22px;}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PANEL POSITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#panelMain{top:12px;right:12px;width:410px;}
#panelClocks{bottom:12px;left:12px;width:310px;}
#panelPhysics{bottom:12px;right:12px;width:410px;}
</style>
</head>

<body>
<canvas id="sim"></canvas>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN CONTROL PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="hudpanel" id="panelMain">
  <h2>ğŸ”¥ FIRE FOX CST NAVIGATION PANEL</h2>

  <div class="label">Departure City</div>
  <select id="fromCity">
    <option>New York</option><option>Los Angeles</option><option>London</option>
    <option>Paris</option><option>Tokyo</option><option>Mexico City</option>
    <option>SÃ£o Paulo</option><option>Mumbai</option><option>Shanghai</option>
    <option>Jakarta</option><option>Istanbul</option><option>Cairo</option>
  </select>

  <div class="label">Arrival City</div>
  <select id="toCity">
    <option>New York</option><option>Los Angeles</option><option>London</option>
    <option>Paris</option><option>Tokyo</option><option>Mexico City</option>
    <option>SÃ£o Paulo</option><option>Mumbai</option><option>Shanghai</option>
    <option>Jakarta</option><option>Istanbul</option><option>Cairo</option>
  </select>

  <div class="label">Engine Mode</div>
  <select id="modeSelect">
    <option value="1">Jet Mode</option>
    <option value="2">Scramjet (Hypersonic)</option>
    <option value="3">CST-Field (M = E / cÂ²)</option>
  </select>

  <button id="calcBtn" disabled>1 â€” Calculate Trip</button>
  <button id="safetyBtn" disabled>2 â€” Recalculate Safety</button>
  <button id="engageBtn" disabled>3 â€” Engage Engine</button>
  <button id="stopBtn">STOP ENGINE</button>
  <button id="resetBtn">Reset Simulation</button>

  <div id="msg"></div>
  <div id="safeMsg"></div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CLOCK PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="hudpanel" id="panelClocks">
  <h2>â± Time Synchronization</h2>
  <div class="label">CST Time</div><div class="value" id="cstClock">--:--:--</div>
  <div class="label">Ship Proper Time</div><div class="value" id="shipClock">--:--:--</div>
  <div class="label">Estimated Arrival (CST)</div><div class="value" id="arrivalClock">--:--:--</div>
  <div class="label">Countdown</div><div class="value" id="countdownVal">--</div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PHYSICS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="hudpanel" id="panelPhysics">
  <h2>ğŸ“¡ Flight Physics Readout</h2>
  <div class="label">Distance</div><div class="value" id="distVal">--</div>
  <div class="label">Atmospheric Drag</div><div class="value" id="dragVal">--</div>
  <div class="label">Speed</div><div class="value" id="speedVal">--</div>
  <div class="label">Time Dilation</div><div class="value" id="dilationVal">--</div>
  <div class="label">G-Force Raw â†’ Cockpit</div><div class="value" id="gVal">--</div>
  <div class="label">Energy Field (E â†” m)</div><div class="value" id="emcVal">--</div>
</div>
<script>
/* UI ELEMENTS */
const fromCity = document.getElementById("fromCity");
const toCity = document.getElementById("toCity");
const modeSelect = document.getElementById("modeSelect");

const calcBtn   = document.getElementById("calcBtn");
const safetyBtn = document.getElementById("safetyBtn");
const engageBtn = document.getElementById("engageBtn");
const stopBtn   = document.getElementById("stopBtn");
const resetBtn  = document.getElementById("resetBtn");

const msgEl     = document.getElementById("msg");
const safeMsgEl = document.getElementById("safeMsg");

/* CLOCK + PHYSICS TEXT OUT */
const cstClockEl    = document.getElementById("cstClock");
const shipClockEl   = document.getElementById("shipClock");
const arrivalClockEl= document.getElementById("arrivalClock");
const countdownEl   = document.getElementById("countdownVal");

const distValEl     = document.getElementById("distVal");
const dragValEl     = document.getElementById("dragVal");
const speedValEl    = document.getElementById("speedVal");
const dilationValEl = document.getElementById("dilationVal");
const gValEl        = document.getElementById("gVal");
const emcValEl      = document.getElementById("emcVal");

/* UI FLOW STATE */
let step_city = false;
let step_calc = false;
let step_safety = false;
let running = false;
let arrived = false;

/* Enable step 1 automatically when cities change */
function validateCities(){
  if(fromCity.value !== toCity.value){
    calcBtn.disabled = false;
    step_city = true;
  } else {
    calcBtn.disabled = true;
    step_city = false;
  }
}
fromCity.onchange = validateCities;
toCity.onchange   = validateCities;

/* CALCULATE TRIP BUTTON */
calcBtn.onclick = () => {
  if(!step_city){ msgEl.textContent="Select two different cities."; return; }

  computeTrip();            // (done in Part 3)
  msgEl.textContent = `Trip locked: ${fromCity.value} â†’ ${toCity.value}`;
  arrived = false;

  /* Step unlock */
  safetyBtn.disabled = false;
  engageBtn.disabled = true;
  step_calc = true;
  step_safety = false;

  safeMsgEl.textContent = "";
};

/* RECALCULATE SAFETY */
safetyBtn.onclick = () => {
  if(!step_calc){ msgEl.textContent="Calculate trip first."; return; }

  const safe = computeSafety();   // (done in Part 3)
  step_safety = safe;

  if(safe){
    engageBtn.disabled = false;
    engageBtn.classList.add("engageBlink");
    safeMsgEl.style.color = "#7bff9f";
    safeMsgEl.textContent = "âœ” CST Warp Corridor Stable â€” Safe to Engage";
  } else {
    engageBtn.disabled = true;
    safeMsgEl.style.color = "#ff7272";
    safeMsgEl.textContent = "âš  Must switch to CST-Field mode to travel safely";
  }
};

/* ENGAGE ENGINE */
engageBtn.onclick = () => {
  if(!step_safety){ msgEl.textContent="Recalculate Safety first."; return; }

  engageBtn.classList.remove("engageBlink");
  running = true;
  arrived = false;

  msgEl.textContent = "ENGINE ONLINE â€” Flight in Progress";
};

/* STOP ENGINE */
stopBtn.onclick = () => {
  running = false;
  engageBtn.classList.remove("engageBlink");
  msgEl.textContent = "Engine stopped.";
};

/* RESET */
resetBtn.onclick = () => {
  running = false;
  arrived = false;
  step_calc = false;
  step_safety = false;
  step_city = false;

  calcBtn.disabled = true;
  safetyBtn.disabled = true;
  engageBtn.disabled = true;
  engageBtn.classList.remove("engageBlink");

  msgEl.textContent = "Simulation reset.";
  safeMsgEl.textContent = "";
  resetPhysicsPanel();     // (Part 3)
};
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CITY DATABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const cityDB = {
  "New York":[40.7128,-74.0060],
  "Los Angeles":[34.0522,-118.2437],
  "London":[51.5074,-0.1278],
  "Paris":[48.8566,2.3522],
  "Tokyo":[35.6762,139.6503],
  "Mexico City":[19.4326,-99.1332],
  "SÃ£o Paulo":[-23.5558,-46.6396],
  "Mumbai":[19.0760,72.8777],
  "Shanghai":[31.2304,121.4737],
  "Jakarta":[-6.2088,106.8456],
  "Istanbul":[41.0082,28.9784],
  "Cairo":[30.0444,31.2357]
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TRIP STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let trip = null;
let arrivalCST = null;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HAVERSINE DISTANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function haversine(lat1, lon1, lat2, lon2){
  const R = 6371; // km
  const dLat = (lat2-lat1) * Math.PI/180;
  const dLon = (lon2-lon1) * Math.PI/180;
  const a = Math.sin(dLat/2)**2 +
            Math.cos(lat1*Math.PI/180) *
            Math.cos(lat2*Math.PI/180) *
            Math.sin(dLon/2)**2;
  return 2*R * Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TRIP CALCULATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function computeTrip(){
  const A = fromCity.value;
  const B = toCity.value;
  const [a1,o1] = cityDB[A];
  const [a2,o2] = cityDB[B];

  const km = haversine(a1,o1,a2,o2);
  const drag = 1 + Math.log1p(km / 6000);

  trip = { km, drag };

  // Enable next step
  safetyBtn.disabled = false;
  engageBtn.disabled = true;
  step_calc = true;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SAFETY CHECK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function computeSafety(){
  const mode = Number(modeSelect.value);
  return mode === 3; // Only CST-Field is safe for long-range travel
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PHYSICS OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function resetPhysicsPanel(){
  distValEl.textContent = dragValEl.textContent = speedValEl.textContent = dilationValEl.textContent = "--";
  gValEl.textContent = emcValEl.textContent = "--";
}

function updatePhysicsPanel(speed, gamma, drag, gRaw, gAdj){
  distValEl.textContent = trip.km.toFixed(0) + " km";
  dragValEl.textContent = drag.toFixed(3);

  if(speed < 300) speedValEl.textContent = speed.toFixed(1) + " km/s";
  else speedValEl.textContent = (speed / 300000 * 100).toFixed(2) + "% c";

  dilationValEl.textContent = ((1 - 1/gamma) * 100).toFixed(2) + "%";
  gValEl.textContent = `${gRaw.toFixed(1)} g â†’ ${gAdj.toFixed(1)} g`;
  emcValEl.textContent = (Number(modeSelect.value)===3 ? "Active E â†” m CST Field" : "Idle");
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CST TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function CST(){
  const now = new Date();
  return new Date(now.getTime() + now.getTimezoneOffset()*60000 - 6*3600000);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN PHYSICS LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function runPhysics(){
  if(!trip) return;

  const mode = Number(modeSelect.value);

  /* Speed model â€” Switching propulsion phases */
  let speed =
    (mode===1)? 0.28 :      // Jet â€” 0.28 km/s
    (mode===2)? 3.8  :      // Scramjet â€” 3.8 km/s
               299792.458*0.99; // CST-Field â€” 0.99 c

  /* G-Forces */
  let gRaw = (mode===1? 2 : mode===2? 7 : 18);
  let gAdj = Math.min(gRaw, 3); // cockpit force reduction

  /* Lorentz dilation */
  let gamma = (mode===3)? 1/Math.sqrt(1-(speed/299792.458)**2) : 1;

  /* Travel time */
  const seconds = trip.km / speed;
  const cstNow = CST();
  if(!arrivalCST) arrivalCST = new Date(cstNow.getTime() + seconds*1000);

  /* Countdown */
  const diff = (arrivalCST - cstNow) / 1000;
  if(diff <= 0){
    countdownEl.textContent = "ARRIVED";
    running = false;
    arrived = true;
  } else {
    countdownEl.textContent = diff.toFixed(0) + " sec";
  }

  /* Clocks */
  cstClockEl.textContent = cstNow.toTimeString().split(" ")[0];
  arrivalClockEl.textContent = arrivalCST.toTimeString().split(" ")[0];
  const shipNow = new Date(cstNow.getTime()/gamma);
  shipClockEl.textContent = shipNow.toTimeString().split(" ")[0];

  /* Update GUI */
  updatePhysicsPanel(speed, gamma, trip.drag, gRaw, gAdj);
}
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VISUAL PARTICLES / ENGINE STREAMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let W = 0, H = 0, cx = 0, cy = 0;
const canvasEl = document.getElementById("sim");
const ctx = canvasEl.getContext("2d");

function resizeCanvas(){
  canvasEl.width = innerWidth;
  canvasEl.height = innerHeight;
  W = innerWidth; H = innerHeight;
  cx = W/2; cy = H/2;
}
addEventListener("resize", resizeCanvas);
resizeCanvas();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ STARFIELD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const stars = [];
for(let i=0;i<350;i++){
  stars.push({ x:Math.random()*W, y:Math.random()*H, s:0.3+Math.random()*1.8 });
}
function drawStars(){
  ctx.fillStyle="white";
  for(const s of stars){
    if(running && !arrived) s.y += s.s * 3.1;
    else s.y += s.s * 0.6;
    if(s.y>H){ s.y = -4; s.x = Math.random()*W; }
    ctx.fillRect(s.x, s.y, 2, 2);
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DRAW FIGHTER SHAPE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function drawPlane(){
  ctx.save();
  ctx.translate(cx, cy);
  ctx.strokeStyle = "rgba(140,200,255,0.95)";
  ctx.lineWidth = 2.5;

  ctx.beginPath();
  ctx.moveTo(0,-270);
  ctx.lineTo(95,-160);
  ctx.lineTo(135,-40);
  ctx.lineTo(105,200);
  ctx.lineTo(0,260);
  ctx.lineTo(-105,200);
  ctx.lineTo(-135,-40);
  ctx.lineTo(-95,-160);
  ctx.closePath();
  ctx.stroke();

  /* Tail fins */
  ctx.beginPath();
  ctx.moveTo(105,200); ctx.lineTo(160,260); ctx.lineTo(90,235);
  ctx.moveTo(-105,200); ctx.lineTo(-160,260); ctx.lineTo(-90,235);
  ctx.stroke();

  ctx.restore();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ENGINE FLAMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function flame(x,y,size,intensity){
  ctx.fillStyle = `rgba(120,220,255,${intensity})`;
  ctx.fillRect(x-size/2, y-size/2, size, size);
}

function drawEngines(){
  if(arrived) return; // engines stable at destination

  let mode = Number(modeSelect.value);
  let i = running ? (0.18 + mode*0.22) : 0.10;

  // Tail engines
  flame(cx-82, cy+145, 24, i);
  flame(cx+82, cy+145, 24, i);

  // Wing-root scramjet boosters
  flame(cx-155, cy+28, 20, i);
  flame(cx+155, cy+28, 20, i);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CST ENERGY SHIELD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function drawShield(time){
  let mode = Number(modeSelect.value);
  let brightness = arrived ? 0.10 : (0.13 + mode * 0.25);
  let R = 220 * (1 + mode * 0.4);

  ctx.save();
  const g = ctx.createRadialGradient(cx,cy,25, cx,cy,R);
  g.addColorStop(0, `rgba(200,255,255,${brightness})`);
  g.addColorStop(1, "rgba(0,20,60,0)");
  ctx.fillStyle = g;
  ctx.beginPath();
  ctx.arc(cx, cy, R, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ANIMATION LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let lastTS = 0;
function loop(ts){
  const dt = (ts - lastTS) / 1000;
  lastTS = ts;

  ctx.clearRect(0,0,W,H);

  drawStars();
  drawPlane();
  drawEngines();
  drawShield(ts);

  /* PHYSICS UPDATE */
  if(running && !arrived) runPhysics();
  else if(arrived){
    msgEl.textContent = "ARRIVAL COMPLETE â€” Engines stabilized";
    engageBtn.disabled = true;
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
