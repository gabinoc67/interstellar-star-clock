<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fire Fox ‚Äî CST Spaceplane-Arrow Fighter</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
html,body{
  margin:0;height:100%;background:#030614;overflow:hidden;
  font-family:Segoe UI,Roboto,Arial;color:#e8f3ff;
}
canvas{position:fixed;inset:0;}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HUD PANELS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.hudpanel{
  position:fixed;background:rgba(10,22,52,0.9);
  padding:16px 20px;border:1px solid rgba(130,190,255,0.75);
  border-radius:16px;backdrop-filter:blur(12px);
  font-size:16px;min-width:340px;
}
h2{margin:0 0 10px;font-size:19px;color:#bfe1ff;}
.label{
  margin-top:12px;font-size:12px;color:#8dbaff;
  letter-spacing:.14em;text-transform:uppercase;
}
.value{margin-top:4px;font-size:15px;}

select,button{
  width:100%;padding:9px;margin-top:7px;
  background:#0b1638;color:#e9f3ff;font-size:15px;
  border:1px solid #4679c7;border-radius:8px;cursor:pointer;
}
select:hover,button:hover{filter:brightness(1.22);}
button:disabled{opacity:0.32;cursor:not-allowed;}

#engageBtn{
  background:#0040ff;font-weight:bold;
}
.engageBlink{
  animation:blink 0.65s infinite alternate;
  box-shadow:0 0 22px rgba(0,160,255,0.95);
}
@keyframes blink{0%{background:#0030cc;}100%{background:#0090ff;}}

#stopBtn{background:#551414;border-color:#b44;}
#resetBtn{background:#0e4468;border-color:#4a8dcb;}

#msg{margin-top:14px;font-size:14px;color:#b6e2ff;min-height:20px;}
#safeMsg{margin-top:8px;font-size:13px;font-weight:bold;min-height:20px;}

/* Panel positions */
#panelMain{top:12px;right:12px;width:420px;}
#panelClocks{bottom:12px;left:12px;width:310px;}
#panelPhysics{bottom:12px;right:12px;width:420px;}
</style>
</head>

<body>
<canvas id="sim"></canvas>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAIN NAV PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="hudpanel" id="panelMain">
  <h2>üî• FIRE FOX CST NAVIGATION PANEL</h2>

  <div class="label">Departure City</div>
  <select id="fromCity"></select>

  <div class="label">Arrival City</div>
  <select id="toCity"></select>

  <div class="label">Engine Mode</div>
  <select id="modeSelect">
    <option value="1">Jet (Fuel)</option>
    <option value="2">Scramjet (Supersonic)</option>
    <option value="3">CST Field (M = E / c¬≤)</option>
  </select>

  <button id="calcBtn" disabled>1 ‚Äî Calculate Trip</button>
  <button id="safetyBtn" disabled>2 ‚Äî Recalculate Safety</button>
  <button id="engageBtn" disabled>3 ‚Äî Engage Engine</button>
  <button id="stopBtn">STOP ENGINE</button>
  <button id="resetBtn">Reset Simulation</button>

  <div id="msg"></div>
  <div id="safeMsg"></div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CLOCK PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="hudpanel" id="panelClocks">
  <h2>‚è± Time Synchronization</h2>
  <div class="label">CST Time</div><div class="value" id="cstClock">--:--:--</div>
  <div class="label">Ship Proper Time</div><div class="value" id="shipClock">--:--:--</div>
  <div class="label">Estimated Arrival</div><div class="value" id="arrivalClock">--:--:--</div>
  <div class="label">Countdown</div><div class="value" id="countdownVal">--</div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PHYSICS PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="hudpanel" id="panelPhysics">
  <h2>üì° Flight Physics Readout</h2>
  <div class="label">Distance</div><div class="value" id="distVal">--</div>
  <div class="label">Atmospheric Drag</div><div class="value" id="dragVal">--</div>
  <div class="label">Speed</div><div class="value" id="speedVal">--</div>
  <div class="label">Time Dilation</div><div class="value" id="dilationVal">--</div>
  <div class="label">G-Force Raw ‚Üí Cockpit</div><div class="value" id="gVal">--</div>
  <div class="label">Energy Field</div><div class="value" id="emcVal">--</div>
</div>
<script>
/* ===============================================================
   INITIALIZATION
================================================================ */
const canvas = document.getElementById("sim");
const ctx = canvas.getContext("2d");
let W, H, cx, cy;
function resize(){ canvas.width = W = innerWidth; canvas.height = H = innerHeight; cx = W/2; cy = H/2; }
addEventListener("resize", resize); resize();

/* ===============================================================
   CITY DATABASE + AUTO POPULATE
================================================================ */
const cities = {
  "New York":[40.7128,-74.0060], "Los Angeles":[34.0522,-118.2437],
  "London":[51.5074,-0.1278], "Paris":[48.8566,2.3522],
  "Tokyo":[35.6762,139.6503], "Mexico City":[19.4326,-99.1332],
  "S√£o Paulo":[-23.5558,-46.6396], "Mumbai":[19.0760,72.8777],
  "Shanghai":[31.2304,121.4737], "Jakarta":[-6.2088,106.8456],
  "Istanbul":[41.0082,28.9784], "Cairo":[30.0444,31.2357]
};
const fromCity = document.getElementById("fromCity");
const toCity   = document.getElementById("toCity");
Object.keys(cities).forEach(c => {
  let o1 = document.createElement("option"); o1.textContent=c; fromCity.appendChild(o1);
  let o2 = document.createElement("option"); o2.textContent=c; toCity.appendChild(o2);
});

/* Panels */
const modeSelect=document.getElementById("modeSelect"),
      calcBtn=document.getElementById("calcBtn"),
      safetyBtn=document.getElementById("safetyBtn"),
      engageBtn=document.getElementById("engageBtn"),
      stopBtn=document.getElementById("stopBtn"),
      resetBtn=document.getElementById("resetBtn"),
      msgEl=document.getElementById("msg"),
      safeMsgEl=document.getElementById("safeMsg");

/* Clocks + Physics readouts */
const cstClockEl=document.getElementById("cstClock"),
      shipClockEl=document.getElementById("shipClock"),
      arrivalClockEl=document.getElementById("arrivalClock"),
      countdownEl=document.getElementById("countdownVal"),
      distValEl=document.getElementById("distVal"),
      dragValEl=document.getElementById("dragVal"),
      speedValEl=document.getElementById("speedVal"),
      dilationValEl=document.getElementById("dilationVal"),
      gValEl=document.getElementById("gVal"),
      emcValEl=document.getElementById("emcVal");

/* ===============================================================
   STATE VARIABLES
================================================================ */
let trip = null;
let running = false;
let arrived = false;
let safeOK = false;
let arrivalCST = null;
let speedNow = 0;   // dynamic, ramps gradually

/* ===============================================================
   BUTTON LOGIC ‚Äî LOCK ORDER
================================================================ */
function cityCheck(){
  calcBtn.disabled = (fromCity.value === toCity.value);
}
fromCity.onchange = cityCheck;
toCity.onchange = cityCheck;

calcBtn.onclick = ()=>{
  computeTrip();
  msgEl.textContent = `${fromCity.value} ‚Üí ${toCity.value} locked`;
  safetyBtn.disabled = false;
  engageBtn.disabled = true;
  safeMsgEl.textContent = "";
  arrivalCST = null;
  arrived = false;
};

safetyBtn.onclick = ()=>{
  safeOK = (Number(modeSelect.value) === 3);
  safeMsgEl.style.color = safeOK ? "#7bff9f" : "#ff7272";
  safeMsgEl.textContent = safeOK ?
    "‚úî Safe Corridor ‚Äî CST Field Active" :
    "‚ö† Must switch to CST mode before Engage";
  engageBtn.disabled = !safeOK;
  if(safeOK) engageBtn.classList.add("engageBlink");
};

engageBtn.onclick = ()=>{
  if(!safeOK){ msgEl.textContent="Recalculate Safety first"; return; }
  engageBtn.classList.remove("engageBlink");
  running = true;
  msgEl.textContent = "ENGINE ONLINE";
};

stopBtn.onclick = ()=>{
  running = false;
  msgEl.textContent = "Engine stopped";
};

resetBtn.onclick = ()=>{
  running = false; arrived = false; trip = null; safeOK = false;
  calcBtn.disabled = true; safetyBtn.disabled = true;
  engageBtn.disabled = true; engageBtn.classList.remove("engageBlink");
  msgEl.textContent = "Simulation reset"; safeMsgEl.textContent = "";
  arrivalCST=null; speedNow = 0;
  resetPhysics();
};

/* ===============================================================
   TRIP PHYSICS & TIME
================================================================ */
function haversine(lat1, lon1, lat2, lon2){
  const R=6371, dLat=(lat2-lat1)*Math.PI/180, dLon=(lon2-lon1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function computeTrip(){
  const A = cities[fromCity.value], B = cities[toCity.value];
  const km = haversine(A[0],A[1],B[0],B[1]);
  trip = { km, drag:1+Math.log1p(km/6000) };
  distValEl.textContent = km.toFixed(0)+" km";
}

function CST(){
  const n = new Date();
  return new Date(n.getTime() + n.getTimezoneOffset()*60000 - 6*3600000);
}

/* ===============================================================
   SPEED MODEL (smooth)
================================================================ */
function targetSpeed(){
  const m = Number(modeSelect.value);
  return (m===1)? 0.30 :      // Jet
         (m===2)? 5.00 :      // Scramjet
                     299792.458*0.25;   // CST = 0.25c
}

/* ===============================================================
   PHYSICS UPDATE
================================================================ */
function resetPhysics(){
  dragValEl.textContent = speedValEl.textContent = dilationValEl.textContent = gValEl.textContent = emcValEl.textContent = "--";
  countdownEl.textContent="--"; arrivalClockEl.textContent="--"; shipClockEl.textContent="--";
}

function updatePhysics(){
  if(!trip) return;

  const spTgt = targetSpeed();
  speedNow += (spTgt - speedNow) * 0.05; // gradual acceleration
  let speed = speedNow;

  let m = Number(modeSelect.value);
  let gRaw = (m===1?3 : m===2?10 : 18), gAdj = Math.min(gRaw,3);
  let gamma = (m===3)? 1/Math.sqrt(1-(speed/299792.458)**2) : 1;

  const cst = CST();
  const sec = trip.km / speed;

  if(!arrivalCST) arrivalCST = new Date(cst.getTime() + sec*1000);
  let diff = (arrivalCST - cst) / 1000;

  cstClockEl.textContent = cst.toTimeString().split(" ")[0];
  arrivalClockEl.textContent = arrivalCST.toTimeString().split(" ")[0];
  countdownEl.textContent = diff<=0 ? "ARRIVED" : diff.toFixed(0)+" sec";

  const shipNow = new Date(cst.getTime()/gamma);
  shipClockEl.textContent = shipNow.toTimeString().split(" ")[0];

  dragValEl.textContent = trip.drag.toFixed(3);
  speedValEl.textContent = (speed<300)? speed.toFixed(2)+" km/s" : (speed/300000*100).toFixed(2)+"% c";
  dilationValEl.textContent = ((1 - 1/gamma)*100).toFixed(2)+"%";
  gValEl.textContent = `${gRaw}g ‚Üí ${gAdj}g`;
  emcValEl.textContent = (m===3)? "Quantum E‚Üîm Plasma" : (m===2? "Hypersonic Mode" : "Fuel Combustion");

  if(diff <= 0){ running=false; arrived=true; }
}

/* ===============================================================
   STARFIELD
================================================================ */
const stars = Array.from({length:360},()=>({x:Math.random()*W,y:Math.random()*H,s:0.4+Math.random()*1.6}));
function drawStars(){
  ctx.fillStyle="white";
  for(const s of stars){
    s.y += (running && !arrived ? s.s*3 : s.s*0.6);
    if(s.y>H){ s.y=-5; s.x=Math.random()*W; }
    ctx.fillRect(s.x,s.y,2,2);
  }
}

/* ===============================================================
   DRAW FIGHTER
================================================================ */
function drawPlane(){
  ctx.save(); ctx.translate(cx,cy);
  ctx.strokeStyle="rgba(160,210,255,0.95)";
  ctx.lineWidth=2.4;
  ctx.beginPath();
  ctx.moveTo(0,-250);
  ctx.lineTo(90,-150);
  ctx.lineTo(125,-30);
  ctx.lineTo(95,180);
  ctx.lineTo(0,240);
  ctx.lineTo(-95,180);
  ctx.lineTo(-125,-30);
  ctx.lineTo(-90,-150);
  ctx.closePath();
  ctx.stroke();
  ctx.restore();
}

/* ===============================================================
   EXHAUST / COLORS PER MODE
================================================================ */
function flame(x,y,intensity,size){
  ctx.fillStyle = intensity;
  ctx.fillRect(x-size/2,y-size/2,size,size);
}

function drawExhaust(){
  let m = Number(modeSelect.value);
  let intensity =
    (m===1)? "rgba(255,160,60," :      // Jet = orange
    (m===2)? "rgba(120,200,255," :    // Scramjet = light blue
             "rgba(255,0,200,";       // CST = rainbow base (quantum pink/violet core)

  let base = running ? 0.25 + m*0.18 : 0.15;
  let iTail = base, iWing = base * 0.85;
  let sizeTail=26, sizeWing=20;

  // Tail engines
  flame(cx-78, cy+140, intensity+(iTail)+")", sizeTail);
  flame(cx+78, cy+140, intensity+(iTail)+")", sizeTail);

  // Wing-root scramjets
  flame(cx-150, cy+30, intensity+(iWing)+")", sizeWing);
  flame(cx+150, cy+30, intensity+(iWing)+")", sizeWing);
}

/* ===============================================================
   CST SHIELD FIELD
================================================================ */
function drawShield(){
  let m = Number(modeSelect.value);
  let R = 190 + m*60;
  let opacity = arrived ? 0.12 : (0.10 + m*0.22);

  ctx.save();
  const g = ctx.createRadialGradient(cx,cy,10, cx,cy,R);
  g.addColorStop(0, `rgba(200,255,255,${opacity})`);
  g.addColorStop(1, "rgba(0,20,60,0)");
  ctx.fillStyle = g;
  ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

/* ===============================================================
   MAIN ANIMATION LOOP
================================================================ */
function loop(){
  ctx.clearRect(0,0,W,H);
  drawStars();
  drawPlane();
  drawExhaust();
  drawShield();
  if(running && !arrived) updatePhysics();
  else if(arrived) msgEl.textContent = "ARRIVED ‚Äî Engines Stable";
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
