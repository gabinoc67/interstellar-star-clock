<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fire Fox — CST Spaceplane-Arrow Fighter</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
html,body{
  margin:0;height:100%;background:#020617;overflow:hidden;
  font-family:Segoe UI,Roboto,Arial;color:#e8f3ff;
}
canvas{position:fixed;inset:0;}

.hudpanel{
  position:fixed;background:rgba(12,22,52,0.82);
  padding:14px 18px;border:1px solid rgba(130,190,255,0.75);
  border-radius:14px;backdrop-filter:blur(12px);
  font-size:15px;min-width:320px;
}
h2{
  margin:0 0 8px;font-size:18px;letter-spacing:.06em;
}
.label{
  margin-top:9px;font-size:12px;color:#8dbaff;
  text-transform:uppercase;letter-spacing:.12em;
}
.value{
  margin-top:4px;font-size:15px;
}

select,button{
  width:100%;padding:9px 9px;margin-top:7px;
  background:#0c1634;color:#d5e9ff;font-size:15px;
  border:1px solid #3d67b8;border-radius:8px;cursor:pointer;
}
select:hover,button:hover{filter:brightness(1.2);}

#engageBtn{
  background:#0040ff;font-weight:bold;
}
.engageBlink{
  animation:blink 0.7s infinite alternate;
  box-shadow:0 0 18px rgba(0,125,255,0.95);
}
@keyframes blink{
  0%{background:#0030cc;} 100%{background:#0090ff;}
}

#stopBtn{background:#5a1010;border-color:#d05050;}
#resetBtn{background:#164d76;border-color:#4d96d7;}

#msg{margin-top:12px;font-size:13px;color:#b6e2ff;min-height:20px;}
#safeMsg{margin-top:6px;font-size:13px;font-weight:bold;}
</style>
</head>
<body>
<canvas id="sim"></canvas>

<!-- MAIN CONTROL PANEL -->
<div class="hudpanel" id="panelMain" style="top:12px;right:12px;width:390px;">
  <h2>Fire Fox CST Navigation Panel</h2>

  <div class="label">Departure City</div>
  <select id="fromCity">
    <option>New York</option><option>Los Angeles</option><option>London</option>
    <option>Paris</option><option>Tokyo</option><option>Mexico City</option>
    <option>São Paulo</option><option>Mumbai</option><option>Shanghai</option>
    <option>Jakarta</option><option>Instanbul</option><option>Cairo</option>
  </select>

  <div class="label">Arrival City</div>
  <select id="toCity">
    <option>New York</option><option>Los Angeles</option><option>London</option>
    <option>Paris</option><option>Tokyo</option><option>Mexico City</option>
    <option>São Paulo</option><option>Mumbai</option><option>Shanghai</option>
    <option>Jakarta</option><option>Instanbul</option><option>Cairo</option>
  </select>

  <div class="label">Engine Mode</div>
  <select id="modeSelect">
    <option value="1">Jet Mode</option>
    <option value="2">Scramjet</option>
    <option value="3">CST-Field (M = E/c²)</option>
  </select>

  <button id="calcBtn">1 — Calculate Trip</button>
  <button id="safetyBtn">2 — Recalculate Safety</button>
  <button id="engageBtn">3 — Engage Engine</button>
  <button id="stopBtn">STOP ENGINE</button>
  <button id="resetBtn">Reset Simulation</button>

  <div id="msg"></div>
  <div id="safeMsg"></div>
</div>

<!-- CLOCKS PANEL -->
<div class="hudpanel" id="panelClocks" style="bottom:12px;left:12px;width:300px;">
  <h2>Time Synchronization</h2>
  <div class="label">CST Time</div>
  <div class="value" id="cstClock">--:--:--</div>

  <div class="label">Ship Proper Time</div>
  <div class="value" id="shipClock">--:--:--</div>

  <div class="label">Estimated Arrival (CST)</div>
  <div class="value" id="arrivalClock">--:--:--</div>

  <div class="label">Countdown</div>
  <div class="value" id="countdownVal">--</div>
</div>

<!-- PHYSICS PANEL -->
<div class="hudpanel" id="panelPhysics" style="bottom:12px;right:12px;width:380px;">
  <h2>Flight Physics Readout</h2>
  <div class="label">Distance</div><div class="value" id="distVal">--</div>
  <div class="label">Atmospheric Drag</div><div class="value" id="dragVal">--</div>
  <div class="label">Speed</div><div class="value" id="speedVal">--</div>
  <div class="label">Time Dilation</div><div class="value" id="dilationVal">--</div>
  <div class="label">G-Force Raw → Cockpit</div><div class="value" id="gVal">--</div>
  <div class="label">Energy Field (E ↔ m)</div><div class="value" id="emcVal">--</div>
</div>
<script>
/* ========== CANVAS BASE ========== */
const canvas=document.getElementById("sim"), ctx=canvas.getContext("2d");
let W,H,cx,cy;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;cx=W/2;cy=H/2;}
addEventListener("resize",resize); resize();

/* ========== CITY DATABASE ========== */
const city={ 
"New York":[40.7128,-74.0060],"Los Angeles":[34.0522,-118.2437],"London":[51.5074,-0.1278],
"Paris":[48.8566,2.3522],"Tokyo":[35.6762,139.6503],"Mexico City":[19.4326,-99.1332],
"São Paulo":[-23.5558,-46.6396],"Mumbai":[19.0760,72.8777],"Shanghai":[31.2304,121.4737],
"Jakarta":[-6.2088,106.8456],"Instanbul":[41.0082,28.9784],"Cairo":[30.0444,31.2357]
};

/* ========== INTERFACE ========== */
const fromCity=document.getElementById("fromCity"),
      toCity=document.getElementById("toCity"),
      modeSelect=document.getElementById("modeSelect"),
      msgEl=document.getElementById("msg"),
      safeMsgEl=document.getElementById("safeMsg"),
      engageBtn=document.getElementById("engageBtn");

const cstClockEl=document.getElementById("cstClock"),
      shipClockEl=document.getElementById("shipClock"),
      arrivalClockEl=document.getElementById("arrivalClock"),
      countdownEl=document.getElementById("countdownVal");

const distValEl=document.getElementById("distVal"),
      dragValEl=document.getElementById("dragVal"),
      speedValEl=document.getElementById("speedVal"),
      dilationValEl=document.getElementById("dilationVal"),
      gValEl=document.getElementById("gVal"),
      emcValEl=document.getElementById("emcVal");

/* ========== STATE ========== */
let trip=null, running=false, safeOK=false, arrivalCST=null, arrived=false;

/* ========== HAVERSINE ========== */
function dist(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+
           Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
           Math.sin(dLon/2)**2;
  return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

/* ========== BUTTON ACTIONS ========== */
document.getElementById("calcBtn").onclick=()=>{
  const A=fromCity.value, B=toCity.value;
  if(A===B){ msgEl.textContent="Departure and arrival must be different."; return; }
  const [a1,o1]=city[A], [a2,o2]=city[B];
  const km = dist(a1,o1,a2,o2);
  trip = { A,B,km,drag:1+Math.log1p(km/6000) };
  arrivalCST=null; arrived=false; safeOK=false;
  engageBtn.classList.remove("engageBlink");
  msgEl.textContent=`Trip locked: ${A} → ${B}`;
  updatePhysics();
};

document.getElementById("safetyBtn").onclick=()=>{
  safeOK = (modeSelect.value==="3");
  safeMsgEl.style.color = safeOK ? "#7bff9f" : "#ff7272";
  safeMsgEl.textContent = safeOK ?
    "✔ CST Warp Corridor Stable — Safe for Engage" :
    "⚠ Must switch to CST-Field mode before engaging";
  if(safeOK) engageBtn.classList.add("engageBlink");
};

document.getElementById("engageBtn").onclick=()=>{
  if(!trip){ msgEl.textContent="Calculate trip first."; return; }
  if(!safeOK){ msgEl.textContent="Recalculate Safety first."; return; }
  running=true;
  engageBtn.classList.remove("engageBlink");
};

document.getElementById("stopBtn").onclick=()=>{ running=false; };
document.getElementById("resetBtn").onclick=()=>{
  running=false; trip=null; arrivalCST=null; safeOK=false; arrived=false;
  engageBtn.classList.remove("engageBlink");
  msgEl.textContent="Simulation reset";
  clearPhysics();
};

/* ========== CST TIME SYSTEM ========== */
function CST(){
  const n=new Date();
  return new Date(n.getTime()+n.getTimezoneOffset()*60000-6*3600000);
}

function updateClocks(){
  const cst=CST();
  cstClockEl.textContent=cst.toTimeString().split(" ")[0];

  /* determine arrival ONLY when running begins */
  if(running && trip && !arrivalCST){
    let m=Number(modeSelect.value);
    let speed = (m===3)?299792.458*0.99:(m===2?3.5:0.8);
    arrivalCST = new Date( cst.getTime() + (trip.km/speed*1000) );
  }

  if(arrivalCST){
    arrivalClockEl.textContent = arrivalCST.toTimeString().split(" ")[0];
    let diff = (arrivalCST - cst)/1000;

    if(diff <= 0){
      countdownEl.textContent="ARRIVED";
      running=false; arrived=true;
      return;
    }
    countdownEl.textContent = diff.toFixed(0)+" sec";
  }

  /* ship time (Lorentz dilation) */
  if(trip){
    let m=Number(modeSelect.value);
    let speed = (m===3)?299792.458*0.99:(m===2?3.5:0.8);
    let gamma = (m===3)?1/Math.sqrt(1-(speed/299792.458)**2):1;
    const shipTime = new Date( cst.getTime()/gamma );
    shipClockEl.textContent = shipTime.toTimeString().split(" ")[0];
  }
}

/* ========== PHYSICS READOUT ========== */
function clearPhysics(){
  distValEl.textContent=dragValEl.textContent=speedValEl.textContent=dilationValEl.textContent="--";
  gValEl.textContent=emcValEl.textContent="--";
}

function updatePhysics(){
  if(!trip){ clearPhysics(); return; }

  distValEl.textContent = trip.km.toFixed(0)+" km";
  dragValEl.textContent = trip.drag.toFixed(3);

  let m=Number(modeSelect.value);
  let speed = (m===3)?299792.458*0.99:(m===2?3.5:0.8);
  let g = (m===1?2:(m===2?6:10));
  let gAdj = Math.min(g,3);
  let gamma = (m===3)?1/Math.sqrt(1-(speed/299792.458)**2):1;

  speedValEl.textContent = speed<300 ? 
    speed.toFixed(1)+" km/s" :
    (speed/300000*100).toFixed(2)+"% of c";

  dilationValEl.textContent = ((1-1/gamma)*100).toFixed(2)+"%";
  gValEl.textContent = `${g.toFixed(1)} g → ${gAdj.toFixed(1)} g`;
  emcValEl.textContent = (m===3 ? "Active E↔m conversion field" : "Idle");
}
/* ========== RENDERING — FIGHTER ========== */
function drawPlane(){
  ctx.save();
  ctx.translate(cx, cy);
  ctx.strokeStyle = "rgba(120,180,255,0.92)";
  ctx.lineWidth = 2.4;

  /* Spaceplane-Arrow outline (scaled larger) */
  ctx.beginPath();
  ctx.moveTo(0,-260);
  ctx.lineTo(85,-160);
  ctx.lineTo(115,-40);
  ctx.lineTo(90,190);
  ctx.lineTo(0,250);
  ctx.lineTo(-90,190);
  ctx.lineTo(-115,-40);
  ctx.lineTo(-85,-160);
  ctx.closePath();
  ctx.stroke();

  /* rear fins */
  ctx.beginPath();
  ctx.moveTo(90,190); ctx.lineTo(135,245); ctx.lineTo(80,225);
  ctx.moveTo(-90,190); ctx.lineTo(-135,245); ctx.lineTo(-80,225);
  ctx.stroke();
  ctx.restore();
}

/* ========== SQUARE EXHAUST FLAMES ========== */
function squareFlame(x,y,size,intensity){
  ctx.fillStyle = `rgba(140,220,255,${intensity})`;
  ctx.fillRect(x-size/2, y-size/2, size, size);
}

function drawExhaust(){
  if(arrived) return;   // engine stable on arrival

  let m = Number(modeSelect.value);
  let i = running ? (0.25 + m * 0.20) : 0.12;

  // Main engines
  squareFlame(cx-75, cy+135, 22, i);
  squareFlame(cx+75, cy+135, 22, i);

  // Scramjets (wing-root)
  squareFlame(cx-145, cy+45, 18, i);
  squareFlame(cx+145, cy+45, 18, i);
}

/* ========== SHIELD FIELD ========== */
function drawShield(t){
  let m = Number(modeSelect.value);

  let fade = arrived ? 0.12 : (0.10 + m * 0.18);
  let R = 200 * (1 + m*0.25);

  ctx.save();
  ctx.beginPath();
  const g = ctx.createRadialGradient(cx,cy,20, cx,cy,R);
  g.addColorStop(0, `rgba(210,255,255,${fade})`);
  g.addColorStop(1, "rgba(10,35,90,0)");
  ctx.fillStyle = g;
  ctx.arc(cx, cy, R, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();
}

/* ========== STARS BACKGROUND ========== */
const stars = [];
for(let i=0;i<280;i++){
  stars.push({
    x:Math.random()*W,
    y:Math.random()*H,
    s:0.6+Math.random()*1.6
  });
}
function drawStars(){
  ctx.fillStyle="white";
  for(let s of stars){
    if(!arrived && running) s.y += s.s * 2.8;
    else s.y += s.s * 0.8;
    if(s.y>H){ s.y = -6; s.x = Math.random()*W; }
    ctx.fillRect(s.x,s.y,2,2);
  }
}

/* ========== MAIN LOOP ========== */
let last = 0;
function loop(ts){
  const dt = (ts-last)/1000; last = ts;

  ctx.clearRect(0,0,W,H);

  drawStars();
  drawPlane();
  drawExhaust();
  drawShield(ts);

  if(running && !arrived) updatePhysics();
  updateClocks();

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
