<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Warp Control ‚Äî Triple Columns + Center Panel (v3.7 ‚Ä¢ live compass)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="viewportScale">
    <div class="wrap">
      <!-- Header -->
      <div class="hdrline">
        <h1>üöÄ Warp Control Center</h1>
        <div class="toggle">
          <label>UI Scale <input id="uiScale" type="range" min="70" max="140" step="1" value="85"> <span id="uiScaleVal" class="badge">85%</span></label>
          <label>Sound <input id="soundOn" type="checkbox" checked></label>
          <span class="badge">v3.7 ‚Ä¢ Live Compass</span>
        </div>
      </div>

      <!-- THREE COLUMNS -->
      <section class="tripleCols">
        <!-- LEFT COLUMN -->
        <div class="col col-left">
          <div class="panel glass">
            <h2>Flight Plan</h2>
            <div class="grid" style="grid-template-columns:1fr 1fr;gap:10px">
              <label>Warp Speed
                <select id="warpSpeed"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option></select>
              </label>
              <label>Destination
                <select id="destination"><option>Mars</option><option>Jupiter</option><option>Saturn</option><option>Pluto</option></select>
              </label>
              <label>Warp Law (n) <input id="warpExp" type="number" step="0.1" value="3"></label>
              <label>Speed Scale (√óc) <input id="warpScale" type="number" step="0.1" value="1"></label>
              <label>IST Day 0 (yrs ago) <input id="istDay0Years" type="number" step="1" value="45500000000"></label>
              <label>Days / IST year <input id="baselineDaysPerYear" type="number" step="0.001" value="365.25"></label>
              <label>Calibration
                <select id="calibration">
                  <option value="off">Off</option>
                  <option value="mars_opp">Mars ‚Äì Opposition (fast window)</option>
                  <option value="mars_conj">Mars ‚Äì Conjunction (slow window)</option>
                </select>
              </label>
            </div>
            <div class="lights" style="margin-top:6px">
              <div class="light good" id="lightBubble"><span class="dot"></span>Bubble</div>
              <div class="light good" id="lightPower"><span class="dot"></span>Power</div>
              <div class="light good" id="lightVector"><span class="dot"></span>Vector</div>
              <div class="light good" id="lightNav"><span class="dot"></span>Nav</div>
            </div>
            <div style="margin-top:6px">
              <button id="startBtn">‚ñ∂Ô∏è Start</button>
              <button id="stopBtn">‚è∏Ô∏è Stop</button>
              <button id="resetBtn">üîÑ Engage Warp</button>
              <button id="exportBtn">üìÑ Export Log</button>
            </div>
            <div class="legend" id="beacon">‚è≥ Waiting‚Ä¶</div>
            <div class="legend" id="constraints">EC/Horizon: ‚Äî</div>
          </div>

          <div class="panel glass">
            <h2>Gravity Vectoring Engine</h2>
            <div class="controls">
              <label>Reactor Output (MW) <input id="reactorMW" type="number" value="5000" step="50"></label>
              <label>Front Contraction % <input id="frontPct" type="range" min="0" max="100" value="35"><span class="stat" id="frontLbl"></span></label>
              <label>Rear Expansion % <input id="rearPct" type="range" min="0" max="100" value="65"><span class="stat" id="rearLbl"></span></label>
              <label>Left / Right Bias % <input id="lrBias" type="range" min="-50" max="50" value="0"><span class="stat" id="lrLbl"></span></label>
              <label>Up / Down Bias % <input id="udBias" type="range" min="-50" max="50" value="0"><span class="stat" id="udLbl"></span></label>
              <label>Intake Mode
                <select id="intakeMode">
                  <option value="balanced">Balanced (¬±)</option>
                  <option value="positive">Positive Gravity Capture</option>
                  <option value="negative">Negative Gravity Capture</option>
                </select>
              </label>
            </div>
            <h3>Power Allocation</h3>
            <div class="meter"><span class="stat" style="width:120px">Field Coils</span><div class="bar"><div id="mCoils" class="fill" style="width:48%"></div></div><span class="stat" id="mCoilsVal"></span></div>
            <div class="meter"><span class="stat" style="width:120px">Vectoring Vanes</span><div class="bar"><div id="mVanes" class="fill" style="width:32%"></div></div><span class="stat" id="mVanesVal"></span></div>
            <div class="meter"><span class="stat" style="width:120px">Containment</span><div class="bar"><div id="mContain" class="fill" style="width:20%"></div></div><span class="stat" id="mContainVal"></span></div>
          </div>
        </div>

        <!-- CENTER COLUMN -->
        <div class="col col-center">
          <div class="panel glass" id="centerTopPanel">
            <h2>Center Hub</h2>
            <div class="legend">This panel sits above ‚ÄúCenter Visuals (Split)‚Äù.</div>
          </div>

          <div class="panel glass" id="modeAltPanel">
            <h2>Mode Alternator ‚Äî Mirror ‚Ä¢ Squeeze ‚Ä¢ Guardrail</h2>
            <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:10px">
              <label>Mirror Suppression S (0‚Äì1)
                <input type="range" id="ma_S" min="0" max="1" step="0.01" value="0.20"><span class="stat" id="ma_S_lbl"></span>
              </label>
              <label>Squeeze Depth r (0‚Äì1)
                <input type="range" id="ma_r" min="0" max="1" step="0.01" value="0.30"><span class="stat" id="ma_r_lbl"></span>
              </label>
              <label>Cadence (Hz) <input type="number" id="ma_f" value="2" step="0.1"></label>
              <label>Phase œÜ (ms) <input type="number" id="ma_phi" value="0" step="1"></label>
              <label>Window œÑ (ms) <input type="number" id="ma_tau" value="60" step="1"></label>
              <label>QI Guardrail <input type="checkbox" id="ma_qi" checked></label>
            </div>
            <div class="legend" id="ma_legend">‚Äî</div>
          </div>

          <div class="panel glass" id="heroPanel">
            <h2>Center Visuals (Split)</h2>
            <div class="heroControls">
              <button type="button" class="heroPairBtn active" data-pair="traj-star">Trajectory + Starfield</button>
              <button type="button" class="heroPairBtn" data-pair="traj-shield">Trajectory + Shield</button>
              <button type="button" class="heroPairBtn" data-pair="star-shield">Starfield + Shield</button>
              <span style="flex:1"></span>
              <button type="button" id="splitVertBtn" class="active">Vertical</button>
              <button type="button" id="splitHorzBtn">Horizontal</button>
            </div>

            <div class="splitHero vertical" id="splitHero">
              <div class="splitPane" id="paneTop"></div>
              <div class="splitHandle" id="splitHandle" title="Drag to resize"></div>
              <div class="splitPane" id="paneBottom"></div>
            </div>

            <!-- Originals; JS moves them into panes -->
            <div style="display:none">
              <canvas id="curveCanvas"></canvas>
              <div class="legend" id="curveLegend">‚Äî</div>
              <canvas id="starfieldCanvas"></canvas>
              <div class="legend" id="starfieldLegend">‚Äî</div>
              <canvas id="shieldCanvas"></canvas>
              <div class="legend" id="shieldLegend">‚Äî</div>
            </div>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col col-right">
          <div class="panel glass">
            <h2>Heliocentric Polar Map (Now vs Arrival)</h2>
            <canvas id="orbitCanvas"></canvas>
            <div class="legend" id="orbitLegend">‚Äî</div>
          </div>

          <div class="panel glass">
            <h2>Einstein Tensor Mini</h2>
            <canvas id="grCanvas"></canvas>
            <div class="legend" id="grMini">G<sub>ŒºŒΩ</sub> proxy ‚Ä¢ œÅ<sub>em</sub> from |‚àáŒ¶|¬≤ (visual) ‚Ä¢ Auto-throttle if g<sub>tt</sub>‚â§0</div>
            <div class="legend">g<sub>tt</sub> min: <span id="gr_gtt">‚Äî</span> ‚Ä¢ œÅ<sub>em</sub> min/max: <span id="gr_rho">‚Äî</span> ‚Ä¢ EC: <span id="gr_ec">‚Äî</span> ‚Ä¢ Horizons: <span id="gr_hor">‚Äî</span></div>
          </div>

          <div class="panel glass" id="pulseRadPanel">
            <h2>Pulse Radiation (Photon Impulse)</h2>
            <div class="grid" style="grid-template-columns:repeat(3,1fr);gap:10px">
              <label>Pulse Energy E<sub>p</sub> (J) <input id="pr_Ep" type="number" value="1000" step="10"></label>
              <label>Rep Rate f<sub>rep</sub> (Hz) <input id="pr_f" type="number" value="1" step="0.1"></label>
              <label>Reflectivity R (0‚Äì1) <input id="pr_R" type="number" value="0.9" step="0.01"></label>
              <label>Capture œá (0‚Äì1) <input id="pr_chi" type="number" value="0.9" step="0.01"></label>
              <label>Aperture Area A (m¬≤) <input id="pr_A" type="number" value="1" step="0.1"></label>
              <label>Radiator Area A<sub>r</sub> (m¬≤) <input id="pr_Ar" type="number" value="10" step="0.1"></label>
              <label>Emissivity Œµ (0‚Äì1) <input id="pr_eps" type="number" value="0.8" step="0.01"></label>
              <label>Ship Mass m (kg) <input id="pr_m" type="number" value="50000" step="100"></label>
              <label>Space T (K) <input id="pr_Tspace" type="number" value="3" step="1"></label>
            </div>
            <div class="legend" id="pr_legend">‚Äî</div>
          </div>

          <div class="panel glass">
            <h2>Debris Defense Field</h2>
            <canvas id="debrisCanvas"></canvas>
            <div class="legend" id="debrisLegend">‚Äî</div>
          </div>
        </div>
      </section>

      <!-- Full-width rows -->
      <section>
        <div class="panel glass">
          <h2>IST Orbital Tracker (Live)</h2>
          <div id="orbit-rows" class="grid" style="grid-template-columns:repeat(4,1fr);gap:var(--gap)"></div>
        </div>
      </section>

      <section class="clockSection">
        <div class="panel glass">
          <div class="clockHeader">
            <h2>Clock Sync (C1‚ÄìC5) + Arrival CST/IST</h2>
            <span class="badge">Compact view</span>
          </div>
          <div class="clockGrid" id="clockGrid"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- CENTERED COMPASS PANEL (always centered on screen) -->
  <div id="compassPanel" class="compassWrap">
    <canvas id="compassCanvas" width="220" height="220"></canvas>
    <div class="compassReadout">
      <span id="compassHeading">000¬∞</span>
      <span class="sub">TRUE</span>
    </div>
    <button id="compassToggle" class="compassToggle" title="Hide/Show Compass">‚ò∏</button>
  </div>

  <!-- Scripts -->
  <script src="app.js"></script>
</body>
</html>
