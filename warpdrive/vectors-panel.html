<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FTL Nav Console — CST + Solver (Offline)</title>
<style>
  :root{
    --scale:1.10;
    --time-scale:0.80;      /* 20% smaller clock text */
    --clock-num-scale:0.80; /* 20% smaller interstellar/stardate numbers */
    --panel:#111a2b; --ink:#e9eef9; --muted:#a9b6d3; --stroke:#274061; --grid:#1b2740;
    --accent:#7dd3fc; --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#081020,#0c1730 55%,#0a1427);
    color:var(--ink);
    font:calc(16px*var(--scale))/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    padding:28px;
  }
  h1{margin:0 0 8px; font-size:clamp(22px,3.2vw,32px); font-weight:800}
  .sub{color:var(--muted); margin:0 0 18px; font-size:.95rem}
  .wrap{width:min(1400px,96vw); margin:0 auto; display:grid; gap:18px}

  .two-up{ display:grid; gap:18px; align-items:stretch; grid-template-columns:1fr }
  @media (min-width:980px){ .two-up{ grid-template-columns:repeat(2,1fr) } }

  .card{ background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius); overflow:hidden; height:100% }
  .card header{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:14px 16px; border-bottom:1px solid var(--stroke);
    background:radial-gradient(1000px 260px at 20% -20%, rgba(125,211,252,.08), transparent 60%);
  }
  .card header h2{margin:0; font-size:1.05rem; font-weight:800}
  .badge{padding:.25rem .55rem; border:1px solid var(--stroke); border-radius:999px; color:#b8c5e0; background:#0a182c; font-size:.85rem}
  .body{padding:16px}
  .muted{color:var(--muted)}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .big{font-size:clamp(24px,3.8vw,36px); font-weight:800; letter-spacing:.4px; font-variant-numeric:tabular-nums}
  .time-big{ font-size: calc(clamp(24px,3.8vw,36px) * var(--time-scale)) }
  .time{     font-size: calc(1rem * var(--time-scale)) }
  .big-clock{ font-size: calc(clamp(24px,3.8vw,36px) * var(--clock-num-scale)) }

  input,button,select{
    background:#0b152a; border:1px solid var(--stroke); color:var(--ink);
    border-radius:10px; font:inherit; padding:.45rem .6rem;
  }
  button{ cursor:pointer }
  input[type="number"]{width:12ch}
  .even{ display:grid; grid-template-columns:repeat(auto-fit,minmax(210px,1fr)); gap:12px; align-items:center }

  .table{width:100%; border-collapse:separate; border-spacing:0}
  .table th,.table td{padding:10px 12px; border-bottom:1px solid var(--grid); text-align:left}
  .table thead th{position:sticky; top:0; background:#0f1830; z-index:1; font-size:.92rem; color:#cfd7eb}
  .table tbody tr:hover{background:#0d1730}
  .groupRow{ background:#0f1830; color:#cfd7eb; font-weight:800 }
  .num{font-variant-numeric:tabular-nums}
  .status{margin-top:10px; padding:10px 12px; border:1px dashed #32496b; border-radius:12px; background:#0b162b; color:#d0d7ea}
  .status.ok{border-color:#2f6b45; background:#0e1f1a; color:#bde6c7}
</style>
</head>
<body>
  <div class="wrap">
    <h1>FTL Nav Console — CST + Solver</h1>
    <p class="sub">
      100% offline demo. Planets & the Moon use a circular-orbit live model; stars/galaxies use given distances and Hubble flow (H₀). Bound systems ignore cosmological expansion.
    </p>

    <div class="two-up">
      <section class="card">
        <header>
          <h2>Quantum Clocks</h2>
          <span class="badge" id="tzBadge">America/Chicago</span>
        </header>
        <div class="body">
          <div class="even" style="text-align:center">
            <div>
              <div class="muted">CST (America/Chicago)</div>
              <div class="big time-big mono" id="cstTime">--:--:--</div>
              <div class="mono time" id="cstDate">--/--/----</div>
            </div>
            <div>
              <div class="muted">Interstellar Time (original)</div>
              <div class="big big-clock mono" id="interstellarYear">Year ~57,889,169.3</div>
              <div class="mono muted time">synced to CST stamp</div>
            </div>
            <div>
              <div class="muted">Stardate (real)</div>
              <div class="big big-clock mono" id="stardateNow">Stardate 65615.2</div>
              <div class="mono time" id="utcStamp">UTC —:—</div>
            </div>
          </div>
          <div class="status mono ok" id="statusMsg">Offline model running — no network needed.</div>
        </div>
      </section>

      <section class="card">
        <header><h2>Solver / Cosmology Settings</h2></header>
        <div class="body even">
          <label>H₀ (km/s/Mpc) <input type="number" id="H0" value="70" step="0.1"/></label>
          <label>Units for Distances
            <select id="unitSelect">
              <option value="AU">AU (astronomical units)</option>
              <option value="km">km</option>
              <option value="mi">mi</option>
              <option value="ly">ly</option>
            </select>
          </label>
          <div class="muted">Tip: Changing H₀ only affects galaxies/stars (Hubble flow). Planets/moons are gravitationally bound.</div>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:18px">
      <header><h2>Targets + CST Solver</h2></header>
      <div class="body">
        <table class="table mono" id="targetsTable">
          <thead>
            <tr>
              <th>Name</th><th>Type</th><th>Live Vector (AU)</th><th>Dist. Sun</th><th>Dist. Earth</th>
              <th>Proper Motion</th><th>Radial Vel.</th><th>Distance</th><th>Rec. Vel.</th><th>Uncertainty</th>
              <th>Last Update</th><th>Status</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <header><h2>Math (implemented)</h2></header>
      <div class="body muted mono" style="font-size:.95rem">
        Planets/Moon: circular orbits, mean motion ω=2π/P; r(t)=a[cosθ,sinθ,0], v(t)=aω[-sinθ,cosθ,0]; Earth used for geocentric ranges.<br/>
        Proper motion (fallback) μ≈(v⊥/d)·(rad→mas/yr). Radial velocity v<sub>r</sub>=(V·Ŕ)·(AU/day→km/s).<br/>
        Stars/Galaxies: D from pc/Mpc; Hubble flow v<sub>rec</sub>=H₀D, z≈v/c (small-z).<br/>
        Uncertainty σ<sub>r</sub>≈|v|·Δt (|v| from model; Δt = time since last stamp).
      </div>
    </section>
  </div>

<script>
/* ---------------- Constants ---------------- */
const AU_KM = 149_597_870.7;
const KM_PER_MI = 1.609344;
const LY_PER_AU = 1/63241.077;
const AU_PER_DAY_TO_KM_S = AU_KM/86400;
const C_KM_S = 299_792.458;
const LY_PER_PC = 3.26156;
const LY_PER_MPC = LY_PER_PC*1e6;
const KM_PER_PC = 3.085677581e13;
const KM_PER_MPC = KM_PER_PC*1e6;
const DEG = Math.PI/180;
const J2000 = Date.UTC(2000,0,1,12,0,0); // 2000-01-01 12:00:00 UTC

const STARDATE_FIXED = 65615.2;

/* ---------------- helpers ---------------- */
const v3 = {
  add:(a,b)=>[a[0]+b[0],a[1]+b[1],a[2]+b[2]],
  sub:(a,b)=>[a[0]-b[0],a[1]-b[1],a[2]-b[2]],
  dot:(a,b)=>a[0]*b[0]+a[1]*b[1]+a[2]*b[2],
  norm:a=>Math.hypot(a[0],a[1],a[2]),
  mul:(a,s)=>[a[0]*s,a[1]*s,a[2]*s],
  unit:a=>{const n=Math.hypot(a[0],a[1],a[2]); return n?[a[0]/n,a[1]/n,a[2]/n]:[0,0,0];}
};
const fmt=(n,f=2)=>Number.isFinite(n)?n.toLocaleString(undefined,{maximumFractionDigits:f,minimumFractionDigits:f}):'—';
function setText(id,v){ const el=document.getElementById(id); if(el) el.textContent=v; }
function toCSTString(d){ const s = new Date(d).toLocaleString('sv-SE',{timeZone:'America/Chicago',hour12:false}); return s.replace('T',' '); }

/* ---------------- seed data (offline) ---------------- */
const SEED = {
  planets: [
    {name:'Mercury', a_AU:0.387098, P_d:87.9691, lon0_deg: 75},
    {name:'Venus',   a_AU:0.723332, P_d:224.701, lon0_deg:180},
    {name:'Earth',   a_AU:1.000000, P_d:365.256, lon0_deg:100},
    {name:'Mars',    a_AU:1.523679, P_d:686.980, lon0_deg:250},
    {name:'Jupiter', a_AU:5.2044,   P_d:4332.59, lon0_deg: 34},
    {name:'Saturn',  a_AU:9.5826,   P_d:10759.22,lon0_deg: 50},
    {name:'Uranus',  a_AU:19.2184,  P_d:30688.5, lon0_deg: 10},
    {name:'Neptune', a_AU:30.110,   P_d:60182.0, lon0_deg: 330}
  ],
  moons: [
    // Simple Earth-Moon model in ecliptic plane
    {name:'Moon', parent:'Earth', a_AU:0.002569, P_d:27.321661, lon0_deg:125}
  ],
  stars: [
    {name:'Sirius', type:'star', distance_pc:2.64, radial_velocity_km_s:-5.5, pm_total_mas_yr:1332}
  ],
  galaxies: [
    {name:'Andromeda (M31)', type:'galaxy', distance_mpc:0.778, radial_velocity_km_s:-301}
  ]
};

/* ---------------- UI refs ---------------- */
const rowsEl = document.getElementById('rows');
const H0Input = document.getElementById('H0');
const unitSel = document.getElementById('unitSelect');
document.getElementById('tzBadge').textContent = 'America/Chicago';

/* ---------------- clocks ---------------- */
function tickClocks(){
  const now = new Date();
  const cst = new Date(now.toLocaleString('en-US',{timeZone:'America/Chicago'}));
  setText('cstTime', cst.toLocaleTimeString([], {hour12:false}));
  setText('cstDate', cst.toLocaleDateString());
  setText('utcStamp', 'UTC ' + now.toISOString().replace('T',' ').replace('Z','Z'));
  setText('stardateNow', 'Stardate ' + STARDATE_FIXED.toFixed(1));
  setText('interstellarYear','Year ~57,889,169.3');
}
setInterval(tickClocks,1000); tickClocks();

/* ---------------- orbital model ---------------- */
function daysSinceJ2000(t=Date.now()){ return (t - J2000)/86400000; }
function circularOrbit(a_AU, P_d, lon0_deg){
  const t = daysSinceJ2000();
  const omega = 2*Math.PI/P_d;
  const theta = (lon0_deg*DEG + omega * t);
  const c = Math.cos(theta), s = Math.sin(theta);
  const r = [a_AU * c, a_AU * s, 0];
  const v = [-a_AU*omega*s, a_AU*omega*c, 0]; // AU/day
  return {r, v};
}

/* ---------------- build dynamic state ---------------- */
function computeSystem(){
  // Planets heliocentric
  const planets = {};
  SEED.planets.forEach(p=>{
    planets[p.name] = circularOrbit(p.a_AU, p.P_d, p.lon0_deg);
    planets[p.name].a_AU = p.a_AU; planets[p.name].P_d = p.P_d;
  });

  // Earth ref
  const earth = planets['Earth'];

  // Moon heliocentric
  const moons = {};
  SEED.moons.forEach(m=>{
    const parent = planets[m.parent];
    const rel = circularOrbit(m.a_AU, m.P_d, m.lon0_deg);
    const r = v3.add(parent.r, rel.r);
    const v = v3.add(parent.v, rel.v);
    moons[m.name] = {r,v,a_AU:m.a_AU,P_d:m.P_d, parent:m.parent};
  });

  return {planets, moons, earth};
}

/* ---------------- formatting ---------------- */
function distFormatFromAU(valAU){
  const u = unitSel.value;
  if(!Number.isFinite(valAU)) return '—';
  if(u==='AU') return `${fmt(valAU,6)} AU`;
  const km = valAU*AU_KM;
  if(u==='km') return `${fmt(km,0)} km`;
  if(u==='mi') return `${fmt(km/KM_PER_MI,0)} mi`;
  if(u==='ly') return `${fmt(valAU*LY_PER_AU,9)} ly`;
  return `${fmt(valAU,6)} AU`;
}

/* ---------------- table render ---------------- */
function addGroupRow(title){
  const tr = document.createElement('tr'); tr.className='groupRow';
  const cells = [title,'—','—','—','—','—','—','—','—','—',toCSTString(new Date()),'ready'];
  cells.forEach(c=>{ const td=document.createElement('td'); td.innerHTML=c; tr.appendChild(td); });
  rowsEl.appendChild(tr);
}

function render(){
  rowsEl.innerHTML='';
  const H0 = parseFloat(H0Input.value)||70;

  const sys = computeSystem();
  const earth = sys.earth;

  /* groups: planets */
  addGroupRow('planets');
  SEED.planets.forEach(p=>{
    const st = sys.planets[p.name];
    stampSolarBodyRow(p.name,'planet', st.r, st.v, earth, H0);
  });

  /* moons */
  addGroupRow('moons');
  SEED.moons.forEach(m=>{
    const st = sys.moons[m.name];
    stampSolarBodyRow(m.name,'moon', st.r, st.v, earth, H0);
  });

  /* stars */
  addGroupRow('stars');
  SEED.stars.forEach(s=>{
    stampDeepRow(s.name, s.type||'star', s, H0);
  });

  /* galaxies */
  addGroupRow('galaxies');
  SEED.galaxies.forEach(g=>{
    stampDeepRow(g.name, g.type||'galaxy', g, H0);
  });
}

function stampSolarBodyRow(name, type, rHelio, vHelio, earth, H0){
  const tr = document.createElement('tr');

  const rEarth = earth && rHelio ? v3.sub(rHelio, earth.r) : null;
  const dSunAU   = rHelio ? v3.norm(rHelio) : null;
  const dEarthAU = rEarth ? v3.norm(rEarth) : null;

  // proper motion (apparent, from tangential Earth-relative)
  let pm_mas_yr = null;
  if(rEarth && vHelio && earth){
    const vRel = v3.sub(vHelio, earth.v);
    const Rhat = v3.unit(rEarth);
    const v_rad = v3.dot(vRel, Rhat);
    const v_tan = v3.norm( v3.sub(vRel, v3.mul(Rhat, v_rad)) );
    const d = v3.norm(rEarth);
    if(d>0){
      const mu_rad_per_day = v_tan / d;
      pm_mas_yr = mu_rad_per_day * (180/Math.PI) * 3600 * 1000 * 365.25;
    }
  }

  // radial velocity vs Earth (km/s)
  let vr_kms = null;
  if(rEarth && vHelio && earth){
    const vRel = v3.sub(vHelio, earth.v);
    vr_kms = v3.dot(vRel, v3.unit(rEarth)) * AU_PER_DAY_TO_KM_S;
  }

  // tiny cosmology (bound systems ~0)
  let D_mpc_live = null, dist_pc=null;
  const dLyDelta = (dSunAU!=null && dEarthAU!=null) ? Math.abs((dSunAU - dEarthAU)*LY_PER_AU) : null;

  // uncertainty: |v|·Δt, with Δt=1 s since we update each second
  const speed_kms = vHelio ? v3.norm(vHelio)*AU_PER_DAY_TO_KM_S : null;
  const sigma_km = speed_kms!=null ? speed_kms*1 : null;

  const cells = [
    name, type,
    rHelio ? `<span class="num">[${fmt(rHelio[0],6)}, ${fmt(rHelio[1],6)}, ${fmt(rHelio[2],6)}]</span>` : '—',
    (dSunAU!=null)   ? `<span class="num">${distFormatFromAU(dSunAU)}</span>`   : '—',
    (dEarthAU!=null) ? `<span class="num">${distFormatFromAU(dEarthAU)}</span>` : '—',
    (pm_mas_yr!=null)? `<span class="num">${fmt(pm_mas_yr,2)} mas/yr</span>` : '—',
    (vr_kms!=null)   ? `<span class="num">${fmt(vr_kms,2)} km/s</span>` : '—',
    (D_mpc_live!=null)
      ? `<span class="num">${fmt(D_mpc_live,4)} Mpc</span> <span class="muted">(≈${fmt(D_mpc_live*LY_PER_MPC,3)} Mly${dLyDelta!=null?`, Δ(SE)≈${fmt(dLyDelta,6)} ly`:''})</span>`
      : (dLyDelta!=null?`<span class="muted">Δ(SE)≈${fmt(dLyDelta,6)} ly</span>`:'—'),
    (D_mpc_live!=null) ? `<span class="num">${fmt((parseFloat(H0Input.value)||70)*D_mpc_live,3)} km/s</span> <span class="muted">(z≈${fmt(((parseFloat(H0Input.value)||70)*D_mpc_live)/C_KM_S,6)})</span>` : '—',
    (sigma_km!=null)? `<span class="num">±${fmt(sigma_km,0)} km</span>` : '—',
    toCSTString(new Date()),
    'offline model'
  ];

  cells.forEach(c=>{ const td=document.createElement('td'); td.innerHTML=c; tr.appendChild(td); });
  rowsEl.appendChild(tr);
}

function stampDeepRow(name, type, obj, H0){
  const tr = document.createElement('tr');

  // Build a fixed Sun-centric vector on +X with magnitude equal to distance (in AU)
  let dist_pc = obj.distance_pc ?? (obj.distance_mpc!=null ? obj.distance_mpc*1e6 : (obj.parallax_mas? 1000/obj.parallax_mas : null));
  let dist_mpc = (obj.distance_mpc!=null) ? obj.distance_mpc : (dist_pc!=null ? dist_pc/1e6 : null);
  const dist_AU = dist_pc!=null ? dist_pc*206265 : (dist_mpc!=null ? dist_mpc*1e6*206265 : null);

  const rHelio = dist_AU!=null ? [dist_AU,0,0] : null;
  const dSunAU = rHelio ? v3.norm(rHelio) : null;

  // Earth vector (≈1 AU) negligible at these scales
  const dEarthAU = dSunAU!=null ? dSunAU - 1.0 : dSunAU;
  const dLyDelta = (dSunAU!=null && dEarthAU!=null) ? Math.abs((dSunAU - dEarthAU)*LY_PER_AU) : null;

  // Proper motion: use given, else N/A
  const pm_mas_yr = (typeof obj.pm_total_mas_yr==='number') ? obj.pm_total_mas_yr : null;

  // Radial velocity: prefer provided
  const vr_kms = (typeof obj.radial_velocity_km_s==='number') ? obj.radial_velocity_km_s : null;

  // Hubble flow (live D not evolving here—can be added but negligible per second at Mpc)
  const vrec = (dist_mpc!=null) ? (H0*dist_mpc) : null;
  const z = (vrec!=null) ? vrec/C_KM_S : null;

  const cells = [
    name, type,
    rHelio ? `<span class="num">[${fmt(rHelio[0],2)}, ${fmt(rHelio[1],2)}, ${fmt(rHelio[2],2)}]</span>` : '—',
    (dSunAU!=null)   ? `<span class="num">${distFormatFromAU(dSunAU)}</span>`   : '—',
    (dEarthAU!=null) ? `<span class="num">${distFormatFromAU(dEarthAU)}</span>` : '—',
    (pm_mas_yr!=null)? `<span class="num">${fmt(pm_mas_yr,1)} mas/yr</span>` : '—',
    (vr_kms!=null)   ? `<span class="num">${fmt(vr_kms,1)} km/s</span>` : '—',
    (dist_mpc!=null)
      ? `<span class="num">${fmt(dist_mpc,3)} Mpc</span> <span class="muted">(≈${fmt(dist_mpc*LY_PER_MPC,2)} Mly${dLyDelta!=null?`, Δ(SE)≈${fmt(dLyDelta,6)} ly`:''})</span>`
      : (dist_pc!=null ? `<span class="num">${fmt(dist_pc,2)} pc</span> <span class="muted">(≈${fmt(dist_pc*LY_PER_PC,2)} ly${dLyDelta!=null?`, Δ(SE)≈${fmt(dLyDelta,6)} ly`:''})</span>` : '—'),
    (vrec!=null) ? `<span class="num">${fmt(vrec,1)} km/s</span> <span class="muted">(z≈${fmt(z,6)})</span>` : '—',
    '±0 km',
    toCSTString(new Date()),
    'offline model'
  ];

  cells.forEach(c=>{ const td=document.createElement('td'); td.innerHTML=c; tr.appendChild(td); });
  rowsEl.appendChild(tr);
}

/* ---------------- live repaint ---------------- */
function repaint(){
  render();
}
setInterval(repaint, 1000);
render();
</script>
</body>
</html>
