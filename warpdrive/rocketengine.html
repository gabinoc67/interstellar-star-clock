<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warp Drive Engine — Blueprint Overlay Animation</title>
<style>
  :root{
    --bg:#05070d; --line:#07afff; --fusion:#ff3b30; --nuclear:#ffd400;
    --packet:#00e5ff; --exhaust:#ff8a00;
  }
  *{box-sizing:border-box}
  body{margin:0;background:#000;color:#dfe8ff;font-family:system-ui,Segoe UI,Roboto,Arial}
  #wrap{min-height:100vh;display:grid;grid-template-rows:auto 1fr auto;gap:12px;place-items:center;padding:18px}
  h1{margin:0;font-size:18px;letter-spacing:.3px}
  .panel{
    width:min(1100px,96vw);background:#0b1424;border:1px solid #172743;
    border-radius:16px;padding:12px 14px;box-shadow:0 10px 30px #0008
  }
  #controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  #controls button, #controls input[type=range]{
    background:#0e203e;color:#e8f3ff;border:1px solid #27406b;border-radius:10px;
    padding:10px 12px;font-weight:600;cursor:pointer
  }
  #controls button:hover{filter:brightness(1.1)}
  #controls .pill{padding:8px 10px;border-radius:999px;background:#0e203e;border:1px solid #27406b}
  #legend{display:flex;gap:14px;flex-wrap:wrap;font-size:12px;margin-left:auto}
  #legend .dot{width:12px;height:12px;border-radius:50%;display:inline-block;margin-right:6px;vertical-align:-2px}

  /* Stage with blueprint background */
  #stage{
    position:relative;width:min(1100px,96vw);aspect-ratio:8/1;border:1px solid #172743;border-radius:18px;
    overflow:hidden;background:#000;
  }
  /* blueprint image layer */
  #stage::before{
    content:""; position:absolute; inset:0;
    background: url("https://gabinoc67.github.io/interstellar-star-clock/warpdrive/ScreenHunter80.png")
                no-repeat center/contain;
    opacity:.45;   /* tweak this for stronger/weaker blueprint */
    filter: saturate(0.9) brightness(0.9);
    pointer-events:none;
  }

  svg{position:relative;z-index:1;width:100%;height:100%;display:block}
  .shell{stroke:var(--line);stroke-width:3;fill:none}
  .rule{stroke:#193154;stroke-width:2}
  .nuclear{fill:var(--nuclear)}
  .fusion-coil{fill:#311317;stroke:#64242a;stroke-width:1}
  .fusion-bar{rx:2;ry:2}
  .fusion-glow{fill:var(--fusion);opacity:.0}
  .loop{stroke:#17d4ff;stroke-width:4;fill:none;opacity:.7}
  .packet{fill:var(--packet)}
  .wave{stroke:#7ff;stroke-width:6;fill:none;opacity:.0}
  .nozzle{stroke:var(--line);stroke-width:3;fill:none}
  .exhaustPulse{fill:var(--exhaust);opacity:.0}
  #phaseLabel{position:absolute;right:12px;bottom:10px;background:#0e203eaa;border:1px solid #27406bcc;
              padding:6px 10px;border-radius:10px;font-size:12px;z-index:2}
  #progress{height:6px;background:#0b1d36;border-radius:999px;overflow:hidden}
  #bar{height:100%;width:0%;background:linear-gradient(90deg,#10b6ff,#6cf);
       box-shadow:0 0 14px #10b6ffcc inset}
</style>
</head>
<body>
<div id="wrap">
  <div class="panel" style="display:flex;align-items:center;gap:12px">
    <h1>Warp Drive Engine — Phase Animation (Blueprint Overlay)</h1>
    <div id="legend">
      <span><i class="dot" style="background:var(--nuclear)"></i>Nuclear Core</span>
      <span><i class="dot" style="background:var(--fusion)"></i>Fusion Coils</span>
      <span><i class="dot" style="background:#17d4ff"></i>Coolant Loops</span>
      <span><i class="dot" style="background:var(--exhaust)"></i>Pulsing Exhaust</span>
    </div>
  </div>

  <div id="stage" class="panel" style="padding:0">
    <svg viewBox="0 0 1100 140" preserveAspectRatio="xMidYMid meet">
      <!-- Optional shell line to match blueprint proportions -->
      <rect x="12" y="18" width="1076" height="104" rx="52" ry="52" class="shell" opacity=".25"/>

      <!-- guide -->
      <line x1="30" y1="70" x2="1068" y2="70" class="rule" opacity=".25"/>

      <!-- Nuclear core chamber -->
      <g id="nuclearGroup" transform="translate(120,70)">
        <ellipse id="nuclearGlow" cx="0" cy="0" rx="38" ry="24" fill="#ffd40022" />
        <circle id="nuclear" class="nuclear" r="16"/>
      </g>

      <!-- Fusion segment block and bars -->
      <g id="fusionGroup" transform="translate(260,70)">
        <rect x="-4" y="-30" width="340" height="60" class="fusion-coil" rx="10" ry="10" opacity=".55"/>
        <g id="fusionBars"></g>
      </g>

      <!-- Coolant twin loops (paths used for packet travel) -->
      <path id="loopTop" class="loop"
            d="M610,34 C720,8 860,10 1010,34 1065,42 1065,98 1010,106 860,130 720,132 610,106 560,96 560,44 610,34 Z"/>
      <path id="loopBottom" class="loop"
            d="M610,106 C500,132 360,130 210,106 155,98 155,42 210,34 360,10 500,8 610,34 660,44 660,96 610,106 Z"/>

      <!-- Energy wave from coils to nozzle -->
      <path id="wave" class="wave" d="M600,70 C760,60 860,70 980,70" />

      <!-- Nozzle tip -->
      <g id="nozzle" transform="translate(1040,70)">
        <path class="nozzle" d="M-6,-16 L44,0 L-6,16" opacity=".7"/>
      </g>

      <!-- Exhaust pulse circles -->
      <g id="exhaustGroup" transform="translate(1068,70)">
        <circle id="ex1" class="exhaustPulse" r="4"/>
        <circle id="ex2" class="exhaustPulse" r="4"/>
        <circle id="ex3" class="exhaustPulse" r="4"/>
      </g>

      <!-- dynamic coolant packets will be appended here -->
      <g id="packets"></g>
    </svg>
    <div id="phaseLabel">Idle</div>
  </div>

  <div class="panel" id="controls">
    <button id="play">▶ Play</button>
    <button id="pause">⏸ Pause</button>
    <button id="step">⏭ Step Phase</button>
    <button id="reset">↺ Reset</button>
    <span class="pill">Speed × <span id="speedVal">1.0</span></span>
    <input id="speed" type="range" min="0.25" max="2.5" step="0.25" value="1" style="width:220px" />
    <div style="flex:1 1 120px"></div>
    <div style="min-width:200px;flex:1">
      <div id="progress"><div id="bar"></div></div>
    </div>
  </div>
</div>

<script>
/* -------------------------------------------------------
   Phases (seconds)
   0: Idle/Warm
   1: Nuclear ignition
   2: Fusion coils ramp
   3: Coolant circulation (packets)
   4: Field transfer (wave)
   5: Pulsing exhaust
-------------------------------------------------------- */
const phases = [
  {name:"Idle / Warmup", dur: 1.2},
  {name:"Nuclear Ignition", dur: 2.2},
  {name:"Fusion Ramp", dur: 3.0},
  {name:"Coolant Circulation", dur: 3.5},
  {name:"Field Transfer", dur: 1.6},
  {name:"Pulsing Exhaust", dur: 2.2}
];
const totalDur = phases.reduce((a,p)=>a+p.dur,0);

let speed=1.0, playing=true, t=0, last=performance.now();
const phaseLabel=document.getElementById('phaseLabel');
const progressBar=document.getElementById('bar');

const nuclear=document.getElementById('nuclear');
const nuclearGlow=document.getElementById('nuclearGlow');
const wave=document.getElementById('wave');
const exPulses=[document.getElementById('ex1'),document.getElementById('ex2'),document.getElementById('ex3')];

const loopTop = document.getElementById('loopTop');
const loopBottom = document.getElementById('loopBottom');
const packetsG = document.getElementById('packets');
const packetPaths = [loopTop, loopBottom];
const packets = [];
const PACKET_COUNT = 16;

/* Build fusion bars + glow overlays */
const fGroup=document.getElementById('fusionBars');
const fusionGlows=[];
for(let i=0;i<14;i++){
  const x = 10 + i*22;
  const base = document.createElementNS('http://www.w3.org/2000/svg','rect');
  base.setAttribute('x', x); base.setAttribute('y', -18);
  base.setAttribute('width', 14); base.setAttribute('height', 36);
  base.setAttribute('class','fusion-bar'); base.setAttribute('fill','#2a1b28');
  base.setAttribute('stroke','#5a3a52'); base.setAttribute('stroke-width','1');
  fGroup.appendChild(base);

  const glow = document.createElementNS('http://www.w3.org/2000/svg','rect');
  glow.setAttribute('x', x); glow.setAttribute('y', -18);
  glow.setAttribute('width', 14); glow.setAttribute('height', 36);
  glow.setAttribute('class','fusion-glow');
  fGroup.appendChild(glow);
  fusionGlows.push(glow);
}

/* init packets */
for(let i=0;i<PACKET_COUNT;i++){
  const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
  c.setAttribute('r',3.8); c.setAttribute('class','packet'); c.style.opacity=0;
  packetsG.appendChild(c);
  packets.push({el:c, path: packetPaths[i%2], offset: i/ PACKET_COUNT});
}

/* Controls */
document.getElementById('play').onclick=()=>playing=true;
document.getElementById('pause').onclick=()=>playing=false;
document.getElementById('reset').onclick=()=>{t=0;playing=false;draw(0,true);}
document.getElementById('step').onclick=()=>{
  const {idx} = getPhase(t);
  const jump = phases[idx].dur - localTime(t);
  t += jump + 0.001;  // jump to next phase
  draw(0,true);
};
const speedSlider=document.getElementById('speed');
const speedVal=document.getElementById('speedVal');
speedSlider.oninput=()=>{speed=parseFloat(speedSlider.value); speedVal.textContent=speed.toFixed(2);};

/* Helpers */
function getPhase(time){
  let acc=0;
  for(let i=0;i<phases.length;i++){
    const start=acc, end=acc+phases[i].dur;
    if(time>=start && time<end) return {idx:i,start,end};
    acc=end;
  }
  return {idx:phases.length-1,start:totalDur-phases.at(-1).dur,end:totalDur};
}
function localTime(time){ const {start}=getPhase(time); return time-start; }
function easeInOut(t){ return t<.5 ? 2*t*t : -1+(4-2*t)*t; }
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

/* Animation loop */
function tick(now){
  const dt = (now-last)/1000; last=now;
  if(playing){ t += dt*speed; if(t>totalDur) t -= totalDur; }
  draw(dt,false);
  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);

/* Draw per-phase */
function draw(dt,force){
  const {idx}=getPhase(t);
  const lt = localTime(t);
  const p = phases[idx];
  phaseLabel.textContent = p.name;
  progressBar.style.width = ((t/totalDur)%1)*100 + '%';

  if(force){ for(const ex of exPulses){ ex.style.opacity=0; ex.setAttribute('r',4);} }

  // subtle breathing on loops
  const breath = 0.5 + 0.5*Math.sin((t/totalDur)*Math.PI*2);
  loopTop.style.opacity = .55 + .25*breath;
  loopBottom.style.opacity = .55 + .25*breath;

  if(idx===0){ // Idle
    nuclear.setAttribute('r', 14 + 2*Math.sin(lt*3));
    nuclearGlow.setAttribute('rx', 32 + 6*Math.sin(lt*2));
    nuclearGlow.setAttribute('ry', 20 + 4*Math.sin(lt*2));
    fusionGlows.forEach(g=>g.style.opacity=0);
    wave.style.opacity=0;
    packets.forEach(p=>p.el.style.opacity=0);
  }

  if(idx===1){ // Nuclear Ignition
    const q = easeInOut(clamp(lt/p.dur,0,1));
    const r = 12 + 10*q + 2*Math.sin(lt*10);
    nuclear.setAttribute('r', r);
    nuclearGlow.setAttribute('rx', 30 + 30*q);
    nuclearGlow.setAttribute('ry', 18 + 18*q);
    nuclearGlow.setAttribute('fill', `rgba(255,212,0,${0.10 + 0.25*q})`);
  }

  if(idx===2){ // Fusion ramp
    const q = clamp(lt/p.dur,0,1);
    const activeBars = Math.floor(q * fusionGlows.length);
    fusionGlows.forEach((g,i)=>{
      const on = i <= activeBars;
      const pulse = on ? (0.5+0.5*Math.sin((lt*6)+i*.4)) : 0;
      g.style.opacity = on ? (0.25 + 0.55*pulse) : 0;
      g.setAttribute('fill', `rgba(255,59,48,${g.style.opacity})`);
    });
    nuclear.setAttribute('r', 18 + 2*Math.sin(lt*8));
  }

  if(idx===3){ // Coolant circulation
    const pathLenTop = loopTop.getTotalLength();
    const pathLenBottom = loopBottom.getTotalLength();
    packets.forEach((pk,i)=>{
      const cycle = ((lt/p.dur) + pk.offset) % 1;
      const len = (pk.path===loopTop?pathLenTop:pathLenBottom);
      const pt = pk.path.getPointAtLength(cycle*len);
      pk.el.setAttribute('cx', pt.x);
      pk.el.setAttribute('cy', pt.y);
      pk.el.style.opacity = 0.35 + 0.6*Math.sin((cycle*2*Math.PI)+i*.8)**2;
    });
  } else {
    packets.forEach(pk=>pk.el.style.opacity = Math.max(0, pk.el.style.opacity - dt*2));
  }

  if(idx===4){ // Field transfer — wave travels
    const q = clamp(lt/p.dur,0,1);
    wave.style.opacity = 0.15 + 0.5*Math.sin(lt*8)**2;
    const d = `M600,70 C${740+40*q},${60-6*q} ${850+30*q},${70+2*q} 980,70`;
    wave.setAttribute('d', d);
  } else {
    wave.style.opacity = Math.max(0, (parseFloat(wave.style.opacity||0)-dt*3));
  }

  if(idx===5){ // Exhaust pulsing
    for(let i=0;i<exPulses.length;i++){
      const ex=exPulses[i];
      const phase = (lt/p.dur + i/3)%1;
      const r = 4 + phase* (28 + i*10);
      const op = 0.6 * (1 - phase);
      ex.setAttribute('r', r);
      ex.style.opacity = op;
    }
  }
}
</script>
</body>
</html>
