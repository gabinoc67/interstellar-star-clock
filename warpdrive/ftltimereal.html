<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FTL Warp Control System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="mainContainer">

    <!-- Manual Warp Control -->
    <div class="panel">
        <h2>Manual Warp Control</h2>
        <label>Warp Factor:
            <input type="number" id="inputWarpFactor" min="1" max="9.99" step="0.01" value="5">
        </label>
        <label>Distance (AU):
            <input type="number" id="inputDistance" min="0.1" step="0.01" value="20">
        </label>
        <button id="btnEngageWarp">Engage</button>
        <button id="btnIdle">Idle</button>
    </div>

    <!-- Panel: Warp Factor & Status -->
    <div class="panel">
        <h2>Warp Factor</h2>
        <div>Current: <span id="warpFactorDisplay">0.00</span> <span class="status-light" id="warpStatus"></span></div>
        <div>Target: <span id="warpTargetDisplay">0.00</span></div>
        <div>Safe Range: ±5%</div>
    </div>

    <!-- Panel: FTL Distance & ETA -->
    <div class="panel">
        <h2>Distance & ETA</h2>
        <div>Distance Remaining: <span id="distanceRemaining">0.000</span> AU</div>
        <div>ETA: <span id="etaDisplay">--:--:--</span></div>
        <div>Light-Minutes: <span id="lightMinutesDisplay">0</span></div>
        <div>Light-Hours: <span id="lightHoursDisplay">0</span></div>
    </div>

    <!-- Panel: Heading & Compass -->
    <div class="panel">
        <h2>Course Vector</h2>
        <div>Heading: <span id="headingDegrees">000</span>°</div>
        <canvas id="compassCanvas" width="200" height="200"></canvas>
        <div>Pitch: <span id="pitchDegrees">0</span>°</div>
        <div>Yaw: <span id="yawDegrees">0</span>°</div>
    </div>

    <!-- Panel: Magnetic Field -->
    <div class="panel">
        <h2>Magnetic Field</h2>
        <div>Current Field: <span id="magField">0.00</span> Tesla</div>
        <div>Required: <span id="magFieldTarget">0.00</span> Tesla</div>
        <div>Status: <span class="status-light" id="magFieldStatus"></span></div>
    </div>

    <!-- Panel: Engine Pressure -->
    <div class="panel">
        <h2>Engine Pressure</h2>
        <div>Current: <span id="enginePressure">0.00</span> MPa</div>
        <div>Required: <span id="enginePressureTarget">0.00</span> MPa</div>
        <div>Status: <span class="status-light" id="enginePressureStatus"></span></div>
    </div>

    <!-- Panel: Energy Allocation -->
    <div class="panel">
        <h2>Energy Allocation</h2>
        <div>Coils: <span id="energyCoils">0</span> MW</div>
        <div>Navigation: <span id="energyNav">0</span> MW</div>
        <div>Shields: <span id="energyShields">0</span> MW</div>
        <div>Life Support: <span id="energyLife">0</span> MW</div>
    </div>

    <!-- Panel: Safety Monitor -->
    <div class="panel">
        <h2>Safety Monitor</h2>
        <div>FTL Stability: <span id="stabilityIndex">0.00</span> % <span class="status-light" id="stabilityStatus"></span></div>
        <div>Hull Integrity: <span id="hullIntegrity">100</span> %</div>
        <div>Gravity Balance: <span id="gravityBalance">0.00</span> g</div>
    </div>

    <!-- Panel: Crew Status -->
    <div class="panel">
        <h2>Crew Status</h2>
        <div>Total Crew: <span id="crewTotal">0</span></div>
        <div>Active Duty: <span id="crewActive">0</span></div>
        <div>Medical: <span id="crewMedical">0</span></div>
        <div>Status: <span class="status-light" id="crewStatus"></span></div>
    </div>

    <!-- Panel: Clocks -->
    <div class="panel">
        <h2>Clocks</h2>
        <div>Ship Time: <span id="clockShip">--:--:--</span></div>
        <div>Earth Time: <span id="clockEarth">--:--:--</span></div>
        <div>Destination Time: <span id="clockDest">--:--:--</span></div>
        <div>Countdown: <span id="countdown">--:--:--</span></div>
    </div>

    <!-- Panel: Einstein Tensor -->
    <div class="panel">
        <h2>Einstein Tensor</h2>
        <canvas id="tensorCanvas" width="250" height="80"></canvas>
    </div>

    <!-- Panel: Starfield -->
    <div class="panel">
        <h2>Warp Starfield</h2>
        <canvas id="starfieldCanvas" width="300" height="150"></canvas>
    </div>

    <!-- Abbreviations Panels -->
    <div class="panel">
        <h2>Navigation Systems</h2>
        <div id="navAbbr"></div>
    </div>
    <div class="panel">
        <h2>Engine Systems</h2>
        <div id="engAbbr"></div>
    </div>
    <div class="panel">
        <h2>Crew & Life Support</h2>
        <div id="crewAbbr"></div>
    </div>
    <div class="panel">
        <h2>Environment & Ship Systems</h2>
        <div id="envAbbr"></div>
    </div>

    <!-- Panel: Status Log -->
    <div class="panel">
        <h2>Status Log</h2>
        <div id="statusLog" class="log-box"></div>
    </div>

</div>
<style>
/* General body styles */
body {
    background-color: #05080f;
    font-family: Arial, sans-serif;
    color: #eaf2ff;
    margin: 0;
    padding: 0;
}

#mainContainer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    grid-gap: 12px;
    padding: 12px;
}

/* Panel styling */
.panel {
    background-color: #0c1424;
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.7);
    border: 1px solid #3ad5ff;
}

.panel h2 {
    margin: 0 0 8px;
    font-size: 1.2em;
    color: #3ad5ff;
    text-shadow: 0 0 8px #3ad5ff;
}

/* Status light circle */
.status-light {
    display: inline-block;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: gray;
    margin-left: 6px;
    vertical-align: middle;
    box-shadow: 0 0 6px rgba(255,255,255,0.3);
}

/* Flash animations */
@keyframes flashRed {
    0%, 100% { background: red; box-shadow: 0 0 8px red; }
    50% { background: darkred; box-shadow: 0 0 4px darkred; }
}
@keyframes flashYellow {
    0%, 100% { background: yellow; box-shadow: 0 0 8px yellow; }
    50% { background: gold; box-shadow: 0 0 4px gold; }
}
.status-light.red-flash {
    animation: flashRed 1s infinite;
}
.status-light.yellow-flash {
    animation: flashYellow 1s infinite;
}

/* Log box */
.log-box {
    height: 160px;
    overflow-y: auto;
    background: rgba(0,0,0,0.25);
    border: 1px solid #3ad5ff;
    padding: 6px;
    font-size: 0.95em;
}
.log-box::-webkit-scrollbar {
    width: 8px;
}
.log-box::-webkit-scrollbar-thumb {
    background: #3ad5ff;
    border-radius: 4px;
}

/* Value rows */
.panel div {
    font-size: 1.05em;
    margin-bottom: 4px;
}

/* Canvas styling */
#tensorCanvas, #starfieldCanvas, #compassCanvas {
    display: block;
    background: black;
    margin-top: 4px;
    border: 1px solid #3ad5ff;
    border-radius: 4px;
}

/* Abbreviations grid */
#navAbbr, #engAbbr, #crewAbbr, #envAbbr {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 4px;
}
.abbr-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(0,0,0,0.2);
    border: 1px solid #3ad5ff;
    padding: 4px 6px;
    border-radius: 4px;
    font-size: 0.9em;
}
.abbr-label {
    color: #9fd6ff;
}
.abbr-value {
    font-weight: bold;
    min-width: 40px;
    text-align: right;
}

/* Flashing abbreviations */
.abbr-red {
    color: red;
    animation: flashRed 1s infinite;
}
.abbr-yellow {
    color: yellow;
    animation: flashYellow 1s infinite;
}

/* Compass styles */
#compassCanvas {
    background: radial-gradient(circle at center, #000 60%, #0c1424 100%);
    border: 2px solid #3ad5ff;
    border-radius: 50%;
}

/* Buttons */
button {
    background: #3ad5ff;
    color: black;
    border: none;
    padding: 6px 12px;
    margin-top: 6px;
    font-size: 0.9em;
    border-radius: 4px;
    cursor: pointer;
}
button:hover {
    background: #6de0ff;
}
button:active {
    background: #2db9df;
}
</style>
<script>
// ==========================
// SOUND SETUP
// ==========================
const humSound = new Audio("https://gabinoc67.github.io/interstellar-star-clock/warpdrive/hum.mp3");
const warpSound = new Audio("https://gabinoc67.github.io/interstellar-star-clock/warpdrive/warp.mp3");
const arriveSound = new Audio("https://gabinoc67.github.io/interstellar-star-clock/warpdrive/arrive.mp3");

humSound.loop = true;
warpSound.loop = true;

let soundOn = true;
let warpEngaged = false;

// ==========================
// ENGINE & NAV VARIABLES
// ==========================
let warpFactor = 0;
let warpTarget = 0;
let distanceRemaining = 0; // AU
let magField = 0;
let magTarget = 0;
let pressure = 0;
let pressureTarget = 0;
let stabilityIndex = 100;
let hullIntegrity = 100;
let gravityBalance = 1;
let crewTotal = 50;
let crewActive = 45;
let crewMedical = 5;

let tripInterval;
let arrivalTime;
let heading = 0;

// ==========================
// HELPER FUNCTIONS
// ==========================
function updateElement(id, value) {
    const el = document.getElementById(id);
    if (el) el.textContent = value;
}

function statusLight(id, status) {
    let el = document.getElementById(id);
    if (!el) return;
    el.classList.remove("red-flash", "yellow-flash");
    if (status === "green") el.style.background = "lime";
    else if (status === "yellow") {
        el.style.background = "gold";
        el.classList.add("yellow-flash");
    }
    else {
        el.style.background = "red";
        el.classList.add("red-flash");
    }
}

function logStatus(msg, warning = false) {
    let logBox = document.getElementById("statusLog");
    if (!logBox) return;
    let entry = document.createElement("div");
    entry.style.color = warning ? "red" : "cyan";
    entry.textContent = msg;
    logBox.prepend(entry);
}

// ==========================
// CLOCK UPDATES
// ==========================
function updateClocks() {
    let now = new Date();
    updateElement("clockShip", now.toLocaleTimeString());
    updateElement("clockEarth", now.toUTCString().split(" ")[4]);

    if (arrivalTime) {
        let destTime = new Date(arrivalTime);
        updateElement("clockDest", destTime.toLocaleTimeString());
        let diff = Math.max(0, (destTime - now) / 1000);
        let hrs = Math.floor(diff / 3600);
        let mins = Math.floor((diff % 3600) / 60);
        let secs = Math.floor(diff % 60);
        updateElement("countdown", `${hrs}:${mins}:${secs}`);
    }
}

// ==========================
// WARP FORMULAS
// ==========================
function warpSpeed(wf) {
    return Math.pow(wf, 3); // simplified warp curve
}

function travelTimeAU(distanceAU, wf) {
    let c_in_AUph = 173.145; // 1c in AU/hour
    return distanceAU / (warpSpeed(wf) * c_in_AUph);
}

// ==========================
// PANEL UPDATES
// ==========================
function updatePanels() {
    updateElement("warpFactorDisplay", warpFactor.toFixed(2));
    updateElement("warpTargetDisplay", warpTarget.toFixed(2));

    updateElement("distanceRemaining", distanceRemaining.toFixed(3));
    updateElement("lightMinutesDisplay", (distanceRemaining * 8.31675).toFixed(2));
    updateElement("lightHoursDisplay", (distanceRemaining * 0.1386125).toFixed(2));

    heading = (heading + 1) % 360;
    updateElement("headingDegrees", heading.toFixed(0));
    updateElement("pitchDegrees", (Math.random() * 10 - 5).toFixed(2));
    updateElement("yawDegrees", (Math.random() * 10 - 5).toFixed(2));

    magField = magTarget + (Math.random() - 0.5) * 0.05;
    updateElement("magField", magField.toFixed(2));
    statusLight("magFieldStatus", Math.abs(magField - magTarget) <= 0.05 ? "green" : "red");

    pressure = pressureTarget + (Math.random() - 0.5) * 0.1;
    updateElement("enginePressure", pressure.toFixed(2));
    statusLight("enginePressureStatus", Math.abs(pressure - pressureTarget) <= 0.1 ? "green" : "red");

    updateElement("energyCoils", (warpFactor * 50).toFixed(0));
    updateElement("energyNav", (warpFactor * 10).toFixed(0));
    updateElement("energyShields", (warpFactor * 15).toFixed(0));
    updateElement("energyLife", 200);

    stabilityIndex = 100 - Math.random() * 2;
    updateElement("stabilityIndex", stabilityIndex.toFixed(2));
    statusLight("stabilityStatus", stabilityIndex >= 95 ? "green" : "yellow");

    updateElement("hullIntegrity", hullIntegrity.toFixed(2));
    updateElement("gravityBalance", (1 + (Math.random() - 0.5) * 0.01).toFixed(3));

    updateElement("crewTotal", crewTotal);
    updateElement("crewActive", crewActive);
    updateElement("crewMedical", crewMedical);
    statusLight("crewStatus", crewMedical === 0 ? "green" : "yellow");

    updateAbbreviations();
}

// ==========================
// ABBREVIATIONS UPDATE
// ==========================
let abbrList = [
    // Navigation
    "HDG","PCH","YAW","SPD","DST","ETA","POS","COG","VAR",
    // Engine
    "TMP","PRES","MAG","COIL","THR","VIB","FREQ","FLOW","RPM",
    // Crew
    "CRW","MED","OFF","ENG","SCI","ACT",
    // Environment
    "O2","CO2","TMP_ENV","GRAV","HUM","PRES_ENV"
];

// plus user’s 100+ custom abbreviations
for(let i=1;i<=100;i++){ abbrList.push("SYS"+i); }

function updateAbbreviations() {
    abbrList.forEach(id=>{
        let el = document.getElementById("abbr-"+id);
        if (!el) return;

        let value;
        if (id==="HDG") value = heading+"°";
        else if (id==="SPD") value = (warpSpeed(warpFactor)*173.145).toFixed(2)+" AU/h";
        else if (id.includes("PRES")) value = (Math.random()*200).toFixed(2)+" psi";
        else if (id.includes("MAG")) value = magField.toFixed(2)+" T";
        else if (id.includes("TMP")) value = (20+Math.random()*5).toFixed(1)+"°C";
        else value = (Math.random()*100).toFixed(2);

        el.textContent = value;

        // Flash logic for warp
        if (warpEngaged && Math.random() < 0.05) {
            el.classList.add("abbr-red");
            setTimeout(()=>el.classList.remove("abbr-red"), 500);
        }
    });
}

// ==========================
// WARP CONTROL
// ==========================
function engageWarp(targetWF, targetAU) {
    if (warpEngaged) return;
    warpEngaged = true;
    warpTarget = targetWF;
    distanceRemaining = targetAU;

    magTarget = warpTarget * 0.5;
    pressureTarget = warpTarget * 1.2;

    let travelHours = travelTimeAU(distanceRemaining, warpTarget);
    arrivalTime = new Date(Date.now() + travelHours * 3600000);

    logStatus(`Warp engaged to ${targetAU} AU at Warp ${targetWF}`);
    if (soundOn) { humSound.pause(); warpSound.play(); }

    tripInterval = setInterval(() => {
        warpFactor = warpTarget + (Math.random() - 0.5) * 0.05;
        distanceRemaining -= warpSpeed(warpFactor) * 0.0005;
        if (distanceRemaining <= 0) {
            arriveWarp();
        }
        updatePanels();
        updateClocks();
        safetyCheck();
    }, 1000);
}

function arriveWarp() {
    clearInterval(tripInterval);
    warpEngaged = false;
    warpFactor = 0;
    distanceRemaining = 0;
    updatePanels();
    logStatus("Arrived at destination!");
    if (soundOn) { warpSound.pause(); arriveSound.play(); setTimeout(() => humSound.play(), 5000); }
}

function safetyCheck() {
    if (Math.abs(magField - magTarget) > 0.1 || Math.abs(pressure - pressureTarget) > 0.2 || stabilityIndex < 90) {
        logStatus("⚠ Safety limits exceeded — Warp disengaging!", true);
        arriveWarp();
    }
}

// ==========================
// COMPASS
// ==========================
function drawCompass() {
    const ctx = document.getElementById("compassCanvas").getContext("2d");
    ctx.clearRect(0,0,200,200);
    ctx.strokeStyle = "#3ad5ff";
    ctx.beginPath();
    ctx.arc(100,100,90,0,Math.PI*2);
    ctx.stroke();

    ctx.save();
    ctx.translate(100,100);
    ctx.rotate((heading*Math.PI)/180);
    ctx.beginPath();
    ctx.moveTo(0,-80);
    ctx.lineTo(0,0);
    ctx.strokeStyle = "red";
    ctx.stroke();
    ctx.restore();
}

// ==========================
// EINSTEIN TENSOR VISUAL
// ==========================
function drawTensor() {
    const ctx = document.getElementById("tensorCanvas").getContext("2d");
    ctx.clearRect(0,0,250,80);
    ctx.strokeStyle = "#3ad5ff";
    for(let i=0;i<5;i++){
        ctx.beginPath();
        ctx.moveTo(0,Math.random()*80);
        ctx.lineTo(250,Math.random()*80);
        ctx.stroke();
    }
}

// ==========================
// STARFIELD
// ==========================
let stars = Array.from({length:100}, ()=>({x:Math.random()*300, y:Math.random()*150, speed:Math.random()*2+1}));
function drawStarfield() {
    const ctx = document.getElementById("starfieldCanvas").getContext("2d");
    ctx.clearRect(0,0,300,150);
    ctx.fillStyle = "white";
    stars.forEach(s=>{
        ctx.beginPath();
        ctx.arc(s.x,s.y,1,0,Math.PI*2);
        ctx.fill();
        if (warpEngaged) s.y += s.speed*2; else s.y += s.speed*0.5;
        if (s.y>150) s.y = 0;
    });
}

// ==========================
// INIT
// ==========================
setInterval(updateClocks, 1000);
setInterval(()=>{
    updatePanels();
    drawCompass();
    drawTensor();
    drawStarfield();
}, 500);

if (soundOn) humSound.play();

// Example auto-engage for testing
setTimeout(()=>engageWarp(5, 20), 3000);
</script>
</html>
