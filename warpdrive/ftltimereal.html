<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FTL Warp Control System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="mainContainer">

    <!-- Panel: Warp Factor & Status -->
    <div class="panel">
        <h2>Warp Factor</h2>
        <div>Current: <span id="warpFactorDisplay">0.00</span> <span class="status-light" id="warpStatus"></span></div>
        <div>Target: <span id="warpTargetDisplay">0.00</span></div>
        <div>Safe Range: ±5%</div>
    </div>

    <!-- Panel: FTL Distance & ETA -->
    <div class="panel">
        <h2>Distance & ETA</h2>
        <div>Distance Remaining: <span id="distanceRemaining">0.000</span> AU</div>
        <div>ETA: <span id="etaDisplay">--:--:--</span></div>
        <div>Light-Minutes: <span id="lightMinutesDisplay">0</span></div>
        <div>Light-Hours: <span id="lightHoursDisplay">0</span></div>
    </div>

    <!-- Panel: Heading & Course -->
    <div class="panel">
        <h2>Course Vector</h2>
        <div>Heading: <span id="headingDegrees">000</span>°</div>
        <div>Pitch: <span id="pitchDegrees">0</span>°</div>
        <div>Yaw: <span id="yawDegrees">0</span>°</div>
    </div>

    <!-- Panel: Magnetic Field -->
    <div class="panel">
        <h2>Magnetic Field</h2>
        <div>Current Field: <span id="magField">0.00</span> Tesla</div>
        <div>Required: <span id="magFieldTarget">0.00</span> Tesla</div>
        <div>Status: <span class="status-light" id="magFieldStatus"></span></div>
    </div>

    <!-- Panel: Engine Pressure -->
    <div class="panel">
        <h2>Engine Pressure</h2>
        <div>Current: <span id="enginePressure">0.00</span> MPa</div>
        <div>Required: <span id="enginePressureTarget">0.00</span> MPa</div>
        <div>Status: <span class="status-light" id="enginePressureStatus"></span></div>
    </div>

    <!-- Panel: Energy Allocation -->
    <div class="panel">
        <h2>Energy Allocation</h2>
        <div>Coils: <span id="energyCoils">0</span> MW</div>
        <div>Navigation: <span id="energyNav">0</span> MW</div>
        <div>Shields: <span id="energyShields">0</span> MW</div>
        <div>Life Support: <span id="energyLife">0</span> MW</div>
    </div>

    <!-- Panel: Safety Monitor -->
    <div class="panel">
        <h2>Safety Monitor</h2>
        <div>FTL Stability: <span id="stabilityIndex">0.00</span> % <span class="status-light" id="stabilityStatus"></span></div>
        <div>Hull Integrity: <span id="hullIntegrity">100</span> %</div>
        <div>Gravity Balance: <span id="gravityBalance">0.00</span> g</div>
    </div>

    <!-- Panel: Crew Status -->
    <div class="panel">
        <h2>Crew Status</h2>
        <div>Total Crew: <span id="crewTotal">0</span></div>
        <div>Active Duty: <span id="crewActive">0</span></div>
        <div>Medical: <span id="crewMedical">0</span></div>
        <div>Status: <span class="status-light" id="crewStatus"></span></div>
    </div>

    <!-- Panel: Clocks -->
    <div class="panel">
        <h2>Clocks</h2>
        <div>Ship Time: <span id="clockShip">--:--:--</span></div>
        <div>Earth Time: <span id="clockEarth">--:--:--</span></div>
        <div>Destination Time: <span id="clockDest">--:--:--</span></div>
        <div>Countdown: <span id="countdown">--:--:--</span></div>
    </div>

    <!-- Panel: Einstein Tensor -->
    <div class="panel">
        <h2>Einstein Tensor</h2>
        <canvas id="tensorCanvas" width="250" height="80"></canvas>
    </div>

    <!-- Panel: Starfield -->
    <div class="panel">
        <h2>Warp Starfield</h2>
        <canvas id="starfieldCanvas" width="300" height="150"></canvas>
    </div>

    <!-- Panel: Status Log -->
    <div class="panel">
        <h2>Status Log</h2>
        <div id="statusLog" class="log-box"></div>
    </div>

</div>
<script>
// ==========================
// SOUND SETUP
// ==========================
const humSound = new Audio("https://gabinoc67.github.io/interstellar-star-clock/warpdrive/hum.mp3");
const warpSound = new Audio("https://gabinoc67.github.io/interstellar-star-clock/warpdrive/warp.mp3");
const arriveSound = new Audio("https://gabinoc67.github.io/interstellar-star-clock/warpdrive/arrive.mp3");

humSound.loop = true;
warpSound.loop = true;

let soundOn = true;
let warpEngaged = false;

// ==========================
// ENGINE & NAV VARIABLES
// ==========================
let warpFactor = 0;
let warpTarget = 0;
let distanceRemaining = 0; // AU
let magField = 0;
let magTarget = 0;
let pressure = 0;
let pressureTarget = 0;
let stabilityIndex = 100;
let hullIntegrity = 100;
let gravityBalance = 1;
let crewTotal = 50;
let crewActive = 45;
let crewMedical = 5;

let tripInterval;
let arrivalTime;

// ==========================
// HELPER FUNCTIONS
// ==========================
function updateElement(id, value) {
    document.getElementById(id).textContent = value;
}

function statusLight(id, status) {
    let el = document.getElementById(id);
    if (status === "green") el.style.background = "lime";
    else if (status === "yellow") el.style.background = "yellow";
    else el.style.background = "red";
}

function logStatus(msg, warning = false) {
    let logBox = document.getElementById("statusLog");
    let entry = document.createElement("div");
    entry.style.color = warning ? "red" : "cyan";
    entry.textContent = msg;
    logBox.prepend(entry);
}

// ==========================
// CLOCK UPDATES
// ==========================
function updateClocks() {
    let now = new Date();
    updateElement("clockShip", now.toLocaleTimeString());
    updateElement("clockEarth", now.toUTCString().split(" ")[4]);

    if (arrivalTime) {
        let destTime = new Date(arrivalTime);
        updateElement("clockDest", destTime.toLocaleTimeString());
        let diff = Math.max(0, (destTime - now) / 1000);
        let hrs = Math.floor(diff / 3600);
        let mins = Math.floor((diff % 3600) / 60);
        let secs = Math.floor(diff % 60);
        updateElement("countdown", `${hrs}:${mins}:${secs}`);
    }
}

// ==========================
// WARP FORMULAS
// ==========================
// Warp speed (c) using simple cubic warp factor rule
function warpSpeed(wf) {
    return Math.pow(wf, 3); // Simplified warp curve
}

// Time (in hours) = distance in AU / warp speed in AU/hour
function travelTimeAU(distanceAU, wf) {
    let c_in_AUph = 173.145; // 1c in AU/hour
    return distanceAU / (warpSpeed(wf) * c_in_AUph);
}

// ==========================
// PANEL UPDATES
// ==========================
function updatePanels() {
    updateElement("warpFactorDisplay", warpFactor.toFixed(2));
    updateElement("warpTargetDisplay", warpTarget.toFixed(2));

    updateElement("distanceRemaining", distanceRemaining.toFixed(3));
    updateElement("lightMinutesDisplay", (distanceRemaining * 8.31675).toFixed(2));
    updateElement("lightHoursDisplay", (distanceRemaining * 0.1386125).toFixed(2));

    updateElement("headingDegrees", (Math.random() * 360).toFixed(0));
    updateElement("pitchDegrees", (Math.random() * 10 - 5).toFixed(2));
    updateElement("yawDegrees", (Math.random() * 10 - 5).toFixed(2));

    magField = magTarget + (Math.random() - 0.5) * 0.05;
    updateElement("magField", magField.toFixed(2));
    statusLight("magFieldStatus", Math.abs(magField - magTarget) <= 0.05 ? "green" : "red");

    pressure = pressureTarget + (Math.random() - 0.5) * 0.1;
    updateElement("enginePressure", pressure.toFixed(2));
    statusLight("enginePressureStatus", Math.abs(pressure - pressureTarget) <= 0.1 ? "green" : "red");

    updateElement("energyCoils", (warpFactor * 50).toFixed(0));
    updateElement("energyNav", (warpFactor * 10).toFixed(0));
    updateElement("energyShields", (warpFactor * 15).toFixed(0));
    updateElement("energyLife", 200);

    stabilityIndex = 100 - Math.random() * 2;
    updateElement("stabilityIndex", stabilityIndex.toFixed(2));
    statusLight("stabilityStatus", stabilityIndex >= 95 ? "green" : "yellow");

    updateElement("hullIntegrity", hullIntegrity.toFixed(2));
    updateElement("gravityBalance", (1 + (Math.random() - 0.5) * 0.01).toFixed(3));

    updateElement("crewTotal", crewTotal);
    updateElement("crewActive", crewActive);
    updateElement("crewMedical", crewMedical);
    statusLight("crewStatus", crewMedical === 0 ? "green" : "yellow");
}

// ==========================
// WARP CONTROL
// ==========================
function engageWarp(targetWF, targetAU) {
    if (warpEngaged) return;
    warpEngaged = true;
    warpTarget = targetWF;
    distanceRemaining = targetAU;

    magTarget = warpTarget * 0.5;
    pressureTarget = warpTarget * 1.2;

    let travelHours = travelTimeAU(distanceRemaining, warpTarget);
    arrivalTime = new Date(Date.now() + travelHours * 3600000);

    logStatus(`Warp engaged to ${targetAU} AU at Warp ${targetWF}`);
    if (soundOn) { humSound.pause(); warpSound.play(); }

    tripInterval = setInterval(() => {
        warpFactor = warpTarget + (Math.random() - 0.5) * 0.05;
        distanceRemaining -= warpSpeed(warpFactor) * 0.0001;
        if (distanceRemaining <= 0) {
            arriveWarp();
        }
        updatePanels();
        updateClocks();
        safetyCheck();
    }, 1000);
}

function arriveWarp() {
    clearInterval(tripInterval);
    warpEngaged = false;
    warpFactor = 0;
    distanceRemaining = 0;
    updatePanels();
    logStatus("Arrived at destination!");
    if (soundOn) { warpSound.pause(); arriveSound.play(); setTimeout(() => humSound.play(), 5000); }
}

function safetyCheck() {
    if (Math.abs(magField - magTarget) > 0.1 || Math.abs(pressure - pressureTarget) > 0.2 || stabilityIndex < 90) {
        logStatus("⚠ Safety limits exceeded — Warp disengaging!", true);
        arriveWarp();
    }
}

// ==========================
// INIT
// ==========================
updatePanels();
setInterval(updateClocks, 1000);
if (soundOn) humSound.play();

// Example: Auto-engage warp for testing
setTimeout(() => engageWarp(5, 20), 3000); // Warp 5 to 20 AU
</script>
<style>
body {
    background-color: #05080f;
    font-family: Arial, sans-serif;
    color: #eaf2ff;
    margin: 0;
    padding: 0;
}

#mainContainer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    grid-gap: 12px;
    padding: 12px;
}

/* Panel styling */
.panel {
    background-color: #0c1424;
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.7);
    border: 1px solid #3ad5ff;
}

.panel h2 {
    margin: 0 0 8px;
    font-size: 1.2em;
    color: #3ad5ff;
    text-shadow: 0 0 8px #3ad5ff;
}

/* Status light circle */
.status-light {
    display: inline-block;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: gray;
    margin-left: 6px;
    vertical-align: middle;
    box-shadow: 0 0 6px rgba(255,255,255,0.3);
}

/* Log box */
.log-box {
    height: 160px;
    overflow-y: auto;
    background: rgba(0,0,0,0.25);
    border: 1px solid #3ad5ff;
    padding: 6px;
    font-size: 0.95em;
}

/* Gauges & values */
.panel div {
    font-size: 1.05em;
    margin-bottom: 4px;
}

/* Canvas styling */
#tensorCanvas, #starfieldCanvas {
    display: block;
    background: black;
    margin-top: 4px;
    border: 1px solid #3ad5ff;
    border-radius: 4px;
}

/* Scrollbar styling for logs */
.log-box::-webkit-scrollbar {
    width: 8px;
}
.log-box::-webkit-scrollbar-thumb {
    background: #3ad5ff;
    border-radius: 4px;
}
</style>
</body>
</html>
