<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warp Drive Demo — CST Synced</title>
  <style>
    :root {
      --bg:#0d1117; --panel:#161b22; --accent:#59d; --accent2:#9cf; --text:#e6edf3; --muted:#94a3b8; --ok:#16a34a; --warn:#eab308; --bad:#ef4444;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1000px 800px at 20% -10%, #0a0f1a 0%, #0d1117 60%);color:var(--text);font:16px/1.4 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:16px 24px;border-bottom:1px solid #222}
    header h1{margin:0;font-size:20px;font-weight:700;letter-spacing:.5px}
    .container{display:grid;grid-template-columns: 320px 1fr 380px;gap:16px;padding:16px}
    .panel{background:var(--panel);border:1px solid #222;border-radius:16px;box-shadow:var(--shadow);padding:16px}
    .panel h2{margin:0 0 10px 0;font-size:15px;font-weight:700;color:var(--accent2);text-transform:uppercase;letter-spacing:.08em}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:13px}
    select,input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid #2a3340;background:#0f1420;color:var(--text)}
    .row{display:flex;gap:12px}
    .row > *{flex:1}
    button{cursor:pointer;border:1px solid #2a3340;background:linear-gradient(180deg,#1b2333,#141b28);color:var(--text);padding:12px 14px;border-radius:12px;font-weight:700;box-shadow:var(--shadow)}
    button.primary{border-color:#2b4ea3;background:linear-gradient(180deg,#2b4ea3,#1b2f66)}
    button.ghost{background:transparent}
    .metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:8px}
    .metric{background:#0f1420;border:1px solid #232a36;border-radius:12px;padding:10px;text-align:center}
    .metric .label{font-size:12px;color:var(--muted)}
    .metric .value{font-size:18px;font-weight:800;margin-top:4px}
    #log{height:260px;overflow:auto;background:#0a0f1a;border:1px dashed #2a3340;border-radius:10px;padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:12px}
    .grid-rows{display:grid;gap:16px}
    .map{height:340px;border-radius:12px;border:1px solid #232a36;background:radial-gradient(600px 300px at 20% 10%, rgba(88,122,255,.18), transparent 60%), linear-gradient(180deg,#0b0f19,#0a0e16)}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid #2a3340;background:#0f1420;color:var(--muted)}
    .badge.ok{color:#b7f7c1;border-color:#14532d;background:linear-gradient(180deg,#0c1b11,#0b1510)}
    .badge.warn{color:#fff0b4;border-color:#7a5c05;background:linear-gradient(180deg,#1b1709,#141004)}
    .badge.bad{color:#ffc4c4;border-color:#7a1f1f;background:linear-gradient(180deg,#1b0c0c,#140808)}
    .flex{display:flex;gap:10px;align-items:center}
    .right{justify-content:flex-end}
    footer{padding:12px 16px;color:var(--muted);font-size:12px;border-top:1px solid #222}
    .saved-tag{display:inline-block;background:#0f1420;border:1px solid #2a3340;border-radius:8px;padding:4px 8px;margin:4px;font-size:12px}

    /* Starfield video fills the map */
    #map video{width:100%;height:100%;display:block;object-fit:cover;border-radius:12px}

    /* Saved Missions scroll box (matches Status & Log) */
    #savedBox{
      height:260px;
      overflow-y:auto;
      background:#0a0f1a;
      border:1px dashed #2a3340;
      border-radius:10px;
      padding:10px;
    }
    #savedBox::-webkit-scrollbar { width: 10px; }
    #savedBox::-webkit-scrollbar-track { background:#0a0f1a; }
    #savedBox::-webkit-scrollbar-thumb { background:#2a3340; border-radius:8px; }
    #savedBox::-webkit-scrollbar-thumb:hover { background:#3a4558; }
    #savedBox{ scrollbar-color:#2a3340 #0a0f1a; scrollbar-width:thin; }
  </style>
</head>
<body>
  <header>
    <h1>Warp Drive Demonstrator · CST-Synced Equilibrium</h1>
    <div class="flex right">
      <span id="cstBadge" class="badge ok">CST Sync: <strong id="cstClock">--:--:--</strong></span>
      <span id="rhythmBadge" class="badge ok">Bio Rhythm: Stable</span>
    </div>
  </header>

  <main class="container">
    <!-- Left: Controls -->
    <section class="panel">
      <h2>Controls</h2>
      <label for="warp">Warp Factor (1–10)</label>
      <select id="warp">
        <option value="1">Warp 1</option>
        <option value="2">Warp 2</option>
        <option value="3">Warp 3</option>
        <option value="4">Warp 4</option>
        <option value="5" selected>Warp 5</option>
        <option value="6">Warp 6</option>
        <option value="7">Warp 7</option>
        <option value="8">Warp 8</option>
        <option value="9">Warp 9</option>
        <option value="10">Warp 10</option>
      </select>

      <div class="row">
        <div>
          <label for="class">Destination Class</label>
          <select id="class">
            <option value="planet" selected>Planet</option>
            <option value="moon">Moon</option>
            <option value="galaxy">Galaxy</option>
            <option value="star">Star</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div>
          <label for="target">Target Name</label>
          <input id="target" type="text" placeholder="e.g., Mars, Andromeda, Europa" />
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="engage" class="primary">Engage</button>
        <button id="save">Save Mission</button>
      </div>

      <div class="metrics">
        <div class="metric"><div class="label">Front (+E)</div><div id="frontE" class="value">0.00</div></div>
        <div class="metric"><div class="label">Mid (~0)</div><div id="midE" class="value">0.00</div></div>
        <div class="metric"><div class="label">Rear (−E)</div><div id="rearE" class="value">0.00</div></div>
      </div>

      <div style="margin-top:12px" class="flex">
        <button id="reset" class="ghost">Reset</button>
        <span id="persistBadge" class="badge">Not saved</span>
      </div>

      <!-- NEW: metrics-only reset button -->
      <div style="margin-top:8px" class="flex">
        <button id="resetMetrics" class="ghost">Reset Clock Metrics Only</button>
      </div>
    </section>

    <!-- Center: Visualization / Map -->
    <section class="panel grid-rows">
      <h2>Navigation Map (Concept)</h2>
      <div id="map" class="map">
        <!-- Starfield video background -->
        <video id="starVideo" src="./warp/starsmoving.mp4" autoplay loop muted playsinline></video>
      </div>
      <div class="row">
        <div class="metric"><div class="label">Bubble Velocity (eff.)</div><div id="vEff" class="value">0.00 c</div></div>
        <div class="metric"><div class="label">Pulse Rate</div><div id="pulse" class="value">0.0 MHz</div></div>
        <div class="metric"><div class="label">Loop η</div><div id="eta" class="value">0.000</div></div>
      </div>
    </section>

    <!-- Right: Logs / Saved -->
    <aside class="panel grid-rows">
      <h2>Status & Log</h2>
      <div id="log"></div>
      <h2>Saved Missions</h2>
      <div id="savedBox">
        <div id="saved"></div>
      </div>
    </aside>
  </main>

  <footer>
    Demo only. Timebase is locked to America/Chicago (CST/CDT) to illustrate circadian equilibrium while traveling. Selections persist via localStorage for GitHub Pages deployments.
  </footer>

  <script>
    // ---- Time: force CST/CDT display no matter user's locale ----
    const tz = 'America/Chicago';
    function cstNow(){ return new Date(); }
    function fmtCST(d){
      const f = new Intl.DateTimeFormat('en-US', { timeZone: tz, hour12:false, hour:'2-digit', minute:'2-digit', second:'2-digit'});
      return f.format(d);
    }

    const cstClockEl = document.getElementById('cstClock');
    setInterval(()=>{
      const d = cstNow();
      cstClockEl.textContent = fmtCST(d) + (new Intl.DateTimeFormat('en-US',{timeZoneName:'short', timeZone:tz}).formatToParts(d).find(p=>p.type==='timeZoneName')?.value.replace('GMT','')||'');
    }, 250);

    // ---- UI elements ----
    const warpSel = document.getElementById('warp');
    const classSel = document.getElementById('class');
    const targetInput = document.getElementById('target');
    const engageBtn = document.getElementById('engage');
    const saveBtn = document.getElementById('save');
    const resetBtn = document.getElementById('reset');
    const resetMetricsBtn = document.getElementById('resetMetrics');
    const frontE = document.getElementById('frontE');
    const midE = document.getElementById('midE');
    const rearE = document.getElementById('rearE');
    const vEff = document.getElementById('vEff');
    const pulse = document.getElementById('pulse');
    const eta = document.getElementById('eta');
    const logEl = document.getElementById('log');
    const savedEl = document.getElementById('saved');
    const persistBadge = document.getElementById('persistBadge');
    const rhythmBadge = document.getElementById('rhythmBadge');

    // ---- Persistence (localStorage) ----
    const KEY = 'warp-demo:saves';
    function loadSaves(){ try { return JSON.parse(localStorage.getItem(KEY))||[] } catch(e){ return [] } }
    function saveSaves(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

    function renderSaves(){
      const arr = loadSaves();
      savedEl.innerHTML = arr.length? '' : '<span class="muted">No saved missions yet.</span>';
      arr.forEach((m,i)=>{
        const tag = document.createElement('div');
        tag.className='saved-tag';
        tag.textContent = `#${i+1} · ${m.when} CST · Warp ${m.warp} → ${m.class}:${m.target}`;
        tag.title = 'Click to load';
        tag.onclick = ()=>{
          warpSel.value = m.warp;
          classSel.value = m.class;
          targetInput.value = m.target;
          log(`Loaded mission #${i+1}`);
          clearEngaged();
        };
        savedEl.appendChild(tag);
      });
      persistBadge.textContent = arr.length? 'Saved ✓' : 'Not saved';
    }

    // ---- Metrics tied to warp ----
    function updateMetrics(){
      const w = Number(warpSel.value);
      const plus = (w*0.11).toFixed(2);
      const minus = (-w*0.11).toFixed(2);
      const mid = (0).toFixed(2);
      frontE.textContent = plus;
      rearE.textContent = minus;
      midE.textContent = mid;
      vEff.textContent = (Math.min(0.2*w + 0.1*w*w/10, 10)).toFixed(2) + ' c';
      pulse.textContent = (w*0.5).toFixed(1) + ' MHz';
      eta.textContent = (0.995 + w*0.0004).toFixed(3);

      rhythmBadge.className = 'badge ok';
      rhythmBadge.textContent = 'Bio Rhythm: CST-Locked';
    }

    // Zero-out metrics only
    function zeroMetrics(){
      frontE.textContent = "0.00";
      midE.textContent   = "0.00";
      rearE.textContent  = "0.00";
      vEff.textContent   = "0.00 c";
      pulse.textContent  = "0.0 MHz";
      eta.textContent    = "0.000";
    }

    function log(msg){
      const ts = fmtCST(new Date());
      logEl.insertAdjacentHTML('afterbegin', `[${ts}] ${msg}<br/>`);
    }

    // ---- Starfield video rate tied to Warp ----
    const starVideo = document.getElementById('starVideo');
    function updateVideoRate(){
      const w = Number(warpSel.value);
      const rate = 0.5 + (w-1) * ((3.0 - 0.5) / 9); // Warp 1..10 => 0.5x..3.0x
      starVideo.playbackRate = rate;
      starVideo.style.animation = 'none'; // ensure map never moves
    }
    starVideo.addEventListener('canplay', ()=> { starVideo.play().catch(()=>{}); });

    // ---- Require Engage before Save ----
    let engagedState = null; // {warp, class, target, when}
    function clearEngaged(){ engagedState = null; }
    function currentState(){
      return {
        warp: warpSel.value,
        class: classSel.value,
        target: targetInput.value || '(unspecified)'
      };
    }
    warpSel.addEventListener('change', clearEngaged);
    classSel.addEventListener('change', clearEngaged);
    targetInput.addEventListener('input', clearEngaged);

    // ---- Actions ----
    engageBtn.onclick = ()=>{
      updateMetrics();
      updateVideoRate();
      engagedState = { ...currentState(), when: new Intl.DateTimeFormat('en-US', { timeZone: tz, dateStyle:'medium', timeStyle:'medium' }).format(new Date()) };
      log(`ENGAGE → Warp ${engagedState.warp} to ${engagedState.class}:${engagedState.target}`);
    };

    saveBtn.onclick = ()=>{
      const nowState = currentState();
      if(!engagedState || engagedState.warp !== nowState.warp || engagedState.class !== nowState.class || engagedState.target !== nowState.target){
        log('Save blocked: please click ENGAGE first for the current settings.');
        return;
      }
      const arr = loadSaves();
      const m = {
        ...engagedState,
        when: new Intl.DateTimeFormat('en-US', { timeZone: tz, dateStyle:'medium', timeStyle:'short' }).format(new Date())
      };
      arr.unshift(m);
      saveSaves(arr.slice(0,25));
      renderSaves();
      log('Mission saved.');
    };

    // Reset: warp→1, clear target, clear log, clear saved missions, refresh metrics/video, clear engaged
    resetBtn.onclick = ()=>{
      localStorage.removeItem(KEY);
      renderSaves();
      warpSel.value = "1";
      targetInput.value = "";
      logEl.innerHTML = "";
      clearEngaged();
      updateMetrics();
      updateVideoRate();
    };

    // NEW: Reset Clock Metrics Only (zero the readouts, nothing else)
    resetMetricsBtn.onclick = ()=>{
      zeroMetrics();
      log('Metrics reset to zero.');
    };

    // Update video speed immediately when warp changes
    warpSel.addEventListener('change', updateVideoRate);

    // init
    renderSaves();
    updateMetrics();
    updateVideoRate();
    log('System initialized. CST sync engaged.');
  </script>
</body>
</html>
