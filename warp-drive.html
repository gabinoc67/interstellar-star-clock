<script>
  const planets = {
    Mercury: { distance: 56974000, angle: 30 },
    Venus: { distance: 25000000, angle: 60 },
    Mars: { distance: 140000000, angle: 120 },
    Pluto: { distance: 4670000000, angle: 160 }
  };

  const speedOfLight = 186282; // miles/sec

  let ship;
  let animationId;

  function simulateTravel() {
    const svg = document.getElementById("warpPath");
    const info = document.getElementById("travelInfo");
    const planetName = document.getElementById("planetSelect").value;
    const warpFactor = parseInt(document.getElementById("warpSpeed").value);
    const { distance, angle } = planets[planetName];
    const speed = speedOfLight * Math.pow(warpFactor, 2.5); // Sci-fi speed scaling

    const timeSec = distance / speed;
    const timeMin = (timeSec / 60).toFixed(2);
    const timeHr = (timeSec / 3600).toFixed(2);

    // Clear previous
    while (svg.children.length > 2) svg.removeChild(svg.lastChild);
    cancelAnimationFrame(animationId);

    const rad = angle * (Math.PI / 180);
    const x = 100 + 400 * Math.cos(rad);
    const y = 300 - 200 * Math.sin(rad);

    const arcMidX = (100 + x) / 2;
    const arcMidY = (300 + y) / 2 - (200 / warpFactor); // curve flattens with speed

    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    const pathId = "travelPath";
    path.setAttribute("id", pathId);
    path.setAttribute("d", `M100,300 Q${arcMidX},${arcMidY} ${x},${y}`);
    path.setAttribute("stroke", "lime");
    path.setAttribute("fill", "none");
    path.setAttribute("stroke-width", "3");
    svg.appendChild(path);

    const planet = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    planet.setAttribute("cx", x);
    planet.setAttribute("cy", y);
    planet.setAttribute("r", "10");
    planet.setAttribute("fill", "orange");
    svg.appendChild(planet);

    const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
    label.setAttribute("x", x - 20);
    label.setAttribute("y", y + 20);
    label.setAttribute("fill", "white");
    label.textContent = planetName;
    svg.appendChild(label);

    // Ship animation dot
    ship = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    ship.setAttribute("r", "6");
    ship.setAttribute("fill", "cyan");
    svg.appendChild(ship);

    const pathElement = path;
    const pathLength = pathElement.getTotalLength();
    let progress = 0;

    // Adjust speed visually based on warp factor
    const frames = Math.max(60, 600 / Math.pow(warpFactor, 1.5));
    const increment = pathLength / frames;

    function animate() {
      const point = pathElement.getPointAtLength(progress);
      ship.setAttribute("cx", point.x);
      ship.setAttribute("cy", point.y);
      progress += increment;
      if (progress < pathLength) {
        animationId = requestAnimationFrame(animate);
      }
    }
    animate();

    info.innerHTML = `
      <strong>ü™ê Destination:</strong> ${planetName}<br>
      <strong>Distance:</strong> ${distance.toLocaleString()} miles<br>
      <strong>Warp Factor:</strong> ${warpFactor}<br>
      <strong>Speed:</strong> ${(speed / speedOfLight).toFixed(2)}x light speed<br>
      <strong>Time in Warp:</strong> ${timeSec.toFixed(2)} sec / ${timeMin} min / ${timeHr} hr<br><br>
      <strong>üïí Clocks at Arrival:</strong><br>
      ‚Ä¢ Local Planet Time (Scaled)<br>
      ‚Ä¢ Earth CST Time (Reference)<br>
      ‚Ä¢ Interstellar Time (Jan 1, 2000+)<br>
      ‚Ä¢ Star Date (Calculated Approx.)
    `;
  }
</script>
